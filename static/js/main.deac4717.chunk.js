(this.webpackJsonprepoviewrreact=this.webpackJsonprepoviewrreact||[]).push([[0],{170:function(e,n,t){e.exports=t(299)},175:function(e,n,t){},177:function(e,n,t){},179:function(e){e.exports=JSON.parse('[{"date":"Aug 13th 20","parents":[{"sha":"dab0854c5e66ca74ca0591fd312d6a654e5aaaf1","url":"https://api.github.com/repos/facebook/react/commits/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1","html_url":"https://github.com/facebook/react/commit/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1"}],"author":"captbaritone","files":[{"sha":"26cda5e2908752d95b29cda831fff2744e79ffc0","filename":"packages/eslint-plugin-react-hooks/__tests__/ESLintRuleExhaustiveDeps-test.js","status":"modified","additions":617,"deletions":48,"changes":665,"blob_url":"https://github.com/facebook/react/blob/1d5e10f7035f0d3bcbffcd057a15940b1a20b164/packages/eslint-plugin-react-hooks/__tests__/ESLintRuleExhaustiveDeps-test.js","raw_url":"https://github.com/facebook/react/raw/1d5e10f7035f0d3bcbffcd057a15940b1a20b164/packages/eslint-plugin-react-hooks/__tests__/ESLintRuleExhaustiveDeps-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/eslint-plugin-react-hooks/__tests__/ESLintRuleExhaustiveDeps-test.js?ref=1d5e10f7035f0d3bcbffcd057a15940b1a20b164","patch":"@@ -56,7 +56,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(local);\\n           }, [local]);\\n@@ -94,9 +94,9 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local1 = {};\\n+          const local1 = someFunc();\\n           {\\n-            const local2 = {};\\n+            const local2 = someFunc();\\n             useCallback(() => {\\n               console.log(local1);\\n               console.log(local2);\\n@@ -108,9 +108,9 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local1 = {};\\n+          const local1 = someFunc();\\n           function MyNestedComponent() {\\n-            const local2 = {};\\n+            const local2 = someFunc();\\n             useCallback(() => {\\n               console.log(local1);\\n               console.log(local2);\\n@@ -122,7 +122,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(local);\\n             console.log(local);\\n@@ -142,7 +142,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(local);\\n           }, [,,,local,,,]);\\n@@ -222,7 +222,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent(props) {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(props.foo);\\n             console.log(props.bar);\\n@@ -243,7 +243,7 @@ const tests = {\\n             console.log(props.bar);\\n           }, [props, props.foo]);\\n \\n-          let color = {}\\n+          let color = someFunc();\\n           useEffect(() => {\\n             console.log(props.foo.bar.baz);\\n             console.log(color);\\n@@ -416,7 +416,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           function myEffect() {\\n             console.log(local);\\n           }\\n@@ -731,7 +731,7 @@ const tests = {\\n       // direct assignments.\\n       code: normalizeIndent`\\n         function MyComponent(props) {\\n-          let obj = {};\\n+          let obj = someFunc();\\n           useEffect(() => {\\n             obj.foo = true;\\n           }, [obj]);\\n@@ -1376,6 +1376,64 @@ const tests = {\\n         }\\n       `,\\n     },\\n+    {\\n+      code: normalizeIndent`\\n+        function useFoo(foo){\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function useFoo(){\\n+          const foo = \\"hi!\\";\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function useFoo(){\\n+          let {foo} = {foo: 1};\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function useFoo(){\\n+          let [foo] = [1];\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function useFoo() {\\n+          const foo = \\"fine\\";\\n+          if (true) {\\n+            // Shadowed variable with constant construction in a nested scope is fine.\\n+            const foo = {};\\n+          }\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function MyComponent({foo}) {\\n+          return useMemo(() => foo, [foo])\\n+        }\\n+      `,\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function MyComponent() {\\n+          const foo = true ? \\"fine\\" : \\"also fine\\";\\n+          return useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+    },\\n   ],\\n   invalid: [\\n     {\\n@@ -1494,7 +1552,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(local);\\n           }, []);\\n@@ -1510,7 +1568,7 @@ const tests = {\\n               desc: \'Update the dependencies array to be: [local]\',\\n               output: normalizeIndent`\\n                 function MyComponent() {\\n-                  const local = {};\\n+                  const local = someFunc();\\n                   useEffect(() => {\\n                     console.log(local);\\n                   }, [local]);\\n@@ -1636,7 +1694,7 @@ const tests = {\\n       // Regression test\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             if (true) {\\n               console.log(local);\\n@@ -1654,7 +1712,7 @@ const tests = {\\n               desc: \'Update the dependencies array to be: [local]\',\\n               output: normalizeIndent`\\n                 function MyComponent() {\\n-                  const local = {};\\n+                  const local = someFunc();\\n                   useEffect(() => {\\n                     if (true) {\\n                       console.log(local);\\n@@ -1742,9 +1800,9 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local1 = {};\\n+          const local1 = someFunc();\\n           {\\n-            const local2 = {};\\n+            const local2 = someFunc();\\n             useEffect(() => {\\n               console.log(local1);\\n               console.log(local2);\\n@@ -1762,9 +1820,9 @@ const tests = {\\n               desc: \'Update the dependencies array to be: [local1, local2]\',\\n               output: normalizeIndent`\\n                 function MyComponent() {\\n-                  const local1 = {};\\n+                  const local1 = someFunc();\\n                   {\\n-                    const local2 = {};\\n+                    const local2 = someFunc();\\n                     useEffect(() => {\\n                       console.log(local1);\\n                       console.log(local2);\\n@@ -1846,7 +1904,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local1 = {};\\n+          const local1 = someFunc();\\n           function MyNestedComponent() {\\n             const local2 = {};\\n             useCallback(() => {\\n@@ -1868,7 +1926,7 @@ const tests = {\\n               desc: \'Update the dependencies array to be: [local2]\',\\n               output: normalizeIndent`\\n                 function MyComponent() {\\n-                  const local1 = {};\\n+                  const local1 = someFunc();\\n                   function MyNestedComponent() {\\n                     const local2 = {};\\n                     useCallback(() => {\\n@@ -2295,7 +2353,7 @@ const tests = {\\n     {\\n       code: normalizeIndent`\\n         function MyComponent() {\\n-          const local = {};\\n+          const local = someFunc();\\n           useEffect(() => {\\n             console.log(local);\\n           }, [local, ...dependencies]);\\n@@ -5311,7 +5369,7 @@ const tests = {\\n             `The \'handleNext\' function makes the dependencies of ` +\\n             `useEffect Hook (at line 11) change on every render. ` +\\n             `Move it inside the useEffect callback. Alternatively, ` +\\n-            `wrap the \'handleNext\' definition into its own useCallback() Hook.`,\\n+            `wrap the definition of \'handleNext\' in its own useCallback() Hook.`,\\n           // Not gonna fix a function definition\\n           // because it\'s not always safe due to hoisting.\\n           suggestions: undefined,\\n@@ -5340,7 +5398,7 @@ const tests = {\\n             `The \'handleNext\' function makes the dependencies of ` +\\n             `useEffect Hook (at line 11) change on every render. ` +\\n             `Move it inside the useEffect callback. Alternatively, ` +\\n-            `wrap the \'handleNext\' definition into its own useCallback() Hook.`,\\n+            `wrap the definition of \'handleNext\' in its own useCallback() Hook.`,\\n           // We don\'t fix moving (too invasive). But that\'s the suggested fix\\n           // when only effect uses this function. Otherwise, we\'d useCallback.\\n           suggestions: undefined,\\n@@ -5373,13 +5431,13 @@ const tests = {\\n           message:\\n             `The \'handleNext\' function makes the dependencies of ` +\\n             `useEffect Hook (at line 11) change on every render. ` +\\n-            `To fix this, wrap the \'handleNext\' definition into its own useCallback() Hook.`,\\n+            `To fix this, wrap the definition of \'handleNext\' in its own useCallback() Hook.`,\\n           // We fix this one with useCallback since it\'s\\n           // the easy fix and you can\'t just move it into effect.\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   let [, setState] = useState();\\n@@ -5428,21 +5486,21 @@ const tests = {\\n           message:\\n             \\"The \'handleNext1\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 14) change on every render. Move it inside the useEffect callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext1\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext2\' function makes the dependencies of useLayoutEffect Hook \\" +\\n             \'(at line 17) change on every render. Move it inside the useLayoutEffect callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext2\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext3\' function makes the dependencies of useMemo Hook \\" +\\n             \'(at line 20) change on every render. Move it inside the useMemo callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext3\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext3\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n       ],\\n@@ -5480,21 +5538,21 @@ const tests = {\\n           message:\\n             \\"The \'handleNext1\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 15) change on every render. Move it inside the useEffect callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext1\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext2\' function makes the dependencies of useLayoutEffect Hook \\" +\\n             \'(at line 19) change on every render. Move it inside the useLayoutEffect callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext2\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext3\' function makes the dependencies of useMemo Hook \\" +\\n             \'(at line 23) change on every render. Move it inside the useMemo callback. \' +\\n-            \\"Alternatively, wrap the \'handleNext3\' definition into its own useCallback() Hook.\\",\\n+            \\"Alternatively, wrap the definition of \'handleNext3\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n       ],\\n@@ -5541,20 +5599,20 @@ const tests = {\\n           message:\\n             \\"The \'handleNext1\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 15) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext1\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext2\' function makes the dependencies of useLayoutEffect Hook \\" +\\n             \'(at line 19) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext2\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n           // Suggestion wraps into useCallback where possible (variables only)\\n           // because they are only referenced outside the effect.\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext2\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   function handleNext1() {\\n@@ -5598,13 +5656,13 @@ const tests = {\\n           message:\\n             \\"The \'handleNext3\' function makes the dependencies of useMemo Hook \\" +\\n             \'(at line 23) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext3\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext3\' in its own useCallback() Hook.\\",\\n           // Autofix wraps into useCallback where possible (variables only)\\n           // because they are only referenced outside the effect.\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext3\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext3\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   function handleNext1() {\\n@@ -5675,11 +5733,11 @@ const tests = {\\n           message:\\n             \\"The \'handleNext1\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 12) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext1\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext1\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   const handleNext1 = useCallback(() => {\\n@@ -5705,11 +5763,11 @@ const tests = {\\n           message:\\n             \\"The \'handleNext1\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 16) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext1\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext1\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext1\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   const handleNext1 = useCallback(() => {\\n@@ -5735,14 +5793,14 @@ const tests = {\\n           message:\\n             \\"The \'handleNext2\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 12) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext2\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n         {\\n           message:\\n             \\"The \'handleNext2\' function makes the dependencies of useEffect Hook \\" +\\n             \'(at line 16) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext2\' definition into its own useCallback() Hook.\\",\\n+            \\"definition of \'handleNext2\' in its own useCallback() Hook.\\",\\n           suggestions: undefined,\\n         },\\n       ],\\n@@ -5767,16 +5825,16 @@ const tests = {\\n         {\\n           message:\\n             \\"The \'handleNext\' function makes the dependencies of useEffect Hook \\" +\\n-            \'(at line 13) change on every render. To fix this, wrap the \' +\\n-            \\"\'handleNext\' definition into its own useCallback() Hook.\\",\\n+            \'(at line 13) change on every render. To fix this, wrap the definition of \' +\\n+            \\"\'handleNext\' in its own useCallback() Hook.\\",\\n           // Normally we\'d suggest moving handleNext inside an\\n           // effect. But it\'s used more than once.\\n           // TODO: our autofix here isn\'t quite sufficient because\\n           // it only wraps the first definition. But seems ok.\\n           suggestions: [\\n             {\\n               desc:\\n-                \\"Wrap the \'handleNext\' definition into its own useCallback() Hook.\\",\\n+                \\"Wrap the definition of \'handleNext\' in its own useCallback() Hook.\\",\\n               output: normalizeIndent`\\n                 function MyComponent(props) {\\n                   let handleNext = useCallback(() => {\\n@@ -5820,7 +5878,7 @@ const tests = {\\n             `The \'handleNext\' function makes the dependencies of ` +\\n             `useEffect Hook (at line 14) change on every render. ` +\\n             `Move it inside the useEffect callback. Alternatively, wrap the ` +\\n-            `\'handleNext\' definition into its own useCallback() Hook.`,\\n+            `definition of \'handleNext\' in its own useCallback() Hook.`,\\n           suggestions: undefined,\\n         },\\n       ],\\n@@ -6085,7 +6143,7 @@ const tests = {\\n           message:\\n             `The \'increment\' function makes the dependencies of useEffect Hook ` +\\n             `(at line 14) change on every render. Move it inside the useEffect callback. ` +\\n-            `Alternatively, wrap the \\\\\'increment\\\\\' definition into its own ` +\\n+            `Alternatively, wrap the definition of \\\\\'increment\\\\\' in its own ` +\\n             `useCallback() Hook.`,\\n           suggestions: undefined,\\n         },\\n@@ -6967,6 +7025,499 @@ const tests = {\\n         },\\n       ],\\n     },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = [];\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' array makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = () => {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' function makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the definition of \'foo\' in its own \\" +\\n+            \'useCallback() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = function bar(){};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' function makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the definition of \'foo\' in its own \\" +\\n+            \'useCallback() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = class {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' class makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = true ? {} : \\"fine\\";\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' conditional could make the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = bar || {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' logical expression could make the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = bar ?? {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' logical expression could make the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = bar && {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' logical expression could make the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = bar ? baz ? {} : null : null;\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' conditional could make the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          let foo = {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          var foo = {};\\n+          useMemo(() => foo, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 4) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = {};\\n+          useCallback(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useCallback Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useCallback callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = {};\\n+          useEffect(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useEffect Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useEffect callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = {};\\n+          useLayoutEffect(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useLayoutEffect Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useLayoutEffect callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Component() {\\n+          const foo = {};\\n+          useImperativeHandle(\\n+            ref,\\n+            () => {\\n+               console.log(foo);\\n+            },\\n+            [foo]\\n+          );\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useImperativeHandle Hook (at line 9) change on every render. \\" +\\n+            \\"Move it inside the useImperativeHandle callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo(section) {\\n+          const foo = section.section_components?.edges ?? [];\\n+          useEffect(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' logical expression could make the dependencies of useEffect Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useEffect callback. Alternatively, wrap the initialization of \'foo\' in its own \\" +\\n+            \'useMemo() Hook.\',\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo(section) {\\n+          const foo = {};\\n+          console.log(foo);\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 7) change on every render. \\" +\\n+            \\"To fix this, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = <>Hi!</>;\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' JSX fragment makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = <div>Hi!</div>;\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' JSX element makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = bar = {};\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' assignment expression makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = new String(\'foo\'); // Note \'foo\' will be boxed, and thus an object and thus compared by reference.\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object construction makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = new Map([]);\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object construction makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = /reg/;\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' regular expression makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = ({}: any);\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          class Bar {};\\n+          useMemo(() => {\\n+            console.log(new Bar());\\n+          }, [Bar]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'Bar\' class makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'Bar\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = {};\\n+          useLayoutEffect(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+          useEffect(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useLayoutEffect Hook (at line 6) change on every render. \\" +\\n+            \\"To fix this, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useEffect Hook (at line 9) change on every render. \\" +\\n+            \\"To fix this, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n   ],\\n };\\n \\n@@ -7345,6 +7896,24 @@ const testsTypescript = {\\n         },\\n       ],\\n     },\\n+    {\\n+      code: normalizeIndent`\\n+        function Foo() {\\n+          const foo = {} as any;\\n+          useMemo(() => {\\n+            console.log(foo);\\n+          }, [foo]);\\n+        }\\n+      `,\\n+      errors: [\\n+        {\\n+          message:\\n+            \\"The \'foo\' object makes the dependencies of useMemo Hook (at line 6) change on every render. \\" +\\n+            \\"Move it inside the useMemo callback. Alternatively, wrap the initialization of \'foo\' in its own useMemo() Hook.\\",\\n+          suggestions: undefined,\\n+        },\\n+      ],\\n+    },\\n   ],\\n };\\n "},{"sha":"ab552c305a4db2243a016aa33dd581837b4db2a0","filename":"packages/eslint-plugin-react-hooks/src/ExhaustiveDeps.js","status":"modified","additions":156,"deletions":68,"changes":224,"blob_url":"https://github.com/facebook/react/blob/1d5e10f7035f0d3bcbffcd057a15940b1a20b164/packages/eslint-plugin-react-hooks/src/ExhaustiveDeps.js","raw_url":"https://github.com/facebook/react/raw/1d5e10f7035f0d3bcbffcd057a15940b1a20b164/packages/eslint-plugin-react-hooks/src/ExhaustiveDeps.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/eslint-plugin-react-hooks/src/ExhaustiveDeps.js?ref=1d5e10f7035f0d3bcbffcd057a15940b1a20b164","patch":"@@ -844,59 +844,80 @@ export default {\\n         unnecessaryDependencies.size;\\n \\n       if (problemCount === 0) {\\n-        // If nothing else to report, check if some callbacks\\n-        // are bare and would invalidate on every render.\\n-        const bareFunctions = scanForDeclaredBareFunctions({\\n+        // If nothing else to report, check if some dependencies would\\n+        // invalidate on every render.\\n+        const constructions = scanForConstructions({\\n           declaredDependencies,\\n           declaredDependenciesNode,\\n           componentScope,\\n           scope,\\n         });\\n-        bareFunctions.forEach(({fn, suggestUseCallback}) => {\\n-          let message =\\n-            `The \'${fn.name.name}\' function makes the dependencies of ` +\\n-            `${reactiveHookName} Hook (at line ${declaredDependenciesNode.loc.start.line}) ` +\\n-            `change on every render.`;\\n-          if (suggestUseCallback) {\\n-            message +=\\n-              ` To fix this, ` +\\n-              `wrap the \'${fn.name.name}\' definition into its own useCallback() Hook.`;\\n-          } else {\\n-            message +=\\n-              ` Move it inside the ${reactiveHookName} callback. ` +\\n-              `Alternatively, wrap the \'${fn.name.name}\' definition into its own useCallback() Hook.`;\\n-          }\\n+        constructions.forEach(\\n+          ({construction, isUsedOutsideOfHook, depType}) => {\\n+            const wrapperHook =\\n+              depType === \'function\' ? \'useCallback\' : \'useMemo\';\\n \\n-          let suggest;\\n-          // Only handle the simple case: arrow functions.\\n-          // Wrapping function declarations can mess up hoisting.\\n-          if (suggestUseCallback && fn.type === \'Variable\') {\\n-            suggest = [\\n-              {\\n-                desc: `Wrap the \'${fn.name.name}\' definition into its own useCallback() Hook.`,\\n-                fix(fixer) {\\n-                  return [\\n-                    // TODO: also add an import?\\n-                    fixer.insertTextBefore(fn.node.init, \'useCallback(\'),\\n-                    // TODO: ideally we\'d gather deps here but it would require\\n-                    // restructuring the rule code. This will cause a new lint\\n-                    // error to appear immediately for useCallback. Note we\'re\\n-                    // not adding [] because would that changes semantics.\\n-                    fixer.insertTextAfter(fn.node.init, \')\'),\\n-                  ];\\n+            const constructionType =\\n+              depType === \'function\' ? \'definition\' : \'initialization\';\\n+\\n+            const defaultAdvice = `wrap the ${constructionType} of \'${construction.name.name}\' in its own ${wrapperHook}() Hook.`;\\n+\\n+            const advice = isUsedOutsideOfHook\\n+              ? `To fix this, ${defaultAdvice}`\\n+              : `Move it inside the ${reactiveHookName} callback. Alternatively, ${defaultAdvice}`;\\n+\\n+            const causation =\\n+              depType === \'conditional\' || depType === \'logical expression\'\\n+                ? \'could make\'\\n+                : \'makes\';\\n+\\n+            const message =\\n+              `The \'${construction.name.name}\' ${depType} ${causation} the dependencies of ` +\\n+              `${reactiveHookName} Hook (at line ${declaredDependenciesNode.loc.start.line}) ` +\\n+              `change on every render. ${advice}`;\\n+\\n+            let suggest;\\n+            // Only handle the simple case of variable assignments.\\n+            // Wrapping function declarations can mess up hoisting.\\n+            if (\\n+              isUsedOutsideOfHook &&\\n+              construction.type === \'Variable\' &&\\n+              // Objects may be mutated ater construction, which would make this\\n+              // fix unsafe. Functions _probably_ won\'t be mutated, so we\'ll\\n+              // allow this fix for them.\\n+              depType === \'function\'\\n+            ) {\\n+              suggest = [\\n+                {\\n+                  desc: `Wrap the ${constructionType} of \'${construction.name.name}\' in its own ${wrapperHook}() Hook.`,\\n+                  fix(fixer) {\\n+                    const [before, after] =\\n+                      wrapperHook === \'useMemo\'\\n+                        ? [`useMemo(() => { return `, \'; })\']\\n+                        : [\'useCallback(\', \')\'];\\n+                    return [\\n+                      // TODO: also add an import?\\n+                      fixer.insertTextBefore(construction.node.init, before),\\n+                      // TODO: ideally we\'d gather deps here but it would require\\n+                      // restructuring the rule code. This will cause a new lint\\n+                      // error to appear immediately for useCallback. Note we\'re\\n+                      // not adding [] because would that changes semantics.\\n+                      fixer.insertTextAfter(construction.node.init, after),\\n+                    ];\\n+                  },\\n                 },\\n-              },\\n-            ];\\n-          }\\n-          // TODO: What if the function needs to change on every render anyway?\\n-          // Should we suggest removing effect deps as an appropriate fix too?\\n-          reportProblem({\\n-            // TODO: Why not report this at the dependency site?\\n-            node: fn.node,\\n-            message,\\n-            suggest,\\n-          });\\n-        });\\n+              ];\\n+            }\\n+            // TODO: What if the function needs to change on every render anyway?\\n+            // Should we suggest removing effect deps as an appropriate fix too?\\n+            reportProblem({\\n+              // TODO: Why not report this at the dependency site?\\n+              node: construction.node,\\n+              message,\\n+              suggest,\\n+            });\\n+          },\\n+        );\\n         return;\\n       }\\n \\n@@ -1381,50 +1402,116 @@ function collectRecommendations({\\n   };\\n }\\n \\n-// Finds functions declared as dependencies\\n+// If the node will result in constructing a referentially unique value, return\\n+// its human readable type name, else return null.\\n+function getConstructionExpressionType(node) {\\n+  switch (node.type) {\\n+    case \'ObjectExpression\':\\n+      return \'object\';\\n+    case \'ArrayExpression\':\\n+      return \'array\';\\n+    case \'ArrowFunctionExpression\':\\n+    case \'FunctionExpression\':\\n+      return \'function\';\\n+    case \'ClassExpression\':\\n+      return \'class\';\\n+    case \'ConditionalExpression\':\\n+      if (\\n+        getConstructionExpressionType(node.consequent) != null ||\\n+        getConstructionExpressionType(node.alternate) != null\\n+      ) {\\n+        return \'conditional\';\\n+      }\\n+      return null;\\n+    case \'LogicalExpression\':\\n+      if (\\n+        getConstructionExpressionType(node.left) != null ||\\n+        getConstructionExpressionType(node.right) != null\\n+      ) {\\n+        return \'logical expression\';\\n+      }\\n+      return null;\\n+    case \'JSXFragment\':\\n+      return \'JSX fragment\';\\n+    case \'JSXElement\':\\n+      return \'JSX element\';\\n+    case \'AssignmentExpression\':\\n+      if (getConstructionExpressionType(node.right) != null) {\\n+        return \'assignment expression\';\\n+      }\\n+      return null;\\n+    case \'NewExpression\':\\n+      return \'object construction\';\\n+    case \'Literal\':\\n+      if (node.value instanceof RegExp) {\\n+        return \'regular expression\';\\n+      }\\n+      return null;\\n+    case \'TypeCastExpression\':\\n+      return getConstructionExpressionType(node.expression);\\n+    case \'TSAsExpression\':\\n+      return getConstructionExpressionType(node.expression);\\n+  }\\n+  return null;\\n+}\\n+\\n+// Finds variables declared as dependencies\\n // that would invalidate on every render.\\n-function scanForDeclaredBareFunctions({\\n+function scanForConstructions({\\n   declaredDependencies,\\n   declaredDependenciesNode,\\n   componentScope,\\n   scope,\\n }) {\\n-  const bareFunctions = declaredDependencies\\n+  const constructions = declaredDependencies\\n     .map(({key}) => {\\n-      const fnRef = componentScope.set.get(key);\\n-      if (fnRef == null) {\\n+      const ref = componentScope.variables.find(v => v.name === key);\\n+      if (ref == null) {\\n         return null;\\n       }\\n-      const fnNode = fnRef.defs[0];\\n-      if (fnNode == null) {\\n+\\n+      const node = ref.defs[0];\\n+      if (node == null) {\\n         return null;\\n       }\\n       // const handleChange = function () {}\\n       // const handleChange = () => {}\\n+      // const foo = {}\\n+      // const foo = []\\n+      // etc.\\n       if (\\n-        fnNode.type === \'Variable\' &&\\n-        fnNode.node.type === \'VariableDeclarator\' &&\\n-        fnNode.node.init != null &&\\n-        (fnNode.node.init.type === \'ArrowFunctionExpression\' ||\\n-          fnNode.node.init.type === \'FunctionExpression\')\\n+        node.type === \'Variable\' &&\\n+        node.node.type === \'VariableDeclarator\' &&\\n+        node.node.id.type === \'Identifier\' && // Ensure this is not destructed assignment\\n+        node.node.init != null\\n       ) {\\n-        return fnRef;\\n+        const constantExpressionType = getConstructionExpressionType(\\n+          node.node.init,\\n+        );\\n+        if (constantExpressionType != null) {\\n+          return [ref, constantExpressionType];\\n+        }\\n       }\\n       // function handleChange() {}\\n       if (\\n-        fnNode.type === \'FunctionName\' &&\\n-        fnNode.node.type === \'FunctionDeclaration\'\\n+        node.type === \'FunctionName\' &&\\n+        node.node.type === \'FunctionDeclaration\'\\n       ) {\\n-        return fnRef;\\n+        return [ref, \'function\'];\\n+      }\\n+\\n+      // class Foo {}\\n+      if (node.type === \'ClassName\' && node.node.type === \'ClassDeclaration\') {\\n+        return [ref, \'class\'];\\n       }\\n       return null;\\n     })\\n     .filter(Boolean);\\n \\n-  function isUsedOutsideOfHook(fnRef) {\\n+  function isUsedOutsideOfHook(ref) {\\n     let foundWriteExpr = false;\\n-    for (let i = 0; i < fnRef.references.length; i++) {\\n-      const reference = fnRef.references[i];\\n+    for (let i = 0; i < ref.references.length; i++) {\\n+      const reference = ref.references[i];\\n       if (reference.writeExpr) {\\n         if (foundWriteExpr) {\\n           // Two writes to the same function.\\n@@ -1450,9 +1537,10 @@ function scanForDeclaredBareFunctions({\\n     return false;\\n   }\\n \\n-  return bareFunctions.map(fnRef => ({\\n-    fn: fnRef.defs[0],\\n-    suggestUseCallback: isUsedOutsideOfHook(fnRef),\\n+  return constructions.map(([ref, depType]) => ({\\n+    construction: ref.defs[0],\\n+    depType,\\n+    isUsedOutsideOfHook: isUsedOutsideOfHook(ref),\\n   }));\\n }\\n "}],"stats":{"total":889,"additions":773,"deletions":116}},{"date":"Aug 13th 20","parents":[{"sha":"c3ee973c5604078d5e9645a7e50db1842939d1e0","url":"https://api.github.com/repos/facebook/react/commits/c3ee973c5604078d5e9645a7e50db1842939d1e0","html_url":"https://github.com/facebook/react/commit/c3ee973c5604078d5e9645a7e50db1842939d1e0"}],"author":"sebmarkbage","files":[{"sha":"79002ff6ae629fb8ff9a194f332f1eb861fff960","filename":"packages/react-reconciler/src/ReactFiberCommitWork.new.js","status":"modified","additions":159,"deletions":4,"changes":163,"blob_url":"https://github.com/facebook/react/blob/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1/packages/react-reconciler/src/ReactFiberCommitWork.new.js","raw_url":"https://github.com/facebook/react/raw/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1/packages/react-reconciler/src/ReactFiberCommitWork.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCommitWork.new.js?ref=dab0854c5e66ca74ca0591fd312d6a654e5aaaf1","patch":"@@ -20,10 +20,14 @@ import type {FiberRoot} from \'./ReactInternalTypes\';\\n import type {Lanes} from \'./ReactFiberLane\';\\n import type {SuspenseState} from \'./ReactFiberSuspenseComponent.new\';\\n import type {UpdateQueue} from \'./ReactUpdateQueue.new\';\\n-import type {FunctionComponentUpdateQueue} from \'./ReactFiberHooks.new\';\\n+import type {\\n+  Effect as HookEffect,\\n+  FunctionComponentUpdateQueue,\\n+} from \'./ReactFiberHooks.new\';\\n import type {Wakeable} from \'shared/ReactTypes\';\\n import type {ReactPriorityLevel} from \'./ReactInternalTypes\';\\n import type {OffscreenState} from \'./ReactFiberOffscreenComponent\';\\n+import type {HookEffectTag} from \'./ReactHookEffectTags\';\\n \\n import {unstable_wrap as Schedule_tracing_wrap} from \'scheduler/tracing\';\\n import {\\n@@ -77,6 +81,8 @@ import {\\n   getCommitTime,\\n   recordLayoutEffectDuration,\\n   startLayoutEffectTimer,\\n+  recordPassiveEffectDuration,\\n+  startPassiveEffectTimer,\\n } from \'./ReactProfilerTimer.new\';\\n import {ProfileMode} from \'./ReactTypeOfMode\';\\n import {commitUpdateQueue} from \'./ReactUpdateQueue.new\';\\n@@ -121,6 +127,7 @@ import {\\n   NoEffect as NoHookEffect,\\n   HasEffect as HookHasEffect,\\n   Layout as HookLayout,\\n+  Passive as HookPassive,\\n } from \'./ReactHookEffectTags\';\\n import {didWarnAboutReassigningProps} from \'./ReactFiberBeginWork.new\';\\n import {\\n@@ -308,7 +315,7 @@ function commitBeforeMutationLifeCycles(\\n   );\\n }\\n \\n-function commitHookEffectListUnmount(tag: number, finishedWork: Fiber) {\\n+function commitHookEffectListUnmount(tag: HookEffectTag, finishedWork: Fiber) {\\n   const updateQueue: FunctionComponentUpdateQueue | null = (finishedWork.updateQueue: any);\\n   const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n   if (lastEffect !== null) {\\n@@ -328,7 +335,43 @@ function commitHookEffectListUnmount(tag: number, finishedWork: Fiber) {\\n   }\\n }\\n \\n-function commitHookEffectListMount(tag: number, finishedWork: Fiber) {\\n+// TODO: Remove this duplication.\\n+function commitHookEffectListUnmount2(\\n+  // Tags to check for when deciding whether to unmount. e.g. to skip over\\n+  // layout effects\\n+  hookEffectTag: HookEffectTag,\\n+  fiber: Fiber,\\n+): void {\\n+  const updateQueue: FunctionComponentUpdateQueue | null = (fiber.updateQueue: any);\\n+  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n+  if (lastEffect !== null) {\\n+    const firstEffect = lastEffect.next;\\n+    let effect = firstEffect;\\n+    do {\\n+      const {next, tag} = effect;\\n+      if ((tag & hookEffectTag) === hookEffectTag) {\\n+        const destroy = effect.destroy;\\n+        if (destroy !== undefined) {\\n+          effect.destroy = undefined;\\n+          if (\\n+            enableProfilerTimer &&\\n+            enableProfilerCommitHooks &&\\n+            fiber.mode & ProfileMode\\n+          ) {\\n+            startPassiveEffectTimer();\\n+            safelyCallDestroy(fiber, destroy);\\n+            recordPassiveEffectDuration(fiber);\\n+          } else {\\n+            safelyCallDestroy(fiber, destroy);\\n+          }\\n+        }\\n+      }\\n+      effect = next;\\n+    } while (effect !== firstEffect);\\n+  }\\n+}\\n+\\n+function commitHookEffectListMount(tag: HookEffectTag, finishedWork: Fiber) {\\n   const updateQueue: FunctionComponentUpdateQueue | null = (finishedWork.updateQueue: any);\\n   const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n   if (lastEffect !== null) {\\n@@ -378,6 +421,83 @@ function commitHookEffectListMount(tag: number, finishedWork: Fiber) {\\n   }\\n }\\n \\n+function invokePassiveEffectCreate(effect: HookEffect): void {\\n+  const create = effect.create;\\n+  effect.destroy = create();\\n+}\\n+\\n+// TODO: Remove this duplication.\\n+function commitHookEffectListMount2(fiber: Fiber): void {\\n+  const updateQueue: FunctionComponentUpdateQueue | null = (fiber.updateQueue: any);\\n+  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n+  if (lastEffect !== null) {\\n+    const firstEffect = lastEffect.next;\\n+    let effect = firstEffect;\\n+    do {\\n+      const {next, tag} = effect;\\n+\\n+      if (\\n+        (tag & HookPassive) !== NoHookEffect &&\\n+        (tag & HookHasEffect) !== NoHookEffect\\n+      ) {\\n+        if (__DEV__) {\\n+          if (\\n+            enableProfilerTimer &&\\n+            enableProfilerCommitHooks &&\\n+            fiber.mode & ProfileMode\\n+          ) {\\n+            startPassiveEffectTimer();\\n+            invokeGuardedCallback(\\n+              null,\\n+              invokePassiveEffectCreate,\\n+              null,\\n+              effect,\\n+            );\\n+            recordPassiveEffectDuration(fiber);\\n+          } else {\\n+            invokeGuardedCallback(\\n+              null,\\n+              invokePassiveEffectCreate,\\n+              null,\\n+              effect,\\n+            );\\n+          }\\n+          if (hasCaughtError()) {\\n+            invariant(fiber !== null, \'Should be working on an effect.\');\\n+            const error = clearCaughtError();\\n+            captureCommitPhaseError(fiber, error);\\n+          }\\n+        } else {\\n+          try {\\n+            const create = effect.create;\\n+            if (\\n+              enableProfilerTimer &&\\n+              enableProfilerCommitHooks &&\\n+              fiber.mode & ProfileMode\\n+            ) {\\n+              try {\\n+                startPassiveEffectTimer();\\n+                effect.destroy = create();\\n+              } finally {\\n+                recordPassiveEffectDuration(fiber);\\n+              }\\n+            } else {\\n+              effect.destroy = create();\\n+            }\\n+            // TODO: This is missing the warning that exists in commitHookEffectListMount.\\n+            // The warning refers to useEffect but only applies to useLayoutEffect.\\n+          } catch (error) {\\n+            invariant(fiber !== null, \'Should be working on an effect.\');\\n+            captureCommitPhaseError(fiber, error);\\n+          }\\n+        }\\n+      }\\n+\\n+      effect = next;\\n+    } while (effect !== firstEffect);\\n+  }\\n+}\\n+\\n export function commitPassiveEffectDurations(\\n   finishedRoot: FiberRoot,\\n   finishedWork: Fiber,\\n@@ -1709,13 +1829,45 @@ export function isSuspenseBoundaryBeingHidden(\\n   return false;\\n }\\n \\n-function commitResetTextContent(current: Fiber) {\\n+function commitResetTextContent(current: Fiber): void {\\n   if (!supportsMutation) {\\n     return;\\n   }\\n   resetTextContent(current.stateNode);\\n }\\n \\n+function commitPassiveWork(finishedWork: Fiber): void {\\n+  switch (finishedWork.tag) {\\n+    case FunctionComponent:\\n+    case ForwardRef:\\n+    case SimpleMemoComponent:\\n+    case Block: {\\n+      commitHookEffectListUnmount2(HookPassive | HookHasEffect, finishedWork);\\n+    }\\n+  }\\n+}\\n+\\n+function commitPassiveUnmount(current: Fiber): void {\\n+  switch (current.tag) {\\n+    case FunctionComponent:\\n+    case ForwardRef:\\n+    case SimpleMemoComponent:\\n+    case Block:\\n+      commitHookEffectListUnmount2(HookPassive, current);\\n+  }\\n+}\\n+\\n+function commitPassiveLifeCycles(finishedWork: Fiber): void {\\n+  switch (finishedWork.tag) {\\n+    case FunctionComponent:\\n+    case ForwardRef:\\n+    case SimpleMemoComponent:\\n+    case Block: {\\n+      commitHookEffectListMount2(finishedWork);\\n+    }\\n+  }\\n+}\\n+\\n export {\\n   commitBeforeMutationLifeCycles,\\n   commitResetTextContent,\\n@@ -1725,4 +1877,7 @@ export {\\n   commitLifeCycles,\\n   commitAttachRef,\\n   commitDetachRef,\\n+  commitPassiveUnmount,\\n+  commitPassiveWork,\\n+  commitPassiveLifeCycles,\\n };"},{"sha":"e35f87982daba81b56c6c2315a5415ba7ed0b0c6","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.new.js","status":"modified","additions":13,"deletions":148,"changes":161,"blob_url":"https://github.com/facebook/react/blob/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","raw_url":"https://github.com/facebook/react/raw/dab0854c5e66ca74ca0591fd312d6a654e5aaaf1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.new.js?ref=dab0854c5e66ca74ca0591fd312d6a654e5aaaf1","patch":"@@ -14,8 +14,6 @@ import type {ReactPriorityLevel} from \'./ReactInternalTypes\';\\n import type {Interaction} from \'scheduler/src/Tracing\';\\n import type {SuspenseConfig} from \'./ReactFiberSuspenseConfig\';\\n import type {SuspenseState} from \'./ReactFiberSuspenseComponent.new\';\\n-import type {Effect as HookEffect} from \'./ReactFiberHooks.new\';\\n-import type {HookEffectTag} from \'./ReactHookEffectTags\';\\n import type {StackCursor} from \'./ReactFiberStack.new\';\\n import type {FunctionComponentUpdateQueue} from \'./ReactFiberHooks.new\';\\n \\n@@ -53,7 +51,6 @@ import {\\n } from \'./SchedulerWithReactIntegration.new\';\\n import {\\n   NoEffect as NoHookEffect,\\n-  HasEffect as HookHasEffect,\\n   Passive as HookPassive,\\n } from \'./ReactHookEffectTags\';\\n import {\\n@@ -206,12 +203,14 @@ import {\\n   commitPlacement,\\n   commitWork,\\n   commitDeletion,\\n+  commitPassiveUnmount,\\n+  commitPassiveWork,\\n+  commitPassiveLifeCycles as commitPassiveEffectOnFiber,\\n   commitDetachRef,\\n   commitAttachRef,\\n   commitPassiveEffectDurations,\\n   commitResetTextContent,\\n   isSuspenseBoundaryBeingHidden,\\n-  safelyCallDestroy,\\n } from \'./ReactFiberCommitWork.new\';\\n import {enqueueUpdate} from \'./ReactUpdateQueue.new\';\\n import {resetContextDependencies} from \'./ReactFiberNewContext.new\';\\n@@ -229,8 +228,6 @@ import {\\n \\n import {\\n   recordCommitTime,\\n-  recordPassiveEffectDuration,\\n-  startPassiveEffectTimer,\\n   startProfilerTimer,\\n   stopProfilerTimerIfRunningAndRecordDelta,\\n } from \'./ReactProfilerTimer.new\';\\n@@ -2738,11 +2735,6 @@ export function enqueuePendingPassiveProfilerEffect(fiber: Fiber): void {\\n   }\\n }\\n \\n-function invokePassiveEffectCreate(effect: HookEffect): void {\\n-  const create = effect.create;\\n-  effect.destroy = create();\\n-}\\n-\\n function flushPassiveMountEffects(firstChild: Fiber): void {\\n   let fiber = firstChild;\\n   while (fiber !== null) {\\n@@ -2753,93 +2745,15 @@ function flushPassiveMountEffects(firstChild: Fiber): void {\\n     }\\n \\n     if ((fiber.effectTag & Update) !== NoEffect) {\\n-      switch (fiber.tag) {\\n-        case FunctionComponent:\\n-        case ForwardRef:\\n-        case SimpleMemoComponent:\\n-        case Block: {\\n-          flushPassiveMountEffectsImpl(fiber);\\n-        }\\n-      }\\n+      setCurrentDebugFiberInDEV(fiber);\\n+      commitPassiveEffectOnFiber(fiber);\\n+      resetCurrentDebugFiberInDEV();\\n     }\\n \\n     fiber = fiber.sibling;\\n   }\\n }\\n \\n-function flushPassiveMountEffectsImpl(fiber: Fiber): void {\\n-  setCurrentDebugFiberInDEV(fiber);\\n-\\n-  const updateQueue: FunctionComponentUpdateQueue | null = (fiber.updateQueue: any);\\n-  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n-  if (lastEffect !== null) {\\n-    const firstEffect = lastEffect.next;\\n-    let effect = firstEffect;\\n-    do {\\n-      const {next, tag} = effect;\\n-\\n-      if (\\n-        (tag & HookPassive) !== NoHookEffect &&\\n-        (tag & HookHasEffect) !== NoHookEffect\\n-      ) {\\n-        if (__DEV__) {\\n-          if (\\n-            enableProfilerTimer &&\\n-            enableProfilerCommitHooks &&\\n-            fiber.mode & ProfileMode\\n-          ) {\\n-            startPassiveEffectTimer();\\n-            invokeGuardedCallback(\\n-              null,\\n-              invokePassiveEffectCreate,\\n-              null,\\n-              effect,\\n-            );\\n-            recordPassiveEffectDuration(fiber);\\n-          } else {\\n-            invokeGuardedCallback(\\n-              null,\\n-              invokePassiveEffectCreate,\\n-              null,\\n-              effect,\\n-            );\\n-          }\\n-          if (hasCaughtError()) {\\n-            invariant(fiber !== null, \'Should be working on an effect.\');\\n-            const error = clearCaughtError();\\n-            captureCommitPhaseError(fiber, error);\\n-          }\\n-        } else {\\n-          try {\\n-            const create = effect.create;\\n-            if (\\n-              enableProfilerTimer &&\\n-              enableProfilerCommitHooks &&\\n-              fiber.mode & ProfileMode\\n-            ) {\\n-              try {\\n-                startPassiveEffectTimer();\\n-                effect.destroy = create();\\n-              } finally {\\n-                recordPassiveEffectDuration(fiber);\\n-              }\\n-            } else {\\n-              effect.destroy = create();\\n-            }\\n-          } catch (error) {\\n-            invariant(fiber !== null, \'Should be working on an effect.\');\\n-            captureCommitPhaseError(fiber, error);\\n-          }\\n-        }\\n-      }\\n-\\n-      effect = next;\\n-    } while (effect !== firstEffect);\\n-\\n-    resetCurrentDebugFiberInDEV();\\n-  }\\n-}\\n-\\n function flushPassiveUnmountEffects(firstChild: Fiber): void {\\n   let fiber = firstChild;\\n   while (fiber !== null) {\\n@@ -2866,16 +2780,11 @@ function flushPassiveUnmountEffects(firstChild: Fiber): void {\\n       }\\n     }\\n \\n-    switch (fiber.tag) {\\n-      case FunctionComponent:\\n-      case ForwardRef:\\n-      case SimpleMemoComponent:\\n-      case Block: {\\n-        const primaryEffectTag = fiber.effectTag & Passive;\\n-        if (primaryEffectTag !== NoEffect) {\\n-          flushPassiveUnmountEffectsImpl(fiber, HookPassive | HookHasEffect);\\n-        }\\n-      }\\n+    const primaryEffectTag = fiber.effectTag & Passive;\\n+    if (primaryEffectTag !== NoEffect) {\\n+      setCurrentDebugFiberInDEV(fiber);\\n+      commitPassiveWork(fiber);\\n+      resetCurrentDebugFiberInDEV();\\n     }\\n \\n     fiber = fiber.sibling;\\n@@ -2898,52 +2807,8 @@ function flushPassiveUnmountEffectsInsideOfDeletedTree(\\n   }\\n \\n   if ((fiberToDelete.effectTag & PassiveStatic) !== NoEffect) {\\n-    switch (fiberToDelete.tag) {\\n-      case FunctionComponent:\\n-      case ForwardRef:\\n-      case SimpleMemoComponent:\\n-      case Block: {\\n-        flushPassiveUnmountEffectsImpl(fiberToDelete, HookPassive);\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-function flushPassiveUnmountEffectsImpl(\\n-  fiber: Fiber,\\n-  // Tags to check for when deciding whether to unmount. e.g. to skip over\\n-  // layout effects\\n-  hookEffectTag: HookEffectTag,\\n-): void {\\n-  const updateQueue: FunctionComponentUpdateQueue | null = (fiber.updateQueue: any);\\n-  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\\n-  if (lastEffect !== null) {\\n-    setCurrentDebugFiberInDEV(fiber);\\n-\\n-    const firstEffect = lastEffect.next;\\n-    let effect = firstEffect;\\n-    do {\\n-      const {next, tag} = effect;\\n-      if ((tag & hookEffectTag) === hookEffectTag) {\\n-        const destroy = effect.destroy;\\n-        if (destroy !== undefined) {\\n-          effect.destroy = undefined;\\n-          if (\\n-            enableProfilerTimer &&\\n-            enableProfilerCommitHooks &&\\n-            fiber.mode & ProfileMode\\n-          ) {\\n-            startPassiveEffectTimer();\\n-            safelyCallDestroy(fiber, destroy);\\n-            recordPassiveEffectDuration(fiber);\\n-          } else {\\n-            safelyCallDestroy(fiber, destroy);\\n-          }\\n-        }\\n-      }\\n-      effect = next;\\n-    } while (effect !== firstEffect);\\n-\\n+    setCurrentDebugFiberInDEV(fiberToDelete);\\n+    commitPassiveUnmount(fiberToDelete);\\n     resetCurrentDebugFiberInDEV();\\n   }\\n }"}],"stats":{"total":324,"additions":172,"deletions":152}},{"date":"Aug 13th 20","parents":[{"sha":"ccb6c39451b502c6b3ff3c014962827c54bae548","url":"https://api.github.com/repos/facebook/react/commits/ccb6c39451b502c6b3ff3c014962827c54bae548","html_url":"https://github.com/facebook/react/commit/ccb6c39451b502c6b3ff3c014962827c54bae548"}],"author":"bvaughn","files":[{"sha":"00e3735c72c11df4ffdcfbe97843fc0a4b5e0b6e","filename":"packages/react-devtools-extensions/src/main.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/c3ee973c5604078d5e9645a7e50db1842939d1e0/packages/react-devtools-extensions/src/main.js","raw_url":"https://github.com/facebook/react/raw/c3ee973c5604078d5e9645a7e50db1842939d1e0/packages/react-devtools-extensions/src/main.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-extensions/src/main.js?ref=c3ee973c5604078d5e9645a7e50db1842939d1e0","patch":"@@ -296,7 +296,7 @@ function createPanelIfReactLoaded() {\\n       let needsToSyncElementSelection = false;\\n \\n       chrome.devtools.panels.create(\\n-        isChrome ? \'\u269b Components\' : \'Components\',\\n+        isChrome ? \'\u269b\ufe0f Components\' : \'Components\',\\n         \'\',\\n         \'panel.html\',\\n         extensionPanel => {\\n@@ -326,7 +326,7 @@ function createPanelIfReactLoaded() {\\n       );\\n \\n       chrome.devtools.panels.create(\\n-        isChrome ? \'\u269b Profiler\' : \'Profiler\',\\n+        isChrome ? \'\u269b\ufe0f Profiler\' : \'Profiler\',\\n         \'\',\\n         \'panel.html\',\\n         extensionPanel => {"}],"stats":{"total":4,"additions":2,"deletions":2}},{"date":"Aug 13th 20","parents":[{"sha":"629125555f381764c9f4943e877985274ebbc1b6","url":"https://api.github.com/repos/facebook/react/commits/629125555f381764c9f4943e877985274ebbc1b6","html_url":"https://github.com/facebook/react/commit/629125555f381764c9f4943e877985274ebbc1b6"}],"author":"inottn","files":[{"sha":"679a93bdd27907923a843bd9431839abfec57797","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.new.js","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/facebook/react/blob/ccb6c39451b502c6b3ff3c014962827c54bae548/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","raw_url":"https://github.com/facebook/react/raw/ccb6c39451b502c6b3ff3c014962827c54bae548/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.new.js?ref=ccb6c39451b502c6b3ff3c014962827c54bae548","patch":"@@ -1470,7 +1470,7 @@ function handleError(root, thrownValue): void {\\n   } while (true);\\n }\\n \\n-function pushDispatcher(root) {\\n+function pushDispatcher() {\\n   const prevDispatcher = ReactCurrentDispatcher.current;\\n   ReactCurrentDispatcher.current = ContextOnlyDispatcher;\\n   if (prevDispatcher === null) {\\n@@ -1586,7 +1586,7 @@ export function renderHasNotSuspendedYet(): boolean {\\n function renderRootSync(root: FiberRoot, lanes: Lanes) {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= RenderContext;\\n-  const prevDispatcher = pushDispatcher(root);\\n+  const prevDispatcher = pushDispatcher();\\n \\n   // If the root or lanes have changed, throw out the existing stack\\n   // and prepare a fresh one. Otherwise we\'ll continue where we left off.\\n@@ -1661,7 +1661,7 @@ function workLoopSync() {\\n function renderRootConcurrent(root: FiberRoot, lanes: Lanes) {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= RenderContext;\\n-  const prevDispatcher = pushDispatcher(root);\\n+  const prevDispatcher = pushDispatcher();\\n \\n   // If the root or lanes have changed, throw out the existing stack\\n   // and prepare a fresh one. Otherwise we\'ll continue where we left off."},{"sha":"0aabd21aab4709e7d93092d635347f45400800a4","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.old.js","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/facebook/react/blob/ccb6c39451b502c6b3ff3c014962827c54bae548/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","raw_url":"https://github.com/facebook/react/raw/ccb6c39451b502c6b3ff3c014962827c54bae548/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.old.js?ref=ccb6c39451b502c6b3ff3c014962827c54bae548","patch":"@@ -1454,7 +1454,7 @@ function handleError(root, thrownValue): void {\\n   } while (true);\\n }\\n \\n-function pushDispatcher(root) {\\n+function pushDispatcher() {\\n   const prevDispatcher = ReactCurrentDispatcher.current;\\n   ReactCurrentDispatcher.current = ContextOnlyDispatcher;\\n   if (prevDispatcher === null) {\\n@@ -1570,7 +1570,7 @@ export function renderHasNotSuspendedYet(): boolean {\\n function renderRootSync(root: FiberRoot, lanes: Lanes) {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= RenderContext;\\n-  const prevDispatcher = pushDispatcher(root);\\n+  const prevDispatcher = pushDispatcher();\\n \\n   // If the root or lanes have changed, throw out the existing stack\\n   // and prepare a fresh one. Otherwise we\'ll continue where we left off.\\n@@ -1645,7 +1645,7 @@ function workLoopSync() {\\n function renderRootConcurrent(root: FiberRoot, lanes: Lanes) {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= RenderContext;\\n-  const prevDispatcher = pushDispatcher(root);\\n+  const prevDispatcher = pushDispatcher();\\n \\n   // If the root or lanes have changed, throw out the existing stack\\n   // and prepare a fresh one. Otherwise we\'ll continue where we left off."}],"stats":{"total":12,"additions":6,"deletions":6}},{"date":"Aug 12th 20","parents":[{"sha":"b8ed6a1aa580e4de80f707293015d638d3252d63","url":"https://api.github.com/repos/facebook/react/commits/b8ed6a1aa580e4de80f707293015d638d3252d63","html_url":"https://github.com/facebook/react/commit/b8ed6a1aa580e4de80f707293015d638d3252d63"}],"author":"pfongkye","files":[{"sha":"aa8578a1086462be0b45d7bd7eaf7cde5e521b47","filename":"packages/react-devtools-extensions/src/backend.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-extensions/src/backend.js","raw_url":"https://github.com/facebook/react/raw/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-extensions/src/backend.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-extensions/src/backend.js?ref=b6e1d086043a801682ff01b00c7a623d529b46c0","patch":"@@ -72,7 +72,7 @@ function setup(hook) {\\n   initBackend(hook, agent, window);\\n \\n   // Let the frontend know that the backend has attached listeners and is ready for messages.\\n-  // This covers the case of of syncing saved values after reloading/navigating while DevTools remain open.\\n+  // This covers the case of syncing saved values after reloading/navigating while DevTools remain open.\\n   bridge.send(\'extensionBackendInitialized\');\\n \\n   // Setup React Native style editor if a renderer like react-native-web has injected it."},{"sha":"1989aee6391a9869ad43b8d1d2051bc3c295c9e4","filename":"packages/react-devtools-shared/src/__tests__/__snapshots__/inspectedElementContext-test.js.snap","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/__tests__/__snapshots__/inspectedElementContext-test.js.snap","raw_url":"https://github.com/facebook/react/raw/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/__tests__/__snapshots__/inspectedElementContext-test.js.snap","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/__tests__/__snapshots__/inspectedElementContext-test.js.snap?ref=b6e1d086043a801682ff01b00c7a623d529b46c0","patch":"@@ -541,6 +541,7 @@ exports[`InspectedElementContext should support complex data types: 1: Inspected\\n     \\"object_of_objects\\": {\\n       \\"inner\\": {}\\n     },\\n+    \\"proxy\\": {},\\n     \\"react_element\\": {},\\n     \\"regexp\\": {},\\n     \\"set\\": {"},{"sha":"29e8e379e4e43e5cb346f817551f4d272ecf9a63","filename":"packages/react-devtools-shared/src/__tests__/inspectedElementContext-test.js","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/facebook/react/blob/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/__tests__/inspectedElementContext-test.js","raw_url":"https://github.com/facebook/react/raw/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/__tests__/inspectedElementContext-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/__tests__/inspectedElementContext-test.js?ref=b6e1d086043a801682ff01b00c7a623d529b46c0","patch":"@@ -549,6 +549,14 @@ describe(\'InspectedElementContext\', () => {\\n     }\\n     const instance = new Class();\\n \\n+    const proxyInstance = new Proxy(() => {}, {\\n+      get: function(_, name) {\\n+        return function() {\\n+          return null;\\n+        };\\n+      },\\n+    });\\n+\\n     const container = document.createElement(\'div\');\\n     await utils.actAsync(() =>\\n       ReactDOM.render(\\n@@ -567,6 +575,7 @@ describe(\'InspectedElementContext\', () => {\\n           map={mapShallow}\\n           map_of_maps={mapOfMaps}\\n           object_of_objects={objectOfObjects}\\n+          proxy={proxyInstance}\\n           react_element={<span />}\\n           regexp={/abc/giu}\\n           set={setShallow}\\n@@ -619,6 +628,7 @@ describe(\'InspectedElementContext\', () => {\\n       map,\\n       map_of_maps,\\n       object_of_objects,\\n+      proxy,\\n       react_element,\\n       regexp,\\n       set,\\n@@ -722,6 +732,12 @@ describe(\'InspectedElementContext\', () => {\\n     );\\n     expect(object_of_objects.inner[meta.preview_short]).toBe(\'{\u2026}\');\\n \\n+    expect(proxy[meta.inspectable]).toBe(false);\\n+    expect(proxy[meta.name]).toBe(\'function\');\\n+    expect(proxy[meta.type]).toBe(\'function\');\\n+    expect(proxy[meta.preview_long]).toBe(\'\u0192 () {}\');\\n+    expect(proxy[meta.preview_short]).toBe(\'\u0192 () {}\');\\n+\\n     expect(react_element[meta.inspectable]).toBe(false);\\n     expect(react_element[meta.name]).toBe(\'span\');\\n     expect(react_element[meta.type]).toBe(\'react_element\');"},{"sha":"23cb0a68fd9b29013a69430473504be58160fc96","filename":"packages/react-devtools-shared/src/hydration.js","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/facebook/react/blob/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/hydration.js","raw_url":"https://github.com/facebook/react/raw/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/hydration.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/hydration.js?ref=b6e1d086043a801682ff01b00c7a623d529b46c0","patch":"@@ -151,7 +151,10 @@ export function dehydrate(\\n         inspectable: false,\\n         preview_short: formatDataForPreview(data, false),\\n         preview_long: formatDataForPreview(data, true),\\n-        name: data.name || \'function\',\\n+        name:\\n+          typeof data.name === \'function\' || !data.name\\n+            ? \'function\'\\n+            : data.name,\\n         type,\\n       };\\n "},{"sha":"419aaac0c3dd0749a933d5a2ed279463553f3ce1","filename":"packages/react-devtools-shared/src/utils.js","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/utils.js","raw_url":"https://github.com/facebook/react/raw/b6e1d086043a801682ff01b00c7a623d529b46c0/packages/react-devtools-shared/src/utils.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/utils.js?ref=b6e1d086043a801682ff01b00c7a623d529b46c0","patch":"@@ -539,7 +539,9 @@ export function formatDataForPreview(\\n     case \'html_element\':\\n       return `<${truncateForDisplay(data.tagName.toLowerCase())} />`;\\n     case \'function\':\\n-      return truncateForDisplay(`\u0192 ${data.name}() {}`);\\n+      return truncateForDisplay(\\n+        `\u0192 ${typeof data.name === \'function\' ? \'\' : data.name}() {}`,\\n+      );\\n     case \'string\':\\n       return `\\"${data}\\"`;\\n     case \'bigint\':"}],"stats":{"total":28,"additions":25,"deletions":3}},{"date":"Aug 12th 20","parents":[{"sha":"c8d9b8878a3a50fe94db5407727a3d5cba13f971","url":"https://api.github.com/repos/facebook/react/commits/c8d9b8878a3a50fe94db5407727a3d5cba13f971","html_url":"https://github.com/facebook/react/commit/c8d9b8878a3a50fe94db5407727a3d5cba13f971"}],"author":"acdlite","files":[{"sha":"6998bca453f18aa173ed8da1393f040ca8be6b52","filename":".eslintrc.js","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/.eslintrc.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/.eslintrc.js","contents_url":"https://api.github.com/repos/facebook/react/contents/.eslintrc.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -166,6 +166,12 @@ module.exports = {\\n         __webpack_require__: true,\\n       },\\n     },\\n+    {\\n+      files: [\'packages/scheduler/**/*.js\'],\\n+      globals: {\\n+        TaskController: true,\\n+      },\\n+    },\\n   ],\\n \\n   globals: {"},{"sha":"b42f2114be2c3bb0085fdb1999d4449115224a4a","filename":"packages/scheduler/src/SchedulerPostTask.js","status":"added","additions":249,"deletions":0,"changes":249,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/src/SchedulerPostTask.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/src/SchedulerPostTask.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/SchedulerPostTask.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -0,0 +1,249 @@\\n+/**\\n+ * Copyright (c) Facebook, Inc. and its affiliates.\\n+ *\\n+ * This source code is licensed under the MIT license found in the\\n+ * LICENSE file in the root directory of this source tree.\\n+ *\\n+ * @flow\\n+ */\\n+\\n+import type {PriorityLevel} from \'./SchedulerPriorities\';\\n+\\n+declare class TaskController {\\n+  constructor(priority?: string): TaskController;\\n+  signal: mixed;\\n+  abort(): void;\\n+}\\n+\\n+type PostTaskPriorityLevel = \'user-blocking\' | \'user-visible\' | \'background\';\\n+\\n+type CallbackNode = {|\\n+  _controller: TaskController,\\n+|};\\n+\\n+import {\\n+  ImmediatePriority,\\n+  UserBlockingPriority,\\n+  NormalPriority,\\n+  LowPriority,\\n+  IdlePriority,\\n+} from \'./SchedulerPriorities\';\\n+\\n+export {\\n+  ImmediatePriority as unstable_ImmediatePriority,\\n+  UserBlockingPriority as unstable_UserBlockingPriority,\\n+  NormalPriority as unstable_NormalPriority,\\n+  IdlePriority as unstable_IdlePriority,\\n+  LowPriority as unstable_LowPriority,\\n+};\\n+\\n+// Capture local references to native APIs, in case a polyfill overrides them.\\n+const perf = window.performance;\\n+\\n+// Use experimental Chrome Scheduler postTask API.\\n+const scheduler = global.scheduler;\\n+\\n+const getCurrentTime = perf.now.bind(perf);\\n+\\n+export const unstable_now = getCurrentTime;\\n+\\n+// Scheduler periodically yields in case there is other work on the main\\n+// thread, like user events. By default, it yields multiple times per frame.\\n+// It does not attempt to align with frame boundaries, since most tasks don\'t\\n+// need to be frame aligned; for those that do, use requestAnimationFrame.\\n+const yieldInterval = 5;\\n+let deadline = 0;\\n+\\n+let currentPriorityLevel_DEPRECATED = NormalPriority;\\n+\\n+// `isInputPending` is not available. Since we have no way of knowing if\\n+// there\'s pending input, always yield at the end of the frame.\\n+export function unstable_shouldYield() {\\n+  return getCurrentTime() >= deadline;\\n+}\\n+\\n+export function unstable_requestPaint() {\\n+  // Since we yield every frame regardless, `requestPaint` has no effect.\\n+}\\n+\\n+type SchedulerCallback<T> = (\\n+  didTimeout_DEPRECATED: boolean,\\n+) =>\\n+  | T\\n+  // May return a continuation\\n+  | SchedulerCallback<T>;\\n+\\n+export function unstable_scheduleCallback<T>(\\n+  priorityLevel: PriorityLevel,\\n+  callback: SchedulerCallback<T>,\\n+  options?: {delay?: number},\\n+): CallbackNode {\\n+  let postTaskPriority;\\n+  switch (priorityLevel) {\\n+    case ImmediatePriority:\\n+    case UserBlockingPriority:\\n+      postTaskPriority = \'user-blocking\';\\n+      break;\\n+    case LowPriority:\\n+    case NormalPriority:\\n+      postTaskPriority = \'user-visible\';\\n+      break;\\n+    case IdlePriority:\\n+      postTaskPriority = \'background\';\\n+      break;\\n+    default:\\n+      postTaskPriority = \'user-visible\';\\n+      break;\\n+  }\\n+\\n+  const controller = new TaskController();\\n+  const postTaskOptions = {\\n+    priority: postTaskPriority,\\n+    delay: typeof options === \'object\' && options !== null ? options.delay : 0,\\n+    signal: controller.signal,\\n+  };\\n+\\n+  const node = {\\n+    _controller: controller,\\n+  };\\n+\\n+  scheduler\\n+    .postTask(\\n+      runTask.bind(null, priorityLevel, postTaskPriority, node, callback),\\n+      postTaskOptions,\\n+    )\\n+    .catch(handlePostTaskError);\\n+\\n+  return node;\\n+}\\n+\\n+function runTask<T>(\\n+  priorityLevel: PriorityLevel,\\n+  postTaskPriority: PostTaskPriorityLevel,\\n+  node: CallbackNode,\\n+  callback: SchedulerCallback<T>,\\n+) {\\n+  deadline = getCurrentTime() + yieldInterval;\\n+  try {\\n+    currentPriorityLevel_DEPRECATED = priorityLevel;\\n+    const didTimeout_DEPRECATED = false;\\n+    const result = callback(didTimeout_DEPRECATED);\\n+    if (typeof result === \'function\') {\\n+      // Assume this is a continuation\\n+      const continuation: SchedulerCallback<T> = (result: any);\\n+      const continuationController = new TaskController();\\n+      const continuationOptions = {\\n+        priority: postTaskPriority,\\n+        signal: continuationController.signal,\\n+      };\\n+      // Update the original callback node\'s controller, since even though we\'re\\n+      // posting a new task, conceptually it\'s the same one.\\n+      node._controller = continuationController;\\n+      scheduler\\n+        .postTask(\\n+          runTask.bind(\\n+            null,\\n+            priorityLevel,\\n+            postTaskPriority,\\n+            node,\\n+            continuation,\\n+          ),\\n+          continuationOptions,\\n+        )\\n+        .catch(handlePostTaskError);\\n+    }\\n+  } finally {\\n+    currentPriorityLevel_DEPRECATED = NormalPriority;\\n+  }\\n+}\\n+\\n+function handlePostTaskError(error) {\\n+  // This error is either a user error thrown by a callback, or an AbortError\\n+  // as a result of a cancellation.\\n+  //\\n+  // User errors trigger a global `error` event even if we don\'t rethrow them.\\n+  // In fact, if we do rethrow them, they\'ll get reported to the console twice.\\n+  // I\'m not entirely sure the current `postTask` spec makes sense here. If I\\n+  // catch a `postTask` call, it shouldn\'t trigger a global error.\\n+  //\\n+  // Abort errors are an implementation detail. We don\'t expose the\\n+  // TaskController to the user, nor do we expose the promise that is returned\\n+  // from `postTask`. So we shouldn\'t rethrow those, either, since there\'s no\\n+  // way to handle them. (If we did return the promise to the user, then it\\n+  // should be up to them to handle the AbortError.)\\n+  //\\n+  // In either case, we can suppress the error, barring changes to the spec\\n+  // or the Scheduler API.\\n+}\\n+\\n+export function unstable_cancelCallback(node: CallbackNode) {\\n+  const controller = node._controller;\\n+  controller.abort();\\n+}\\n+\\n+export function unstable_runWithPriority<T>(\\n+  priorityLevel: PriorityLevel,\\n+  callback: () => T,\\n+): T {\\n+  const previousPriorityLevel = currentPriorityLevel_DEPRECATED;\\n+  currentPriorityLevel_DEPRECATED = priorityLevel;\\n+  try {\\n+    return callback();\\n+  } finally {\\n+    currentPriorityLevel_DEPRECATED = previousPriorityLevel;\\n+  }\\n+}\\n+\\n+export function unstable_getCurrentPriorityLevel() {\\n+  return currentPriorityLevel_DEPRECATED;\\n+}\\n+\\n+export function unstable_next<T>(callback: () => T): T {\\n+  let priorityLevel;\\n+  switch (currentPriorityLevel_DEPRECATED) {\\n+    case ImmediatePriority:\\n+    case UserBlockingPriority:\\n+    case NormalPriority:\\n+      // Shift down to normal priority\\n+      priorityLevel = NormalPriority;\\n+      break;\\n+    default:\\n+      // Anything lower than normal priority should remain at the current level.\\n+      priorityLevel = currentPriorityLevel_DEPRECATED;\\n+      break;\\n+  }\\n+\\n+  const previousPriorityLevel = currentPriorityLevel_DEPRECATED;\\n+  currentPriorityLevel_DEPRECATED = priorityLevel;\\n+  try {\\n+    return callback();\\n+  } finally {\\n+    currentPriorityLevel_DEPRECATED = previousPriorityLevel;\\n+  }\\n+}\\n+\\n+export function unstable_wrapCallback<T>(callback: () => T): () => T {\\n+  const parentPriorityLevel = currentPriorityLevel_DEPRECATED;\\n+  return () => {\\n+    const previousPriorityLevel = currentPriorityLevel_DEPRECATED;\\n+    currentPriorityLevel_DEPRECATED = parentPriorityLevel;\\n+    try {\\n+      return callback();\\n+    } finally {\\n+      currentPriorityLevel_DEPRECATED = previousPriorityLevel;\\n+    }\\n+  };\\n+}\\n+\\n+export function unstable_forceFrameRate() {}\\n+\\n+export function unstable_pauseExecution() {}\\n+\\n+export function unstable_continueExecution() {}\\n+\\n+export function unstable_getFirstCallbackNode() {\\n+  return null;\\n+}\\n+\\n+// Currently no profiling build\\n+export const unstable_Profiling = null;"},{"sha":"8ad6228bb8a916263a3bc6cdc83e4c8c7ec3f47e","filename":"packages/scheduler/src/__tests__/SchedulerPostTask-test.js","status":"modified","additions":134,"deletions":98,"changes":232,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/src/__tests__/SchedulerPostTask-test.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/src/__tests__/SchedulerPostTask-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/__tests__/SchedulerPostTask-test.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -17,18 +17,16 @@ let runtime;\\n let performance;\\n let cancelCallback;\\n let scheduleCallback;\\n+let ImmediatePriority;\\n let NormalPriority;\\n+let UserBlockingPriority;\\n+let LowPriority;\\n+let IdlePriority;\\n \\n // The Scheduler postTask implementation uses a new postTask browser API to\\n-// schedule work on the main thread. Most of our tests treat this as an\\n-// implementation detail; however, the sequence and timing of browser\\n-// APIs are not precisely specified, and can vary across browsers.\\n-//\\n-// To prevent regressions, we need the ability to simulate specific edge cases\\n-// that we may encounter in various browsers.\\n-//\\n-// This test suite mocks all browser methods used in our implementation. It\\n-// assumes as little as possible about the order and timing of events.s\\n+// schedule work on the main thread. This test suite mocks all browser methods\\n+// used in our implementation. It assumes as little as possible about the order\\n+// and timing of events.\\n describe(\'SchedulerPostTask\', () => {\\n   beforeEach(() => {\\n     jest.resetModules();\\n@@ -37,18 +35,17 @@ describe(\'SchedulerPostTask\', () => {\\n     jest.mock(\'scheduler\', () =>\\n       require.requireActual(\'scheduler/unstable_post_task\'),\\n     );\\n-    jest.mock(\'scheduler/src/SchedulerHostConfig\', () =>\\n-      require.requireActual(\\n-        \'scheduler/src/forks/SchedulerHostConfig.post-task.js\',\\n-      ),\\n-    );\\n \\n     runtime = installMockBrowserRuntime();\\n     performance = window.performance;\\n     Scheduler = require(\'scheduler\');\\n     cancelCallback = Scheduler.unstable_cancelCallback;\\n     scheduleCallback = Scheduler.unstable_scheduleCallback;\\n+    ImmediatePriority = Scheduler.unstable_ImmediatePriority;\\n+    UserBlockingPriority = Scheduler.unstable_UserBlockingPriority;\\n     NormalPriority = Scheduler.unstable_NormalPriority;\\n+    LowPriority = Scheduler.unstable_LowPriority;\\n+    IdlePriority = Scheduler.unstable_IdlePriority;\\n   });\\n \\n   afterEach(() => {\\n@@ -58,43 +55,48 @@ describe(\'SchedulerPostTask\', () => {\\n   });\\n \\n   function installMockBrowserRuntime() {\\n-    let hasPendingTask = false;\\n-    let timerIDCounter = 0;\\n+    let taskQueue = new Map();\\n     let eventLog = [];\\n \\n     // Mock window functions\\n     const window = {};\\n     global.window = window;\\n \\n+    let idCounter = 0;\\n     let currentTime = 0;\\n     window.performance = {\\n       now() {\\n         return currentTime;\\n       },\\n     };\\n \\n-    window.setTimeout = (cb, delay) => {\\n-      const id = timerIDCounter++;\\n-      log(`Set Timer`);\\n-      // TODO\\n-      return id;\\n-    };\\n-    window.clearTimeout = id => {\\n-      // TODO\\n-    };\\n-\\n     // Mock browser scheduler.\\n     const scheduler = {};\\n     global.scheduler = scheduler;\\n \\n-    let nextTask;\\n-    scheduler.postTask = function(callback) {\\n-      if (hasPendingTask) {\\n-        throw Error(\'Task already scheduled\');\\n+    scheduler.postTask = function(callback, {priority, signal}) {\\n+      const id = idCounter++;\\n+      log(\\n+        `Post Task ${id} [${priority === undefined ? \'<default>\' : priority}]`,\\n+      );\\n+      const controller = signal._controller;\\n+      return new Promise((resolve, reject) => {\\n+        taskQueue.set(controller, {id, callback, resolve, reject});\\n+      });\\n+    };\\n+\\n+    global.TaskController = class TaskController {\\n+      constructor() {\\n+        this.signal = {_controller: this};\\n+      }\\n+      abort() {\\n+        const task = taskQueue.get(this);\\n+        if (task !== undefined) {\\n+          taskQueue.delete(this);\\n+          const reject = task.reject;\\n+          reject(new Error(\'Aborted\'));\\n+        }\\n       }\\n-      log(\'Post Task\');\\n-      hasPendingTask = true;\\n-      nextTask = callback;\\n     };\\n \\n     function ensureLogIsEmpty() {\\n@@ -105,22 +107,26 @@ describe(\'SchedulerPostTask\', () => {\\n     function advanceTime(ms) {\\n       currentTime += ms;\\n     }\\n-    function fireNextTask() {\\n+    function flushTasks() {\\n       ensureLogIsEmpty();\\n-      if (!hasPendingTask) {\\n-        throw Error(\'No task was scheduled\');\\n-      }\\n-      hasPendingTask = false;\\n-\\n-      log(\'Task Event\');\\n \\n       // If there\'s a continuation, it will call postTask again\\n       // which will set nextTask. That means we need to clear\\n       // nextTask before the invocation, otherwise we would\\n       // delete the continuation task.\\n-      const task = nextTask;\\n-      nextTask = null;\\n-      task();\\n+      const prevTaskQueue = taskQueue;\\n+      taskQueue = new Map();\\n+      for (const [, {id, callback, resolve, reject}] of prevTaskQueue) {\\n+        try {\\n+          log(`Task ${id} Fired`);\\n+          callback(false);\\n+          resolve();\\n+        } catch (error) {\\n+          log(`Task ${id} errored [${error.message}]`);\\n+          reject(error);\\n+          continue;\\n+        }\\n+      }\\n     }\\n     function log(val) {\\n       eventLog.push(val);\\n@@ -135,7 +141,7 @@ describe(\'SchedulerPostTask\', () => {\\n     }\\n     return {\\n       advanceTime,\\n-      fireNextTask,\\n+      flushTasks,\\n       log,\\n       isLogEmpty,\\n       assertLog,\\n@@ -144,16 +150,16 @@ describe(\'SchedulerPostTask\', () => {\\n \\n   it(\'task that finishes before deadline\', () => {\\n     scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'Task\');\\n+      runtime.log(\'A\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'Task\']);\\n+    runtime.assertLog([\'Post Task 0 [user-visible]\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 0 Fired\', \'A\']);\\n   });\\n \\n   it(\'task with continuation\', () => {\\n     scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'Task\');\\n+      runtime.log(\'A\');\\n       while (!Scheduler.unstable_shouldYield()) {\\n         runtime.advanceTime(1);\\n       }\\n@@ -162,13 +168,18 @@ describe(\'SchedulerPostTask\', () => {\\n         runtime.log(\'Continuation\');\\n       };\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n+    runtime.assertLog([\'Post Task 0 [user-visible]\']);\\n \\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'Task\', \'Yield at 5ms\', \'Post Task\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\\n+      \'Task 0 Fired\',\\n+      \'A\',\\n+      \'Yield at 5ms\',\\n+      \'Post Task 1 [user-visible]\',\\n+    ]);\\n \\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'Continuation\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 1 Fired\', \'Continuation\']);\\n   });\\n \\n   it(\'multiple tasks\', () => {\\n@@ -178,90 +189,115 @@ describe(\'SchedulerPostTask\', () => {\\n     scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'B\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'A\', \'B\']);\\n-  });\\n-\\n-  it(\'multiple tasks with a yield in between\', () => {\\n-    scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'A\');\\n-      runtime.advanceTime(4999);\\n-    });\\n-    scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'B\');\\n-    });\\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n     runtime.assertLog([\\n-      \'Task Event\',\\n-      \'A\',\\n-      // Ran out of time. Post a continuation event.\\n-      \'Post Task\',\\n+      \'Post Task 0 [user-visible]\',\\n+      \'Post Task 1 [user-visible]\',\\n     ]);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'B\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 0 Fired\', \'A\', \'Task 1 Fired\', \'B\']);\\n   });\\n \\n   it(\'cancels tasks\', () => {\\n     const task = scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'Task\');\\n+      runtime.log(\'A\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n+    runtime.assertLog([\'Post Task 0 [user-visible]\']);\\n     cancelCallback(task);\\n+    runtime.flushTasks();\\n     runtime.assertLog([]);\\n   });\\n \\n-  it(\'throws when a task errors then continues in a new event\', () => {\\n+  it(\'an error in one task does not affect execution of other tasks\', () => {\\n     scheduleCallback(NormalPriority, () => {\\n-      runtime.log(\'Oops!\');\\n       throw Error(\'Oops!\');\\n     });\\n     scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'Yay\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n-\\n-    expect(() => runtime.fireNextTask()).toThrow(\'Oops!\');\\n-    runtime.assertLog([\'Task Event\', \'Oops!\', \'Post Task\']);\\n-\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'Yay\']);\\n+    runtime.assertLog([\\n+      \'Post Task 0 [user-visible]\',\\n+      \'Post Task 1 [user-visible]\',\\n+    ]);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\\n+      \'Task 0 Fired\',\\n+      \'Task 0 errored [Oops!]\',\\n+      \'Task 1 Fired\',\\n+      \'Yay\',\\n+    ]);\\n   });\\n \\n   it(\'schedule new task after queue has emptied\', () => {\\n     scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'A\');\\n     });\\n \\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'A\']);\\n+    runtime.assertLog([\'Post Task 0 [user-visible]\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 0 Fired\', \'A\']);\\n \\n     scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'B\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'B\']);\\n+    runtime.assertLog([\'Post Task 1 [user-visible]\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 1 Fired\', \'B\']);\\n   });\\n \\n   it(\'schedule new task after a cancellation\', () => {\\n     const handle = scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'A\');\\n     });\\n \\n-    runtime.assertLog([\'Post Task\']);\\n+    runtime.assertLog([\'Post Task 0 [user-visible]\']);\\n     cancelCallback(handle);\\n \\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([]);\\n \\n     scheduleCallback(NormalPriority, () => {\\n       runtime.log(\'B\');\\n     });\\n-    runtime.assertLog([\'Post Task\']);\\n-    runtime.fireNextTask();\\n-    runtime.assertLog([\'Task Event\', \'B\']);\\n+    runtime.assertLog([\'Post Task 1 [user-visible]\']);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\'Task 1 Fired\', \'B\']);\\n+  });\\n+\\n+  it(\'schedules tasks at different priorities\', () => {\\n+    scheduleCallback(ImmediatePriority, () => {\\n+      runtime.log(\'A\');\\n+    });\\n+    scheduleCallback(UserBlockingPriority, () => {\\n+      runtime.log(\'B\');\\n+    });\\n+    scheduleCallback(NormalPriority, () => {\\n+      runtime.log(\'C\');\\n+    });\\n+    scheduleCallback(LowPriority, () => {\\n+      runtime.log(\'D\');\\n+    });\\n+    scheduleCallback(IdlePriority, () => {\\n+      runtime.log(\'E\');\\n+    });\\n+    runtime.assertLog([\\n+      \'Post Task 0 [user-blocking]\',\\n+      \'Post Task 1 [user-blocking]\',\\n+      \'Post Task 2 [user-visible]\',\\n+      \'Post Task 3 [user-visible]\',\\n+      \'Post Task 4 [background]\',\\n+    ]);\\n+    runtime.flushTasks();\\n+    runtime.assertLog([\\n+      \'Task 0 Fired\',\\n+      \'A\',\\n+      \'Task 1 Fired\',\\n+      \'B\',\\n+      \'Task 2 Fired\',\\n+      \'C\',\\n+      \'Task 3 Fired\',\\n+      \'D\',\\n+      \'Task 4 Fired\',\\n+      \'E\',\\n+    ]);\\n   });\\n });"},{"sha":"1bd6bbea03ecfd78f8602b5e0f21175542925910","filename":"packages/scheduler/src/forks/SchedulerHostConfig.post-task.js","status":"removed","additions":0,"deletions":99,"changes":99,"blob_url":"https://github.com/facebook/react/blob/c8d9b8878a3a50fe94db5407727a3d5cba13f971/packages/scheduler/src/forks/SchedulerHostConfig.post-task.js","raw_url":"https://github.com/facebook/react/raw/c8d9b8878a3a50fe94db5407727a3d5cba13f971/packages/scheduler/src/forks/SchedulerHostConfig.post-task.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/forks/SchedulerHostConfig.post-task.js?ref=c8d9b8878a3a50fe94db5407727a3d5cba13f971","patch":"@@ -1,99 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- */\\n-\\n-// Capture local references to native APIs, in case a polyfill overrides them.\\n-const perf = window.performance;\\n-const setTimeout = window.setTimeout;\\n-const clearTimeout = window.clearTimeout;\\n-\\n-function postTask(callback) {\\n-  // Use experimental Chrome Scheduler postTask API.\\n-  global.scheduler.postTask(callback);\\n-}\\n-\\n-function getNow() {\\n-  return perf.now();\\n-}\\n-\\n-let isTaskLoopRunning = false;\\n-let scheduledHostCallback = null;\\n-let taskTimeoutID = -1;\\n-\\n-// Scheduler periodically yields in case there is other work on the main\\n-// thread, like user events. By default, it yields multiple times per frame.\\n-// It does not attempt to align with frame boundaries, since most tasks don\'t\\n-// need to be frame aligned; for those that do, use requestAnimationFrame.\\n-const yieldInterval = 5;\\n-let deadline = 0;\\n-\\n-// `isInputPending` is not available. Since we have no way of knowing if\\n-// there\'s pending input, always yield at the end of the frame.\\n-export function shouldYieldToHost() {\\n-  return getNow() >= deadline;\\n-}\\n-\\n-export function requestPaint() {\\n-  // Since we yield every frame regardless, `requestPaint` has no effect.\\n-}\\n-\\n-export function forceFrameRate(fps) {\\n-  // No-op\\n-}\\n-\\n-function performWorkUntilDeadline() {\\n-  if (scheduledHostCallback !== null) {\\n-    const currentTime = getNow();\\n-    // Yield after `yieldInterval` ms, regardless of where we are in the vsync\\n-    // cycle. This means there\'s always time remaining at the beginning of\\n-    // the message event.\\n-    deadline = currentTime + yieldInterval;\\n-    const hasTimeRemaining = true;\\n-    try {\\n-      const hasMoreWork = scheduledHostCallback(hasTimeRemaining, currentTime);\\n-      if (!hasMoreWork) {\\n-        isTaskLoopRunning = false;\\n-        scheduledHostCallback = null;\\n-      } else {\\n-        // If there\'s more work, schedule the next message event at the end\\n-        // of the preceding one.\\n-        postTask(performWorkUntilDeadline);\\n-      }\\n-    } catch (error) {\\n-      // If a scheduler task throws, exit the current browser task so the\\n-      // error can be observed.\\n-      postTask(performWorkUntilDeadline);\\n-      throw error;\\n-    }\\n-  } else {\\n-    isTaskLoopRunning = false;\\n-  }\\n-}\\n-\\n-export function requestHostCallback(callback) {\\n-  scheduledHostCallback = callback;\\n-  if (!isTaskLoopRunning) {\\n-    isTaskLoopRunning = true;\\n-    postTask(performWorkUntilDeadline);\\n-  }\\n-}\\n-\\n-export function cancelHostCallback() {\\n-  scheduledHostCallback = null;\\n-}\\n-\\n-export function requestHostTimeout(callback, ms) {\\n-  taskTimeoutID = setTimeout(() => {\\n-    callback(getNow());\\n-  }, ms);\\n-}\\n-\\n-export function cancelHostTimeout() {\\n-  clearTimeout(taskTimeoutID);\\n-  taskTimeoutID = -1;\\n-}\\n-\\n-export const getCurrentTime = getNow;"},{"sha":"666eff8a8589827552edd93690ce1255236bb1ff","filename":"packages/scheduler/unstable_post_task.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/unstable_post_task.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/packages/scheduler/unstable_post_task.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/unstable_post_task.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -7,4 +7,4 @@\\n \\n \'use strict\';\\n \\n-export * from \'./src/Scheduler\';\\n+export * from \'./src/SchedulerPostTask\';"},{"sha":"e34daab32c6d3cb6866b74f20df6c239b1b55709","filename":"scripts/rollup/forks.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/forks.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/forks.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/forks.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -209,8 +209,6 @@ const forks = Object.freeze({\\n       entry === \'react-test-renderer\'\\n     ) {\\n       return \'scheduler/src/forks/SchedulerHostConfig.mock\';\\n-    } else if (entry === \'scheduler/unstable_post_task\') {\\n-      return \'scheduler/src/forks/SchedulerHostConfig.post-task\';\\n     }\\n     return \'scheduler/src/forks/SchedulerHostConfig.default\';\\n   },"},{"sha":"4eae89839ae16d7dc31065b6fc0efd818d3597ea","filename":"scripts/rollup/validate/eslintrc.cjs.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.cjs.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.cjs.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/validate/eslintrc.cjs.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -30,6 +30,8 @@ module.exports = {\\n     Int32Array: true,\\n     ArrayBuffer: true,\\n \\n+    TaskController: true,\\n+\\n     // Flight\\n     Uint8Array: true,\\n     Promise: true,"},{"sha":"81383a59643e943d344127876cc2ffc3efa63559","filename":"scripts/rollup/validate/eslintrc.cjs2015.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.cjs2015.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.cjs2015.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/validate/eslintrc.cjs2015.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -30,6 +30,8 @@ module.exports = {\\n     Int32Array: true,\\n     ArrayBuffer: true,\\n \\n+    TaskController: true,\\n+\\n     // Flight\\n     Uint8Array: true,\\n     Promise: true,"},{"sha":"9c9f6b780a935a7894aef1ad182a1bc842b76656","filename":"scripts/rollup/validate/eslintrc.fb.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.fb.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/validate/eslintrc.fb.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -31,6 +31,8 @@ module.exports = {\\n     Int32Array: true,\\n     ArrayBuffer: true,\\n \\n+    TaskController: true,\\n+\\n     // Flight\\n     Uint8Array: true,\\n     Promise: true,"},{"sha":"4fb8181ae7096c607e4e184b29b8a2d40ba48ab0","filename":"scripts/rollup/validate/eslintrc.rn.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.rn.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.rn.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/validate/eslintrc.rn.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -29,6 +29,8 @@ module.exports = {\\n     SharedArrayBuffer: true,\\n     Int32Array: true,\\n     ArrayBuffer: true,\\n+\\n+    TaskController: true,\\n   },\\n   parserOptions: {\\n     ecmaVersion: 5,"},{"sha":"e3786ffd3b6c2276a68f3468049dce907ea444fd","filename":"scripts/rollup/validate/eslintrc.umd.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.umd.js","raw_url":"https://github.com/facebook/react/raw/b8ed6a1aa580e4de80f707293015d638d3252d63/scripts/rollup/validate/eslintrc.umd.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/validate/eslintrc.umd.js?ref=b8ed6a1aa580e4de80f707293015d638d3252d63","patch":"@@ -34,6 +34,8 @@ module.exports = {\\n     Int32Array: true,\\n     ArrayBuffer: true,\\n \\n+    TaskController: true,\\n+\\n     // Flight\\n     Uint8Array: true,\\n     Promise: true,"}],"stats":{"total":600,"additions":400,"deletions":200}},{"date":"Aug 11th 20","parents":[{"sha":"ce37bfad5f61dcca7c2d0c0787bc65e64614c912","url":"https://api.github.com/repos/facebook/react/commits/ce37bfad5f61dcca7c2d0c0787bc65e64614c912","html_url":"https://github.com/facebook/react/commit/ce37bfad5f61dcca7c2d0c0787bc65e64614c912"}],"author":"rickhanlonii","files":[{"sha":"559add55dbd649cf3ab2edbffd57794c50db091a","filename":".circleci/config.yml","status":"modified","additions":52,"deletions":71,"changes":123,"blob_url":"https://github.com/facebook/react/blob/c8d9b8878a3a50fe94db5407727a3d5cba13f971/.circleci/config.yml","raw_url":"https://github.com/facebook/react/raw/c8d9b8878a3a50fe94db5407727a3d5cba13f971/.circleci/config.yml","contents_url":"https://api.github.com/repos/facebook/react/contents/.circleci/config.yml?ref=c8d9b8878a3a50fe94db5407727a3d5cba13f971","patch":"@@ -7,17 +7,11 @@ aliases:\\n   - &environment\\n     TZ: /usr/share/zoneinfo/America/Los_Angeles\\n \\n-  - &restore_yarn_cache\\n+  - &restore_node_modules\\n     restore_cache:\\n       name: Restore node_modules cache\\n       keys:\\n-        - v2-node-{{ arch }}-{{ .Branch }}-{{ checksum \\"yarn.lock\\" }}\\n-        - v2-node-{{ arch }}-{{ .Branch }}-\\n-        - v2-node-{{ arch }}-\\n-  - &run_yarn\\n-    run:\\n-      name: Install Packages\\n-      command: yarn --frozen-lockfile\\n+        - v2-node-{{ arch }}-{{ .Branch }}-{{ checksum \\"yarn.lock\\" }}-node-modules\\n \\n   - &TEST_PARALLELISM 20\\n \\n@@ -30,8 +24,7 @@ aliases:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: node ./scripts/rollup/consolidateBundleSizes.js\\n       - run: ./scripts/circleci/pack_and_store_artifact.sh\\n       - store_artifacts:\\n@@ -59,22 +52,37 @@ jobs:\\n       - run:\\n           name: Nodejs Version\\n           command: node --version\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - restore_cache:\\n+          name: Restore yarn cache\\n+          key: v2-node-{{ arch }}-{{ checksum \\"yarn.lock\\" }}-yarn\\n+      - run:\\n+          name: Install Packages\\n+          command: yarn --frozen-lockfile --cache-folder ~/.cache/yarn\\n       - save_cache:\\n-          name: Save node_modules cache\\n-          key: v2-node-{{ arch }}-{{ .Branch }}-{{ checksum \\"yarn.lock\\" }}\\n+          # Store the yarn cache globally for all lock files with this same\\n+          # checksum. This will speed up the setup job for all PRs where the\\n+          # lockfile is the same.\\n+          name: Save yarn cache for future installs\\n+          key: v2-node-{{ arch }}-{{ checksum \\"yarn.lock\\" }}-yarn\\n           paths:\\n             - ~/.cache/yarn\\n+      - save_cache:\\n+          # Store node_modules for all jobs in this workflow so that they don\'t\\n+          # need to each run a yarn install for each job. This will speed up\\n+          # all jobs run on this branch with the same lockfile.\\n+          name: Save node_modules cache\\n+          # This cache key is per branch, a yarn install in setup is required.\\n+          key: v2-node-{{ arch }}-{{ .Branch }}-{{ checksum \\"yarn.lock\\" }}-node-modules\\n+          paths:\\n+            - node_modules\\n \\n   yarn_lint:\\n     docker: *docker\\n     environment: *environment\\n \\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: node ./scripts/prettier/index\\n       - run: node ./scripts/tasks/eslint\\n       - run: ./scripts/circleci/check_license.sh\\n@@ -87,8 +95,7 @@ jobs:\\n \\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: node ./scripts/tasks/flow-ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test:\\n@@ -98,8 +105,7 @@ jobs:\\n \\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=stable --ci\\n \\n   yarn_test:\\n@@ -108,8 +114,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_www:\\n@@ -118,8 +123,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-classic --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_www_variant:\\n@@ -128,8 +132,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-classic --variant --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_prod_www:\\n@@ -138,8 +141,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-classic --prod --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_prod_www_variant:\\n@@ -148,8 +150,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-classic --prod --variant --ci\\n \\n   yarn_test_www:\\n@@ -158,8 +159,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-modern --ci\\n \\n   yarn_test_www_variant:\\n@@ -168,8 +168,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-modern --variant --ci\\n \\n   yarn_test_prod_www:\\n@@ -178,8 +177,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-modern --prod --ci\\n \\n   yarn_test_prod_www_variant:\\n@@ -188,8 +186,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=www-modern --prod --variant --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_persistent:\\n@@ -199,8 +196,7 @@ jobs:\\n \\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=stable --persistent --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_prod:\\n@@ -210,8 +206,7 @@ jobs:\\n \\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=stable --prod --ci\\n \\n   yarn_test_prod:\\n@@ -220,8 +215,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=experimental --prod --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_build:\\n@@ -230,8 +224,7 @@ jobs:\\n     parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run:\\n           environment:\\n             RELEASE_CHANNEL: stable\\n@@ -257,8 +250,7 @@ jobs:\\n     parallelism: 20\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run:\\n           environment:\\n             RELEASE_CHANNEL: experimental\\n@@ -285,8 +277,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run:\\n           environment:\\n             RELEASE_CHANNEL: experimental\\n@@ -305,8 +296,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       # This runs in the process_artifacts job, too, but it\'s faster to run\\n       # this step in both jobs instead of running the jobs sequentially\\n       - run: node ./scripts/rollup/consolidateBundleSizes.js\\n@@ -321,8 +311,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       # This runs in the process_artifacts job, too, but it\'s faster to run\\n       # this step in both jobs instead of running the jobs sequentially\\n       - run: node ./scripts/rollup/consolidateBundleSizes.js\\n@@ -337,8 +326,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn lint-build\\n       - run: scripts/circleci/check_minified_errors.sh\\n \\n@@ -348,8 +336,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run:\\n           environment:\\n             RELEASE_CHANNEL: stable\\n@@ -363,8 +350,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=stable --build --ci\\n \\n   yarn_test_build:\\n@@ -374,8 +360,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=experimental --build --ci\\n \\n   yarn_test_build_devtools:\\n@@ -384,8 +369,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --project=devtools --build --ci\\n \\n   RELEASE_CHANNEL_stable_yarn_test_dom_fixtures:\\n@@ -394,7 +378,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n+      - *restore_node_modules\\n       - run:\\n           name: Run DOM fixture tests\\n           environment:\\n@@ -410,8 +394,7 @@ jobs:\\n     environment: *environment\\n     steps:\\n       - checkout\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run:\\n           name: Run fuzz tests\\n           command: |\\n@@ -425,8 +408,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=stable --build --prod --ci\\n \\n   yarn_test_build_prod:\\n@@ -436,8 +418,7 @@ jobs:\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n-      - *restore_yarn_cache\\n-      - *run_yarn\\n+      - *restore_node_modules\\n       - run: yarn test --release-channel=experimental --build --prod --ci\\n \\n workflows:"}],"stats":{"total":123,"additions":52,"deletions":71}},{"date":"Aug 12th 20","parents":[{"sha":"b6e1d086043a801682ff01b00c7a623d529b46c0","url":"https://api.github.com/repos/facebook/react/commits/b6e1d086043a801682ff01b00c7a623d529b46c0","html_url":"https://github.com/facebook/react/commit/b6e1d086043a801682ff01b00c7a623d529b46c0"}],"author":"acdlite","files":[{"sha":"5d986d5127cb061447422f3ac389fb9192121a0f","filename":"packages/scheduler/src/SchedulerPostTask.js","status":"modified","additions":16,"deletions":17,"changes":33,"blob_url":"https://github.com/facebook/react/blob/629125555f381764c9f4943e877985274ebbc1b6/packages/scheduler/src/SchedulerPostTask.js","raw_url":"https://github.com/facebook/react/raw/629125555f381764c9f4943e877985274ebbc1b6/packages/scheduler/src/SchedulerPostTask.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/SchedulerPostTask.js?ref=629125555f381764c9f4943e877985274ebbc1b6","patch":"@@ -39,6 +39,7 @@ export {\\n \\n // Capture local references to native APIs, in case a polyfill overrides them.\\n const perf = window.performance;\\n+const setTimeout = window.setTimeout;\\n \\n // Use experimental Chrome Scheduler postTask API.\\n const scheduler = global.scheduler;\\n@@ -112,7 +113,7 @@ export function unstable_scheduleCallback<T>(\\n       runTask.bind(null, priorityLevel, postTaskPriority, node, callback),\\n       postTaskOptions,\\n     )\\n-    .catch(handlePostTaskError);\\n+    .catch(handleAbortError);\\n \\n   return node;\\n }\\n@@ -150,30 +151,28 @@ function runTask<T>(\\n           ),\\n           continuationOptions,\\n         )\\n-        .catch(handlePostTaskError);\\n+        .catch(handleAbortError);\\n     }\\n+  } catch (error) {\\n+    // We\'re inside a `postTask` promise. If we don\'t handle this error, then it\\n+    // will trigger an \\"Unhandled promise rejection\\" error. We don\'t want that,\\n+    // but we do want the default error reporting behavior that normal\\n+    // (non-Promise) tasks get for unhandled errors.\\n+    //\\n+    // So we\'ll re-throw the error inside a regular browser task.\\n+    setTimeout(() => {\\n+      throw error;\\n+    });\\n   } finally {\\n     currentPriorityLevel_DEPRECATED = NormalPriority;\\n   }\\n }\\n \\n-function handlePostTaskError(error) {\\n-  // This error is either a user error thrown by a callback, or an AbortError\\n-  // as a result of a cancellation.\\n-  //\\n-  // User errors trigger a global `error` event even if we don\'t rethrow them.\\n-  // In fact, if we do rethrow them, they\'ll get reported to the console twice.\\n-  // I\'m not entirely sure the current `postTask` spec makes sense here. If I\\n-  // catch a `postTask` call, it shouldn\'t trigger a global error.\\n-  //\\n+function handleAbortError(error) {\\n   // Abort errors are an implementation detail. We don\'t expose the\\n   // TaskController to the user, nor do we expose the promise that is returned\\n-  // from `postTask`. So we shouldn\'t rethrow those, either, since there\'s no\\n-  // way to handle them. (If we did return the promise to the user, then it\\n-  // should be up to them to handle the AbortError.)\\n-  //\\n-  // In either case, we can suppress the error, barring changes to the spec\\n-  // or the Scheduler API.\\n+  // from `postTask`. So we should suppress them, since there\'s no way for the\\n+  // user to handle them.\\n }\\n \\n export function unstable_cancelCallback(node: CallbackNode) {"},{"sha":"19b6e330b82fb6dd658aedc312796034e6a8632d","filename":"packages/scheduler/src/__tests__/SchedulerPostTask-test.js","status":"modified","additions":14,"deletions":16,"changes":30,"blob_url":"https://github.com/facebook/react/blob/629125555f381764c9f4943e877985274ebbc1b6/packages/scheduler/src/__tests__/SchedulerPostTask-test.js","raw_url":"https://github.com/facebook/react/raw/629125555f381764c9f4943e877985274ebbc1b6/packages/scheduler/src/__tests__/SchedulerPostTask-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/__tests__/SchedulerPostTask-test.js?ref=629125555f381764c9f4943e877985274ebbc1b6","patch":"@@ -70,6 +70,15 @@ describe(\'SchedulerPostTask\', () => {\\n       },\\n     };\\n \\n+    // Note: setTimeout is used to report errors and nothing else.\\n+    window.setTimeout = cb => {\\n+      try {\\n+        cb();\\n+      } catch (error) {\\n+        runtime.log(`Error: ${error.message}`);\\n+      }\\n+    };\\n+\\n     // Mock browser scheduler.\\n     const scheduler = {};\\n     global.scheduler = scheduler;\\n@@ -116,16 +125,10 @@ describe(\'SchedulerPostTask\', () => {\\n       // delete the continuation task.\\n       const prevTaskQueue = taskQueue;\\n       taskQueue = new Map();\\n-      for (const [, {id, callback, resolve, reject}] of prevTaskQueue) {\\n-        try {\\n-          log(`Task ${id} Fired`);\\n-          callback(false);\\n-          resolve();\\n-        } catch (error) {\\n-          log(`Task ${id} errored [${error.message}]`);\\n-          reject(error);\\n-          continue;\\n-        }\\n+      for (const [, {id, callback, resolve}] of prevTaskQueue) {\\n+        log(`Task ${id} Fired`);\\n+        callback(false);\\n+        resolve();\\n       }\\n     }\\n     function log(val) {\\n@@ -219,12 +222,7 @@ describe(\'SchedulerPostTask\', () => {\\n       \'Post Task 1 [user-visible]\',\\n     ]);\\n     runtime.flushTasks();\\n-    runtime.assertLog([\\n-      \'Task 0 Fired\',\\n-      \'Task 0 errored [Oops!]\',\\n-      \'Task 1 Fired\',\\n-      \'Yay\',\\n-    ]);\\n+    runtime.assertLog([\'Task 0 Fired\', \'Error: Oops!\', \'Task 1 Fired\', \'Yay\']);\\n   });\\n \\n   it(\'schedule new task after queue has emptied\', () => {"}],"stats":{"total":63,"additions":30,"deletions":33}},{"date":"Aug 10th 20","parents":[{"sha":"2704bb5374e52ed548db96df2d975dae42158dfb","url":"https://api.github.com/repos/facebook/react/commits/2704bb5374e52ed548db96df2d975dae42158dfb","html_url":"https://github.com/facebook/react/commit/2704bb5374e52ed548db96df2d975dae42158dfb"}],"author":"gaearon","files":[{"sha":"724eba635de013cf24e1f2023dbd56d57704eae2","filename":"packages/react-test-renderer/package.json","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/ce37bfad5f61dcca7c2d0c0787bc65e64614c912/packages/react-test-renderer/package.json","raw_url":"https://github.com/facebook/react/raw/ce37bfad5f61dcca7c2d0c0787bc65e64614c912/packages/react-test-renderer/package.json","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-test-renderer/package.json?ref=ce37bfad5f61dcca7c2d0c0787bc65e64614c912","patch":"@@ -27,9 +27,6 @@\\n   \\"peerDependencies\\": {\\n     \\"react\\": \\"^17.0.0-alpha\\"\\n   },\\n-  \\"resolutions\\": {\\n-    \\"react-shallow-renderer/react-is\\": \\"^17.0.0-alpha\\"\\n-  },\\n   \\"files\\": [\\n     \\"LICENSE\\",\\n     \\"README.md\\","}],"stats":{"total":3,"additions":0,"deletions":3}},{"date":"Aug 10th 20","parents":[{"sha":"0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","url":"https://api.github.com/repos/facebook/react/commits/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","html_url":"https://github.com/facebook/react/commit/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f"}],"author":"kartikcho","files":[{"sha":"7e06b9821600a1ea394ddb17e540113e894a2b0f","filename":"packages/react-reconciler/src/SchedulingProfiler.js","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/facebook/react/blob/2704bb5374e52ed548db96df2d975dae42158dfb/packages/react-reconciler/src/SchedulingProfiler.js","raw_url":"https://github.com/facebook/react/raw/2704bb5374e52ed548db96df2d975dae42158dfb/packages/react-reconciler/src/SchedulingProfiler.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/SchedulingProfiler.js?ref=2704bb5374e52ed548db96df2d975dae42158dfb","patch":"@@ -15,6 +15,7 @@ import {\\n   enableSchedulingProfiler,\\n   enableSchedulingProfilerComponentStacks,\\n } from \'shared/ReactFeatureFlags\';\\n+import ReactVersion from \'shared/ReactVersion\';\\n import getComponentName from \'shared/getComponentName\';\\n import {getStackByFiberInDevAndProd} from \'./ReactFiberComponentStack\';\\n \\n@@ -29,6 +30,13 @@ function formatLanes(laneOrLanes: Lane | Lanes): string {\\n   return ((laneOrLanes: any): number).toString();\\n }\\n \\n+// Create a mark on React initialization\\n+if (enableSchedulingProfiler) {\\n+  if (supportsUserTiming) {\\n+    performance.mark(`--react-init-${ReactVersion}`);\\n+  }\\n+}\\n+\\n export function markCommitStarted(lanes: Lanes): void {\\n   if (enableSchedulingProfiler) {\\n     if (supportsUserTiming) {"},{"sha":"ce6bc2ac0904cda50f853c360509d9b9c01f482b","filename":"packages/react-reconciler/src/__tests__/SchedulingProfiler-test.internal.js","status":"modified","additions":46,"deletions":10,"changes":56,"blob_url":"https://github.com/facebook/react/blob/2704bb5374e52ed548db96df2d975dae42158dfb/packages/react-reconciler/src/__tests__/SchedulingProfiler-test.internal.js","raw_url":"https://github.com/facebook/react/raw/2704bb5374e52ed548db96df2d975dae42158dfb/packages/react-reconciler/src/__tests__/SchedulingProfiler-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/__tests__/SchedulingProfiler-test.internal.js?ref=2704bb5374e52ed548db96df2d975dae42158dfb","patch":"@@ -10,6 +10,8 @@\\n \\n \'use strict\';\\n \\n+import ReactVersion from \'shared/ReactVersion\';\\n+\\n function normalizeCodeLocInfo(str) {\\n   return (\\n     str &&\\n@@ -54,6 +56,7 @@ describe(\'SchedulingProfiler\', () => {\\n   beforeEach(() => {\\n     jest.resetModules();\\n     global.performance = createUserTimingPolyfill();\\n+    marks = [];\\n \\n     React = require(\'react\');\\n \\n@@ -62,8 +65,6 @@ describe(\'SchedulingProfiler\', () => {\\n     ReactNoop = require(\'react-noop-renderer\');\\n \\n     Scheduler = require(\'scheduler\');\\n-\\n-    marks = [];\\n   });\\n \\n   afterEach(() => {\\n@@ -76,11 +77,17 @@ describe(\'SchedulingProfiler\', () => {\\n     expect(marks).toEqual([]);\\n   });\\n \\n+  // @gate enableSchedulingProfiler\\n+  it(\'should log React version on initialization\', () => {\\n+    expect(marks).toEqual([`--react-init-${ReactVersion}`]);\\n+  });\\n+\\n   // @gate enableSchedulingProfiler\\n   it(\'should mark sync render without suspends or state updates\', () => {\\n     ReactTestRenderer.create(<div />);\\n \\n     expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n       \'--schedule-render-1\',\\n       \'--render-start-1\',\\n       \'--render-stop\',\\n@@ -95,7 +102,10 @@ describe(\'SchedulingProfiler\', () => {\\n   it(\'should mark concurrent render without suspends or state updates\', () => {\\n     ReactTestRenderer.create(<div />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -128,6 +138,7 @@ describe(\'SchedulingProfiler\', () => {\\n     expect(ReactNoop.flushNextYield()).toEqual([\'Foo\']);\\n \\n     expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n       \'--schedule-render-512\',\\n       \'--render-start-512\',\\n       \'--render-yield\',\\n@@ -148,6 +159,7 @@ describe(\'SchedulingProfiler\', () => {\\n     );\\n \\n     expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n       \'--schedule-render-1\',\\n       \'--render-start-1\',\\n       toggleComponentStacks(\\n@@ -184,6 +196,7 @@ describe(\'SchedulingProfiler\', () => {\\n     );\\n \\n     expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n       \'--schedule-render-1\',\\n       \'--render-start-1\',\\n       toggleComponentStacks(\\n@@ -220,7 +233,10 @@ describe(\'SchedulingProfiler\', () => {\\n       {unstable_isConcurrent: true},\\n     );\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -262,7 +278,10 @@ describe(\'SchedulingProfiler\', () => {\\n       {unstable_isConcurrent: true},\\n     );\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -304,7 +323,10 @@ describe(\'SchedulingProfiler\', () => {\\n \\n     ReactTestRenderer.create(<Example />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -340,7 +362,10 @@ describe(\'SchedulingProfiler\', () => {\\n \\n     ReactTestRenderer.create(<Example />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -377,7 +402,10 @@ describe(\'SchedulingProfiler\', () => {\\n \\n     ReactTestRenderer.create(<Example />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -414,7 +442,10 @@ describe(\'SchedulingProfiler\', () => {\\n \\n     ReactTestRenderer.create(<Example />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -449,7 +480,10 @@ describe(\'SchedulingProfiler\', () => {\\n \\n     ReactTestRenderer.create(<Example />, {unstable_isConcurrent: true});\\n \\n-    expect(marks).toEqual([\'--schedule-render-512\']);\\n+    expect(marks).toEqual([\\n+      `--react-init-${ReactVersion}`,\\n+      \'--schedule-render-512\',\\n+    ]);\\n \\n     marks.splice(0);\\n \\n@@ -489,6 +523,7 @@ describe(\'SchedulingProfiler\', () => {\\n     gate(({old}) => {\\n       if (old) {\\n         expect(marks.map(normalizeCodeLocInfo)).toEqual([\\n+          `--react-init-${ReactVersion}`,\\n           \'--schedule-render-512\',\\n           \'--render-start-512\',\\n           \'--render-stop\',\\n@@ -508,6 +543,7 @@ describe(\'SchedulingProfiler\', () => {\\n         ]);\\n       } else {\\n         expect(marks.map(normalizeCodeLocInfo)).toEqual([\\n+          `--react-init-${ReactVersion}`,\\n           \'--schedule-render-512\',\\n           \'--render-start-512\',\\n           \'--render-stop\',"}],"stats":{"total":64,"additions":54,"deletions":10}},{"date":"Aug 10th 20","parents":[{"sha":"94c0244bab7515c9b2c00b8e5312a9b6f31ef13a","url":"https://api.github.com/repos/facebook/react/commits/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a","html_url":"https://github.com/facebook/react/commit/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a"}],"author":"bvaughn","files":[{"sha":"25e56daf6f44e17539edcf50a944920db3b4134d","filename":"packages/react-devtools-shared/src/__tests__/__snapshots__/ownersListContext-test.js.snap","status":"modified","additions":27,"deletions":0,"changes":27,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-devtools-shared/src/__tests__/__snapshots__/ownersListContext-test.js.snap","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-devtools-shared/src/__tests__/__snapshots__/ownersListContext-test.js.snap","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/__tests__/__snapshots__/ownersListContext-test.js.snap?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -78,6 +78,33 @@ Array [\\n ]\\n `;\\n \\n+exports[`OwnersListContext should include all owners for a component wrapped in react memo: owners for \\"InnerComponent\\" 1`] = `\\n+Array [\\n+  Object {\\n+    \\"displayName\\": \\"Grandparent\\",\\n+    \\"hocDisplayNames\\": null,\\n+    \\"id\\": 2,\\n+    \\"type\\": 5,\\n+  },\\n+  Object {\\n+    \\"displayName\\": \\"InnerComponent\\",\\n+    \\"hocDisplayNames\\": Array [\\n+      \\"Memo\\",\\n+    ],\\n+    \\"id\\": 3,\\n+    \\"type\\": 8,\\n+  },\\n+  Object {\\n+    \\"displayName\\": \\"InnerComponent\\",\\n+    \\"hocDisplayNames\\": Array [\\n+      \\"ForwardRef\\",\\n+    ],\\n+    \\"id\\": 4,\\n+    \\"type\\": 6,\\n+  },\\n+]\\n+`;\\n+\\n exports[`OwnersListContext should include the current element even if there are no other owners: mount 1`] = `\\n [root]\\n     <Grandparent>"},{"sha":"4e60bd6a55025e6ce78f00510303802d57efd4a6","filename":"packages/react-devtools-shared/src/__tests__/ownersListContext-test.js","status":"modified","additions":39,"deletions":0,"changes":39,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-devtools-shared/src/__tests__/ownersListContext-test.js","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-devtools-shared/src/__tests__/ownersListContext-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/__tests__/ownersListContext-test.js?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -206,4 +206,43 @@ describe(\'OwnersListContext\', () => {\\n \\n     done();\\n   });\\n+\\n+  it(\'should include all owners for a component wrapped in react memo\', async done => {\\n+    const InnerComponent = (props, ref) => <div ref={ref} />;\\n+    const ForwardRef = React.forwardRef(InnerComponent);\\n+    const Memo = React.memo(ForwardRef);\\n+    const Grandparent = () => {\\n+      const ref = React.createRef();\\n+      return <Memo ref={ref} />;\\n+    };\\n+\\n+    utils.act(() =>\\n+      ReactDOM.render(<Grandparent />, document.createElement(\'div\')),\\n+    );\\n+\\n+    let didFinish = false;\\n+    function Suspender({owner}) {\\n+      const read = React.useContext(OwnersListContext);\\n+      const owners = read(owner.id);\\n+      didFinish = true;\\n+      expect(owners.length).toBe(3);\\n+      expect(owners).toMatchSnapshot(\\n+        `owners for \\"${(owner && owner.displayName) || \'\'}\\"`,\\n+      );\\n+      return null;\\n+    }\\n+\\n+    const wrapped = ((store.getElementAtIndex(2): any): Element);\\n+    await utils.actAsync(() =>\\n+      TestRenderer.create(\\n+        <Contexts defaultOwnerID={wrapped.id}>\\n+          <React.Suspense fallback={null}>\\n+            <Suspender owner={wrapped} />\\n+          </React.Suspense>\\n+        </Contexts>,\\n+      ),\\n+    );\\n+    expect(didFinish).toBe(true);\\n+    done();\\n+  });\\n });"},{"sha":"6a90a307c222c711cf053e69643dc297291f4492","filename":"packages/react-reconciler/src/ReactFiber.new.js","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiber.new.js","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiber.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiber.new.js?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -579,6 +579,10 @@ export function createFiberFromTypeAndProps(\\n   fiber.type = resolvedType;\\n   fiber.lanes = lanes;\\n \\n+  if (__DEV__) {\\n+    fiber._debugOwner = owner;\\n+  }\\n+\\n   return fiber;\\n }\\n "},{"sha":"3d896efe8e851a11ab662044f7340b77bcb81030","filename":"packages/react-reconciler/src/ReactFiber.old.js","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiber.old.js","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiber.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiber.old.js?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -573,6 +573,10 @@ export function createFiberFromTypeAndProps(\\n   fiber.type = resolvedType;\\n   fiber.lanes = lanes;\\n \\n+  if (__DEV__) {\\n+    fiber._debugOwner = owner;\\n+  }\\n+\\n   return fiber;\\n }\\n "},{"sha":"5dbb49e3a7c02f81fe8a3354ef401a91f258f820","filename":"packages/react-reconciler/src/ReactFiberBeginWork.new.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiberBeginWork.new.js","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiberBeginWork.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberBeginWork.new.js?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -434,7 +434,7 @@ function updateMemoComponent(\\n       Component.type,\\n       null,\\n       nextProps,\\n-      null,\\n+      workInProgress,\\n       workInProgress.mode,\\n       renderLanes,\\n     );"},{"sha":"163aedb4d66bfd668645ca8b495ebe7e4346a6e4","filename":"packages/react-reconciler/src/ReactFiberBeginWork.old.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiberBeginWork.old.js","raw_url":"https://github.com/facebook/react/raw/0c52e24cb65a8f1c370184f58ee2d5601a3acd7f/packages/react-reconciler/src/ReactFiberBeginWork.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberBeginWork.old.js?ref=0c52e24cb65a8f1c370184f58ee2d5601a3acd7f","patch":"@@ -434,7 +434,7 @@ function updateMemoComponent(\\n       Component.type,\\n       null,\\n       nextProps,\\n-      null,\\n+      workInProgress,\\n       workInProgress.mode,\\n       renderLanes,\\n     );"}],"stats":{"total":78,"additions":76,"deletions":2}},{"date":"Aug 10th 20","parents":[{"sha":"aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","url":"https://api.github.com/repos/facebook/react/commits/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","html_url":"https://github.com/facebook/react/commit/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705"}],"author":"gaearon","files":[{"sha":"b05b4c1f96144d978dd7fce2291b827bb0eccb4e","filename":"packages/react-dom/src/__tests__/ReactDOMFiber-test.js","status":"modified","additions":51,"deletions":0,"changes":51,"blob_url":"https://github.com/facebook/react/blob/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a/packages/react-dom/src/__tests__/ReactDOMFiber-test.js","raw_url":"https://github.com/facebook/react/raw/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a/packages/react-dom/src/__tests__/ReactDOMFiber-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMFiber-test.js?ref=94c0244bab7515c9b2c00b8e5312a9b6f31ef13a","patch":"@@ -989,6 +989,57 @@ describe(\'ReactDOMFiber\', () => {\\n     }\\n   });\\n \\n+  // Regression test for https://github.com/facebook/react/issues/19562\\n+  it(\'does not fire mouseEnter twice when relatedTarget is the root node\', () => {\\n+    let ops = [];\\n+    let target = null;\\n+\\n+    function simulateMouseMove(from, to) {\\n+      if (from) {\\n+        from.dispatchEvent(\\n+          new MouseEvent(\'mouseout\', {\\n+            bubbles: true,\\n+            cancelable: true,\\n+            relatedTarget: to,\\n+          }),\\n+        );\\n+      }\\n+      if (to) {\\n+        to.dispatchEvent(\\n+          new MouseEvent(\'mouseover\', {\\n+            bubbles: true,\\n+            cancelable: true,\\n+            relatedTarget: from,\\n+          }),\\n+        );\\n+      }\\n+    }\\n+\\n+    ReactDOM.render(\\n+      <div\\n+        ref={n => (target = n)}\\n+        onMouseEnter={() => ops.push(\'enter\')}\\n+        onMouseLeave={() => ops.push(\'leave\')}\\n+      />,\\n+      container,\\n+    );\\n+\\n+    simulateMouseMove(null, container);\\n+    expect(ops).toEqual([]);\\n+\\n+    ops = [];\\n+    simulateMouseMove(container, target);\\n+    expect(ops).toEqual([\'enter\']);\\n+\\n+    ops = [];\\n+    simulateMouseMove(target, container);\\n+    expect(ops).toEqual([\'leave\']);\\n+\\n+    ops = [];\\n+    simulateMouseMove(container, null);\\n+    expect(ops).toEqual([]);\\n+  });\\n+\\n   it(\'should throw on bad createPortal argument\', () => {\\n     expect(() => {\\n       ReactDOM.createPortal(<div>portal</div>, null);"},{"sha":"32ab29a91042bf0e682fb0cdb040ccd329ea555e","filename":"packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","status":"modified","additions":11,"deletions":6,"changes":17,"blob_url":"https://github.com/facebook/react/blob/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/94c0244bab7515c9b2c00b8e5312a9b6f31ef13a/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js?ref=94c0244bab7515c9b2c00b8e5312a9b6f31ef13a","patch":"@@ -22,6 +22,7 @@ import {\\n import {\\n   getClosestInstanceFromNode,\\n   getNodeFromInstance,\\n+  isContainerMarkedAsRoot,\\n } from \'../../client/ReactDOMComponentTree\';\\n import {accumulateEnterLeaveTwoPhaseListeners} from \'../DOMPluginEventSystem\';\\n \\n@@ -57,15 +58,19 @@ function extractEvents(\\n     domEventName === \'mouseout\' || domEventName === \'pointerout\';\\n \\n   if (isOverEvent && (eventSystemFlags & IS_REPLAYED) === 0) {\\n+    // If this is an over event with a target, we might have already dispatched\\n+    // the event in the out event of the other target. If this is replayed,\\n+    // then it\'s because we couldn\'t dispatch against this target previously\\n+    // so we have to do it now instead.\\n     const related =\\n       (nativeEvent: any).relatedTarget || (nativeEvent: any).fromElement;\\n     if (related) {\\n-      // Due to the fact we don\'t add listeners to the document with the\\n-      // modern event system and instead attach listeners to roots, we\\n-      // need to handle the over event case. To ensure this, we just need to\\n-      // make sure the node that we\'re coming from is managed by React.\\n-      const inst = getClosestInstanceFromNode(related);\\n-      if (inst !== null) {\\n+      // If the related node is managed by React, we can assume that we have\\n+      // already dispatched the corresponding events during its mouseout.\\n+      if (\\n+        getClosestInstanceFromNode(related) ||\\n+        isContainerMarkedAsRoot(related)\\n+      ) {\\n         return;\\n       }\\n     }"}],"stats":{"total":68,"additions":62,"deletions":6}},{"date":"Aug 10th 20","parents":[{"sha":"7f696bd99c39348a631c20378d2a8704634bab04","url":"https://api.github.com/repos/facebook/react/commits/7f696bd99c39348a631c20378d2a8704634bab04","html_url":"https://github.com/facebook/react/commit/7f696bd99c39348a631c20378d2a8704634bab04"}],"author":"gaearon","files":[{"sha":"59103e984ea408cf0a36c0d8f52b09d7369f9c16","filename":"packages/react-dom/src/events/plugins/__tests__/BeforeInputEventPlugin-test.js","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/facebook/react/blob/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/BeforeInputEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/BeforeInputEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/BeforeInputEventPlugin-test.js?ref=aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","previous_filename":"packages/react-dom/src/events/plugins/__tests__/ModernBeforeInputEventPlugin-test.js"},{"sha":"9f80e7329c5108cb1cbfc8d1d804ee041a24a3aa","filename":"packages/react-dom/src/events/plugins/__tests__/ChangeEventPlugin-test.js","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/facebook/react/blob/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/ChangeEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/ChangeEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/ChangeEventPlugin-test.js?ref=aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","previous_filename":"packages/react-dom/src/events/plugins/__tests__/ModernChangeEventPlugin-test.js"},{"sha":"7433aacca4b1fc9179e5be65e828b866ce77462c","filename":"packages/react-dom/src/events/plugins/__tests__/EnterLeaveEventPlugin-test.js","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/facebook/react/blob/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/EnterLeaveEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/EnterLeaveEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/EnterLeaveEventPlugin-test.js?ref=aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","previous_filename":"packages/react-dom/src/events/plugins/__tests__/ModernEnterLeaveEventPlugin-test.js"},{"sha":"538f3be346af2e36563106244b49523cc54c6606","filename":"packages/react-dom/src/events/plugins/__tests__/SelectEventPlugin-test.js","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/facebook/react/blob/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/SelectEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/SelectEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/SelectEventPlugin-test.js?ref=aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","previous_filename":"packages/react-dom/src/events/plugins/__tests__/ModernSelectEventPlugin-test.js"},{"sha":"4ed062404e52f61b0d2b761cd989bbbb72bb555b","filename":"packages/react-dom/src/events/plugins/__tests__/SimpleEventPlugin-test.js","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/facebook/react/blob/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/SimpleEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705/packages/react-dom/src/events/plugins/__tests__/SimpleEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/SimpleEventPlugin-test.js?ref=aa99b0b08e355fbbff3aaf6568d89b7a9c0e9705","previous_filename":"packages/react-dom/src/events/plugins/__tests__/ModernSimpleEventPlugin-test.js"}],"stats":{"total":0,"additions":0,"deletions":0}},{"date":"Aug 10th 20","parents":[{"sha":"7c30fb3b0b98d3e903e1dc60497f8e7ffb530153","url":"https://api.github.com/repos/facebook/react/commits/7c30fb3b0b98d3e903e1dc60497f8e7ffb530153","html_url":"https://github.com/facebook/react/commit/7c30fb3b0b98d3e903e1dc60497f8e7ffb530153"}],"author":"eps1lon","files":[{"sha":"06fb657227842ca3bf259cfbb7764ae12409f0a4","filename":"packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","status":"modified","additions":93,"deletions":0,"changes":93,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -50,6 +50,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onAnimationEnd\',\\n+        reactEventType: \'animationend\',\\n         nativeEvent: \'animationend\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -66,6 +67,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onAnimationIteration\',\\n+        reactEventType: \'animationiteration\',\\n         nativeEvent: \'animationiteration\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -82,6 +84,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onAnimationStart\',\\n+        reactEventType: \'animationstart\',\\n         nativeEvent: \'animationstart\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -98,6 +101,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onAuxClick\',\\n+        reactEventType: \'auxclick\',\\n         nativeEvent: \'auxclick\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -114,6 +118,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onBlur\',\\n+        reactEventType: \'blur\',\\n         nativeEvent: \'focusout\',\\n         dispatch(node) {\\n           const e = new Event(\'focusout\', {\\n@@ -133,6 +138,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onClick\',\\n+        reactEventType: \'click\',\\n         nativeEvent: \'click\',\\n         dispatch(node) {\\n           node.click();\\n@@ -144,6 +150,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onContextMenu\',\\n+        reactEventType: \'contextmenu\',\\n         nativeEvent: \'contextmenu\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -160,6 +167,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onCopy\',\\n+        reactEventType: \'copy\',\\n         nativeEvent: \'copy\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -176,6 +184,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onCut\',\\n+        reactEventType: \'cut\',\\n         nativeEvent: \'cut\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -192,6 +201,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDoubleClick\',\\n+        reactEventType: \'dblclick\',\\n         nativeEvent: \'dblclick\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -208,6 +218,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDrag\',\\n+        reactEventType: \'drag\',\\n         nativeEvent: \'drag\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -224,6 +235,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragEnd\',\\n+        reactEventType: \'dragend\',\\n         nativeEvent: \'dragend\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -240,6 +252,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragEnter\',\\n+        reactEventType: \'dragenter\',\\n         nativeEvent: \'dragenter\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -256,6 +269,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragExit\',\\n+        reactEventType: \'dragexit\',\\n         nativeEvent: \'dragexit\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -272,6 +286,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragLeave\',\\n+        reactEventType: \'dragleave\',\\n         nativeEvent: \'dragleave\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -288,6 +303,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragOver\',\\n+        reactEventType: \'dragover\',\\n         nativeEvent: \'dragover\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -304,6 +320,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDragStart\',\\n+        reactEventType: \'dragstart\',\\n         nativeEvent: \'dragstart\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -320,6 +337,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onDrop\',\\n+        reactEventType: \'drop\',\\n         nativeEvent: \'drop\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -336,6 +354,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onFocus\',\\n+        reactEventType: \'focus\',\\n         nativeEvent: \'focusin\',\\n         dispatch(node) {\\n           const e = new Event(\'focusin\', {\\n@@ -351,6 +370,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onGotPointerCapture\',\\n+        reactEventType: \'gotpointercapture\',\\n         nativeEvent: \'gotpointercapture\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -367,6 +387,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onKeyDown\',\\n+        reactEventType: \'keydown\',\\n         nativeEvent: \'keydown\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -383,6 +404,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onKeyPress\',\\n+        reactEventType: \'keypress\',\\n         nativeEvent: \'keypress\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -400,6 +422,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onKeyUp\',\\n+        reactEventType: \'keyup\',\\n         nativeEvent: \'keyup\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -416,6 +439,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onLostPointerCapture\',\\n+        reactEventType: \'lostpointercapture\',\\n         nativeEvent: \'lostpointercapture\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -432,6 +456,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onMouseDown\',\\n+        reactEventType: \'mousedown\',\\n         nativeEvent: \'mousedown\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -448,6 +473,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onMouseOut\',\\n+        reactEventType: \'mouseout\',\\n         nativeEvent: \'mouseout\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -464,6 +490,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onMouseOver\',\\n+        reactEventType: \'mouseover\',\\n         nativeEvent: \'mouseover\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -480,6 +507,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onMouseUp\',\\n+        reactEventType: \'mouseup\',\\n         nativeEvent: \'mouseup\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -496,6 +524,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPaste\',\\n+        reactEventType: \'paste\',\\n         nativeEvent: \'paste\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -512,6 +541,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerCancel\',\\n+        reactEventType: \'pointercancel\',\\n         nativeEvent: \'pointercancel\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -528,6 +558,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerDown\',\\n+        reactEventType: \'pointerdown\',\\n         nativeEvent: \'pointerdown\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -544,6 +575,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerMove\',\\n+        reactEventType: \'pointermove\',\\n         nativeEvent: \'pointermove\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -560,6 +592,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerOut\',\\n+        reactEventType: \'pointerout\',\\n         nativeEvent: \'pointerout\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -576,6 +609,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerOver\',\\n+        reactEventType: \'pointerover\',\\n         nativeEvent: \'pointerover\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -592,6 +626,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onPointerUp\',\\n+        reactEventType: \'pointerup\',\\n         nativeEvent: \'pointerup\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -608,6 +643,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'form\',\\n         reactEvent: \'onReset\',\\n+        reactEventType: \'reset\',\\n         nativeEvent: \'reset\',\\n         dispatch(node) {\\n           const e = new Event(\'reset\', {\\n@@ -623,6 +659,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'form\',\\n         reactEvent: \'onSubmit\',\\n+        reactEventType: \'submit\',\\n         nativeEvent: \'submit\',\\n         dispatch(node) {\\n           const e = new Event(\'submit\', {\\n@@ -638,6 +675,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onTouchCancel\',\\n+        reactEventType: \'touchcancel\',\\n         nativeEvent: \'touchcancel\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -654,6 +692,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onTouchEnd\',\\n+        reactEventType: \'touchend\',\\n         nativeEvent: \'touchend\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -670,6 +709,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onTouchMove\',\\n+        reactEventType: \'touchmove\',\\n         nativeEvent: \'touchmove\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -686,6 +726,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onTouchStart\',\\n+        reactEventType: \'touchstart\',\\n         nativeEvent: \'touchstart\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -702,6 +743,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onTransitionEnd\',\\n+        reactEventType: \'transitionend\',\\n         nativeEvent: \'transitionend\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -718,6 +760,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNativeBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onWheel\',\\n+        reactEventType: \'wheel\',\\n         nativeEvent: \'wheel\',\\n         dispatch(node) {\\n           node.dispatchEvent(\\n@@ -736,6 +779,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onAbort\',\\n+        reactEventType: \'abort\',\\n         nativeEvent: \'abort\',\\n         dispatch(node) {\\n           const e = new Event(\'abort\', {\\n@@ -751,6 +795,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'dialog\',\\n         reactEvent: \'onCancel\',\\n+        reactEventType: \'cancel\',\\n         nativeEvent: \'cancel\',\\n         dispatch(node) {\\n           const e = new Event(\'cancel\', {\\n@@ -766,6 +811,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onCanPlay\',\\n+        reactEventType: \'canplay\',\\n         nativeEvent: \'canplay\',\\n         dispatch(node) {\\n           const e = new Event(\'canplay\', {\\n@@ -781,6 +827,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onCanPlayThrough\',\\n+        reactEventType: \'canplaythrough\',\\n         nativeEvent: \'canplaythrough\',\\n         dispatch(node) {\\n           const e = new Event(\'canplaythrough\', {\\n@@ -796,6 +843,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'dialog\',\\n         reactEvent: \'onClose\',\\n+        reactEventType: \'close\',\\n         nativeEvent: \'close\',\\n         dispatch(node) {\\n           const e = new Event(\'close\', {\\n@@ -811,6 +859,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onDurationChange\',\\n+        reactEventType: \'durationchange\',\\n         nativeEvent: \'durationchange\',\\n         dispatch(node) {\\n           const e = new Event(\'durationchange\', {\\n@@ -826,6 +875,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onEmptied\',\\n+        reactEventType: \'emptied\',\\n         nativeEvent: \'emptied\',\\n         dispatch(node) {\\n           const e = new Event(\'emptied\', {\\n@@ -841,6 +891,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onEncrypted\',\\n+        reactEventType: \'encrypted\',\\n         nativeEvent: \'encrypted\',\\n         dispatch(node) {\\n           const e = new Event(\'encrypted\', {\\n@@ -856,6 +907,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onEnded\',\\n+        reactEventType: \'ended\',\\n         nativeEvent: \'ended\',\\n         dispatch(node) {\\n           const e = new Event(\'ended\', {\\n@@ -871,6 +923,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'img\',\\n         reactEvent: \'onError\',\\n+        reactEventType: \'error\',\\n         nativeEvent: \'error\',\\n         dispatch(node) {\\n           const e = new Event(\'error\', {\\n@@ -886,6 +939,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'input\',\\n         reactEvent: \'onInvalid\',\\n+        reactEventType: \'invalid\',\\n         nativeEvent: \'invalid\',\\n         dispatch(node) {\\n           const e = new Event(\'invalid\', {\\n@@ -901,6 +955,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'img\',\\n         reactEvent: \'onLoad\',\\n+        reactEventType: \'load\',\\n         nativeEvent: \'load\',\\n         dispatch(node) {\\n           const e = new Event(\'load\', {\\n@@ -916,6 +971,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onLoadedData\',\\n+        reactEventType: \'loadeddata\',\\n         nativeEvent: \'loadeddata\',\\n         dispatch(node) {\\n           const e = new Event(\'loadeddata\', {\\n@@ -931,6 +987,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onLoadedMetadata\',\\n+        reactEventType: \'loadedmetadata\',\\n         nativeEvent: \'loadedmetadata\',\\n         dispatch(node) {\\n           const e = new Event(\'loadedmetadata\', {\\n@@ -946,6 +1003,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onLoadStart\',\\n+        reactEventType: \'loadstart\',\\n         nativeEvent: \'loadstart\',\\n         dispatch(node) {\\n           const e = new Event(\'loadstart\', {\\n@@ -961,6 +1019,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onPause\',\\n+        reactEventType: \'pause\',\\n         nativeEvent: \'pause\',\\n         dispatch(node) {\\n           const e = new Event(\'pause\', {\\n@@ -976,6 +1035,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onPlay\',\\n+        reactEventType: \'play\',\\n         nativeEvent: \'play\',\\n         dispatch(node) {\\n           const e = new Event(\'play\', {\\n@@ -991,6 +1051,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onPlaying\',\\n+        reactEventType: \'playing\',\\n         nativeEvent: \'playing\',\\n         dispatch(node) {\\n           const e = new Event(\'playing\', {\\n@@ -1006,6 +1067,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onProgress\',\\n+        reactEventType: \'progress\',\\n         nativeEvent: \'progress\',\\n         dispatch(node) {\\n           const e = new Event(\'progress\', {\\n@@ -1021,6 +1083,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onRateChange\',\\n+        reactEventType: \'ratechange\',\\n         nativeEvent: \'ratechange\',\\n         dispatch(node) {\\n           const e = new Event(\'ratechange\', {\\n@@ -1036,6 +1099,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onSeeked\',\\n+        reactEventType: \'seeked\',\\n         nativeEvent: \'seeked\',\\n         dispatch(node) {\\n           const e = new Event(\'seeked\', {\\n@@ -1051,6 +1115,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onSeeking\',\\n+        reactEventType: \'seeking\',\\n         nativeEvent: \'seeking\',\\n         dispatch(node) {\\n           const e = new Event(\'seeking\', {\\n@@ -1066,6 +1131,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onStalled\',\\n+        reactEventType: \'stalled\',\\n         nativeEvent: \'stalled\',\\n         dispatch(node) {\\n           const e = new Event(\'stalled\', {\\n@@ -1081,6 +1147,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onSuspend\',\\n+        reactEventType: \'suspend\',\\n         nativeEvent: \'suspend\',\\n         dispatch(node) {\\n           const e = new Event(\'suspend\', {\\n@@ -1096,6 +1163,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onTimeUpdate\',\\n+        reactEventType: \'timeupdate\',\\n         nativeEvent: \'timeupdate\',\\n         dispatch(node) {\\n           const e = new Event(\'timeupdate\', {\\n@@ -1111,6 +1179,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'details\',\\n         reactEvent: \'onToggle\',\\n+        reactEventType: \'toggle\',\\n         nativeEvent: \'toggle\',\\n         dispatch(node) {\\n           const e = new Event(\'toggle\', {\\n@@ -1126,6 +1195,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onVolumeChange\',\\n+        reactEventType: \'volumechange\',\\n         nativeEvent: \'volumechange\',\\n         dispatch(node) {\\n           const e = new Event(\'volumechange\', {\\n@@ -1141,6 +1211,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testEmulatedBubblingEvent({\\n         type: \'video\',\\n         reactEvent: \'onWaiting\',\\n+        reactEventType: \'waiting\',\\n         nativeEvent: \'waiting\',\\n         dispatch(node) {\\n           const e = new Event(\'waiting\', {\\n@@ -1158,6 +1229,7 @@ describe(\'ReactDOMEventListener\', () => {\\n       testNonBubblingEvent({\\n         type: \'div\',\\n         reactEvent: \'onScroll\',\\n+        reactEventType: \'scroll\',\\n         nativeEvent: \'scroll\',\\n         dispatch(node) {\\n           const e = new Event(\'scroll\', {\\n@@ -1368,6 +1440,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onBeforeInputCapture: e => {\\n+              expect(e.type).toBe(\'beforeinput\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1430,6 +1503,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onChangeCapture: e => {\\n+              expect(e.type).toBe(\'change\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1488,6 +1562,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onCompositionStartCapture: e => {\\n+              expect(e.type).toBe(\'compositionstart\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1549,6 +1624,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onCompositionEndCapture: e => {\\n+              expect(e.type).toBe(\'compositionend\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1610,6 +1686,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onCompositionUpdateCapture: e => {\\n+              expect(e.type).toBe(\'compositionupdate\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1671,6 +1748,7 @@ describe(\'ReactDOMEventListener\', () => {\\n               log.push(\'- outer parent\');\\n             },\\n             onSelectCapture: e => {\\n+              expect(e.type).toBe(\'select\');\\n               log.push(\'- outer parent capture\');\\n             },\\n           }}\\n@@ -1769,6 +1847,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -1825,6 +1904,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -1883,6 +1963,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -1935,6 +2016,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -1986,6 +2068,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2039,6 +2122,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2103,6 +2187,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2165,6 +2250,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2228,6 +2314,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2282,6 +2369,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2350,6 +2438,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2417,6 +2506,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2482,6 +2572,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2547,6 +2638,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}\\n@@ -2615,6 +2707,7 @@ describe(\'ReactDOMEventListener\', () => {\\n             log.push(\'- outer parent\');\\n           },\\n           [eventConfig.reactEvent + \'Capture\']: e => {\\n+            expect(e.type).toBe(eventConfig.reactEventType);\\n             log.push(\'- outer parent capture\');\\n           },\\n         }}"},{"sha":"b11807fdca3e6cd25c0f2bb0735757090bd6c424","filename":"packages/react-dom/src/events/DOMPluginEventSystem.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/DOMPluginEventSystem.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/DOMPluginEventSystem.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/DOMPluginEventSystem.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -709,7 +709,7 @@ export function accumulateSinglePhaseListeners(\\n \\n   let instance = targetFiber;\\n   let lastHostComponent = null;\\n-  const targetType = event.type;\\n+  const targetType = event.nativeEvent.type;\\n \\n   // Accumulate all instances and listeners via the target -> root path.\\n   while (instance !== null) {"},{"sha":"e37af02d162d3cbb5199e152a0fdb76ea10a7421","filename":"packages/react-dom/src/events/ReactSyntheticEventType.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/ReactSyntheticEventType.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/ReactSyntheticEventType.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactSyntheticEventType.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -29,6 +29,7 @@ export type ReactSyntheticEvent = {|\\n   _dispatchListeners?: null | Array<Function> | Function,\\n   _reactName: string,\\n   _targetInst: Fiber,\\n+  nativeEvent: Event,\\n   type: string,\\n   currentTarget: null | EventTarget,\\n |};"},{"sha":"a6c7e60411198b9e6c354545c2aa4f3993782241","filename":"packages/react-dom/src/events/SyntheticEvent.js","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/SyntheticEvent.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/SyntheticEvent.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/SyntheticEvent.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -14,7 +14,6 @@ import getEventCharCode from \'./getEventCharCode\';\\n  * @see http://www.w3.org/TR/DOM-Level-3-Events/\\n  */\\n const EventInterface = {\\n-  type: 0,\\n   eventPhase: 0,\\n   bubbles: 0,\\n   cancelable: 0,\\n@@ -48,13 +47,15 @@ function functionThatReturnsFalse() {\\n  */\\n export function SyntheticEvent(\\n   reactName,\\n+  reactEventType,\\n   targetInst,\\n   nativeEvent,\\n   nativeEventTarget,\\n   Interface = EventInterface,\\n ) {\\n   this._reactName = reactName;\\n   this._targetInst = targetInst;\\n+  this.type = reactEventType;\\n   this.nativeEvent = nativeEvent;\\n   this.target = nativeEventTarget;\\n   this.currentTarget = null;"},{"sha":"1b63e5c3b665526d23c3883b8be2840f7b253f58","filename":"packages/react-dom/src/events/__tests__/SyntheticFocusEvent-test.js","status":"added","additions":70,"deletions":0,"changes":70,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/__tests__/SyntheticFocusEvent-test.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/__tests__/SyntheticFocusEvent-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/__tests__/SyntheticFocusEvent-test.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -0,0 +1,70 @@\\n+/**\\n+ * Copyright (c) Facebook, Inc. and its affiliates.\\n+ *\\n+ * This source code is licensed under the MIT license found in the\\n+ * LICENSE file in the root directory of this source tree.\\n+ */\\n+\\n+\'use strict\';\\n+\\n+describe(\'SyntheticFocusEvent\', () => {\\n+  let React;\\n+  let ReactDOM;\\n+  let container;\\n+\\n+  beforeEach(() => {\\n+    jest.resetModules();\\n+    React = require(\'react\');\\n+    ReactDOM = require(\'react-dom\');\\n+\\n+    container = document.createElement(\'div\');\\n+    document.body.appendChild(container);\\n+  });\\n+\\n+  afterEach(() => {\\n+    document.body.removeChild(container);\\n+    container = null;\\n+  });\\n+\\n+  test(\'onFocus events have the focus type\', () => {\\n+    const log = [];\\n+    ReactDOM.render(\\n+      <button\\n+        onFocus={event => log.push(`onFocus: ${event.type}`)}\\n+        onFocusCapture={event => log.push(`onFocusCapture: ${event.type}`)}\\n+      />,\\n+      container,\\n+    );\\n+    const button = container.querySelector(\'button\');\\n+\\n+    button.dispatchEvent(\\n+      new FocusEvent(\'focusin\', {\\n+        bubbles: true,\\n+        cancelable: false,\\n+      }),\\n+    );\\n+\\n+    expect(log).toEqual([\'onFocusCapture: focus\', \'onFocus: focus\']);\\n+  });\\n+\\n+  test(\'onBlur events have the blur type\', () => {\\n+    const log = [];\\n+    ReactDOM.render(\\n+      <button\\n+        onBlur={event => log.push(`onBlur: ${event.type}`)}\\n+        onBlurCapture={event => log.push(`onBlurCapture: ${event.type}`)}\\n+      />,\\n+      container,\\n+    );\\n+    const button = container.querySelector(\'button\');\\n+\\n+    button.dispatchEvent(\\n+      new FocusEvent(\'focusout\', {\\n+        bubbles: true,\\n+        cancelable: false,\\n+      }),\\n+    );\\n+\\n+    expect(log).toEqual([\'onBlurCapture: blur\', \'onBlur: blur\']);\\n+  });\\n+});"},{"sha":"3cd1825fd67d4901320638acbd32b2d087a326f9","filename":"packages/react-dom/src/events/plugins/BeforeInputEventPlugin.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/BeforeInputEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/BeforeInputEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/BeforeInputEventPlugin.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -229,6 +229,7 @@ function extractCompositionEvent(\\n \\n   const event = new SyntheticEvent(\\n     eventType,\\n+    domEventName,\\n     null,\\n     nativeEvent,\\n     nativeEventTarget,\\n@@ -397,6 +398,7 @@ function extractBeforeInputEvent(\\n \\n   const event = new SyntheticEvent(\\n     \'onBeforeInput\',\\n+    \'beforeinput\',\\n     null,\\n     nativeEvent,\\n     nativeEventTarget,"},{"sha":"e9308c583a44425c6519c5a85dff61db54cdd28f","filename":"packages/react-dom/src/events/plugins/ChangeEventPlugin.js","status":"modified","additions":7,"deletions":2,"changes":9,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/ChangeEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/ChangeEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/ChangeEventPlugin.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -49,8 +49,13 @@ function createAndAccumulateChangeEvent(\\n   nativeEvent,\\n   target,\\n ) {\\n-  const event = new SyntheticEvent(\'onChange\', null, nativeEvent, target);\\n-  event.type = \'change\';\\n+  const event = new SyntheticEvent(\\n+    \'onChange\',\\n+    \'change\',\\n+    null,\\n+    nativeEvent,\\n+    target,\\n+  );\\n   // Flag this event loop as needing state restore.\\n   enqueueStateRestore(((target: any): Node));\\n   accumulateTwoPhaseListeners(inst, dispatchQueue, event);"},{"sha":"1bf6aa3d78de5ee4fd8c6bc335eb0498ffe13826","filename":"packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -133,23 +133,23 @@ function extractEvents(\\n \\n   const leave = new SyntheticEvent(\\n     leaveEventType,\\n+    eventTypePrefix + \'leave\',\\n     from,\\n     nativeEvent,\\n     nativeEventTarget,\\n     eventInterface,\\n   );\\n-  leave.type = eventTypePrefix + \'leave\';\\n   leave.target = fromNode;\\n   leave.relatedTarget = toNode;\\n \\n   let enter = new SyntheticEvent(\\n     enterEventType,\\n+    eventTypePrefix + \'enter\',\\n     to,\\n     nativeEvent,\\n     nativeEventTarget,\\n     eventInterface,\\n   );\\n-  enter.type = eventTypePrefix + \'enter\';\\n   enter.target = toNode;\\n   enter.relatedTarget = fromNode;\\n "},{"sha":"8b99dbe6dbc83f5a78a88020b7123aa0c1671d9f","filename":"packages/react-dom/src/events/plugins/SelectEventPlugin.js","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/SelectEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/SelectEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/SelectEventPlugin.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -114,12 +114,11 @@ function constructSelectEvent(dispatchQueue, nativeEvent, nativeEventTarget) {\\n \\n     const syntheticEvent = new SyntheticEvent(\\n       \'onSelect\',\\n+      \'select\',\\n       null,\\n       nativeEvent,\\n       nativeEventTarget,\\n     );\\n-\\n-    syntheticEvent.type = \'select\';\\n     syntheticEvent.target = activeElement;\\n \\n     accumulateTwoPhaseListeners("},{"sha":"6a2b89f97942f3176965a03f976b4ca15abb7300","filename":"packages/react-dom/src/events/plugins/SimpleEventPlugin.js","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/SimpleEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/SimpleEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/SimpleEventPlugin.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -63,6 +63,7 @@ function extractEvents(\\n     return;\\n   }\\n   let EventInterface;\\n+  let reactEventType = domEventName;\\n   switch (domEventName) {\\n     case \'keypress\':\\n       // Firefox creates a keypress event for function keys too. This removes\\n@@ -77,7 +78,13 @@ function extractEvents(\\n       EventInterface = KeyboardEventInterface;\\n       break;\\n     case \'focusin\':\\n+      reactEventType = \'focus\';\\n+      EventInterface = FocusEventInterface;\\n+      break;\\n     case \'focusout\':\\n+      reactEventType = \'blur\';\\n+      EventInterface = FocusEventInterface;\\n+      break;\\n     case \'beforeblur\':\\n     case \'afterblur\':\\n       EventInterface = FocusEventInterface;\\n@@ -152,6 +159,7 @@ function extractEvents(\\n   }\\n   const event = new SyntheticEvent(\\n     reactName,\\n+    reactEventType,\\n     null,\\n     nativeEvent,\\n     nativeEventTarget,"},{"sha":"59103e984ea408cf0a36c0d8f52b09d7369f9c16","filename":"packages/react-dom/src/events/plugins/__tests__/ModernBeforeInputEventPlugin-test.js","status":"modified","additions":52,"deletions":32,"changes":84,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/__tests__/ModernBeforeInputEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/events/plugins/__tests__/ModernBeforeInputEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/ModernBeforeInputEventPlugin-test.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -224,14 +224,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'compositionend\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'compositionend\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'test string 3\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'textInput\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'textInput\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'abc\xdf\');\\n           },\\n         },\\n@@ -244,7 +246,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\' \');\\n           },\\n         },\\n@@ -281,7 +284,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'textInput\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'textInput\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'\\\\uD83D\\\\uDE0A\');\\n           },\\n         },\\n@@ -359,14 +363,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'a\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\' \');\\n           },\\n         },\\n@@ -391,14 +397,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'c\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'\\\\uD83D\\\\uDE0A\');\\n           },\\n         },\\n@@ -482,14 +490,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'a\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\' \');\\n           },\\n         },\\n@@ -514,14 +524,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'c\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'\\\\uD83D\\\\uDE0A\');\\n           },\\n         },\\n@@ -540,7 +552,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keydown\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keydown\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'bar\');\\n           },\\n         },\\n@@ -553,7 +566,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keyup\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keyup\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'BAR\');\\n           },\\n         },\\n@@ -566,7 +580,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'Bar\');\\n           },\\n         },\\n@@ -596,7 +611,8 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'compositionend\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'compositionend\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'test string 3\');\\n           },\\n         },\\n@@ -609,14 +625,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'a\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\' \');\\n           },\\n         },\\n@@ -641,14 +659,16 @@ describe(\'BeforeInputEventPlugin\', () => {\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'c\');\\n           },\\n         },\\n         {\\n           run: ({beforeInputEvent, spyOnBeforeInput}) => {\\n             expect(spyOnBeforeInput).toHaveBeenCalledTimes(1);\\n-            expect(beforeInputEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.nativeEvent.type).toBe(\'keypress\');\\n+            expect(beforeInputEvent.type).toBe(\'beforeinput\');\\n             expect(beforeInputEvent.data).toBe(\'\\\\uD83D\\\\uDE0A\');\\n           },\\n         },\\n@@ -715,17 +735,17 @@ describe(\'BeforeInputEventPlugin\', () => {\\n     const node = ReactDOM.render(\\n       <input\\n         type=\\"text\\"\\n-        onBeforeInput={({type, data}) => {\\n+        onBeforeInput={e => {\\n           spyOnBeforeInput();\\n-          beforeInputEvent = {type, data};\\n+          beforeInputEvent = e;\\n         }}\\n-        onCompositionStart={({type, data}) => {\\n+        onCompositionStart={e => {\\n           spyOnCompositionStart();\\n-          compositionStartEvent = {type, data};\\n+          compositionStartEvent = e;\\n         }}\\n-        onCompositionUpdate={({type, data}) => {\\n+        onCompositionUpdate={e => {\\n           spyOnCompositionUpdate();\\n-          compositionUpdateEvent = {type, data};\\n+          compositionUpdateEvent = e;\\n         }}\\n       />,\\n       container,\\n@@ -761,17 +781,17 @@ describe(\'BeforeInputEventPlugin\', () => {\\n     const node = ReactDOM.render(\\n       <div\\n         contentEditable={true}\\n-        onBeforeInput={({type, data}) => {\\n+        onBeforeInput={e => {\\n           spyOnBeforeInput();\\n-          beforeInputEvent = {type, data};\\n+          beforeInputEvent = e;\\n         }}\\n-        onCompositionStart={({type, data}) => {\\n+        onCompositionStart={e => {\\n           spyOnCompositionStart();\\n-          compositionStartEvent = {type, data};\\n+          compositionStartEvent = e;\\n         }}\\n-        onCompositionUpdate={({type, data}) => {\\n+        onCompositionUpdate={e => {\\n           spyOnCompositionUpdate();\\n-          compositionUpdateEvent = {type, data};\\n+          compositionUpdateEvent = e;\\n         }}\\n       />,\\n       container,"},{"sha":"52ad2621cdebceefed673e3cfa32dffd3bc4f358","filename":"packages/react-dom/src/test-utils/ReactTestUtils.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/test-utils/ReactTestUtils.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-dom/src/test-utils/ReactTestUtils.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/test-utils/ReactTestUtils.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -587,6 +587,7 @@ function makeSimulator(eventType) {\\n     const targetInst = getInstanceFromNode(domNode);\\n     const event = new SyntheticEvent(\\n       reactName,\\n+      fakeNativeEvent.type,\\n       targetInst,\\n       fakeNativeEvent,\\n       domNode,"},{"sha":"d8f8f3c7d31bbc6292b50003f136561d5a0112a9","filename":"packages/react-interactions/events/src/dom/create-event-handle/__tests__/useFocus-test.internal.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-interactions/events/src/dom/create-event-handle/__tests__/useFocus-test.internal.js","raw_url":"https://github.com/facebook/react/raw/7f696bd99c39348a631c20378d2a8704634bab04/packages/react-interactions/events/src/dom/create-event-handle/__tests__/useFocus-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/create-event-handle/__tests__/useFocus-test.internal.js?ref=7f696bd99c39348a631c20378d2a8704634bab04","patch":"@@ -36,7 +36,7 @@ function initializeModules(hasPointerEvents) {\\n const forcePointerEvents = true;\\n const table = [[forcePointerEvents], [!forcePointerEvents]];\\n \\n-describe.each(table)(`useFocus`, hasPointerEvents => {\\n+describe.each(table)(`useFocus hasPointerEvents=%s`, hasPointerEvents => {\\n   let container;\\n \\n   beforeEach(() => {"}],"stats":{"total":282,"additions":241,"deletions":41}},{"date":"Aug 7th 20","parents":[{"sha":"2d9ec9199ccdfa9872ccb0c86096547d63682cf4","url":"https://api.github.com/repos/facebook/react/commits/2d9ec9199ccdfa9872ccb0c86096547d63682cf4","html_url":"https://github.com/facebook/react/commit/2d9ec9199ccdfa9872ccb0c86096547d63682cf4"}],"author":"acdlite","files":[{"sha":"9039180938a40316b6e9fcf89c61d847518bfb9c","filename":".circleci/config.yml","status":"modified","additions":20,"deletions":1,"changes":21,"blob_url":"https://github.com/facebook/react/blob/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/.circleci/config.yml","raw_url":"https://github.com/facebook/react/raw/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/.circleci/config.yml","contents_url":"https://api.github.com/repos/facebook/react/contents/.circleci/config.yml?ref=0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","patch":"@@ -19,6 +19,8 @@ aliases:\\n       name: Install Packages\\n       command: yarn --frozen-lockfile\\n \\n+  - &TEST_PARALLELISM 20\\n+\\n   - &attach_workspace\\n     at: build\\n \\n@@ -92,6 +94,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n \\n     steps:\\n       - checkout\\n@@ -102,6 +105,7 @@ jobs:\\n   yarn_test:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -111,6 +115,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_www:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -120,6 +125,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_www_variant:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -129,6 +135,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_prod_www:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -138,6 +145,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_prod_www_variant:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -147,6 +155,7 @@ jobs:\\n   yarn_test_www:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -156,6 +165,7 @@ jobs:\\n   yarn_test_www_variant:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -165,6 +175,7 @@ jobs:\\n   yarn_test_prod_www:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -174,6 +185,7 @@ jobs:\\n   yarn_test_prod_www_variant:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -183,6 +195,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_persistent:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n \\n     steps:\\n       - checkout\\n@@ -193,6 +206,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_prod:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n \\n     steps:\\n       - checkout\\n@@ -203,6 +217,7 @@ jobs:\\n   yarn_test_prod:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -212,7 +227,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_build:\\n     docker: *docker\\n     environment: *environment\\n-    parallelism: 20\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - *restore_yarn_cache\\n@@ -344,6 +359,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_build:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n@@ -354,6 +370,7 @@ jobs:\\n   yarn_test_build:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n@@ -404,6 +421,7 @@ jobs:\\n   RELEASE_CHANNEL_stable_yarn_test_build_prod:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace\\n@@ -414,6 +432,7 @@ jobs:\\n   yarn_test_build_prod:\\n     docker: *docker\\n     environment: *environment\\n+    parallelism: *TEST_PARALLELISM\\n     steps:\\n       - checkout\\n       - attach_workspace: *attach_workspace"},{"sha":"a08b67720ac60f045b06483cf863b6efe49c08f5","filename":"packages/react/src/__tests__/ReactClassEquivalence-test.js","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/facebook/react/blob/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/packages/react/src/__tests__/ReactClassEquivalence-test.js","raw_url":"https://github.com/facebook/react/raw/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/packages/react/src/__tests__/ReactClassEquivalence-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/src/__tests__/ReactClassEquivalence-test.js?ref=0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","patch":"@@ -38,6 +38,10 @@ function runJest(testFile) {\\n     cwd,\\n     env: Object.assign({}, process.env, {\\n       REACT_CLASS_EQUIVALENCE_TEST: \'true\',\\n+      // Remove these so that the test file is not filtered out by the mechanism\\n+      // we use to parallelize tests in CI\\n+      CIRCLE_NODE_TOTAL: \'\',\\n+      CIRCLE_NODE_INDEX: \'\',\\n     }),\\n   });\\n "},{"sha":"0e9508221a654e58f6f3347ccd47b8b5fe2b0ca8","filename":"scripts/jest/config.base.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/scripts/jest/config.base.js","raw_url":"https://github.com/facebook/react/raw/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/scripts/jest/config.base.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/jest/config.base.js?ref=0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","patch":"@@ -22,6 +22,8 @@ module.exports = {\\n   timers: \'fake\',\\n   snapshotSerializers: [require.resolve(\'jest-snapshot-serializer-raw\')],\\n \\n+  testSequencer: require.resolve(\'./jestSequencer\'),\\n+\\n   // TODO: Upgrade to Jest 26 which uses jsdom 16 by default.\\n   testEnvironment: require.resolve(\'jest-environment-jsdom-sixteen\'),\\n };"},{"sha":"b21cbbfc0ccbc9170c4efa3e3a938dd0d8e79108","filename":"scripts/jest/jestSequencer.js","status":"added","additions":19,"deletions":0,"changes":19,"blob_url":"https://github.com/facebook/react/blob/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/scripts/jest/jestSequencer.js","raw_url":"https://github.com/facebook/react/raw/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc/scripts/jest/jestSequencer.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/jest/jestSequencer.js?ref=0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","patch":"@@ -0,0 +1,19 @@\\n+\'use strict\';\\n+\\n+const Sequencer = require(\'@jest/test-sequencer\').default;\\n+\\n+class CustomSequencer extends Sequencer {\\n+  sort(tests) {\\n+    if (process.env.CIRCLE_NODE_TOTAL) {\\n+      // In CI, parallelize tests across multiple tasks.\\n+      const nodeTotal = parseInt(process.env.CIRCLE_NODE_TOTAL, 10);\\n+      const nodeIndex = parseInt(process.env.CIRCLE_NODE_INDEX, 10);\\n+      tests = tests\\n+        .sort((a, b) => (a.path < b.path ? -1 : 1))\\n+        .filter((_, i) => i % nodeTotal === nodeIndex);\\n+    }\\n+    return tests;\\n+  }\\n+}\\n+\\n+module.exports = CustomSequencer;"}],"stats":{"total":46,"additions":45,"deletions":1}},{"date":"Aug 10th 20","parents":[{"sha":"0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","url":"https://api.github.com/repos/facebook/react/commits/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc","html_url":"https://github.com/facebook/react/commit/0cd9a6de557f44dcfe79a4f287ca04b05d674bdc"}],"author":"eps1lon","files":[{"sha":"e3216168d39cfe7ee03012ff0db834638bacd7e3","filename":"yarn.lock","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/facebook/react/blob/7c30fb3b0b98d3e903e1dc60497f8e7ffb530153/yarn.lock","raw_url":"https://github.com/facebook/react/raw/7c30fb3b0b98d3e903e1dc60497f8e7ffb530153/yarn.lock","contents_url":"https://api.github.com/repos/facebook/react/contents/yarn.lock?ref=7c30fb3b0b98d3e903e1dc60497f8e7ffb530153","patch":"@@ -7619,7 +7619,7 @@ jsbn@~0.1.0:\\n   resolved \\"https://registry.yarnpkg.com/jsbn/-/jsbn-0.1.1.tgz#a5e654c2e5a2deb5f201d96cefbca80c0ef2f513\\"\\n   integrity sha1-peZUwuWi3rXyAdls77yoDA7y9RM=\\n \\n-jsdom@^15.2.1, \\"jsdom@npm:@gaearon/jsdom@15.2.1\\":\\n+jsdom@^15.2.1:\\n   version \\"15.2.1\\"\\n   resolved \\"https://registry.yarnpkg.com/@gaearon/jsdom/-/jsdom-15.2.1.tgz#23273b20b6c7b6ca70b54bc0b0eecdc518ae9694\\"\\n   integrity sha512-qQc4j+gyi06zrevvopql0pehAXrgTv71wGkKMQZg8bl2VYfv2dqbdtP0hD0TpHsuI7YF1XfE7DM62Nclr13vfA==\\n@@ -10114,6 +10114,11 @@ rc@^1.0.1, rc@^1.1.6, rc@^1.2.8:\\n     object-assign \\"^4.1.0\\"\\n     prop-types \\"^15.5.10\\"\\n \\n+react-is@^16.12.0, react-is@^16.8.1:\\n+  version \\"16.13.1\\"\\n+  resolved \\"https://registry.yarnpkg.com/react-is/-/react-is-16.13.1.tgz#789729a4dc36de2999dc156dd6c1d9c18cea56a4\\"\\n+  integrity sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==\\n+\\n react-lifecycles-compat@^3.0.4:\\n   version \\"3.0.4\\"\\n   resolved \\"https://registry.yarnpkg.com/react-lifecycles-compat/-/react-lifecycles-compat-3.0.4.tgz#4f1a273afdfc8f3488a8c516bfda78f872352362\\""}],"stats":{"total":7,"additions":6,"deletions":1}},{"date":"Aug 7th 20","parents":[{"sha":"db2f22911083f5c8f5c637adf41bb7554928a339","url":"https://api.github.com/repos/facebook/react/commits/db2f22911083f5c8f5c637adf41bb7554928a339","html_url":"https://github.com/facebook/react/commit/db2f22911083f5c8f5c637adf41bb7554928a339"}],"author":"gaearon","files":[{"sha":"2edd8d267efb4702e2b04dd76dbef16734a030d5","filename":"scripts/release/publish-commands/publish-to-npm.js","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/facebook/react/blob/2d9ec9199ccdfa9872ccb0c86096547d63682cf4/scripts/release/publish-commands/publish-to-npm.js","raw_url":"https://github.com/facebook/react/raw/2d9ec9199ccdfa9872ccb0c86096547d63682cf4/scripts/release/publish-commands/publish-to-npm.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/release/publish-commands/publish-to-npm.js?ref=2d9ec9199ccdfa9872ccb0c86096547d63682cf4","patch":"@@ -62,7 +62,9 @@ const run = async ({cwd, dry, packages, tags}, otp) => {\\n           await exec(`npm dist-tag rm ${packageName} untagged --otp=${otp}`);\\n         }\\n         console.log(\\n-          theme.command(`npm dist-tag rm ${packageName} untagged --otp=${otp}`)\\n+          theme.command(\\n+            `  npm dist-tag rm ${packageName} untagged --otp=${otp}`\\n+          )\\n         );\\n       }\\n     }"}],"stats":{"total":4,"additions":3,"deletions":1}},{"date":"Aug 7th 20","parents":[{"sha":"336729856a1355ff264e3e5427c67bb23b708657","url":"https://api.github.com/repos/facebook/react/commits/336729856a1355ff264e3e5427c67bb23b708657","html_url":"https://github.com/facebook/react/commit/336729856a1355ff264e3e5427c67bb23b708657"}],"author":"gaearon","files":[{"sha":"e1e598f7c175ffea4a29d0992bb9a26deb7d32f9","filename":"scripts/release/publish-commands/publish-to-npm.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/db2f22911083f5c8f5c637adf41bb7554928a339/scripts/release/publish-commands/publish-to-npm.js","raw_url":"https://github.com/facebook/react/raw/db2f22911083f5c8f5c637adf41bb7554928a339/scripts/release/publish-commands/publish-to-npm.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/release/publish-commands/publish-to-npm.js?ref=db2f22911083f5c8f5c637adf41bb7554928a339","patch":"@@ -59,10 +59,10 @@ const run = async ({cwd, dry, packages, tags}, otp) => {\\n         // npm doesn\'t let us publish without a tag at all,\\n         // so for one-off publishes we clean it up ourselves.\\n         if (!dry) {\\n-          await exec(`npm dist-tag rm ${packageName}@untagged --otp=${otp}`);\\n+          await exec(`npm dist-tag rm ${packageName} untagged --otp=${otp}`);\\n         }\\n         console.log(\\n-          theme.command(`npm dist-tag rm ${packageName}@untagged --otp=${otp}`)\\n+          theme.command(`npm dist-tag rm ${packageName} untagged --otp=${otp}`)\\n         );\\n       }\\n     }"}],"stats":{"total":4,"additions":2,"deletions":2}},{"date":"Aug 6th 20","parents":[{"sha":"32ff4286872d1a6bb8ce71730064f60ebbdd1509","url":"https://api.github.com/repos/facebook/react/commits/32ff4286872d1a6bb8ce71730064f60ebbdd1509","html_url":"https://github.com/facebook/react/commit/32ff4286872d1a6bb8ce71730064f60ebbdd1509"}],"author":"bvaughn","files":[{"sha":"0c0b1d1a927392539f2c2407e8ba64717abe3f74","filename":"packages/react-dom/src/__tests__/ReactEmptyComponent-test.js","status":"modified","additions":20,"deletions":0,"changes":20,"blob_url":"https://github.com/facebook/react/blob/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-dom/src/__tests__/ReactEmptyComponent-test.js","raw_url":"https://github.com/facebook/react/raw/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-dom/src/__tests__/ReactEmptyComponent-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactEmptyComponent-test.js?ref=a63893ff320c39802e8c37fca84ea023f55230c9","patch":"@@ -316,4 +316,24 @@ describe(\'ReactEmptyComponent\', () => {\\n     const noscript2 = container.firstChild;\\n     expect(noscript2).toBe(null);\\n   });\\n+\\n+  it(\'should warn about React.forwardRef that returns undefined\', () => {\\n+    const Empty = () => {};\\n+    const EmptyForwardRef = React.forwardRef(Empty);\\n+\\n+    expect(() => {\\n+      ReactTestUtils.renderIntoDocument(<EmptyForwardRef />);\\n+    }).toThrowError(\\n+      \'ForwardRef(Empty)(...): Nothing was returned from render.\',\\n+    );\\n+  });\\n+\\n+  it(\'should warn about React.memo that returns undefined\', () => {\\n+    const Empty = () => {};\\n+    const EmptyMemo = React.memo(Empty);\\n+\\n+    expect(() => {\\n+      ReactTestUtils.renderIntoDocument(<EmptyMemo />);\\n+    }).toThrowError(\'Empty(...): Nothing was returned from render.\');\\n+  });\\n });"},{"sha":"3bef3545fc3a2fd3fbba03eba1cf201db1c957f3","filename":"packages/react-reconciler/src/ReactChildFiber.new.js","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/facebook/react/blob/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-reconciler/src/ReactChildFiber.new.js","raw_url":"https://github.com/facebook/react/raw/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-reconciler/src/ReactChildFiber.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactChildFiber.new.js?ref=a63893ff320c39802e8c37fca84ea023f55230c9","patch":"@@ -29,7 +29,9 @@ import {\\n   ClassComponent,\\n   HostText,\\n   HostPortal,\\n+  ForwardRef,\\n   Fragment,\\n+  SimpleMemoComponent,\\n   Block,\\n } from \'./ReactWorkTags\';\\n import invariant from \'shared/invariant\';\\n@@ -1393,14 +1395,16 @@ function ChildReconciler(shouldTrackSideEffects) {\\n         // Intentionally fall through to the next case, which handles both\\n         // functions and classes\\n         // eslint-disable-next-lined no-fallthrough\\n-        case FunctionComponent: {\\n-          const Component = returnFiber.type;\\n+        case Block:\\n+        case FunctionComponent:\\n+        case ForwardRef:\\n+        case SimpleMemoComponent: {\\n           invariant(\\n             false,\\n             \'%s(...): Nothing was returned from render. This usually means a \' +\\n               \'return statement is missing. Or, to render nothing, \' +\\n               \'return null.\',\\n-            Component.displayName || Component.name || \'Component\',\\n+            getComponentName(returnFiber.type) || \'Component\',\\n           );\\n         }\\n       }"},{"sha":"6af9a6ab9fee244608dbbaf7713907979f0de334","filename":"packages/react-reconciler/src/ReactChildFiber.old.js","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/facebook/react/blob/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-reconciler/src/ReactChildFiber.old.js","raw_url":"https://github.com/facebook/react/raw/a63893ff320c39802e8c37fca84ea023f55230c9/packages/react-reconciler/src/ReactChildFiber.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactChildFiber.old.js?ref=a63893ff320c39802e8c37fca84ea023f55230c9","patch":"@@ -29,7 +29,9 @@ import {\\n   ClassComponent,\\n   HostText,\\n   HostPortal,\\n+  ForwardRef,\\n   Fragment,\\n+  SimpleMemoComponent,\\n   Block,\\n } from \'./ReactWorkTags\';\\n import invariant from \'shared/invariant\';\\n@@ -1385,14 +1387,16 @@ function ChildReconciler(shouldTrackSideEffects) {\\n         // Intentionally fall through to the next case, which handles both\\n         // functions and classes\\n         // eslint-disable-next-lined no-fallthrough\\n-        case FunctionComponent: {\\n-          const Component = returnFiber.type;\\n+        case Block:\\n+        case FunctionComponent:\\n+        case ForwardRef:\\n+        case SimpleMemoComponent: {\\n           invariant(\\n             false,\\n             \'%s(...): Nothing was returned from render. This usually means a \' +\\n               \'return statement is missing. Or, to render nothing, \' +\\n               \'return null.\',\\n-            Component.displayName || Component.name || \'Component\',\\n+            getComponentName(returnFiber.type) || \'Component\',\\n           );\\n         }\\n       }"}],"stats":{"total":40,"additions":34,"deletions":6}},{"date":"Aug 6th 20","parents":[{"sha":"a63893ff320c39802e8c37fca84ea023f55230c9","url":"https://api.github.com/repos/facebook/react/commits/a63893ff320c39802e8c37fca84ea023f55230c9","html_url":"https://github.com/facebook/react/commit/a63893ff320c39802e8c37fca84ea023f55230c9"}],"author":"gaearon","files":[{"sha":"eff23057e14041e9bac1e0e1b117d68cf946c75d","filename":"fixtures/nesting/.env","status":"added","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.env","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.env","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/.env?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,2 @@\\n+EXTEND_ESLINT=true\\n+SKIP_PREFLIGHT_CHECK=true"},{"sha":"4c368bf0fb5778e1a5b5be78e44a0bd63c3dec41","filename":"fixtures/nesting/.eslintignore","status":"added","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.eslintignore","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.eslintignore","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/.eslintignore?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1 @@\\n+src/*/node_modules"},{"sha":"abaccc497db8dc751ff1609b43aafcc8044c2e23","filename":"fixtures/nesting/.gitignore","status":"added","additions":27,"deletions":0,"changes":27,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.gitignore","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/.gitignore","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/.gitignore?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,27 @@\\n+# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.\\n+\\n+# dependencies\\n+/node_modules\\n+/.pnp\\n+.pnp.js\\n+\\n+# testing\\n+/coverage\\n+\\n+# production\\n+/build\\n+\\n+# misc\\n+.DS_Store\\n+.env.local\\n+.env.development.local\\n+.env.test.local\\n+.env.production.local\\n+\\n+npm-debug.log*\\n+yarn-debug.log*\\n+yarn-error.log*\\n+\\n+# copies of shared\\n+src/*/shared\\n+src/*/node_modules"},{"sha":"ac57b3a6347d3b767422d2ad4fa533c9db746d18","filename":"fixtures/nesting/README.md","status":"added","additions":163,"deletions":0,"changes":163,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/README.md","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/README.md","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/README.md?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,163 @@\\n+# Nested React Demo\\n+\\n+This is a demo of how you can configure a build system to serve **two different versions of React** side by side in the same app. This is not optimal, and should only be used as a compromise to prevent your app from getting stuck on an old version of React.\\n+\\n+## You Probably Don\'t Need This\\n+\\n+Note that **this approach is meant to be an escape hatch, not the norm**.\\n+\\n+Normally, we encourage you to use a single version of React across your whole app. When you need to upgrade React, it is better to try to upgrade it all at once. We try to keep breaking changes between versions to the minimum, and often there are automatic scripts (\\"codemods\\") that can assist you with migration. You can always find the migration information for any release on [our blog](https://reactjs.org/blog/).\\n+\\n+Using a single version of React removes a lot of complexity. It is also essential to ensure the best experience for your users who don\'t have to download the code twice. Always prefer using one React.\\n+\\n+## What Is This For?\\n+\\n+However, for some apps that have been in production for many years, upgrading all screens at once may be prohibitively difficult. For example, React components written in 2014 may still rely on [the unofficial legacy context API](https://reactjs.org/docs/legacy-context.html) (not to be confused with the modern one), and are not always maintained. \\n+\\n+Traditionally, this meant that if a legacy API is deprecated, you would be stuck on the old version of React forever. That prevents your whole app from receiving improvements and bugfixes. This repository demonstrates a hybrid approach. It shows how you can use a newer version of React for some parts of your app, while **lazy-loading an older version of React** for the parts that haven\'t been migrated yet.\\n+\\n+This approach is inherently more complex, and should be used as a last resort when you can\'t upgrade.\\n+\\n+## Version Requirements\\n+\\n+This demo uses two different versions of React: React 17 for \\"modern\\" components (in `src/modern`), and React 16.8 for \\"legacy\\" components (in `src/legacy`).\\n+\\n+**We still recommend upgrading your whole app to React 17 in one piece.** The React 17 release intentionally has minimal breaking changes so that it\'s easier to upgrade to. In particular, React 17 solves some problems with nesting related to event propagation that earlier versions of React did not handle well. We expect that this nesting demo may not be as useful today as during a future migration from React 17 to the future major versions where some of the long-deprecated APIs may be removed.\\n+\\n+However, if you\'re already stuck on an old version of React, you may found this approach useful today. If you remove a Hook call from `src/shared/Clock.js`, you can downgrade the legacy React all the way down to React 16.3. If you then remove Context API usage from `src/legacy/createLegacyRoot.js`, you can further downgrade the legacy React version, but keep in mind that the usage of third-party libraries included in this demo (React Router and React Redux) may need to be adjusted or removed.\\n+\\n+## Installation\\n+\\n+To run this demo, open its folder in Terminal and execute:\\n+\\n+```sh\\n+npm install\\n+npm start\\n+```\\n+\\n+If you want to test the production build, you can run instead:\\n+\\n+```\\n+npm install\\n+npm run build\\n+npx serve -s build\\n+```\\n+\\n+This sample app uses client-side routing and consists of two routes:\\n+\\n+- `/` renders a page which uses a newer version of React. (In the production build, you can verify that only one version of React is being loaded when this route is rendered.)\\n+- `/about` renders a page which uses an older version of React for a part of its tree. (In the production build, you can verify that both versions of React are loaded from different chunks.)\\n+\\n+**The purpose of this demo is to show some nuances of such setup:**\\n+\\n+- How to install two versions of React in a single app with npm side by side.\\n+- How to avoid the [\\"invalid Hook call\\" error](https://github.com/facebook/react/issues/13991) while nesting React trees.\\n+- How to pass context between different versions of React.\\n+- How to lazy-load the second React bundle so it\'s only loaded on the screens that use it.\\n+- How to do all of this without a special bundler configuration.\\n+\\n+## How It Works\\n+\\n+File structure is extremely important in this demo. It has a direct effect on which code is going to use which version of React. This particular demo is using Create React App without ejecting, so **it doesn\'t rely on any bundler plugins or configuration**. The principle of this demo is portable to other setups.\\n+\\n+### Dependencies\\n+\\n+We will use three different `package.json`s: one for non-React code at the root, and two in the respective `src/legacy` and `src/modern` folders that specify the React dependencies:\\n+\\n+- **`package.json`**: The root `package.json` is a place for build dependencies (such as `react-scripts`) and any React-agnostic libraries (for example, `lodash`, `immer`, or `redux`). We do **not** include React or any React-related libraries in this file.\\n+- **`src/legacy/package.json`**: This is where we declare the `react` and `react-dom`  dependencies for the \\"legacy\\" trees. In this demo, we\'re using React 16.8 (although, as noted above, we could downgrade it further below). This is **also** where we specify any third-party libraries that use React. For example, we include `react-router` and `react-redux` in this example. \\n+- **`src/modern/package.json`**: This is where we declare the `react` and `react-dom`  dependencies for the \\"modern\\" trees. In this demo, we\'re using React 17. Here, we also specify third-party dependencies that use React and are used from the modern part of our app. This is why we *also* have `react-router` and `react-redux` in this file. (Their versions don\'t strictly have to match their `legacy` counterparts, but features that rely on context may require workarounds if they differ.)\\n+\\n+The `scripts` in the root `package.json` are set up so that when you run `npm install` in it, it also runs `npm intall` in both `src/legacy` and `src/modern` folders.\\n+\\n+**Note:** This demo is set up to use a few third-party dependencies (React Router and Redux). These are not essential, and you can remove them from the demo. They are included so we can show how to make them work with this approach.\\n+\\n+### Folders\\n+\\n+There are a few key folders in this example:\\n+\\n+- **`src`**: Root of the source tree. At this level (or below it, except for the special folders noted below), you can put any logic that\'s agnostic of React. For example, in this demo we have `src/index.js` which is the app\'s entry point, and `src/store.js` which exports a Redux store. These regular modules only execute once, and are **not** duplicated between the bundles.\\n+- **`src/legacy`**: This is where all the code using the older version of React should go. This includes React components and Hooks, and general product code that is **only** used by the legacy trees.\\n+- **`src/modern`**: This is where all the code using the newer version of React should go. This includes React components and Hooks, and general product code that is **only** used by the modern trees.\\n+- **`src/shared`**: You may have some components or Hooks that you wish to use from both modern and legacy subtrees. The build process is set up so that **everything inside `src/shared` gets copied by a file watcher** into both `src/legacy/shared` and `src/modern/shared` on every change. This lets you write a component or a Hook once, but reuse it in both places.\\n+ \\n+### Lazy Loading\\n+\\n+Loading two Reacts on the same page is bad for the user experience, so you should strive to push this as far as possible from the critical path of your app. For example, if there is a dialog that is less commonly used, or a route that is rarely visited, those are better candidates for staying on an older version of React than parts of your homepage.\\n+\\n+To encourage only loading the older React when necessary, this demo includes a helper that works similarly to `React.lazy`. For example, `src/modern/AboutPage.js`, simplified, looks like this:\\n+\\n+```js\\n+import lazyLegacyRoot from \'./lazyLegacyRoot\';\\n+\\n+// Lazy-load a component from the bundle using legacy React.\\n+const Greeting = lazyLegacyRoot(() => import(\'../legacy/Greeting\'));\\n+\\n+function AboutPage() {\\n+  return (\\n+    <>\\n+      <h3>This component is rendered by React ({React.version}).</h3>\\n+      <Greeting />\\n+    </>\\n+  );\\n+}\\n+```\\n+\\n+As a result, only if the `AboutPage` (and as a result, `<Greeting />`) gets rendered, we will load the bundle containing the legacy React and the legacy `Greeting` component. Like with `React.lazy()`, we wrap it in `<Suspense>` to specify the loading indicator:\\n+\\n+```js\\n+<Suspense fallback={<Spinner />}>\\n+  <AboutPage />\\n+</Suspense>\\n+```\\n+\\n+If the legacy component is only rendered conditionally, we won\'t load the second React until it\'s shown:\\n+\\n+```js\\n+<>\\n+  <button onClick={() => setShowGreeting(true)}>\\n+    Say hi\\n+  </button>\\n+  {showGreeting && (\\n+    <Suspense fallback={<Spinner />}>\\n+      <Greeting />\\n+    </Suspense>\\n+  )}\\n+</>\\n+```\\n+\\n+\\n+The implementation of the `src/modern/lazyLegacyRoot.js` helper is included so you can tweak it and customize it to your needs. Remember to test lazy loading with the production builds because the bundler may not optimize it in development.\\n+\\n+### Context\\n+\\n+If you have nested trees managed by different versions of React, the inner tree won\'t \\"see\\" the outer tree\'s Context.\\n+\\n+This breaks third-party libraries like React Redux or React Router, as well as any of your own usage of Context (for example, for theming).\\n+\\n+To solve this problem, we read all the Contexts we care about in the outer tree, pass them to the inner tree, and then wrap the inner tree in the corresponding Providers. You can see this in action in two files:\\n+\\n+* `src/modern/lazyLegacyRoot.js`: Look for `useContext` calls, and how their results are combined into a single object that is passed through. **You can read more Contexts there** if your app requires them.\\n+* `src/legacy/createLegacyRoot.js`: Look for the `Bridge` component which receives that object and wraps its children with the appropriate Context Providers. **You can wrap them with more Providers there** if your app requires them.\\n+\\n+Note that, generally saying, this approach is somewhat fragile, especially because some libraries may not expose their Contexts officially or consider their structure private. You may be able to expose private Contexts by using a tool like [patch-package](https://www.npmjs.com/package/patch-package), but remember to keep all the versions pinned because even a patch release of a third-party library may change the behavior.\\n+\\n+### Nesting Direction\\n+\\n+In this demo, we use an older React inside an app managed by the newer React. However, we could rename the folders and apply the same approach in the other direction.\\n+\\n+### Event Propagation\\n+\\n+Note that before React 17, `event.stopPropagation()` in the inner React tree does not prevent the event propagation to the outer React tree. This may cause unexpected behavior when extracting a UI tree like a dialog to use a separate React. This is because prior to React 17, both Reacts would attach the event listener at the `document` level. React 17 fixes this by attaching handlers to the roots. We strongly recommend upgrading to React 17 before considering the nesting strategy for future upgrades.\\n+\\n+### Gotchas\\n+\\n+This setup is unusual, so it has a few gotchas.\\n+\\n+* Don\'t add `package.json` to the `src/shared` folder. For example, if you want to use an npm React component inside `src/shared`, you should add it to both `src/modern/package.json` and `src/legacy/package.json` instead. You can use different versions of it but make sure your code works with both of them \u2014 and that it works with both Reacts!\\n+* Don\'t use React outside of the `src/modern`, `src/legacy`, or `src/shared`. Don\'t add React-related libraries outside of `src/modern/package.json` or `src/legacy/package.json`.\\n+* Remember that `src/shared` is where you write shared components, but the files you write there are automatically copied into `src/modern/shared` and `src/legacy/shared`, **from which you should import them**. Both of the target directories are in `.gitignore`. Importing directly from `src/shared` **will not work** because it is ambiguous what `react` refers to in that folder.\\n+* Keep in mind that any code in `src/shared` gets duplicated between the legacy and the modern bundles. Code that should not be duplicated needs to be anywhere else in `src` (but you can\'t use React there since the version is ambiguous).\\n+* You\'ll want to exclude `src/*/node_modules` from your linter\'s configuration, as this demo does in `.eslintignorerc`.\\n+\\n+This setup is complicated, and we don\'t recommend it for most apps. However, we believe it is important to offer it as an option for apps that would otherwise get left behind. There might be ways to simplify it with a layer of tooling, but this example is intentionally showing the low-level mechanism that other tools may build on."},{"sha":"130ecfa54e772d723391f775a59e8b8d490eddc0","filename":"fixtures/nesting/package.json","status":"added","additions":43,"deletions":0,"changes":43,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/package.json","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/package.json","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/package.json?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,43 @@\\n+{\\n+  \\"name\\": \\"react-nesting-example\\",\\n+  \\"version\\": \\"0.1.0\\",\\n+  \\"private\\": true,\\n+  \\"dependencies\\": {\\n+    \\"react-scripts\\": \\"3.4.1\\",\\n+    \\"redux\\": \\"^4.0.5\\"\\n+  },\\n+  \\"scripts\\": {\\n+    \\"postinstall\\": \\"run-p install:*\\",\\n+    \\"install:legacy\\": \\"cd src/legacy && npm install\\",\\n+    \\"install:modern\\": \\"cd src/modern && npm install\\",\\n+    \\"copy:legacy\\": \\"cpx \'src/shared/**\' \'src/legacy/shared/\'\\",\\n+    \\"copy:modern\\": \\"cpx \'src/shared/**\' \'src/modern/shared/\'\\",\\n+    \\"watch:legacy\\": \\"cpx \'src/shared/**\' \'src/legacy/shared/\' --watch --no-initial\\",\\n+    \\"watch:modern\\": \\"cpx \'src/shared/**\' \'src/modern/shared/\' --watch --no-initial\\",\\n+    \\"prebuild\\": \\"run-p copy:*\\",\\n+    \\"prestart\\": \\"run-p copy:*\\",\\n+    \\"start\\": \\"run-p start-app watch:*\\",\\n+    \\"start-app\\": \\"react-scripts start\\",\\n+    \\"build\\": \\"react-scripts build\\",\\n+    \\"eject\\": \\"react-scripts eject\\"\\n+  },\\n+  \\"eslintConfig\\": {\\n+    \\"extends\\": \\"react-app\\"\\n+  },\\n+  \\"browserslist\\": {\\n+    \\"production\\": [\\n+      \\">0.2%\\",\\n+      \\"not dead\\",\\n+      \\"not op_mini all\\"\\n+    ],\\n+    \\"development\\": [\\n+      \\"last 1 chrome version\\",\\n+      \\"last 1 firefox version\\",\\n+      \\"last 1 safari version\\"\\n+    ]\\n+  },\\n+  \\"devDependencies\\": {\\n+    \\"cpx\\": \\"^1.5.0\\",\\n+    \\"npm-run-all\\": \\"^4.1.5\\"\\n+  }\\n+}"},{"sha":"6252f08e4954dbedc423ae6a76b2e66bafa239e0","filename":"fixtures/nesting/public/index.html","status":"added","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/public/index.html","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/public/index.html","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/public/index.html?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,12 @@\\n+<!DOCTYPE html>\\n+<html lang=\\"en\\">\\n+  <head>\\n+    <meta charset=\\"utf-8\\" />\\n+    <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1\\" />\\n+    <title>React App</title>\\n+  </head>\\n+  <body>\\n+    <noscript>You need to enable JavaScript to run this app.</noscript>\\n+    <div id=\\"root\\"></div>\\n+  </body>\\n+</html>"},{"sha":"6a70a32424423f28cb1fc7659ad734d067adefb2","filename":"fixtures/nesting/src/index.js","status":"added","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/index.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/index.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/index.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1 @@\\n+import \'./modern/index\';"},{"sha":"11bf3faf31c41b041f5ee27bfdac1ced913d9051","filename":"fixtures/nesting/src/legacy/Greeting.js","status":"added","additions":51,"deletions":0,"changes":51,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/Greeting.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/Greeting.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/legacy/Greeting.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,51 @@\\n+import React from \'react\';\\n+import {Component} from \'react\';\\n+import {findDOMNode} from \'react-dom\';\\n+import {Link} from \'react-router-dom\';\\n+import {connect} from \'react-redux\';\\n+import {store} from \'../store\';\\n+\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+import Clock from \'./shared/Clock\';\\n+\\n+store.subscribe(() => {\\n+  console.log(\'Counter:\', store.getState());\\n+});\\n+\\n+class AboutSection extends Component {\\n+  componentDidMount() {\\n+    // The modern app is wrapped in StrictMode,\\n+    // but the legacy bits can still use old APIs.\\n+    findDOMNode(this);\\n+  }\\n+  render() {\\n+    return (\\n+      <ThemeContext.Consumer>\\n+        {theme => (\\n+          <div style={{border: \'1px dashed black\', padding: 20}}>\\n+            <h3>src/legacy/Greeting.js</h3>\\n+            <h4 style={{color: theme}}>\\n+              This component is rendered by the nested React ({React.version}).\\n+            </h4>\\n+            <Clock />\\n+            <p>\\n+              Counter: {this.props.counter}{\' \'}\\n+              <button onClick={() => this.props.dispatch({type: \'increment\'})}>\\n+                +\\n+              </button>\\n+            </p>\\n+            <b>\\n+              <Link to=\\"/\\">Go to Home</Link>\\n+            </b>\\n+          </div>\\n+        )}\\n+      </ThemeContext.Consumer>\\n+    );\\n+  }\\n+}\\n+\\n+function mapStateToProps(state) {\\n+  return {counter: state};\\n+}\\n+\\n+export default connect(mapStateToProps)(AboutSection);"},{"sha":"ec4941b5d9293011f6415ae6481401276b3bc1ee","filename":"fixtures/nesting/src/legacy/createLegacyRoot.js","status":"added","additions":43,"deletions":0,"changes":43,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/createLegacyRoot.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/createLegacyRoot.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/legacy/createLegacyRoot.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,43 @@\\n+/* eslint-disable react/jsx-pascal-case */\\n+\\n+import React from \'react\';\\n+import ReactDOM from \'react-dom\';\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+\\n+// Note: this is a semi-private API, but it\'s ok to use it\\n+// if we never inspect the values, and only pass them through.\\n+import {__RouterContext} from \'react-router\';\\n+import {Provider} from \'react-redux\';\\n+\\n+// Pass through every context required by this tree.\\n+// The context object is populated in src/modern/withLegacyRoot.\\n+function Bridge({children, context}) {\\n+  return (\\n+    <ThemeContext.Provider value={context.theme}>\\n+      <__RouterContext.Provider value={context.router}>\\n+        {/*\\n+          If we used the newer react-redux@7.x in the legacy/package.json,\\n+          we woud instead import {ReactReduxContext} from \'react-redux\'\\n+          and render <ReactReduxContext.Provider value={context.reactRedux}>.\\n+        */}\\n+        <Provider store={context.reactRedux.store}>{children}</Provider>\\n+      </__RouterContext.Provider>\\n+    </ThemeContext.Provider>\\n+  );\\n+}\\n+\\n+export default function createLegacyRoot(container) {\\n+  return {\\n+    render(Component, props, context) {\\n+      ReactDOM.render(\\n+        <Bridge context={context}>\\n+          <Component {...props} />\\n+        </Bridge>,\\n+        container\\n+      );\\n+    },\\n+    unmount() {\\n+      ReactDOM.unmountComponentAtNode(container);\\n+    },\\n+  };\\n+}"},{"sha":"7517005ef9ec8f212545ac1447075949f803250e","filename":"fixtures/nesting/src/legacy/package.json","status":"added","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/package.json","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/legacy/package.json","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/legacy/package.json?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,10 @@\\n+{\\n+  \\"private\\": true,\\n+  \\"name\\": \\"react-nesting-example-legacy\\",\\n+  \\"dependencies\\": {\\n+    \\"react\\": \\"16.8\\",\\n+    \\"react-dom\\": \\"16.8\\",\\n+    \\"react-redux\\": \\"4.4.10\\",\\n+    \\"react-router-dom\\": \\"5.2.0\\"\\n+  }\\n+}"},{"sha":"27e52dad5a83afbfaea0258e46dd81fa4be5785c","filename":"fixtures/nesting/src/modern/AboutPage.js","status":"added","additions":33,"deletions":0,"changes":33,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/AboutPage.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/AboutPage.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/AboutPage.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,33 @@\\n+import React from \'react\';\\n+import {useContext} from \'react\';\\n+import {connect} from \'react-redux\';\\n+\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+import lazyLegacyRoot from \'./lazyLegacyRoot\';\\n+\\n+// Lazy-load a component from the bundle using legacy React.\\n+const Greeting = lazyLegacyRoot(() => import(\'../legacy/Greeting\'));\\n+\\n+function AboutPage({counter, dispatch}) {\\n+  const theme = useContext(ThemeContext);\\n+  return (\\n+    <>\\n+      <h2>src/modern/AboutPage.js</h2>\\n+      <h3 style={{color: theme}}>\\n+        This component is rendered by the outer React ({React.version}).\\n+      </h3>\\n+      <Greeting />\\n+      <br />\\n+      <p>\\n+        Counter: {counter}{\' \'}\\n+        <button onClick={() => dispatch({type: \'increment\'})}>+</button>\\n+      </p>\\n+    </>\\n+  );\\n+}\\n+\\n+function mapStateToProps(state) {\\n+  return {counter: state};\\n+}\\n+\\n+export default connect(mapStateToProps)(AboutPage);"},{"sha":"51782179284cbf142375d67d5741b4450fa2514b","filename":"fixtures/nesting/src/modern/App.js","status":"added","additions":52,"deletions":0,"changes":52,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/App.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/App.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/App.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,52 @@\\n+import React from \'react\';\\n+import {useState, Suspense} from \'react\';\\n+import {BrowserRouter, Switch, Route} from \'react-router-dom\';\\n+\\n+import HomePage from \'./HomePage\';\\n+import AboutPage from \'./AboutPage\';\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+\\n+export default function App() {\\n+  const [theme, setTheme] = useState(\'slategrey\');\\n+\\n+  function handleToggleClick() {\\n+    if (theme === \'slategrey\') {\\n+      setTheme(\'hotpink\');\\n+    } else {\\n+      setTheme(\'slategrey\');\\n+    }\\n+  }\\n+\\n+  return (\\n+    <BrowserRouter>\\n+      <ThemeContext.Provider value={theme}>\\n+        <div style={{fontFamily: \'sans-serif\'}}>\\n+          <div\\n+            style={{\\n+              margin: 20,\\n+              padding: 20,\\n+              border: \'1px solid black\',\\n+              minHeight: 300,\\n+            }}>\\n+            <button onClick={handleToggleClick}>Toggle Theme Context</button>\\n+            <br />\\n+            <Suspense fallback={<Spinner />}>\\n+              <Switch>\\n+                <Route path=\\"/about\\">\\n+                  <AboutPage />\\n+                </Route>\\n+                <Route path=\\"/\\">\\n+                  <HomePage />\\n+                </Route>\\n+              </Switch>\\n+            </Suspense>\\n+          </div>\\n+        </div>\\n+      </ThemeContext.Provider>\\n+    </BrowserRouter>\\n+  );\\n+}\\n+\\n+function Spinner() {\\n+  return null;\\n+}"},{"sha":"7b23652ef5c1926ea60a7257d1873e3383d51c91","filename":"fixtures/nesting/src/modern/HomePage.js","status":"added","additions":22,"deletions":0,"changes":22,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/HomePage.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/HomePage.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/HomePage.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,22 @@\\n+import React from \'react\';\\n+import {useContext} from \'react\';\\n+import {Link} from \'react-router-dom\';\\n+\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+import Clock from \'./shared/Clock\';\\n+\\n+export default function HomePage({counter, dispatch}) {\\n+  const theme = useContext(ThemeContext);\\n+  return (\\n+    <>\\n+      <h2>src/modern/HomePage.js</h2>\\n+      <h3 style={{color: theme}}>\\n+        This component is rendered by the outer React ({React.version}).\\n+      </h3>\\n+      <Clock />\\n+      <b>\\n+        <Link to=\\"/about\\">Go to About</Link>\\n+      </b>\\n+    </>\\n+  );\\n+}"},{"sha":"940886e9bbaf2b7ce7bfe1ef37c8706b2112812a","filename":"fixtures/nesting/src/modern/index.js","status":"added","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/index.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/index.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/index.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,15 @@\\n+import React from \'react\';\\n+import {StrictMode} from \'react\';\\n+import ReactDOM from \'react-dom\';\\n+import {Provider} from \'react-redux\';\\n+import App from \'./App\';\\n+import {store} from \'../store\';\\n+\\n+ReactDOM.render(\\n+  <StrictMode>\\n+    <Provider store={store}>\\n+      <App />\\n+    </Provider>\\n+  </StrictMode>,\\n+  document.getElementById(\'root\')\\n+);"},{"sha":"648b2aea3fe2b9247ac89f5afa47e5e68aab196e","filename":"fixtures/nesting/src/modern/lazyLegacyRoot.js","status":"added","additions":94,"deletions":0,"changes":94,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/lazyLegacyRoot.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/lazyLegacyRoot.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/lazyLegacyRoot.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,94 @@\\n+import React from \'react\';\\n+import {useContext, useMemo, useRef, useState, useLayoutEffect} from \'react\';\\n+import {__RouterContext} from \'react-router\';\\n+import {ReactReduxContext} from \'react-redux\';\\n+\\n+import ThemeContext from \'./shared/ThemeContext\';\\n+\\n+let rendererModule = {\\n+  status: \'pending\',\\n+  promise: null,\\n+  result: null,\\n+};\\n+\\n+export default function lazyLegacyRoot(getLegacyComponent) {\\n+  let componentModule = {\\n+    status: \'pending\',\\n+    promise: null,\\n+    result: null,\\n+  };\\n+\\n+  return function Wrapper(props) {\\n+    const createLegacyRoot = readModule(rendererModule, () =>\\n+      import(\'../legacy/createLegacyRoot\')\\n+    ).default;\\n+    const Component = readModule(componentModule, getLegacyComponent).default;\\n+    const containerRef = useRef(null);\\n+    const rootRef = useRef(null);\\n+\\n+    // Populate every contexts we want the legacy subtree to see.\\n+    // Then in src/legacy/createLegacyRoot we will apply them.\\n+    const theme = useContext(ThemeContext);\\n+    const router = useContext(__RouterContext);\\n+    const reactRedux = useContext(ReactReduxContext);\\n+    const context = useMemo(\\n+      () => ({\\n+        theme,\\n+        router,\\n+        reactRedux,\\n+      }),\\n+      [theme, router, reactRedux]\\n+    );\\n+\\n+    // Create/unmount.\\n+    useLayoutEffect(() => {\\n+      if (!rootRef.current) {\\n+        rootRef.current = createLegacyRoot(containerRef.current);\\n+      }\\n+      const root = rootRef.current;\\n+      return () => {\\n+        root.unmount();\\n+      };\\n+    }, [createLegacyRoot]);\\n+\\n+    // Mount/update.\\n+    useLayoutEffect(() => {\\n+      if (rootRef.current) {\\n+        rootRef.current.render(Component, props, context);\\n+      }\\n+    }, [Component, props, context]);\\n+\\n+    return <div style={{display: \'contents\'}} ref={containerRef} />;\\n+  };\\n+}\\n+\\n+// This is similar to React.lazy, but implemented manually.\\n+// We use this to Suspend rendering of this component until\\n+// we fetch the component and the legacy React to render it.\\n+function readModule(record, createPromise) {\\n+  if (record.status === \'fulfilled\') {\\n+    return record.result;\\n+  }\\n+  if (record.status === \'rejected\') {\\n+    throw record.result;\\n+  }\\n+  if (!record.promise) {\\n+    record.promise = createPromise().then(\\n+      value => {\\n+        if (record.status === \'pending\') {\\n+          record.status = \'fulfilled\';\\n+          record.promise = null;\\n+          record.result = value;\\n+        }\\n+      },\\n+      error => {\\n+        if (record.status === \'pending\') {\\n+          record.status = \'rejected\';\\n+          record.promise = null;\\n+          record.result = error;\\n+        }\\n+      }\\n+    );\\n+  }\\n+  throw record.promise;\\n+}"},{"sha":"4d11e94913dedf247e8a47321a082ec88d71b2cf","filename":"fixtures/nesting/src/modern/package.json","status":"added","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/package.json","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/modern/package.json","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/modern/package.json?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,10 @@\\n+{\\n+  \\"private\\": true,\\n+  \\"name\\": \\"react-nesting-example-modern\\",\\n+  \\"dependencies\\": {\\n+    \\"react\\": \\"0.0.0-3d0895557\\",\\n+    \\"react-dom\\": \\"0.0.0-3d0895557\\",\\n+    \\"react-redux\\": \\"7.2.1\\",\\n+    \\"react-router-dom\\": \\"5.2.0\\"\\n+  }\\n+}"},{"sha":"8c4b36696ba18fd8099e9863485e3cc5029b8625","filename":"fixtures/nesting/src/shared/Clock.js","status":"added","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/Clock.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/Clock.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/shared/Clock.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,8 @@\\n+import React from \'react\';\\n+\\n+import useTime from \'./useTime\';\\n+\\n+export default function Clock() {\\n+  const time = useTime();\\n+  return <p>Time: {time}</p>;\\n+}"},{"sha":"caa4b07322acc96fef7cf98041d69973e934ee9c","filename":"fixtures/nesting/src/shared/ThemeContext.js","status":"added","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/ThemeContext.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/ThemeContext.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/shared/ThemeContext.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,5 @@\\n+import {createContext} from \'react\';\\n+\\n+const ThemeContext = createContext(null);\\n+\\n+export default ThemeContext;"},{"sha":"afe7bbf4580dfa0f66e816edb4ef837be59f7fdd","filename":"fixtures/nesting/src/shared/useTime.js","status":"added","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/useTime.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/shared/useTime.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/shared/useTime.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,12 @@\\n+import {useState, useEffect} from \'react\';\\n+\\n+export default function useTimer() {\\n+  const [value, setValue] = useState(() => new Date());\\n+  useEffect(() => {\\n+    const id = setInterval(() => {\\n+      setValue(new Date());\\n+    }, 1000);\\n+    return () => clearInterval(id);\\n+  }, []);\\n+  return value.toLocaleTimeString();\\n+}"},{"sha":"d9031980ec9f5be5b66233a7db9d10b826256d54","filename":"fixtures/nesting/src/store.js","status":"added","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/facebook/react/blob/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/store.js","raw_url":"https://github.com/facebook/react/raw/336729856a1355ff264e3e5427c67bb23b708657/fixtures/nesting/src/store.js","contents_url":"https://api.github.com/repos/facebook/react/contents/fixtures/nesting/src/store.js?ref=336729856a1355ff264e3e5427c67bb23b708657","patch":"@@ -0,0 +1,14 @@\\n+import {createStore} from \'redux\';\\n+\\n+function reducer(state = 0, action) {\\n+  switch (action.type) {\\n+    case \'increment\':\\n+      return state + 1;\\n+    default:\\n+      return state;\\n+  }\\n+}\\n+\\n+// Because this file is declared above both Modern and Legacy folders,\\n+// we can import this from either folder without duplicating the object.\\n+export const store = createStore(reducer);"}],"stats":{"total":618,"additions":618,"deletions":0}},{"date":"Aug 6th 20","parents":[{"sha":"5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a","url":"https://api.github.com/repos/facebook/react/commits/5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a","html_url":"https://github.com/facebook/react/commit/5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a"}],"author":"rickhanlonii","files":[{"sha":"d92c6d5eb582af8dfda4376a4105e8e811e05966","filename":"packages/react-dom/src/events/ReactDOMEventListener.js","status":"modified","additions":23,"deletions":7,"changes":30,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-dom/src/events/ReactDOMEventListener.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-dom/src/events/ReactDOMEventListener.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMEventListener.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -38,7 +38,10 @@ import {\\n import getEventTarget from \'./getEventTarget\';\\n import {getClosestInstanceFromNode} from \'../client/ReactDOMComponentTree\';\\n \\n-import {enableLegacyFBSupport} from \'shared/ReactFeatureFlags\';\\n+import {\\n+  enableLegacyFBSupport,\\n+  decoupleUpdatePriorityFromScheduler,\\n+} from \'shared/ReactFeatureFlags\';\\n import {\\n   UserBlockingEvent,\\n   ContinuousEvent,\\n@@ -147,10 +150,25 @@ function dispatchUserBlockingUpdate(\\n   container,\\n   nativeEvent,\\n ) {\\n-  // TODO: Double wrapping is necessary while we decouple Scheduler priority.\\n-  const previousPriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(InputContinuousLanePriority);\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousPriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      // TODO: Double wrapping is necessary while we decouple Scheduler priority.\\n+      setCurrentUpdateLanePriority(InputContinuousLanePriority);\\n+      runWithPriority(\\n+        UserBlockingPriority,\\n+        dispatchEvent.bind(\\n+          null,\\n+          domEventName,\\n+          eventSystemFlags,\\n+          container,\\n+          nativeEvent,\\n+        ),\\n+      );\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousPriority);\\n+    }\\n+  } else {\\n     runWithPriority(\\n       UserBlockingPriority,\\n       dispatchEvent.bind(\\n@@ -161,8 +179,6 @@ function dispatchUserBlockingUpdate(\\n         nativeEvent,\\n       ),\\n     );\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousPriority);\\n   }\\n }\\n "},{"sha":"99f367f606873d66fe269774d4d14423a35fa381","filename":"packages/react-reconciler/src/ReactFiberHooks.new.js","status":"modified","additions":57,"deletions":26,"changes":83,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberHooks.new.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberHooks.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberHooks.new.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -26,6 +26,7 @@ import {\\n   enableDebugTracing,\\n   enableSchedulingProfiler,\\n   enableNewReconciler,\\n+  decoupleUpdatePriorityFromScheduler,\\n } from \'shared/ReactFeatureFlags\';\\n \\n import {NoMode, BlockingMode, DebugTracingMode} from \'./ReactTypeOfMode\';\\n@@ -1506,34 +1507,64 @@ function rerenderDeferredValue<T>(\\n \\n function startTransition(setPending, config, callback) {\\n   const priorityLevel = getCurrentPriorityLevel();\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  setCurrentUpdateLanePriority(\\n-    higherLanePriority(previousLanePriority, InputContinuousLanePriority),\\n-  );\\n-  runWithPriority(\\n-    priorityLevel < UserBlockingPriority ? UserBlockingPriority : priorityLevel,\\n-    () => {\\n-      setPending(true);\\n-    },\\n-  );\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    setCurrentUpdateLanePriority(\\n+      higherLanePriority(previousLanePriority, InputContinuousLanePriority),\\n+    );\\n \\n-  // If there\'s no SuspenseConfig set, we\'ll use the DefaultLanePriority for this transition.\\n-  setCurrentUpdateLanePriority(DefaultLanePriority);\\n+    runWithPriority(\\n+      priorityLevel < UserBlockingPriority\\n+        ? UserBlockingPriority\\n+        : priorityLevel,\\n+      () => {\\n+        setPending(true);\\n+      },\\n+    );\\n \\n-  runWithPriority(\\n-    priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n-    () => {\\n-      const previousConfig = ReactCurrentBatchConfig.suspense;\\n-      ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n-      try {\\n-        setPending(false);\\n-        callback();\\n-      } finally {\\n-        setCurrentUpdateLanePriority(previousLanePriority);\\n-        ReactCurrentBatchConfig.suspense = previousConfig;\\n-      }\\n-    },\\n-  );\\n+    // If there\'s no SuspenseConfig set, we\'ll use the DefaultLanePriority for this transition.\\n+    setCurrentUpdateLanePriority(DefaultLanePriority);\\n+\\n+    runWithPriority(\\n+      priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n+      () => {\\n+        const previousConfig = ReactCurrentBatchConfig.suspense;\\n+        ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n+        try {\\n+          setPending(false);\\n+          callback();\\n+        } finally {\\n+          if (decoupleUpdatePriorityFromScheduler) {\\n+            setCurrentUpdateLanePriority(previousLanePriority);\\n+          }\\n+          ReactCurrentBatchConfig.suspense = previousConfig;\\n+        }\\n+      },\\n+    );\\n+  } else {\\n+    runWithPriority(\\n+      priorityLevel < UserBlockingPriority\\n+        ? UserBlockingPriority\\n+        : priorityLevel,\\n+      () => {\\n+        setPending(true);\\n+      },\\n+    );\\n+\\n+    runWithPriority(\\n+      priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n+      () => {\\n+        const previousConfig = ReactCurrentBatchConfig.suspense;\\n+        ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n+        try {\\n+          setPending(false);\\n+          callback();\\n+        } finally {\\n+          ReactCurrentBatchConfig.suspense = previousConfig;\\n+        }\\n+      },\\n+    );\\n+  }\\n }\\n \\n function mountTransition("},{"sha":"380524df9aad68c913f5da83fa04e8d0667b2288","filename":"packages/react-reconciler/src/ReactFiberHooks.old.js","status":"modified","additions":57,"deletions":26,"changes":83,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberHooks.old.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberHooks.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberHooks.old.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -26,6 +26,7 @@ import {\\n   enableDebugTracing,\\n   enableSchedulingProfiler,\\n   enableNewReconciler,\\n+  decoupleUpdatePriorityFromScheduler,\\n } from \'shared/ReactFeatureFlags\';\\n \\n import {NoMode, BlockingMode, DebugTracingMode} from \'./ReactTypeOfMode\';\\n@@ -1505,34 +1506,64 @@ function rerenderDeferredValue<T>(\\n \\n function startTransition(setPending, config, callback) {\\n   const priorityLevel = getCurrentPriorityLevel();\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  setCurrentUpdateLanePriority(\\n-    higherLanePriority(previousLanePriority, InputContinuousLanePriority),\\n-  );\\n-  runWithPriority(\\n-    priorityLevel < UserBlockingPriority ? UserBlockingPriority : priorityLevel,\\n-    () => {\\n-      setPending(true);\\n-    },\\n-  );\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    setCurrentUpdateLanePriority(\\n+      higherLanePriority(previousLanePriority, InputContinuousLanePriority),\\n+    );\\n \\n-  // If there\'s no SuspenseConfig set, we\'ll use the DefaultLanePriority for this transition.\\n-  setCurrentUpdateLanePriority(DefaultLanePriority);\\n+    runWithPriority(\\n+      priorityLevel < UserBlockingPriority\\n+        ? UserBlockingPriority\\n+        : priorityLevel,\\n+      () => {\\n+        setPending(true);\\n+      },\\n+    );\\n \\n-  runWithPriority(\\n-    priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n-    () => {\\n-      const previousConfig = ReactCurrentBatchConfig.suspense;\\n-      ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n-      try {\\n-        setPending(false);\\n-        callback();\\n-      } finally {\\n-        setCurrentUpdateLanePriority(previousLanePriority);\\n-        ReactCurrentBatchConfig.suspense = previousConfig;\\n-      }\\n-    },\\n-  );\\n+    // If there\'s no SuspenseConfig set, we\'ll use the DefaultLanePriority for this transition.\\n+    setCurrentUpdateLanePriority(DefaultLanePriority);\\n+\\n+    runWithPriority(\\n+      priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n+      () => {\\n+        const previousConfig = ReactCurrentBatchConfig.suspense;\\n+        ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n+        try {\\n+          setPending(false);\\n+          callback();\\n+        } finally {\\n+          if (decoupleUpdatePriorityFromScheduler) {\\n+            setCurrentUpdateLanePriority(previousLanePriority);\\n+          }\\n+          ReactCurrentBatchConfig.suspense = previousConfig;\\n+        }\\n+      },\\n+    );\\n+  } else {\\n+    runWithPriority(\\n+      priorityLevel < UserBlockingPriority\\n+        ? UserBlockingPriority\\n+        : priorityLevel,\\n+      () => {\\n+        setPending(true);\\n+      },\\n+    );\\n+\\n+    runWithPriority(\\n+      priorityLevel > NormalPriority ? NormalPriority : priorityLevel,\\n+      () => {\\n+        const previousConfig = ReactCurrentBatchConfig.suspense;\\n+        ReactCurrentBatchConfig.suspense = config === undefined ? null : config;\\n+        try {\\n+          setPending(false);\\n+          callback();\\n+        } finally {\\n+          ReactCurrentBatchConfig.suspense = previousConfig;\\n+        }\\n+      },\\n+    );\\n+  }\\n }\\n \\n function mountTransition("},{"sha":"9cd162cb01cf0cc145d448d424b32a7e68837fe1","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.new.js","status":"modified","additions":112,"deletions":55,"changes":167,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.new.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -1163,13 +1163,16 @@ export function flushDiscreteUpdates() {\\n }\\n \\n export function deferredUpdates<A>(fn: () => A): A {\\n-  // TODO: Remove in favor of Scheduler.next\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(DefaultLanePriority);\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(DefaultLanePriority);\\n+      return runWithPriority(NormalSchedulerPriority, fn);\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+    }\\n+  } else {\\n     return runWithPriority(NormalSchedulerPriority, fn);\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n   }\\n }\\n \\n@@ -1225,20 +1228,35 @@ export function discreteUpdates<A, B, C, D, R>(\\n ): R {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= DiscreteEventContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(InputDiscreteLanePriority);\\n-    // Should this\\n-    return runWithPriority(\\n-      UserBlockingSchedulerPriority,\\n-      fn.bind(null, a, b, c, d),\\n-    );\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    if (executionContext === NoContext) {\\n-      // Flush the immediate callbacks that were scheduled during this batch\\n-      flushSyncCallbackQueue();\\n+\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(InputDiscreteLanePriority);\\n+      return runWithPriority(\\n+        UserBlockingSchedulerPriority,\\n+        fn.bind(null, a, b, c, d),\\n+      );\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n+    }\\n+  } else {\\n+    try {\\n+      return runWithPriority(\\n+        UserBlockingSchedulerPriority,\\n+        fn.bind(null, a, b, c, d),\\n+      );\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n     }\\n   }\\n }\\n@@ -1271,37 +1289,67 @@ export function flushSync<A, R>(fn: A => R, a: A): R {\\n     return fn(a);\\n   }\\n   executionContext |= BatchedContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n-    if (fn) {\\n-      return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n-    } else {\\n-      return (undefined: $FlowFixMe);\\n+\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+      if (fn) {\\n+        return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n+      } else {\\n+        return (undefined: $FlowFixMe);\\n+      }\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+      executionContext = prevExecutionContext;\\n+      // Flush the immediate callbacks that were scheduled during this batch.\\n+      // Note that this will happen even if batchedUpdates is higher up\\n+      // the stack.\\n+      flushSyncCallbackQueue();\\n+    }\\n+  } else {\\n+    try {\\n+      if (fn) {\\n+        return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n+      } else {\\n+        return (undefined: $FlowFixMe);\\n+      }\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      // Flush the immediate callbacks that were scheduled during this batch.\\n+      // Note that this will happen even if batchedUpdates is higher up\\n+      // the stack.\\n+      flushSyncCallbackQueue();\\n     }\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    // Flush the immediate callbacks that were scheduled during this batch.\\n-    // Note that this will happen even if batchedUpdates is higher up\\n-    // the stack.\\n-    flushSyncCallbackQueue();\\n   }\\n }\\n \\n export function flushControlled(fn: () => mixed): void {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= BatchedContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n-    runWithPriority(ImmediateSchedulerPriority, fn);\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    if (executionContext === NoContext) {\\n-      // Flush the immediate callbacks that were scheduled during this batch\\n-      flushSyncCallbackQueue();\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+      runWithPriority(ImmediateSchedulerPriority, fn);\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n+    }\\n+  } else {\\n+    try {\\n+      runWithPriority(ImmediateSchedulerPriority, fn);\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n     }\\n   }\\n }\\n@@ -2122,8 +2170,11 @@ function commitRootImpl(root, renderPriorityLevel) {\\n   }\\n \\n   if (firstEffect !== null) {\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n+    let previousLanePriority;\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      previousLanePriority = getCurrentUpdateLanePriority();\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+    }\\n \\n     const prevExecutionContext = executionContext;\\n     executionContext |= CommitContext;\\n@@ -2214,8 +2265,10 @@ function commitRootImpl(root, renderPriorityLevel) {\\n     }\\n     executionContext = prevExecutionContext;\\n \\n-    // Reset the priority to the previous non-sync value.\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n+    if (decoupleUpdatePriorityFromScheduler && previousLanePriority != null) {\\n+      // Reset the priority to the previous non-sync value.\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+    }\\n   } else {\\n     // No effects.\\n     root.current = finishedWork;\\n@@ -2655,14 +2708,18 @@ export function flushPassiveEffects(): boolean {\\n         ? NormalSchedulerPriority\\n         : pendingPassiveEffectsRenderPriority;\\n     pendingPassiveEffectsRenderPriority = NoSchedulerPriority;\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    try {\\n-      setCurrentUpdateLanePriority(\\n-        schedulerPriorityToLanePriority(priorityLevel),\\n-      );\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      const previousLanePriority = getCurrentUpdateLanePriority();\\n+      try {\\n+        setCurrentUpdateLanePriority(\\n+          schedulerPriorityToLanePriority(priorityLevel),\\n+        );\\n+        return runWithPriority(priorityLevel, flushPassiveEffectsImpl);\\n+      } finally {\\n+        setCurrentUpdateLanePriority(previousLanePriority);\\n+      }\\n+    } else {\\n       return runWithPriority(priorityLevel, flushPassiveEffectsImpl);\\n-    } finally {\\n-      setCurrentUpdateLanePriority(previousLanePriority);\\n     }\\n   }\\n   return false;"},{"sha":"4cb6e5093377e9ca793f80b92e894b017fbb0d68","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.old.js","status":"modified","additions":112,"deletions":55,"changes":167,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.old.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -1147,13 +1147,16 @@ export function flushDiscreteUpdates() {\\n }\\n \\n export function deferredUpdates<A>(fn: () => A): A {\\n-  // TODO: Remove in favor of Scheduler.next\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(DefaultLanePriority);\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(DefaultLanePriority);\\n+      return runWithPriority(NormalSchedulerPriority, fn);\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+    }\\n+  } else {\\n     return runWithPriority(NormalSchedulerPriority, fn);\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n   }\\n }\\n \\n@@ -1209,20 +1212,35 @@ export function discreteUpdates<A, B, C, D, R>(\\n ): R {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= DiscreteEventContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(InputDiscreteLanePriority);\\n-    // Should this\\n-    return runWithPriority(\\n-      UserBlockingSchedulerPriority,\\n-      fn.bind(null, a, b, c, d),\\n-    );\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    if (executionContext === NoContext) {\\n-      // Flush the immediate callbacks that were scheduled during this batch\\n-      flushSyncCallbackQueue();\\n+\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(InputDiscreteLanePriority);\\n+      return runWithPriority(\\n+        UserBlockingSchedulerPriority,\\n+        fn.bind(null, a, b, c, d),\\n+      );\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n+    }\\n+  } else {\\n+    try {\\n+      return runWithPriority(\\n+        UserBlockingSchedulerPriority,\\n+        fn.bind(null, a, b, c, d),\\n+      );\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n     }\\n   }\\n }\\n@@ -1255,37 +1273,67 @@ export function flushSync<A, R>(fn: A => R, a: A): R {\\n     return fn(a);\\n   }\\n   executionContext |= BatchedContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n-    if (fn) {\\n-      return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n-    } else {\\n-      return (undefined: $FlowFixMe);\\n+\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+      if (fn) {\\n+        return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n+      } else {\\n+        return (undefined: $FlowFixMe);\\n+      }\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+      executionContext = prevExecutionContext;\\n+      // Flush the immediate callbacks that were scheduled during this batch.\\n+      // Note that this will happen even if batchedUpdates is higher up\\n+      // the stack.\\n+      flushSyncCallbackQueue();\\n+    }\\n+  } else {\\n+    try {\\n+      if (fn) {\\n+        return runWithPriority(ImmediateSchedulerPriority, fn.bind(null, a));\\n+      } else {\\n+        return (undefined: $FlowFixMe);\\n+      }\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      // Flush the immediate callbacks that were scheduled during this batch.\\n+      // Note that this will happen even if batchedUpdates is higher up\\n+      // the stack.\\n+      flushSyncCallbackQueue();\\n     }\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    // Flush the immediate callbacks that were scheduled during this batch.\\n-    // Note that this will happen even if batchedUpdates is higher up\\n-    // the stack.\\n-    flushSyncCallbackQueue();\\n   }\\n }\\n \\n export function flushControlled(fn: () => mixed): void {\\n   const prevExecutionContext = executionContext;\\n   executionContext |= BatchedContext;\\n-  const previousLanePriority = getCurrentUpdateLanePriority();\\n-  try {\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n-    runWithPriority(ImmediateSchedulerPriority, fn);\\n-  } finally {\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n-    executionContext = prevExecutionContext;\\n-    if (executionContext === NoContext) {\\n-      // Flush the immediate callbacks that were scheduled during this batch\\n-      flushSyncCallbackQueue();\\n+  if (decoupleUpdatePriorityFromScheduler) {\\n+    const previousLanePriority = getCurrentUpdateLanePriority();\\n+    try {\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+      runWithPriority(ImmediateSchedulerPriority, fn);\\n+    } finally {\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n+    }\\n+  } else {\\n+    try {\\n+      runWithPriority(ImmediateSchedulerPriority, fn);\\n+    } finally {\\n+      executionContext = prevExecutionContext;\\n+      if (executionContext === NoContext) {\\n+        // Flush the immediate callbacks that were scheduled during this batch\\n+        flushSyncCallbackQueue();\\n+      }\\n     }\\n   }\\n }\\n@@ -2019,8 +2067,11 @@ function commitRootImpl(root, renderPriorityLevel) {\\n   }\\n \\n   if (firstEffect !== null) {\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    setCurrentUpdateLanePriority(SyncLanePriority);\\n+    let previousLanePriority;\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      previousLanePriority = getCurrentUpdateLanePriority();\\n+      setCurrentUpdateLanePriority(SyncLanePriority);\\n+    }\\n \\n     const prevExecutionContext = executionContext;\\n     executionContext |= CommitContext;\\n@@ -2143,8 +2194,10 @@ function commitRootImpl(root, renderPriorityLevel) {\\n     }\\n     executionContext = prevExecutionContext;\\n \\n-    // Reset the priority to the previous non-sync value.\\n-    setCurrentUpdateLanePriority(previousLanePriority);\\n+    if (decoupleUpdatePriorityFromScheduler && previousLanePriority != null) {\\n+      // Reset the priority to the previous non-sync value.\\n+      setCurrentUpdateLanePriority(previousLanePriority);\\n+    }\\n   } else {\\n     // No effects.\\n     root.current = finishedWork;\\n@@ -2463,14 +2516,18 @@ export function flushPassiveEffects(): boolean {\\n         ? NormalSchedulerPriority\\n         : pendingPassiveEffectsRenderPriority;\\n     pendingPassiveEffectsRenderPriority = NoSchedulerPriority;\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    try {\\n-      setCurrentUpdateLanePriority(\\n-        schedulerPriorityToLanePriority(priorityLevel),\\n-      );\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      const previousLanePriority = getCurrentUpdateLanePriority();\\n+      try {\\n+        setCurrentUpdateLanePriority(\\n+          schedulerPriorityToLanePriority(priorityLevel),\\n+        );\\n+        return runWithPriority(priorityLevel, flushPassiveEffectsImpl);\\n+      } finally {\\n+        setCurrentUpdateLanePriority(previousLanePriority);\\n+      }\\n+    } else {\\n       return runWithPriority(priorityLevel, flushPassiveEffectsImpl);\\n-    } finally {\\n-      setCurrentUpdateLanePriority(previousLanePriority);\\n     }\\n   }\\n   return false;"},{"sha":"18e4ba82ab36c54ed9a02b5291f1bcf2b1de7e88","filename":"packages/react-reconciler/src/SchedulerWithReactIntegration.new.js","status":"modified","additions":59,"deletions":27,"changes":86,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/SchedulerWithReactIntegration.new.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/SchedulerWithReactIntegration.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/SchedulerWithReactIntegration.new.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -13,7 +13,10 @@ import type {ReactPriorityLevel} from \'./ReactInternalTypes\';\\n // CommonJS interop named imports.\\n import * as Scheduler from \'scheduler\';\\n import {__interactionsRef} from \'scheduler/tracing\';\\n-import {enableSchedulerTracing} from \'shared/ReactFeatureFlags\';\\n+import {\\n+  enableSchedulerTracing,\\n+  decoupleUpdatePriorityFromScheduler,\\n+} from \'shared/ReactFeatureFlags\';\\n import invariant from \'shared/invariant\';\\n import {\\n   SyncLanePriority,\\n@@ -176,34 +179,63 @@ function flushSyncCallbackQueueImpl() {\\n     // Prevent re-entrancy.\\n     isFlushingSyncQueue = true;\\n     let i = 0;\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    try {\\n-      const isSync = true;\\n-      const queue = syncQueue;\\n-      setCurrentUpdateLanePriority(SyncLanePriority);\\n-      runWithPriority(ImmediatePriority, () => {\\n-        for (; i < queue.length; i++) {\\n-          let callback = queue[i];\\n-          do {\\n-            callback = callback(isSync);\\n-          } while (callback !== null);\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      const previousLanePriority = getCurrentUpdateLanePriority();\\n+      try {\\n+        const isSync = true;\\n+        const queue = syncQueue;\\n+        setCurrentUpdateLanePriority(SyncLanePriority);\\n+        runWithPriority(ImmediatePriority, () => {\\n+          for (; i < queue.length; i++) {\\n+            let callback = queue[i];\\n+            do {\\n+              callback = callback(isSync);\\n+            } while (callback !== null);\\n+          }\\n+        });\\n+        syncQueue = null;\\n+      } catch (error) {\\n+        // If something throws, leave the remaining callbacks on the queue.\\n+        if (syncQueue !== null) {\\n+          syncQueue = syncQueue.slice(i + 1);\\n+        }\\n+        // Resume flushing in the next tick\\n+        Scheduler_scheduleCallback(\\n+          Scheduler_ImmediatePriority,\\n+          flushSyncCallbackQueue,\\n+        );\\n+        throw error;\\n+      } finally {\\n+        setCurrentUpdateLanePriority(previousLanePriority);\\n+        isFlushingSyncQueue = false;\\n+      }\\n+    } else {\\n+      try {\\n+        const isSync = true;\\n+        const queue = syncQueue;\\n+        runWithPriority(ImmediatePriority, () => {\\n+          for (; i < queue.length; i++) {\\n+            let callback = queue[i];\\n+            do {\\n+              callback = callback(isSync);\\n+            } while (callback !== null);\\n+          }\\n+        });\\n+        syncQueue = null;\\n+      } catch (error) {\\n+        // If something throws, leave the remaining callbacks on the queue.\\n+        if (syncQueue !== null) {\\n+          syncQueue = syncQueue.slice(i + 1);\\n         }\\n-      });\\n-      syncQueue = null;\\n-    } catch (error) {\\n-      // If something throws, leave the remaining callbacks on the queue.\\n-      if (syncQueue !== null) {\\n-        syncQueue = syncQueue.slice(i + 1);\\n+        // Resume flushing in the next tick\\n+        Scheduler_scheduleCallback(\\n+          Scheduler_ImmediatePriority,\\n+          flushSyncCallbackQueue,\\n+        );\\n+        throw error;\\n+      } finally {\\n+        isFlushingSyncQueue = false;\\n       }\\n-      // Resume flushing in the next tick\\n-      Scheduler_scheduleCallback(\\n-        Scheduler_ImmediatePriority,\\n-        flushSyncCallbackQueue,\\n-      );\\n-      throw error;\\n-    } finally {\\n-      setCurrentUpdateLanePriority(previousLanePriority);\\n-      isFlushingSyncQueue = false;\\n     }\\n   }\\n }"},{"sha":"18e4ba82ab36c54ed9a02b5291f1bcf2b1de7e88","filename":"packages/react-reconciler/src/SchedulerWithReactIntegration.old.js","status":"modified","additions":59,"deletions":27,"changes":86,"blob_url":"https://github.com/facebook/react/blob/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/SchedulerWithReactIntegration.old.js","raw_url":"https://github.com/facebook/react/raw/32ff4286872d1a6bb8ce71730064f60ebbdd1509/packages/react-reconciler/src/SchedulerWithReactIntegration.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/SchedulerWithReactIntegration.old.js?ref=32ff4286872d1a6bb8ce71730064f60ebbdd1509","patch":"@@ -13,7 +13,10 @@ import type {ReactPriorityLevel} from \'./ReactInternalTypes\';\\n // CommonJS interop named imports.\\n import * as Scheduler from \'scheduler\';\\n import {__interactionsRef} from \'scheduler/tracing\';\\n-import {enableSchedulerTracing} from \'shared/ReactFeatureFlags\';\\n+import {\\n+  enableSchedulerTracing,\\n+  decoupleUpdatePriorityFromScheduler,\\n+} from \'shared/ReactFeatureFlags\';\\n import invariant from \'shared/invariant\';\\n import {\\n   SyncLanePriority,\\n@@ -176,34 +179,63 @@ function flushSyncCallbackQueueImpl() {\\n     // Prevent re-entrancy.\\n     isFlushingSyncQueue = true;\\n     let i = 0;\\n-    const previousLanePriority = getCurrentUpdateLanePriority();\\n-    try {\\n-      const isSync = true;\\n-      const queue = syncQueue;\\n-      setCurrentUpdateLanePriority(SyncLanePriority);\\n-      runWithPriority(ImmediatePriority, () => {\\n-        for (; i < queue.length; i++) {\\n-          let callback = queue[i];\\n-          do {\\n-            callback = callback(isSync);\\n-          } while (callback !== null);\\n+    if (decoupleUpdatePriorityFromScheduler) {\\n+      const previousLanePriority = getCurrentUpdateLanePriority();\\n+      try {\\n+        const isSync = true;\\n+        const queue = syncQueue;\\n+        setCurrentUpdateLanePriority(SyncLanePriority);\\n+        runWithPriority(ImmediatePriority, () => {\\n+          for (; i < queue.length; i++) {\\n+            let callback = queue[i];\\n+            do {\\n+              callback = callback(isSync);\\n+            } while (callback !== null);\\n+          }\\n+        });\\n+        syncQueue = null;\\n+      } catch (error) {\\n+        // If something throws, leave the remaining callbacks on the queue.\\n+        if (syncQueue !== null) {\\n+          syncQueue = syncQueue.slice(i + 1);\\n+        }\\n+        // Resume flushing in the next tick\\n+        Scheduler_scheduleCallback(\\n+          Scheduler_ImmediatePriority,\\n+          flushSyncCallbackQueue,\\n+        );\\n+        throw error;\\n+      } finally {\\n+        setCurrentUpdateLanePriority(previousLanePriority);\\n+        isFlushingSyncQueue = false;\\n+      }\\n+    } else {\\n+      try {\\n+        const isSync = true;\\n+        const queue = syncQueue;\\n+        runWithPriority(ImmediatePriority, () => {\\n+          for (; i < queue.length; i++) {\\n+            let callback = queue[i];\\n+            do {\\n+              callback = callback(isSync);\\n+            } while (callback !== null);\\n+          }\\n+        });\\n+        syncQueue = null;\\n+      } catch (error) {\\n+        // If something throws, leave the remaining callbacks on the queue.\\n+        if (syncQueue !== null) {\\n+          syncQueue = syncQueue.slice(i + 1);\\n         }\\n-      });\\n-      syncQueue = null;\\n-    } catch (error) {\\n-      // If something throws, leave the remaining callbacks on the queue.\\n-      if (syncQueue !== null) {\\n-        syncQueue = syncQueue.slice(i + 1);\\n+        // Resume flushing in the next tick\\n+        Scheduler_scheduleCallback(\\n+          Scheduler_ImmediatePriority,\\n+          flushSyncCallbackQueue,\\n+        );\\n+        throw error;\\n+      } finally {\\n+        isFlushingSyncQueue = false;\\n       }\\n-      // Resume flushing in the next tick\\n-      Scheduler_scheduleCallback(\\n-        Scheduler_ImmediatePriority,\\n-        flushSyncCallbackQueue,\\n-      );\\n-      throw error;\\n-    } finally {\\n-      setCurrentUpdateLanePriority(previousLanePriority);\\n-      isFlushingSyncQueue = false;\\n     }\\n   }\\n }"}],"stats":{"total":702,"additions":479,"deletions":223}},{"date":"Aug 6th 20","parents":[{"sha":"a5fed98a96c41cb852355f208bc86a9120f3227e","url":"https://api.github.com/repos/facebook/react/commits/a5fed98a96c41cb852355f208bc86a9120f3227e","html_url":"https://github.com/facebook/react/commit/a5fed98a96c41cb852355f208bc86a9120f3227e"}],"author":"gusaiani","files":[{"sha":"bb9aa9c815dcdd7eaeee02cc64871ede1fcbdc67","filename":"packages/react/src/__tests__/ReactChildren-test.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a/packages/react/src/__tests__/ReactChildren-test.js","raw_url":"https://github.com/facebook/react/raw/5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a/packages/react/src/__tests__/ReactChildren-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/src/__tests__/ReactChildren-test.js?ref=5bdd4c8c60ed6c12c5af7ffb73660c8f91bf955a","patch":"@@ -460,7 +460,7 @@ describe(\'ReactChildren\', () => {\\n     });\\n \\n     function assertCalls() {\\n-      expect(callback).toHaveBeenCalledTimes(2, 0);\\n+      expect(callback).toHaveBeenCalledTimes(2);\\n       expect(callback).toHaveBeenCalledWith(\'a\', 0);\\n       expect(callback).toHaveBeenCalledWith(13, 1);\\n       callback.mockClear();"}],"stats":{"total":2,"additions":1,"deletions":1}},{"date":"Aug 6th 20","parents":[{"sha":"50893dbcb7030499eeecfa4b44539b603b757afd","url":"https://api.github.com/repos/facebook/react/commits/50893dbcb7030499eeecfa4b44539b603b757afd","html_url":"https://github.com/facebook/react/commit/50893dbcb7030499eeecfa4b44539b603b757afd"}],"author":"Andarist","files":[{"sha":"034c2666c4d063e6628e3677c9127b812cd1bddd","filename":"packages/react-refresh/src/ReactFreshBabelPlugin.js","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/ReactFreshBabelPlugin.js","raw_url":"https://github.com/facebook/react/raw/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/ReactFreshBabelPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-refresh/src/ReactFreshBabelPlugin.js?ref=a5fed98a96c41cb852355f208bc86a9120f3227e","patch":"@@ -140,9 +140,6 @@ export default function(babel, opts = {}) {\\n             } else if (calleeType === \'MemberExpression\') {\\n               // Could be something like React.forwardRef(...)\\n               // Pass through.\\n-            } else {\\n-              // More complicated call.\\n-              return false;\\n             }\\n             break;\\n           }"},{"sha":"c06961bae7a3f19fd41e83d201714facaf892fb5","filename":"packages/react-refresh/src/__tests__/ReactFreshBabelPlugin-test.js","status":"modified","additions":13,"deletions":4,"changes":17,"blob_url":"https://github.com/facebook/react/blob/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/__tests__/ReactFreshBabelPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/__tests__/ReactFreshBabelPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-refresh/src/__tests__/ReactFreshBabelPlugin-test.js?ref=a5fed98a96c41cb852355f208bc86a9120f3227e","patch":"@@ -261,15 +261,18 @@ describe(\'ReactFreshBabelPlugin\', () => {\\n         Store.subscribe();\\n \\n         const Header = styled.div\\\\`color: red\\\\`\\n-        const Factory = funny.factory\\\\`\\\\`;\\n+        const StyledFactory1 = styled(\'div\')\\\\`color: hotpink\\\\`\\n+        const StyledFactory2 = styled(\'div\')({ color: \'hotpink\' })\\n+        const StyledFactory3 = styled(A)({ color: \'hotpink\' })\\n+        const FunnyFactory = funny.factory\\\\`\\\\`;\\n \\n         let Alias1 = A;\\n         let Alias2 = A.Foo;\\n         const Dict = {};\\n \\n         function Foo() {\\n           return (\\n-            <div><A /><B /><Alias1 /><Alias2 /><Header /><Dict.X /></div>\\n+            <div><A /><B /><StyledFactory1 /><StyledFactory2 /><StyledFactory3 /><Alias1 /><Alias2 /><Header /><Dict.X /></div>\\n           );\\n         }\\n \\n@@ -294,7 +297,10 @@ describe(\'ReactFreshBabelPlugin\', () => {\\n         Store.subscribe();\\n \\n         const Header = styled.div\\\\`color: red\\\\`\\n-        const Factory = funny.factory\\\\`\\\\`;\\n+        const StyledFactory1 = styled(\'div\')\\\\`color: hotpink\\\\`\\n+        const StyledFactory2 = styled(\'div\')({ color: \'hotpink\' })\\n+        const StyledFactory3 = styled(A)({ color: \'hotpink\' })\\n+        const FunnyFactory = funny.factory\\\\`\\\\`;\\n \\n         let Alias1 = A;\\n         let Alias2 = A.Foo;\\n@@ -304,6 +310,9 @@ describe(\'ReactFreshBabelPlugin\', () => {\\n           return [\\n             React.createElement(A),\\n             React.createElement(B),\\n+            React.createElement(StyledFactory1),\\n+            React.createElement(StyledFactory2),\\n+            React.createElement(StyledFactory3),\\n             React.createElement(Alias1),\\n             React.createElement(Alias2),\\n             jsx(Header),\\n@@ -408,7 +417,7 @@ describe(\'ReactFreshBabelPlugin\', () => {\\n       transform(\\n         `\\n         import {useFancyState} from \'./hooks\';\\n-        \\n+\\n         export default function App() {\\n           const bar = useFancyState();\\n           return <h1>{bar}</h1>;"},{"sha":"729996f49ea3f9fc600b9e9e8c8113620820ec75","filename":"packages/react-refresh/src/__tests__/__snapshots__/ReactFreshBabelPlugin-test.js.snap","status":"modified","additions":44,"deletions":18,"changes":62,"blob_url":"https://github.com/facebook/react/blob/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/__tests__/__snapshots__/ReactFreshBabelPlugin-test.js.snap","raw_url":"https://github.com/facebook/react/raw/a5fed98a96c41cb852355f208bc86a9120f3227e/packages/react-refresh/src/__tests__/__snapshots__/ReactFreshBabelPlugin-test.js.snap","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-refresh/src/__tests__/__snapshots__/ReactFreshBabelPlugin-test.js.snap?ref=a5fed98a96c41cb852355f208bc86a9120f3227e","patch":"@@ -347,29 +347,42 @@ import Store from \'./Store\';\\n Store.subscribe();\\n const Header = styled.div\\\\`color: red\\\\`;\\n _c = Header;\\n-const Factory = funny.factory\\\\`\\\\`;\\n+const StyledFactory1 = styled(\'div\')\\\\`color: hotpink\\\\`;\\n+_c2 = StyledFactory1;\\n+const StyledFactory2 = styled(\'div\')({\\n+  color: \'hotpink\'\\n+});\\n+_c3 = StyledFactory2;\\n+const StyledFactory3 = styled(A)({\\n+  color: \'hotpink\'\\n+});\\n+_c4 = StyledFactory3;\\n+const FunnyFactory = funny.factory\\\\`\\\\`;\\n let Alias1 = A;\\n let Alias2 = A.Foo;\\n const Dict = {};\\n \\n function Foo() {\\n-  return <div><A /><B /><Alias1 /><Alias2 /><Header /><Dict.X /></div>;\\n+  return <div><A /><B /><StyledFactory1 /><StyledFactory2 /><StyledFactory3 /><Alias1 /><Alias2 /><Header /><Dict.X /></div>;\\n }\\n \\n-_c2 = Foo;\\n+_c5 = Foo;\\n const B = hoc(A); // This is currently registered as a false positive:\\n \\n-_c3 = B;\\n+_c6 = B;\\n const NotAComponent = wow(A); // We could avoid it but it also doesn\'t hurt.\\n \\n-_c4 = NotAComponent;\\n+_c7 = NotAComponent;\\n \\n-var _c, _c2, _c3, _c4;\\n+var _c, _c2, _c3, _c4, _c5, _c6, _c7;\\n \\n $RefreshReg$(_c, \\"Header\\");\\n-$RefreshReg$(_c2, \\"Foo\\");\\n-$RefreshReg$(_c3, \\"B\\");\\n-$RefreshReg$(_c4, \\"NotAComponent\\");\\n+$RefreshReg$(_c2, \\"StyledFactory1\\");\\n+$RefreshReg$(_c3, \\"StyledFactory2\\");\\n+$RefreshReg$(_c4, \\"StyledFactory3\\");\\n+$RefreshReg$(_c5, \\"Foo\\");\\n+$RefreshReg$(_c6, \\"B\\");\\n+$RefreshReg$(_c7, \\"NotAComponent\\");\\n `;\\n \\n exports[`ReactFreshBabelPlugin registers identifiers used in React.createElement at definition site 1`] = `\\n@@ -378,30 +391,43 @@ import Store from \'./Store\';\\n Store.subscribe();\\n const Header = styled.div\\\\`color: red\\\\`;\\n _c = Header;\\n-const Factory = funny.factory\\\\`\\\\`;\\n+const StyledFactory1 = styled(\'div\')\\\\`color: hotpink\\\\`;\\n+_c2 = StyledFactory1;\\n+const StyledFactory2 = styled(\'div\')({\\n+  color: \'hotpink\'\\n+});\\n+_c3 = StyledFactory2;\\n+const StyledFactory3 = styled(A)({\\n+  color: \'hotpink\'\\n+});\\n+_c4 = StyledFactory3;\\n+const FunnyFactory = funny.factory\\\\`\\\\`;\\n let Alias1 = A;\\n let Alias2 = A.Foo;\\n const Dict = {};\\n \\n function Foo() {\\n-  return [React.createElement(A), React.createElement(B), React.createElement(Alias1), React.createElement(Alias2), jsx(Header), React.createElement(Dict.X)];\\n+  return [React.createElement(A), React.createElement(B), React.createElement(StyledFactory1), React.createElement(StyledFactory2), React.createElement(StyledFactory3), React.createElement(Alias1), React.createElement(Alias2), jsx(Header), React.createElement(Dict.X)];\\n }\\n \\n-_c2 = Foo;\\n+_c5 = Foo;\\n React.createContext(Store);\\n const B = hoc(A); // This is currently registered as a false positive:\\n \\n-_c3 = B;\\n+_c6 = B;\\n const NotAComponent = wow(A); // We could avoid it but it also doesn\'t hurt.\\n \\n-_c4 = NotAComponent;\\n+_c7 = NotAComponent;\\n \\n-var _c, _c2, _c3, _c4;\\n+var _c, _c2, _c3, _c4, _c5, _c6, _c7;\\n \\n $RefreshReg$(_c, \\"Header\\");\\n-$RefreshReg$(_c2, \\"Foo\\");\\n-$RefreshReg$(_c3, \\"B\\");\\n-$RefreshReg$(_c4, \\"NotAComponent\\");\\n+$RefreshReg$(_c2, \\"StyledFactory1\\");\\n+$RefreshReg$(_c3, \\"StyledFactory2\\");\\n+$RefreshReg$(_c4, \\"StyledFactory3\\");\\n+$RefreshReg$(_c5, \\"Foo\\");\\n+$RefreshReg$(_c6, \\"B\\");\\n+$RefreshReg$(_c7, \\"NotAComponent\\");\\n `;\\n \\n exports[`ReactFreshBabelPlugin registers likely HOCs with inline functions 1`] = `"}],"stats":{"total":82,"additions":57,"deletions":25}},{"date":"Aug 6th 20","parents":[{"sha":"f77c7b9d76205d93908a06fb2d58ee8c31188d16","url":"https://api.github.com/repos/facebook/react/commits/f77c7b9d76205d93908a06fb2d58ee8c31188d16","html_url":"https://github.com/facebook/react/commit/f77c7b9d76205d93908a06fb2d58ee8c31188d16"}],"author":"DaniAcu","files":[{"sha":"342e653bd48a3d246976dcfbbe672c15080c8e4c","filename":"packages/react-dom/src/events/DOMEventProperties.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/50893dbcb7030499eeecfa4b44539b603b757afd/packages/react-dom/src/events/DOMEventProperties.js","raw_url":"https://github.com/facebook/react/raw/50893dbcb7030499eeecfa4b44539b603b757afd/packages/react-dom/src/events/DOMEventProperties.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/DOMEventProperties.js?ref=50893dbcb7030499eeecfa4b44539b603b757afd","patch":"@@ -8,7 +8,7 @@\\n  */\\n \\n import type {EventPriority} from \'shared/ReactTypes\';\\n-import type {DOMEventName} from \'../events/DOMEventNames\';\\n+import type {DOMEventName} from \'./DOMEventNames\';\\n \\n import {registerTwoPhaseEvent} from \'./EventRegistry\';\\n import {"}],"stats":{"total":2,"additions":1,"deletions":1}},{"date":"Aug 5th 20","parents":[{"sha":"e9721e14e4b8776c107afa3cdd7c6d664fe20c24","url":"https://api.github.com/repos/facebook/react/commits/e9721e14e4b8776c107afa3cdd7c6d664fe20c24","html_url":"https://github.com/facebook/react/commit/e9721e14e4b8776c107afa3cdd7c6d664fe20c24"}],"author":"emilisb","files":[{"sha":"50a9927ae3c6b3f7ce95092938a0675cb5f87040","filename":"packages/scheduler/src/__tests__/SchedulerBrowser-test.js","status":"modified","additions":7,"deletions":5,"changes":12,"blob_url":"https://github.com/facebook/react/blob/5cff7755022220f24c1066643e0036b41806e8fa/packages/scheduler/src/__tests__/SchedulerBrowser-test.js","raw_url":"https://github.com/facebook/react/raw/5cff7755022220f24c1066643e0036b41806e8fa/packages/scheduler/src/__tests__/SchedulerBrowser-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/__tests__/SchedulerBrowser-test.js?ref=5cff7755022220f24c1066643e0036b41806e8fa","patch":"@@ -42,14 +42,16 @@ describe(\'SchedulerBrowser\', () => {\\n     );\\n \\n     runtime = installMockBrowserRuntime();\\n-    performance = window.performance;\\n+    performance = global.performance;\\n     Scheduler = require(\'scheduler\');\\n     cancelCallback = Scheduler.unstable_cancelCallback;\\n     scheduleCallback = Scheduler.unstable_scheduleCallback;\\n     NormalPriority = Scheduler.unstable_NormalPriority;\\n   });\\n \\n   afterEach(() => {\\n+    delete global.performance;\\n+\\n     if (!runtime.isLogEmpty()) {\\n       throw Error(\'Test exited without clearing log.\');\\n     }\\n@@ -63,17 +65,17 @@ describe(\'SchedulerBrowser\', () => {\\n \\n     let eventLog = [];\\n \\n-    const window = {};\\n-    global.window = window;\\n-\\n     let currentTime = 0;\\n \\n-    window.performance = {\\n+    global.performance = {\\n       now() {\\n         return currentTime;\\n       },\\n     };\\n \\n+    const window = {};\\n+    global.window = window;\\n+\\n     // TODO: Scheduler no longer requires these methods to be polyfilled. But\\n     // maybe we want to continue warning if they don\'t exist, to preserve the\\n     // option to rely on it in the future?"},{"sha":"998380bd110a34ff6b9dc676fd9407ba26111222","filename":"packages/scheduler/src/forks/SchedulerHostConfig.default.js","status":"modified","additions":12,"deletions":16,"changes":28,"blob_url":"https://github.com/facebook/react/blob/5cff7755022220f24c1066643e0036b41806e8fa/packages/scheduler/src/forks/SchedulerHostConfig.default.js","raw_url":"https://github.com/facebook/react/raw/5cff7755022220f24c1066643e0036b41806e8fa/packages/scheduler/src/forks/SchedulerHostConfig.default.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/scheduler/src/forks/SchedulerHostConfig.default.js?ref=5cff7755022220f24c1066643e0036b41806e8fa","patch":"@@ -16,6 +16,18 @@ export let requestPaint;\\n export let getCurrentTime;\\n export let forceFrameRate;\\n \\n+const hasPerformanceNow =\\n+  typeof performance === \'object\' && typeof performance.now === \'function\';\\n+\\n+if (hasPerformanceNow) {\\n+  const localPerformance = performance;\\n+  getCurrentTime = () => localPerformance.now();\\n+} else {\\n+  const localDate = Date;\\n+  const initialTime = localDate.now();\\n+  getCurrentTime = () => localDate.now() - initialTime;\\n+}\\n+\\n if (\\n   // If Scheduler runs in a non-DOM environment, it falls back to a naive\\n   // implementation using setTimeout.\\n@@ -40,10 +52,6 @@ if (\\n       }\\n     }\\n   };\\n-  const initialTime = Date.now();\\n-  getCurrentTime = function() {\\n-    return Date.now() - initialTime;\\n-  };\\n   requestHostCallback = function(cb) {\\n     if (_callback !== null) {\\n       // Protect against re-entrancy.\\n@@ -68,8 +76,6 @@ if (\\n   requestPaint = forceFrameRate = function() {};\\n } else {\\n   // Capture local references to native APIs, in case a polyfill overrides them.\\n-  const performance = window.performance;\\n-  const Date = window.Date;\\n   const setTimeout = window.setTimeout;\\n   const clearTimeout = window.clearTimeout;\\n \\n@@ -98,16 +104,6 @@ if (\\n     }\\n   }\\n \\n-  if (\\n-    typeof performance === \'object\' &&\\n-    typeof performance.now === \'function\'\\n-  ) {\\n-    getCurrentTime = () => performance.now();\\n-  } else {\\n-    const initialTime = Date.now();\\n-    getCurrentTime = () => Date.now() - initialTime;\\n-  }\\n-\\n   let isMessageLoopRunning = false;\\n   let scheduledHostCallback = null;\\n   let taskTimeoutID = -1;"}],"stats":{"total":40,"additions":19,"deletions":21}},{"date":"Aug 6th 20","parents":[{"sha":"e67a6b16030ebc30257a69a7fb36a9ed67f29b39","url":"https://api.github.com/repos/facebook/react/commits/e67a6b16030ebc30257a69a7fb36a9ed67f29b39","html_url":"https://github.com/facebook/react/commit/e67a6b16030ebc30257a69a7fb36a9ed67f29b39"}],"author":"trueadm","files":[{"sha":"abf076597c638cd88504ee6bcfa2a9c9b14358c5","filename":"packages/react-dom/src/__tests__/ReactDOMFiber-test.js","status":"modified","additions":15,"deletions":4,"changes":19,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/__tests__/ReactDOMFiber-test.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/__tests__/ReactDOMFiber-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMFiber-test.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -1031,6 +1031,17 @@ describe(\'ReactDOMFiber\', () => {\\n     const handlerA = () => ops.push(\'A\');\\n     const handlerB = () => ops.push(\'B\');\\n \\n+    function click() {\\n+      const event = new MouseEvent(\'click\', {\\n+        bubbles: true,\\n+        cancelable: true,\\n+      });\\n+      Object.defineProperty(event, \'timeStamp\', {\\n+        value: 0,\\n+      });\\n+      node.dispatchEvent(event);\\n+    }\\n+\\n     class Example extends React.Component {\\n       state = {flip: false, count: 0};\\n       flip() {\\n@@ -1064,23 +1075,23 @@ describe(\'ReactDOMFiber\', () => {\\n     const node = container.firstChild;\\n     expect(node.tagName).toEqual(\'DIV\');\\n \\n-    node.click();\\n+    click();\\n \\n     expect(ops).toEqual([\'A\']);\\n     ops = [];\\n \\n     // Render with the other event handler.\\n     inst.flip();\\n \\n-    node.click();\\n+    click();\\n \\n     expect(ops).toEqual([\'B\']);\\n     ops = [];\\n \\n     // Rerender without changing any props.\\n     inst.tick();\\n \\n-    node.click();\\n+    click();\\n \\n     expect(ops).toEqual([\'B\']);\\n     ops = [];\\n@@ -1100,7 +1111,7 @@ describe(\'ReactDOMFiber\', () => {\\n     ops = [];\\n \\n     // Any click that happens after commit, should invoke A.\\n-    node.click();\\n+    click();\\n     expect(ops).toEqual([\'A\']);\\n   });\\n "},{"sha":"6f0b981ab95df93765d2fcaa456ba6ffa69323df","filename":"packages/react-dom/src/events/ReactDOMEventListener.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/ReactDOMEventListener.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/ReactDOMEventListener.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMEventListener.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -130,7 +130,7 @@ function dispatchDiscreteEvent(\\n     // flushed for this event and we don\'t need to do it again.\\n     (eventSystemFlags & IS_LEGACY_FB_SUPPORT_MODE) === 0\\n   ) {\\n-    flushDiscreteUpdatesIfNeeded();\\n+    flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp);\\n   }\\n   discreteUpdates(\\n     dispatchEvent,"},{"sha":"01625f45d265399c9bb6dfbabd130daae85da827","filename":"packages/react-dom/src/events/ReactDOMUpdateBatching.js","status":"modified","additions":27,"deletions":3,"changes":30,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/ReactDOMUpdateBatching.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/ReactDOMUpdateBatching.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMUpdateBatching.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -9,6 +9,7 @@ import {\\n   needsStateRestore,\\n   restoreStateIfNeeded,\\n } from \'./ReactDOMControlledComponent\';\\n+import {enableDiscreteEventFlushingChange} from \'shared/ReactFeatureFlags\';\\n \\n // Used as a way to call batchedUpdates when we don\'t have a reference to\\n // the renderer. Such as when we\'re dispatching events or if third party\\n@@ -87,9 +88,32 @@ export function discreteUpdates(fn, a, b, c, d) {\\n   }\\n }\\n \\n-export function flushDiscreteUpdatesIfNeeded() {\\n-  if (!isInsideEventHandler) {\\n-    flushDiscreteUpdatesImpl();\\n+let lastFlushedEventTimeStamp = 0;\\n+export function flushDiscreteUpdatesIfNeeded(timeStamp: number) {\\n+  if (enableDiscreteEventFlushingChange) {\\n+    // event.timeStamp isn\'t overly reliable due to inconsistencies in\\n+    // how different browsers have historically provided the time stamp.\\n+    // Some browsers provide high-resolution time stamps for all events,\\n+    // some provide low-resolution time stamps for all events. FF < 52\\n+    // even mixes both time stamps together. Some browsers even report\\n+    // negative time stamps or time stamps that are 0 (iOS9) in some cases.\\n+    // Given we are only comparing two time stamps with equality (!==),\\n+    // we are safe from the resolution differences. If the time stamp is 0\\n+    // we bail-out of preventing the flush, which can affect semantics,\\n+    // such as if an earlier flush removes or adds event listeners that\\n+    // are fired in the subsequent flush. However, this is the same\\n+    // behaviour as we had before this change, so the risks are low.\\n+    if (\\n+      !isInsideEventHandler &&\\n+      (timeStamp === 0 || lastFlushedEventTimeStamp !== timeStamp)\\n+    ) {\\n+      lastFlushedEventTimeStamp = timeStamp;\\n+      flushDiscreteUpdatesImpl();\\n+    }\\n+  } else {\\n+    if (!isInsideEventHandler) {\\n+      flushDiscreteUpdatesImpl();\\n+    }\\n   }\\n }\\n "},{"sha":"4ed062404e52f61b0d2b761cd989bbbb72bb555b","filename":"packages/react-dom/src/events/plugins/__tests__/ModernSimpleEventPlugin-test.js","status":"modified","additions":24,"deletions":9,"changes":33,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/plugins/__tests__/ModernSimpleEventPlugin-test.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/react-dom/src/events/plugins/__tests__/ModernSimpleEventPlugin-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/__tests__/ModernSimpleEventPlugin-test.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -275,9 +275,14 @@ describe(\'SimpleEventPlugin\', function() {\\n       expect(Scheduler).toFlushAndYield([\'render button: enabled\']);\\n \\n       function click() {\\n-        button.dispatchEvent(\\n-          new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-        );\\n+        const event = new MouseEvent(\'click\', {\\n+          bubbles: true,\\n+          cancelable: true,\\n+        });\\n+        Object.defineProperty(event, \'timeStamp\', {\\n+          value: 0,\\n+        });\\n+        button.dispatchEvent(event);\\n       }\\n \\n       // Click the button to trigger the side-effect\\n@@ -340,9 +345,14 @@ describe(\'SimpleEventPlugin\', function() {\\n       expect(button.textContent).toEqual(\'Count: 0\');\\n \\n       function click() {\\n-        button.dispatchEvent(\\n-          new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-        );\\n+        const event = new MouseEvent(\'click\', {\\n+          bubbles: true,\\n+          cancelable: true,\\n+        });\\n+        Object.defineProperty(event, \'timeStamp\', {\\n+          value: 0,\\n+        });\\n+        button.dispatchEvent(event);\\n       }\\n \\n       // Click the button a single time\\n@@ -421,9 +431,14 @@ describe(\'SimpleEventPlugin\', function() {\\n       expect(button.textContent).toEqual(\'High-pri count: 0, Low-pri count: 0\');\\n \\n       function click() {\\n-        button.dispatchEvent(\\n-          new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-        );\\n+        const event = new MouseEvent(\'click\', {\\n+          bubbles: true,\\n+          cancelable: true,\\n+        });\\n+        Object.defineProperty(event, \'timeStamp\', {\\n+          value: 0,\\n+        });\\n+        button.dispatchEvent(event);\\n       }\\n \\n       // Click the button a single time"},{"sha":"5ea7d961b4fd305e1c2aa852132d859be691fc25","filename":"packages/shared/ReactFeatureFlags.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/ReactFeatureFlags.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/ReactFeatureFlags.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/ReactFeatureFlags.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -125,3 +125,5 @@ export const deferRenderPhaseUpdateToNextBatch = true;\\n \\n // Replacement for runWithPriority in React internals.\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+\\n+export const enableDiscreteEventFlushingChange = false;"},{"sha":"ffab7e2c44e35bdbb8de8bd6a61b04170d8a6425","filename":"packages/shared/forks/ReactFeatureFlags.native-fb.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.native-fb.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.native-fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-fb.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -48,6 +48,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"ac3e17527db0007d4a08c43b161f62115a95e7ba","filename":"packages/shared/forks/ReactFeatureFlags.native-oss.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.native-oss.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.native-oss.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-oss.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"d436c9e1d67c76444ebd32d6eb0948aa60bd6075","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"99b14ee92e77fe89f1f927b8657c65a8546e553b","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"bc06ea7359416c8633c7a59607633828376574e5","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"09e5193473d4f02581e37b46d9def8ab16ba4eca","filename":"packages/shared/forks/ReactFeatureFlags.testing.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.testing.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.testing.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = false;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"2dea66f08fb234df6814cdc35f32636c87cb428c","filename":"packages/shared/forks/ReactFeatureFlags.testing.www.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.testing.www.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.testing.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.www.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -47,6 +47,7 @@ export const enableFilterEmptyStringAttributesDOM = false;\\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;\\n export const decoupleUpdatePriorityFromScheduler = false;\\n+export const enableDiscreteEventFlushingChange = true;\\n \\n // Flow magic to verify the exports of this file match the original version.\\n // eslint-disable-next-line no-unused-vars"},{"sha":"bb52cc86083a4102d830732c456b666e277907f5","filename":"packages/shared/forks/ReactFeatureFlags.www.js","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/facebook/react/blob/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.www.js","raw_url":"https://github.com/facebook/react/raw/f77c7b9d76205d93908a06fb2d58ee8c31188d16/packages/shared/forks/ReactFeatureFlags.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.www.js?ref=f77c7b9d76205d93908a06fb2d58ee8c31188d16","patch":"@@ -75,6 +75,8 @@ export const disableTextareaChildren = __EXPERIMENTAL__;\\n \\n export const warnUnstableRenderSubtreeIntoContainer = false;\\n \\n+export const enableDiscreteEventFlushingChange = true;\\n+\\n // Enable forked reconciler. Piggy-backing on the \\"variant\\" global so that we\\n // don\'t have to add another test dimension. The build system will compile this\\n // to the correct value."}],"stats":{"total":95,"additions":78,"deletions":17}},{"date":"Aug 5th 20","parents":[{"sha":"b61174fb7b09580c1ec2a8f55e73204b706d2935","url":"https://api.github.com/repos/facebook/react/commits/b61174fb7b09580c1ec2a8f55e73204b706d2935","html_url":"https://github.com/facebook/react/commit/b61174fb7b09580c1ec2a8f55e73204b706d2935"}],"author":"gaearon","files":[{"sha":"cb28d2f2522656bd0d30bffe26225eb1e0d03834","filename":"packages/react-dom/src/__tests__/ReactDOMEventListener-test.js","status":"modified","additions":6,"deletions":17,"changes":23,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/__tests__/ReactDOMEventListener-test.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/__tests__/ReactDOMEventListener-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMEventListener-test.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -712,23 +712,12 @@ describe(\'ReactDOMEventListener\', () => {\\n           bubbles: false,\\n         }),\\n       );\\n-      if (gate(flags => flags.disableOnScrollBubbling)) {\\n-        expect(log).toEqual([\\n-          [\'capture\', \'grand\'],\\n-          [\'capture\', \'parent\'],\\n-          [\'capture\', \'child\'],\\n-          [\'bubble\', \'child\'],\\n-        ]);\\n-      } else {\\n-        expect(log).toEqual([\\n-          [\'capture\', \'grand\'],\\n-          [\'capture\', \'parent\'],\\n-          [\'capture\', \'child\'],\\n-          [\'bubble\', \'child\'],\\n-          [\'bubble\', \'parent\'],\\n-          [\'bubble\', \'grand\'],\\n-        ]);\\n-      }\\n+      expect(log).toEqual([\\n+        [\'capture\', \'grand\'],\\n+        [\'capture\', \'parent\'],\\n+        [\'capture\', \'child\'],\\n+        [\'bubble\', \'child\'],\\n+      ]);\\n     } finally {\\n       document.body.removeChild(container);\\n     }"},{"sha":"1c737df509fbdcee23ddb35084afa9f85a108fc8","filename":"packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","status":"modified","additions":0,"deletions":6,"changes":6,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMEventPropagation-test.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -1154,12 +1154,6 @@ describe(\'ReactDOMEventListener\', () => {\\n   });\\n \\n   describe(\'non-bubbling events that do not bubble in React\', () => {\\n-    // This test will fail outside of the no-bubbling flag\\n-    // because its bubbling emulation is currently broken.\\n-    // In particular, if the target itself doesn\'t have\\n-    // a handler, it will not emulate bubbling correctly.\\n-    // Instead of fixing this, we\'ll just turn this flag on.\\n-    // @gate disableOnScrollBubbling\\n     it(\'onScroll\', () => {\\n       testNonBubblingEvent({\\n         type: \'div\',"},{"sha":"558cd15bca11feaa3e4335853f77f2daf90aa666","filename":"packages/react-dom/src/events/plugins/SimpleEventPlugin.js","status":"modified","additions":8,"deletions":13,"changes":21,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/events/plugins/SimpleEventPlugin.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/react-dom/src/events/plugins/SimpleEventPlugin.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/plugins/SimpleEventPlugin.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -47,10 +47,7 @@ import {IS_EVENT_HANDLE_NON_MANAGED_NODE} from \'../EventSystemFlags\';\\n import getEventCharCode from \'../getEventCharCode\';\\n import {IS_CAPTURE_PHASE} from \'../EventSystemFlags\';\\n \\n-import {\\n-  enableCreateEventHandleAPI,\\n-  disableOnScrollBubbling,\\n-} from \'shared/ReactFeatureFlags\';\\n+import {enableCreateEventHandleAPI} from \'shared/ReactFeatureFlags\';\\n \\n function extractEvents(\\n   dispatchQueue: DispatchQueue,\\n@@ -177,15 +174,13 @@ function extractEvents(\\n     // In the past, React has always bubbled them, but this can be surprising.\\n     // We\'re going to try aligning closer to the browser behavior by not bubbling\\n     // them in React either. We\'ll start by not bubbling onScroll, and then expand.\\n-    let accumulateTargetOnly = false;\\n-    if (disableOnScrollBubbling) {\\n-      accumulateTargetOnly =\\n-        !inCapturePhase &&\\n-        // TODO: ideally, we\'d eventually add all events from\\n-        // nonDelegatedEvents list in DOMPluginEventSystem.\\n-        // Then we can remove this special list.\\n-        domEventName === \'scroll\';\\n-    }\\n+    const accumulateTargetOnly =\\n+      !inCapturePhase &&\\n+      // TODO: ideally, we\'d eventually add all events from\\n+      // nonDelegatedEvents list in DOMPluginEventSystem.\\n+      // Then we can remove this special list.\\n+      // This is a breaking change that can wait until React 18.\\n+      domEventName === \'scroll\';\\n \\n     accumulateSinglePhaseListeners(\\n       targetInst,"},{"sha":"bbd6565f9b33b7cca56103045a1f03118507108f","filename":"packages/shared/ReactFeatureFlags.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/ReactFeatureFlags.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/ReactFeatureFlags.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/ReactFeatureFlags.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -125,5 +125,3 @@ export const deferRenderPhaseUpdateToNextBatch = true;\\n \\n // Replacement for runWithPriority in React internals.\\n export const decoupleUpdatePriorityFromScheduler = false;\\n-\\n-export const disableOnScrollBubbling = true;"},{"sha":"4faa8e6ae20da72532d69ee9efadbfa7a198a328","filename":"packages/shared/forks/ReactFeatureFlags.native-fb.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.native-fb.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.native-fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-fb.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -44,7 +44,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = false;\\n export const enableLegacyFBSupport = false;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"5dc776d889698afa17fbcc3354ae7bf1fcabbc26","filename":"packages/shared/forks/ReactFeatureFlags.native-oss.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.native-oss.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.native-oss.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-oss.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -43,7 +43,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = false;\\n export const enableLegacyFBSupport = false;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"de77d17e12eaffd49fbe625acfd7a2f4413333ab","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.test-renderer.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.test-renderer.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -43,7 +43,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = true;\\n export const enableLegacyFBSupport = false;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"c15f17b853f65996bcee0bb50109ac7379909428","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -43,7 +43,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = true;\\n export const enableLegacyFBSupport = false;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"152adff66eec53b8cf443dde9b6e77202ee29445","filename":"packages/shared/forks/ReactFeatureFlags.testing.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.testing.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.testing.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -43,7 +43,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = true;\\n export const enableLegacyFBSupport = false;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"0204874687681804fe40d39bc0ea3d91b395d7c9","filename":"packages/shared/forks/ReactFeatureFlags.testing.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.testing.www.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.testing.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.www.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -43,7 +43,6 @@ export const warnAboutSpreadingKeyToJSX = false;\\n export const enableComponentStackLocations = true;\\n export const enableLegacyFBSupport = !__EXPERIMENTAL__;\\n export const enableFilterEmptyStringAttributesDOM = false;\\n-export const disableOnScrollBubbling = true;\\n \\n export const enableNewReconciler = false;\\n export const deferRenderPhaseUpdateToNextBatch = true;"},{"sha":"201a40fdbfa5b3b300862dc541b4608033a880d6","filename":"packages/shared/forks/ReactFeatureFlags.www-dynamic.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.www-dynamic.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.www-dynamic.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.www-dynamic.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -18,7 +18,6 @@ export const disableInputAttributeSyncing = __VARIANT__;\\n export const enableFilterEmptyStringAttributesDOM = __VARIANT__;\\n export const enableLegacyFBSupport = __VARIANT__;\\n export const decoupleUpdatePriorityFromScheduler = __VARIANT__;\\n-export const disableOnScrollBubbling = __VARIANT__;\\n \\n // Enable this flag to help with concurrent mode debugging.\\n // It logs information to the console about React scheduling, rendering, and commit phases."},{"sha":"016ba13b360984869d266c448fc3b4ceb5356b12","filename":"packages/shared/forks/ReactFeatureFlags.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.www.js","raw_url":"https://github.com/facebook/react/raw/e9721e14e4b8776c107afa3cdd7c6d664fe20c24/packages/shared/forks/ReactFeatureFlags.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.www.js?ref=e9721e14e4b8776c107afa3cdd7c6d664fe20c24","patch":"@@ -27,7 +27,6 @@ export const {\\n   decoupleUpdatePriorityFromScheduler,\\n   enableDebugTracing,\\n   enableSchedulingProfilerComponentStacks,\\n-  disableOnScrollBubbling,\\n } = dynamicFeatureFlags;\\n \\n // On WWW, __EXPERIMENTAL__ is used for a new modern build."}],"stats":{"total":60,"additions":14,"deletions":46}},{"date":"Aug 5th 20","parents":[{"sha":"5cff7755022220f24c1066643e0036b41806e8fa","url":"https://api.github.com/repos/facebook/react/commits/5cff7755022220f24c1066643e0036b41806e8fa","html_url":"https://github.com/facebook/react/commit/5cff7755022220f24c1066643e0036b41806e8fa"}],"author":"bvaughn","files":[{"sha":"8e280e1600510fe38b07d3402aa86294935ee571","filename":"packages/react-reconciler/src/ReactFiberCommitWork.old.js","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/facebook/react/blob/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/ReactFiberCommitWork.old.js","raw_url":"https://github.com/facebook/react/raw/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/ReactFiberCommitWork.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCommitWork.old.js?ref=e67a6b16030ebc30257a69a7fb36a9ed67f29b39","patch":"@@ -1011,6 +1011,10 @@ function detachFiberMutation(fiber: Fiber) {\\n   // with findDOMNode and how it requires the sibling field to carry out\\n   // traversal in a later effect. See PR #16820. We now clear the sibling\\n   // field after effects, see: detachFiberAfterEffects.\\n+  //\\n+  // Don\'t disconnect stateNode now; it will be detached in detachFiberAfterEffects.\\n+  // It may be required if the current component is an error boundary,\\n+  // and one of its descendants throws while unmounting a passive effect.\\n   fiber.alternate = null;\\n   fiber.child = null;\\n   fiber.dependencies = null;\\n@@ -1020,7 +1024,6 @@ function detachFiberMutation(fiber: Fiber) {\\n   fiber.memoizedState = null;\\n   fiber.pendingProps = null;\\n   fiber.return = null;\\n-  fiber.stateNode = null;\\n   fiber.updateQueue = null;\\n   if (__DEV__) {\\n     fiber._debugOwner = null;"},{"sha":"36670a257f0ece02cbd9cd3a664120650d53958e","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.old.js","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/facebook/react/blob/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","raw_url":"https://github.com/facebook/react/raw/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.old.js?ref=e67a6b16030ebc30257a69a7fb36a9ed67f29b39","patch":"@@ -3793,4 +3793,5 @@ export function act(callback: () => Thenable<mixed>): Thenable<void> {\\n \\n function detachFiberAfterEffects(fiber: Fiber): void {\\n   fiber.sibling = null;\\n+  fiber.stateNode = null;\\n }"},{"sha":"eaa222456fc666507bff06cdb7a6f59a0a016ad5","filename":"packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js","status":"modified","additions":100,"deletions":0,"changes":100,"blob_url":"https://github.com/facebook/react/blob/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js","raw_url":"https://github.com/facebook/react/raw/e67a6b16030ebc30257a69a7fb36a9ed67f29b39/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/__tests__/ReactHooksWithNoopRenderer-test.js?ref=e67a6b16030ebc30257a69a7fb36a9ed67f29b39","patch":"@@ -2316,6 +2316,106 @@ describe(\'ReactHooksWithNoopRenderer\', () => {\\n       expect(Scheduler).toFlushAndYieldThrough([\'Unmount: 1\']);\\n       expect(ReactNoop.getChildren()).toEqual([]);\\n     });\\n+\\n+    describe(\'errors thrown in passive destroy function within unmounted trees\', () => {\\n+      let BrokenUseEffectCleanup;\\n+      let ErrorBoundary;\\n+      let LogOnlyErrorBoundary;\\n+\\n+      beforeEach(() => {\\n+        BrokenUseEffectCleanup = function() {\\n+          useEffect(() => {\\n+            Scheduler.unstable_yieldValue(\'BrokenUseEffectCleanup useEffect\');\\n+            return () => {\\n+              Scheduler.unstable_yieldValue(\\n+                \'BrokenUseEffectCleanup useEffect destroy\',\\n+              );\\n+              throw new Error(\'Expected error\');\\n+            };\\n+          }, []);\\n+\\n+          return \'inner child\';\\n+        };\\n+\\n+        ErrorBoundary = class extends React.Component {\\n+          state = {error: null};\\n+          static getDerivedStateFromError(error) {\\n+            Scheduler.unstable_yieldValue(\\n+              `ErrorBoundary static getDerivedStateFromError`,\\n+            );\\n+            return {error};\\n+          }\\n+          componentDidCatch(error, info) {\\n+            Scheduler.unstable_yieldValue(`ErrorBoundary componentDidCatch`);\\n+          }\\n+          render() {\\n+            if (this.state.error) {\\n+              Scheduler.unstable_yieldValue(\'ErrorBoundary render error\');\\n+              return \'ErrorBoundary fallback\';\\n+            }\\n+            Scheduler.unstable_yieldValue(\'ErrorBoundary render success\');\\n+            return this.props.children;\\n+          }\\n+        };\\n+\\n+        LogOnlyErrorBoundary = class extends React.Component {\\n+          componentDidCatch(error, info) {\\n+            Scheduler.unstable_yieldValue(\\n+              `LogOnlyErrorBoundary componentDidCatch`,\\n+            );\\n+          }\\n+          render() {\\n+            Scheduler.unstable_yieldValue(`LogOnlyErrorBoundary render`);\\n+            return this.props.children;\\n+          }\\n+        };\\n+      });\\n+\\n+      it(\'should not error if the nearest unmounted boundary is log-only\', () => {\\n+        function Conditional({showChildren}) {\\n+          if (showChildren) {\\n+            return (\\n+              <LogOnlyErrorBoundary>\\n+                <BrokenUseEffectCleanup />\\n+              </LogOnlyErrorBoundary>\\n+            );\\n+          } else {\\n+            return null;\\n+          }\\n+        }\\n+\\n+        act(() => {\\n+          ReactNoop.render(\\n+            <ErrorBoundary>\\n+              <Conditional showChildren={true} />\\n+            </ErrorBoundary>,\\n+          );\\n+        });\\n+\\n+        expect(Scheduler).toHaveYielded([\\n+          \'ErrorBoundary render success\',\\n+          \'LogOnlyErrorBoundary render\',\\n+          \'BrokenUseEffectCleanup useEffect\',\\n+        ]);\\n+\\n+        act(() => {\\n+          ReactNoop.render(\\n+            <ErrorBoundary>\\n+              <Conditional showChildren={false} />\\n+            </ErrorBoundary>,\\n+          );\\n+          expect(Scheduler).toFlushAndYieldThrough([\\n+            \'ErrorBoundary render success\',\\n+          ]);\\n+        });\\n+\\n+        expect(Scheduler).toHaveYielded([\\n+          \'BrokenUseEffectCleanup useEffect destroy\',\\n+          // This should call componentDidCatch too, but we\'ll address that in a follow up.\\n+          // \'LogOnlyErrorBoundary componentDidCatch\',\\n+        ]);\\n+      });\\n+    });\\n   });\\n \\n   describe(\'useLayoutEffect\', () => {"}],"stats":{"total":106,"additions":105,"deletions":1}},{"date":"Aug 4th 20","parents":[{"sha":"a437f3ff302dc92347d812d518c9a9659d9aa546","url":"https://api.github.com/repos/facebook/react/commits/a437f3ff302dc92347d812d518c9a9659d9aa546","html_url":"https://github.com/facebook/react/commit/a437f3ff302dc92347d812d518c9a9659d9aa546"}],"author":"halitogunc","files":[{"sha":"5e7dfda3090978acaa48ec487ee557b5de911939","filename":"scripts/release/README.md","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/scripts/release/README.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/scripts/release/README.md","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/release/README.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -22,7 +22,7 @@ If this is your first time running the release scripts, go to the `scripts/relea\\n \\n ## Publishing Without Tags\\n \\n-The sections bekow include meaningful `--tags` in the instructions. However, keep in mind that **the `--tags` arguments is optional**, and you can omit it if you don\'t want to tag the release on npm at all. This can be useful when preparing breaking changes.\\n+The sections below include meaningful `--tags` in the instructions. However, keep in mind that **the `--tags` arguments is optional**, and you can omit it if you don\'t want to tag the release on npm at all. This can be useful when preparing breaking changes.\\n \\n ## Publishing Next\\n "}],"stats":{"total":2,"additions":1,"deletions":1}},{"date":"Aug 5th 20","parents":[{"sha":"8d57ca519a3f8e7f76f81f404d048dfc35303d98","url":"https://api.github.com/repos/facebook/react/commits/8d57ca519a3f8e7f76f81f404d048dfc35303d98","html_url":"https://github.com/facebook/react/commit/8d57ca519a3f8e7f76f81f404d048dfc35303d98"}],"author":"trueadm","files":[{"sha":"459f714b90cf0b090afd4c5a31cb67f81fa4d11b","filename":"packages/react-art/src/ReactARTHostConfig.js","status":"modified","additions":0,"deletions":20,"changes":20,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-art/src/ReactARTHostConfig.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-art/src/ReactARTHostConfig.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-art/src/ReactARTHostConfig.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -10,10 +10,6 @@ import Mode from \'art/modes/current\';\\n import invariant from \'shared/invariant\';\\n \\n import {TYPES, EVENT_TYPES, childrenAsString} from \'./ReactARTInternals\';\\n-import type {\\n-  ReactEventResponder,\\n-  ReactEventResponderInstance,\\n-} from \'shared/ReactTypes\';\\n \\n const pooledTransform = new Transform();\\n \\n@@ -429,22 +425,6 @@ export function clearContainer(container) {\\n   // TODO Implement this\\n }\\n \\n-export function DEPRECATED_mountResponderInstance(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderInstance: ReactEventResponderInstance<any, any>,\\n-  props: Object,\\n-  state: Object,\\n-  instance: Object,\\n-) {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n-export function DEPRECATED_unmountResponderInstance(\\n-  responderInstance: ReactEventResponderInstance<any, any>,\\n-): void {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n export function getFundamentalComponentInstance(fundamentalInstance) {\\n   throw new Error(\'Not yet implemented.\');\\n }"},{"sha":"31e03102b440db971c719296e5456abda1b99cd1","filename":"packages/react-debug-tools/src/ReactDebugHooks.js","status":"modified","additions":0,"deletions":19,"changes":19,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-debug-tools/src/ReactDebugHooks.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-debug-tools/src/ReactDebugHooks.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-debug-tools/src/ReactDebugHooks.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -13,8 +13,6 @@ import type {\\n   MutableSourceSubscribeFn,\\n   ReactContext,\\n   ReactProviderType,\\n-  ReactEventResponder,\\n-  ReactEventResponderListener,\\n } from \'shared/ReactTypes\';\\n import type {\\n   Fiber,\\n@@ -260,22 +258,6 @@ function useMutableSource<Source, Snapshot>(\\n   return value;\\n }\\n \\n-function useResponder(\\n-  responder: ReactEventResponder<any, any>,\\n-  listenerProps: Object,\\n-): ReactEventResponderListener<any, any> {\\n-  // Don\'t put the actual event responder object in, just its displayName\\n-  const value = {\\n-    responder: responder.displayName || \'EventResponder\',\\n-    props: listenerProps,\\n-  };\\n-  hookLog.push({primitive: \'Responder\', stackError: new Error(), value});\\n-  return {\\n-    responder,\\n-    props: listenerProps,\\n-  };\\n-}\\n-\\n function useTransition(\\n   config: SuspenseConfig | null | void,\\n ): [(() => void) => void, boolean] {\\n@@ -335,7 +317,6 @@ const Dispatcher: DispatcherType = {\\n   useReducer,\\n   useRef,\\n   useState,\\n-  useResponder,\\n   useTransition,\\n   useMutableSource,\\n   useDeferredValue,"},{"sha":"d5874c5621b164c244842c5c22ce3d358ae6b900","filename":"packages/react-debug-tools/src/__tests__/ReactHooksInspection-test.internal.js","status":"removed","additions":0,"deletions":46,"changes":46,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-debug-tools/src/__tests__/ReactHooksInspection-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-debug-tools/src/__tests__/ReactHooksInspection-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-debug-tools/src/__tests__/ReactHooksInspection-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,46 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- * @jest-environment node\\n- */\\n-\\n-\'use strict\';\\n-\\n-let React;\\n-let ReactDebugTools;\\n-\\n-describe(\'ReactHooksInspection\', () => {\\n-  beforeEach(() => {\\n-    jest.resetModules();\\n-    const ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-    React = require(\'react\');\\n-    ReactDebugTools = require(\'react-debug-tools\');\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should inspect a simple useResponder hook\', () => {\\n-    const TestResponder = React.DEPRECATED_createResponder(\'TestResponder\', {});\\n-\\n-    function Foo(props) {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        preventDefault: false,\\n-      });\\n-      return <div DEPRECATED_flareListeners={listener}>Hello world</div>;\\n-    }\\n-    const tree = ReactDebugTools.inspectHooks(Foo, {});\\n-    expect(tree).toEqual([\\n-      {\\n-        isStateEditable: false,\\n-        id: 0,\\n-        name: \'Responder\',\\n-        value: {props: {preventDefault: false}, responder: \'TestResponder\'},\\n-        subHooks: [],\\n-      },\\n-    ]);\\n-  });\\n-});"},{"sha":"70629f3bffa004190a6dc172b054c0a87ff9920d","filename":"packages/react-devtools-shared/src/backend/ReactSymbols.js","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-devtools-shared/src/backend/ReactSymbols.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-devtools-shared/src/backend/ReactSymbols.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-devtools-shared/src/backend/ReactSymbols.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -58,9 +58,6 @@ export const PROFILER_SYMBOL_STRING = \'Symbol(react.profiler)\';\\n export const PROVIDER_NUMBER = 0xeacd;\\n export const PROVIDER_SYMBOL_STRING = \'Symbol(react.provider)\';\\n \\n-export const RESPONDER_NUMBER = 0xead6;\\n-export const RESPONDER_SYMBOL_STRING = \'Symbol(react.responder)\';\\n-\\n export const SCOPE_NUMBER = 0xead7;\\n export const SCOPE_SYMBOL_STRING = \'Symbol(react.scope)\';\\n "},{"sha":"1d70475041491aed58d55188045065f95a297c20","filename":"packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js","status":"modified","additions":25,"deletions":140,"changes":165,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -17,7 +17,6 @@ let ReactFeatureFlags;\\n let Suspense;\\n let SuspenseList;\\n let act;\\n-let useHover;\\n \\n function dispatchMouseEvent(to, from) {\\n   if (!to) {\\n@@ -76,7 +75,7 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n \\n     ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n     ReactFeatureFlags.enableSuspenseCallback = true;\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n+    ReactFeatureFlags.enableCreateEventHandleAPI = true;\\n \\n     React = require(\'react\');\\n     ReactDOM = require(\'react-dom\');\\n@@ -2202,8 +2201,10 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n   });\\n \\n   // @gate experimental\\n-  it(\'does not invoke an event on a hydrated EventResponder until it commits\', async () => {\\n+  it(\'does not invoke an event on a hydrated event handle until it commits\', async () => {\\n+    const setClick = ReactDOM.unstable_createEventHandle(\'click\');\\n     let suspend = false;\\n+    let isServerRendering = true;\\n     let resolve;\\n     const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n \\n@@ -2216,17 +2217,15 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n     }\\n \\n     const onEvent = jest.fn();\\n-    const TestResponder = React.DEPRECATED_createResponder(\\n-      \'TestEventResponder\',\\n-      {\\n-        targetEventTypes: [\'click\'],\\n-        onEvent,\\n-      },\\n-    );\\n \\n     function Button() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      return <a DEPRECATED_flareListeners={listener}>Click me</a>;\\n+      const ref = React.useRef(null);\\n+      if (!isServerRendering) {\\n+        React.useLayoutEffect(() => {\\n+          return setClick(ref.current, onEvent);\\n+        });\\n+      }\\n+      return <a ref={ref}>Click me</a>;\\n     }\\n \\n     function App() {\\n@@ -2253,6 +2252,7 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n     // On the client we don\'t have all data yet but we want to start\\n     // hydrating anyway.\\n     suspend = true;\\n+    isServerRendering = false;\\n     const root = ReactDOM.createRoot(container, {hydrate: true});\\n     root.render(<App />);\\n \\n@@ -2364,23 +2364,25 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n   });\\n \\n   // @gate experimental\\n-  it(\'invokes discrete events on nested suspense boundaries in a root (responder system)\', async () => {\\n+  it(\'invokes discrete events on nested suspense boundaries in a root (createEventHandle)\', async () => {\\n     let suspend = false;\\n+    let isServerRendering = true;\\n     let resolve;\\n     const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n \\n     const onEvent = jest.fn();\\n-    const TestResponder = React.DEPRECATED_createResponder(\\n-      \'TestEventResponder\',\\n-      {\\n-        targetEventTypes: [\'click\'],\\n-        onEvent,\\n-      },\\n-    );\\n+    const setClick = ReactDOM.unstable_createEventHandle(\'click\');\\n \\n     function Button() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      return <a DEPRECATED_flareListeners={listener}>Click me</a>;\\n+      const ref = React.useRef(null);\\n+\\n+      if (!isServerRendering) {\\n+        React.useLayoutEffect(() => {\\n+          return setClick(ref.current, onEvent);\\n+        });\\n+      }\\n+\\n+      return <a ref={ref}>Click me</a>;\\n     }\\n \\n     function Child() {\\n@@ -2416,6 +2418,7 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n     // On the client we don\'t have all data yet but we want to start\\n     // hydrating anyway.\\n     suspend = true;\\n+    isServerRendering = false;\\n     const root = ReactDOM.createRoot(container, {hydrate: true});\\n     root.render(<App />);\\n \\n@@ -2704,124 +2707,6 @@ describe(\'ReactDOMServerPartialHydration\', () => {\\n     document.body.removeChild(container);\\n   });\\n \\n-  // @gate experimental\\n-  it(\'blocks only on the last continuous event (Responder system)\', async () => {\\n-    useHover = require(\'react-interactions/events/hover\').useHover;\\n-\\n-    let suspend1 = false;\\n-    let resolve1;\\n-    const promise1 = new Promise(resolvePromise => (resolve1 = resolvePromise));\\n-    let suspend2 = false;\\n-    let resolve2;\\n-    const promise2 = new Promise(resolvePromise => (resolve2 = resolvePromise));\\n-\\n-    function First({text}) {\\n-      if (suspend1) {\\n-        throw promise1;\\n-      } else {\\n-        return \'Hello\';\\n-      }\\n-    }\\n-\\n-    function Second({text}) {\\n-      if (suspend2) {\\n-        throw promise2;\\n-      } else {\\n-        return \'World\';\\n-      }\\n-    }\\n-\\n-    const ops = [];\\n-\\n-    function App() {\\n-      const listener1 = useHover({\\n-        onHoverStart() {\\n-          ops.push(\'Hover Start First\');\\n-        },\\n-        onHoverEnd() {\\n-          ops.push(\'Hover End First\');\\n-        },\\n-      });\\n-      const listener2 = useHover({\\n-        onHoverStart() {\\n-          ops.push(\'Hover Start Second\');\\n-        },\\n-        onHoverEnd() {\\n-          ops.push(\'Hover End Second\');\\n-        },\\n-      });\\n-      return (\\n-        <div>\\n-          <Suspense fallback=\\"Loading First...\\">\\n-            <span DEPRECATED_flareListeners={listener1} />\\n-            {/* We suspend after to test what happens when we eager\\n-                attach the listener. */}\\n-            <First />\\n-          </Suspense>\\n-          <Suspense fallback=\\"Loading Second...\\">\\n-            <span DEPRECATED_flareListeners={listener2}>\\n-              <Second />\\n-            </span>\\n-          </Suspense>\\n-        </div>\\n-      );\\n-    }\\n-\\n-    const finalHTML = ReactDOMServer.renderToString(<App />);\\n-    const container = document.createElement(\'div\');\\n-    container.innerHTML = finalHTML;\\n-\\n-    // We need this to be in the document since we\'ll dispatch events on it.\\n-    document.body.appendChild(container);\\n-\\n-    const appDiv = container.getElementsByTagName(\'div\')[0];\\n-    const firstSpan = appDiv.getElementsByTagName(\'span\')[0];\\n-    const secondSpan = appDiv.getElementsByTagName(\'span\')[1];\\n-    expect(firstSpan.textContent).toBe(\'\');\\n-    expect(secondSpan.textContent).toBe(\'World\');\\n-\\n-    // On the client we don\'t have all data yet but we want to start\\n-    // hydrating anyway.\\n-    suspend1 = true;\\n-    suspend2 = true;\\n-    const root = ReactDOM.createRoot(container, {hydrate: true});\\n-    root.render(<App />);\\n-\\n-    Scheduler.unstable_flushAll();\\n-    jest.runAllTimers();\\n-\\n-    dispatchMouseEvent(appDiv, null);\\n-    dispatchMouseEvent(firstSpan, appDiv);\\n-    dispatchMouseEvent(secondSpan, firstSpan);\\n-\\n-    // Neither target is yet hydrated.\\n-    expect(ops).toEqual([]);\\n-\\n-    // Resolving the second promise so that rendering can complete.\\n-    suspend2 = false;\\n-    resolve2();\\n-    await promise2;\\n-\\n-    Scheduler.unstable_flushAll();\\n-    jest.runAllTimers();\\n-\\n-    // We\'ve unblocked the current hover target so we should be\\n-    // able to replay it now.\\n-    expect(ops).toEqual([\'Hover Start Second\']);\\n-\\n-    // Resolving the first promise has no effect now.\\n-    suspend1 = false;\\n-    resolve1();\\n-    await promise1;\\n-\\n-    Scheduler.unstable_flushAll();\\n-    jest.runAllTimers();\\n-\\n-    expect(ops).toEqual([\'Hover Start Second\']);\\n-\\n-    document.body.removeChild(container);\\n-  });\\n-\\n   // @gate experimental\\n   it(\'finishes normal pri work before continuing to hydrate a retry\', async () => {\\n     let suspend = false;"},{"sha":"3a948a0651b1dffd3a5fe892bb69ce4d68464116","filename":"packages/react-dom/src/__tests__/ReactDOMServerSelectiveHydration-test.internal.js","status":"modified","additions":44,"deletions":31,"changes":75,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/__tests__/ReactDOMServerSelectiveHydration-test.internal.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/__tests__/ReactDOMServerSelectiveHydration-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/__tests__/ReactDOMServerSelectiveHydration-test.internal.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -96,8 +96,7 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n     jest.resetModuleRegistry();\\n \\n     const ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-\\n+    ReactFeatureFlags.enableCreateEventHandleAPI = true;\\n     React = require(\'react\');\\n     ReactDOM = require(\'react-dom\');\\n     ReactDOMServer = require(\'react-dom/server\');\\n@@ -348,18 +347,22 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n   });\\n \\n   // @gate experimental\\n-  it(\'hydrates the target boundary synchronously during a click (flare)\', async () => {\\n-    const usePress = require(\'react-interactions/events/press-legacy\').usePress;\\n+  it(\'hydrates the target boundary synchronously during a click (createEventHandle)\', async () => {\\n+    const setClick = ReactDOM.unstable_createEventHandle(\'click\');\\n+    let isServerRendering = true;\\n \\n     function Child({text}) {\\n+      const ref = React.useRef(null);\\n       Scheduler.unstable_yieldValue(text);\\n-      const listener = usePress({\\n-        onPress() {\\n-          Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n-        },\\n-      });\\n+      if (!isServerRendering) {\\n+        React.useLayoutEffect(() => {\\n+          return setClick(ref.current, () => {\\n+            Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n+          });\\n+        });\\n+      }\\n \\n-      return <span DEPRECATED_flareListeners={listener}>{text}</span>;\\n+      return <span ref={ref}>{text}</span>;\\n     }\\n \\n     function App() {\\n@@ -386,7 +389,10 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n \\n     container.innerHTML = finalHTML;\\n \\n+    isServerRendering = false;\\n+\\n     const root = ReactDOM.createRoot(container, {hydrate: true});\\n+\\n     root.render(<App />);\\n \\n     // Nothing has been hydrated so far.\\n@@ -398,11 +404,7 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n \\n     // This should synchronously hydrate the root App and the second suspense\\n     // boundary.\\n-    const preventDefault = jest.fn();\\n-    target.virtualclick({preventDefault});\\n-\\n-    // The event should have been canceled because we called preventDefault.\\n-    expect(preventDefault).toHaveBeenCalled();\\n+    target.virtualclick();\\n \\n     // We rendered App, B and then invoked the event without rendering A.\\n     expect(Scheduler).toHaveYielded([\'App\', \'B\', \'Clicked B\']);\\n@@ -414,24 +416,29 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n   });\\n \\n   // @gate experimental\\n-  it(\'hydrates at higher pri if sync did not work first time (flare)\', async () => {\\n-    const usePress = require(\'react-interactions/events/press-legacy\').usePress;\\n+  it(\'hydrates at higher pri if sync did not work first time (createEventHandle)\', async () => {\\n     let suspend = false;\\n+    let isServerRendering = true;\\n     let resolve;\\n     const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n+    const setClick = ReactDOM.unstable_createEventHandle(\'click\');\\n \\n     function Child({text}) {\\n+      const ref = React.useRef(null);\\n       if ((text === \'A\' || text === \'D\') && suspend) {\\n         throw promise;\\n       }\\n       Scheduler.unstable_yieldValue(text);\\n \\n-      const listener = usePress({\\n-        onPress() {\\n-          Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n-        },\\n-      });\\n-      return <span DEPRECATED_flareListeners={listener}>{text}</span>;\\n+      if (!isServerRendering) {\\n+        React.useLayoutEffect(() => {\\n+          return setClick(ref.current, () => {\\n+            Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n+          });\\n+        });\\n+      }\\n+\\n+      return <span ref={ref}>{text}</span>;\\n     }\\n \\n     function App() {\\n@@ -467,6 +474,7 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n     const spanD = container.getElementsByTagName(\'span\')[3];\\n \\n     suspend = true;\\n+    isServerRendering = false;\\n \\n     // A and D will be suspended. We\'ll click on D which should take\\n     // priority, after we unsuspend.\\n@@ -496,24 +504,28 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n   });\\n \\n   // @gate experimental\\n-  it(\'hydrates at higher pri for secondary discrete events (flare)\', async () => {\\n-    const usePress = require(\'react-interactions/events/press-legacy\').usePress;\\n+  it(\'hydrates at higher pri for secondary discrete events (createEventHandle)\', async () => {\\n+    const setClick = ReactDOM.unstable_createEventHandle(\'click\');\\n     let suspend = false;\\n+    let isServerRendering = true;\\n     let resolve;\\n     const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n \\n     function Child({text}) {\\n+      const ref = React.useRef(null);\\n       if ((text === \'A\' || text === \'D\') && suspend) {\\n         throw promise;\\n       }\\n       Scheduler.unstable_yieldValue(text);\\n \\n-      const listener = usePress({\\n-        onPress() {\\n-          Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n-        },\\n-      });\\n-      return <span DEPRECATED_flareListeners={listener}>{text}</span>;\\n+      if (!isServerRendering) {\\n+        React.useLayoutEffect(() => {\\n+          return setClick(ref.current, () => {\\n+            Scheduler.unstable_yieldValue(\'Clicked \' + text);\\n+          });\\n+        });\\n+      }\\n+      return <span ref={ref}>{text}</span>;\\n     }\\n \\n     function App() {\\n@@ -551,6 +563,7 @@ describe(\'ReactDOMServerSelectiveHydration\', () => {\\n     const spanD = container.getElementsByTagName(\'span\')[3];\\n \\n     suspend = true;\\n+    isServerRendering = false;\\n \\n     // A and D will be suspended. We\'ll click on D which should take\\n     // priority, after we unsuspend."},{"sha":"b82a41eb0faa7dc914778524227fbc512d8fa85f","filename":"packages/react-dom/src/client/ReactDOMComponent.js","status":"modified","additions":1,"deletions":85,"changes":86,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMComponent.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMComponent.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/client/ReactDOMComponent.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -7,20 +7,13 @@\\n  * @flow\\n  */\\n \\n-import type {ElementListenerMapEntry} from \'../client/ReactDOMComponentTree\';\\n-\\n import {\\n   registrationNameDependencies,\\n   possibleRegistrationNames,\\n } from \'../events/EventRegistry\';\\n \\n import {canUseDOM} from \'shared/ExecutionEnvironment\';\\n import invariant from \'shared/invariant\';\\n-import {\\n-  setListenToResponderEventTypes,\\n-  addResponderEventSystemEvent,\\n-  removeTrappedEventListener,\\n-} from \'../events/DeprecatedDOMEventResponderSystem\';\\n \\n import {\\n   getValueForAttribute,\\n@@ -81,16 +74,12 @@ import {validateProperties as validateInputProperties} from \'../shared/ReactDOMN\\n import {validateProperties as validateUnknownProperties} from \'../shared/ReactDOMUnknownPropertyHook\';\\n import {REACT_OPAQUE_ID_TYPE} from \'shared/ReactSymbols\';\\n \\n-import {\\n-  enableDeprecatedFlareAPI,\\n-  enableTrustedTypesIntegration,\\n-} from \'shared/ReactFeatureFlags\';\\n+import {enableTrustedTypesIntegration} from \'shared/ReactFeatureFlags\';\\n import {\\n   listenToReactEvent,\\n   mediaEventTypes,\\n   listenToNonDelegatedEvent,\\n } from \'../events/DOMPluginEventSystem\';\\n-import {getEventListenerMap} from \'./ReactDOMComponentTree\';\\n \\n let didWarnInvalidHydration = false;\\n let didWarnScriptTags = false;\\n@@ -102,7 +91,6 @@ const AUTOFOCUS = \'autoFocus\';\\n const CHILDREN = \'children\';\\n const STYLE = \'style\';\\n const HTML = \'__html\';\\n-const DEPRECATED_flareListeners = \'DEPRECATED_flareListeners\';\\n \\n const {html: HTML_NAMESPACE} = Namespaces;\\n \\n@@ -358,7 +346,6 @@ function setInitialDOMProperties(\\n         setTextContent(domElement, \'\' + nextProp);\\n       }\\n     } else if (\\n-      (enableDeprecatedFlareAPI && propKey === DEPRECATED_flareListeners) ||\\n       propKey === SUPPRESS_CONTENT_EDITABLE_WARNING ||\\n       propKey === SUPPRESS_HYDRATION_WARNING\\n     ) {\\n@@ -728,7 +715,6 @@ export function diffProperties(\\n     } else if (propKey === DANGEROUSLY_SET_INNER_HTML || propKey === CHILDREN) {\\n       // Noop. This is handled by the clear text mechanism.\\n     } else if (\\n-      (enableDeprecatedFlareAPI && propKey === DEPRECATED_flareListeners) ||\\n       propKey === SUPPRESS_CONTENT_EDITABLE_WARNING ||\\n       propKey === SUPPRESS_HYDRATION_WARNING\\n     ) {\\n@@ -817,7 +803,6 @@ export function diffProperties(\\n         (updatePayload = updatePayload || []).push(propKey, \'\' + nextProp);\\n       }\\n     } else if (\\n-      (enableDeprecatedFlareAPI && propKey === DEPRECATED_flareListeners) ||\\n       propKey === SUPPRESS_CONTENT_EDITABLE_WARNING ||\\n       propKey === SUPPRESS_HYDRATION_WARNING\\n     ) {\\n@@ -1083,7 +1068,6 @@ export function diffHydratedProperties(\\n       if (suppressHydrationWarning) {\\n         // Don\'t bother comparing. We\'re ignoring all these warnings.\\n       } else if (\\n-        (enableDeprecatedFlareAPI && propKey === DEPRECATED_flareListeners) ||\\n         propKey === SUPPRESS_CONTENT_EDITABLE_WARNING ||\\n         propKey === SUPPRESS_HYDRATION_WARNING ||\\n         // Controlled attributes are not validated\\n@@ -1317,71 +1301,3 @@ export function restoreControlledState(\\n       return;\\n   }\\n }\\n-\\n-function endsWith(subject: string, search: string): boolean {\\n-  const length = subject.length;\\n-  return subject.substring(length - search.length, length) === search;\\n-}\\n-\\n-export function listenToEventResponderEventTypes(\\n-  eventTypes: Array<string>,\\n-  document: Document,\\n-): void {\\n-  if (enableDeprecatedFlareAPI) {\\n-    // Get the listening Map for this element. We use this to track\\n-    // what events we\'re listening to.\\n-    const listenerMap = getEventListenerMap(document);\\n-\\n-    // Go through each target event type of the event responder\\n-    for (let i = 0, length = eventTypes.length; i < length; ++i) {\\n-      const eventType = eventTypes[i];\\n-      const isPassive = !endsWith(eventType, \'_active\');\\n-      const eventKey = isPassive ? eventType + \'_passive\' : eventType;\\n-      const targetEventType = isPassive\\n-        ? eventType\\n-        : eventType.substring(0, eventType.length - 7);\\n-      if (!listenerMap.has(eventKey)) {\\n-        if (isPassive) {\\n-          const activeKey = targetEventType + \'_active\';\\n-          // If we have an active event listener, do not register\\n-          // a passive event listener. We use the same active event\\n-          // listener.\\n-          if (listenerMap.has(activeKey)) {\\n-            continue;\\n-          }\\n-        } else {\\n-          // If we have a passive event listener, remove the\\n-          // existing passive event listener before we add the\\n-          // active event listener.\\n-          const passiveKey = targetEventType + \'_passive\';\\n-          const passiveItem = ((listenerMap.get(\\n-            passiveKey,\\n-          ): any): ElementListenerMapEntry | void);\\n-          if (passiveItem !== undefined) {\\n-            removeTrappedEventListener(\\n-              document,\\n-              (targetEventType: any),\\n-              true,\\n-              passiveItem.listener,\\n-            );\\n-            listenerMap.delete(passiveKey);\\n-          }\\n-        }\\n-        const eventListener = addResponderEventSystemEvent(\\n-          document,\\n-          targetEventType,\\n-          isPassive,\\n-        );\\n-        listenerMap.set(eventKey, {\\n-          passive: isPassive,\\n-          listener: eventListener,\\n-        });\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-// We can remove this once the event API is stable and out of a flag\\n-if (enableDeprecatedFlareAPI) {\\n-  setListenToResponderEventTypes(listenToEventResponderEventTypes);\\n-}"},{"sha":"19e69126aef0cb1dfdc2554e00e4de9d2661bc61","filename":"packages/react-dom/src/client/ReactDOMEventHandle.js","status":"modified","additions":2,"deletions":5,"changes":7,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMEventHandle.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMEventHandle.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/client/ReactDOMEventHandle.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -28,10 +28,7 @@ import {\\n } from \'../events/DOMPluginEventSystem\';\\n \\n import {HostRoot, HostPortal} from \'react-reconciler/src/ReactWorkTags\';\\n-import {\\n-  PLUGIN_EVENT_SYSTEM,\\n-  IS_EVENT_HANDLE_NON_MANAGED_NODE,\\n-} from \'../events/EventSystemFlags\';\\n+import {IS_EVENT_HANDLE_NON_MANAGED_NODE} from \'../events/EventSystemFlags\';\\n \\n import {\\n   enableScopeAPI,\\n@@ -164,7 +161,7 @@ function registerReactDOMEvent(\\n       null,\\n       isPassiveListener,\\n       listenerPriority,\\n-      PLUGIN_EVENT_SYSTEM | IS_EVENT_HANDLE_NON_MANAGED_NODE,\\n+      IS_EVENT_HANDLE_NON_MANAGED_NODE,\\n     );\\n   } else {\\n     invariant("},{"sha":"22d38dea0439ffeeadae4fbc7e049f2a5e4cc7e5","filename":"packages/react-dom/src/client/ReactDOMHostConfig.js","status":"modified","additions":6,"deletions":47,"changes":53,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMHostConfig.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/client/ReactDOMHostConfig.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/client/ReactDOMHostConfig.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -16,11 +16,7 @@ import type {\\n } from \'react-reconciler/src/ReactTestSelectors\';\\n import type {RootType} from \'./ReactDOMRoot\';\\n import type {ReactScopeInstance} from \'shared/ReactTypes\';\\n-import type {\\n-  ReactDOMEventResponder,\\n-  ReactDOMEventResponderInstance,\\n-  ReactDOMFundamentalComponentInstance,\\n-} from \'../shared/ReactDOMTypes\';\\n+import type {ReactDOMFundamentalComponentInstance} from \'../shared/ReactDOMTypes\';\\n \\n import {\\n   precacheFiberNode,\\n@@ -45,7 +41,6 @@ import {\\n   warnForDeletedHydratableText,\\n   warnForInsertedHydratedElement,\\n   warnForInsertedHydratedText,\\n-  listenToEventResponderEventTypes,\\n } from \'./ReactDOMComponent\';\\n import {getSelectionInformation, restoreSelection} from \'./ReactInputSelection\';\\n import setTextContent from \'./setTextContent\';\\n@@ -65,15 +60,10 @@ import {\\n import dangerousStyleValue from \'../shared/dangerousStyleValue\';\\n \\n import {REACT_OPAQUE_ID_TYPE} from \'shared/ReactSymbols\';\\n-import {\\n-  mountEventResponder,\\n-  unmountEventResponder,\\n-} from \'../events/DeprecatedDOMEventResponderSystem\';\\n import {retryIfBlockedOn} from \'../events/ReactDOMEventReplaying\';\\n \\n import {\\n   enableSuspenseServerRenderer,\\n-  enableDeprecatedFlareAPI,\\n   enableFundamentalAPI,\\n   enableCreateEventHandleAPI,\\n   enableScopeAPI,\\n@@ -232,7 +222,7 @@ export function prepareForCommit(containerInfo: Container): Object | null {\\n   eventsEnabled = ReactBrowserEventEmitterIsEnabled();\\n   selectionInformation = getSelectionInformation();\\n   let activeInstance = null;\\n-  if (enableDeprecatedFlareAPI || enableCreateEventHandleAPI) {\\n+  if (enableCreateEventHandleAPI) {\\n     const focusedElem = selectionInformation.focusedElem;\\n     if (focusedElem !== null) {\\n       activeInstance = getClosestInstanceFromNode(focusedElem);\\n@@ -243,15 +233,15 @@ export function prepareForCommit(containerInfo: Container): Object | null {\\n }\\n \\n export function beforeActiveInstanceBlur(): void {\\n-  if (enableDeprecatedFlareAPI || enableCreateEventHandleAPI) {\\n+  if (enableCreateEventHandleAPI) {\\n     ReactBrowserEventEmitterSetEnabled(true);\\n     dispatchBeforeDetachedBlur((selectionInformation: any).focusedElem);\\n     ReactBrowserEventEmitterSetEnabled(false);\\n   }\\n }\\n \\n export function afterActiveInstanceBlur(): void {\\n-  if (enableDeprecatedFlareAPI || enableCreateEventHandleAPI) {\\n+  if (enableCreateEventHandleAPI) {\\n     ReactBrowserEventEmitterSetEnabled(true);\\n     dispatchAfterDetachedBlur((selectionInformation: any).focusedElem);\\n     ReactBrowserEventEmitterSetEnabled(false);\\n@@ -510,7 +500,7 @@ function createEvent(type: DOMEventName, bubbles: boolean): Event {\\n }\\n \\n function dispatchBeforeDetachedBlur(target: HTMLElement): void {\\n-  if (enableDeprecatedFlareAPI || enableCreateEventHandleAPI) {\\n+  if (enableCreateEventHandleAPI) {\\n     const event = createEvent(\'beforeblur\', true);\\n     // Dispatch \\"beforeblur\\" directly on the target,\\n     // so it gets picked up by the event system and\\n@@ -520,7 +510,7 @@ function dispatchBeforeDetachedBlur(target: HTMLElement): void {\\n }\\n \\n function dispatchAfterDetachedBlur(target: HTMLElement): void {\\n-  if (enableDeprecatedFlareAPI || enableCreateEventHandleAPI) {\\n+  if (enableCreateEventHandleAPI) {\\n     const event = createEvent(\'afterblur\', false);\\n     // So we know what was detached, make the relatedTarget the\\n     // detached target on the \\"afterblur\\" event.\\n@@ -975,37 +965,6 @@ export function didNotFindHydratableSuspenseInstance(\\n   }\\n }\\n \\n-export function DEPRECATED_mountResponderInstance(\\n-  responder: ReactDOMEventResponder,\\n-  responderInstance: ReactDOMEventResponderInstance,\\n-  responderProps: Object,\\n-  responderState: Object,\\n-  instance: Instance,\\n-): ReactDOMEventResponderInstance {\\n-  // Listen to events\\n-  const doc = instance.ownerDocument;\\n-  const {targetEventTypes} = ((responder: any): ReactDOMEventResponder);\\n-  if (targetEventTypes !== null) {\\n-    listenToEventResponderEventTypes(targetEventTypes, doc);\\n-  }\\n-  mountEventResponder(\\n-    responder,\\n-    responderInstance,\\n-    responderProps,\\n-    responderState,\\n-  );\\n-  return responderInstance;\\n-}\\n-\\n-export function DEPRECATED_unmountResponderInstance(\\n-  responderInstance: ReactDOMEventResponderInstance,\\n-): void {\\n-  if (enableDeprecatedFlareAPI) {\\n-    // TODO stop listening to targetEventTypes\\n-    unmountEventResponder(responderInstance);\\n-  }\\n-}\\n-\\n export function getFundamentalComponentInstance(\\n   fundamentalInstance: ReactDOMFundamentalComponentInstance,\\n ): Instance {"},{"sha":"1b23cde2f35a0cebf253e9a9d9d6e58b06b4aae4","filename":"packages/react-dom/src/events/DOMPluginEventSystem.js","status":"modified","additions":5,"deletions":7,"changes":12,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/DOMPluginEventSystem.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/DOMPluginEventSystem.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/DOMPluginEventSystem.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -22,7 +22,6 @@ import type {Fiber} from \'react-reconciler/src/ReactInternalTypes\';\\n \\n import {registrationNameDependencies} from \'./EventRegistry\';\\n import {\\n-  PLUGIN_EVENT_SYSTEM,\\n   IS_CAPTURE_PHASE,\\n   IS_EVENT_HANDLE_NON_MANAGED_NODE,\\n   IS_NON_DELEGATED,\\n@@ -64,7 +63,6 @@ import {\\n   addEventBubbleListenerWithPassiveFlag,\\n   addEventCaptureListenerWithPassiveFlag,\\n } from \'./EventListener\';\\n-import {removeTrappedEventListener} from \'./DeprecatedDOMEventResponderSystem\';\\n import {topLevelEventsToReactNames} from \'./DOMEventProperties\';\\n import * as BeforeInputEventPlugin from \'./plugins/BeforeInputEventPlugin\';\\n import * as ChangeEventPlugin from \'./plugins/ChangeEventPlugin\';\\n@@ -318,7 +316,7 @@ export function listenToNonDelegatedEvent(\\n     const listener = addTrappedEventListener(\\n       targetElement,\\n       domEventName,\\n-      PLUGIN_EVENT_SYSTEM | IS_NON_DELEGATED,\\n+      IS_NON_DELEGATED,\\n       isCapturePhaseListener,\\n     );\\n     listenerMap.set(listenerMapKey, {passive: false, listener});\\n@@ -332,7 +330,7 @@ export function listenToNativeEvent(\\n   targetElement: Element | null,\\n   isPassiveListener?: boolean,\\n   listenerPriority?: EventPriority,\\n-  eventSystemFlags?: EventSystemFlags = PLUGIN_EVENT_SYSTEM,\\n+  eventSystemFlags?: EventSystemFlags = 0,\\n ): void {\\n   let target = rootContainerElement;\\n   // selectionchange needs to be attached to the document\\n@@ -381,11 +379,11 @@ export function listenToNativeEvent(\\n     // If we should upgrade, then we need to remove the existing trapped\\n     // event listener for the target container.\\n     if (shouldUpgrade) {\\n-      removeTrappedEventListener(\\n+      removeEventListener(\\n         target,\\n         domEventName,\\n-        isCapturePhaseListener,\\n         ((listenerEntry: any): ElementListenerMapEntry).listener,\\n+        isCapturePhaseListener,\\n       );\\n     }\\n     if (isCapturePhaseListener) {\\n@@ -549,7 +547,7 @@ function deferClickToDocumentForLegacyFBSupport(\\n   addTrappedEventListener(\\n     targetContainer,\\n     domEventName,\\n-    PLUGIN_EVENT_SYSTEM | IS_LEGACY_FB_SUPPORT_MODE,\\n+    IS_LEGACY_FB_SUPPORT_MODE,\\n     false,\\n     isDeferredListenerForLegacyFBSupport,\\n   );"},{"sha":"73d3ea733175661a957345506472b7fb18c6ef92","filename":"packages/react-dom/src/events/DeprecatedDOMEventResponderSystem.js","status":"removed","additions":0,"deletions":642,"changes":642,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-dom/src/events/DeprecatedDOMEventResponderSystem.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-dom/src/events/DeprecatedDOMEventResponderSystem.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/DeprecatedDOMEventResponderSystem.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,642 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- * @flow\\n- */\\n-\\n-import {\\n-  type EventSystemFlags,\\n-  IS_PASSIVE,\\n-  PASSIVE_NOT_SUPPORTED,\\n-  RESPONDER_EVENT_SYSTEM,\\n-} from \'./EventSystemFlags\';\\n-import type {AnyNativeEvent} from \'../events/PluginModuleType\';\\n-import {\\n-  HostComponent,\\n-  ScopeComponent,\\n-  HostPortal,\\n-} from \'react-reconciler/src/ReactWorkTags\';\\n-import type {EventPriority} from \'shared/ReactTypes\';\\n-import type {\\n-  ReactDOMEventResponder,\\n-  ReactDOMEventResponderInstance,\\n-  ReactDOMResponderContext,\\n-  ReactDOMResponderEvent,\\n-} from \'../shared/ReactDOMTypes\';\\n-import type {DOMEventName} from \'../events/DOMEventNames\';\\n-import {\\n-  batchedEventUpdates,\\n-  discreteUpdates,\\n-  flushDiscreteUpdatesIfNeeded,\\n-  executeUserEventHandler,\\n-} from \'./ReactDOMUpdateBatching\';\\n-import type {Fiber} from \'react-reconciler/src/ReactInternalTypes\';\\n-import {enableDeprecatedFlareAPI} from \'shared/ReactFeatureFlags\';\\n-import invariant from \'shared/invariant\';\\n-\\n-import {getClosestInstanceFromNode} from \'../client/ReactDOMComponentTree\';\\n-import {enqueueStateRestore} from \'./ReactDOMControlledComponent\';\\n-import {createEventListenerWrapper} from \'./ReactDOMEventListener\';\\n-import {passiveBrowserEventsSupported} from \'./checkPassiveEvents\';\\n-import {\\n-  addEventCaptureListener,\\n-  addEventCaptureListenerWithPassiveFlag,\\n-  removeEventListener,\\n-} from \'./EventListener\';\\n-\\n-import {\\n-  ContinuousEvent,\\n-  UserBlockingEvent,\\n-  DiscreteEvent,\\n-} from \'shared/ReactTypes\';\\n-\\n-// Intentionally not named imports because Rollup would use dynamic dispatch for\\n-// CommonJS interop named imports.\\n-import * as Scheduler from \'scheduler\';\\n-\\n-import {\\n-  InputContinuousLanePriority,\\n-  getCurrentUpdateLanePriority,\\n-  setCurrentUpdateLanePriority,\\n-} from \'react-reconciler/src/ReactFiberLane\';\\n-\\n-const {\\n-  unstable_UserBlockingPriority: UserBlockingPriority,\\n-  unstable_runWithPriority: runWithPriority,\\n-} = Scheduler;\\n-\\n-export let listenToResponderEventTypesImpl;\\n-\\n-export function setListenToResponderEventTypes(\\n-  _listenToResponderEventTypesImpl: Function,\\n-) {\\n-  listenToResponderEventTypesImpl = _listenToResponderEventTypesImpl;\\n-}\\n-\\n-const rootEventTypesToEventResponderInstances: Map<\\n-  DOMEventName | string,\\n-  Set<ReactDOMEventResponderInstance>,\\n-> = new Map();\\n-\\n-type PropagationBehavior = 0 | 1;\\n-\\n-const DoNotPropagateToNextResponder = 0;\\n-const PropagateToNextResponder = 1;\\n-\\n-let currentTimeStamp = 0;\\n-let currentInstance: null | ReactDOMEventResponderInstance = null;\\n-let currentDocument: null | Document = null;\\n-let currentPropagationBehavior: PropagationBehavior = DoNotPropagateToNextResponder;\\n-\\n-const eventResponderContext: ReactDOMResponderContext = {\\n-  dispatchEvent(\\n-    eventValue: any,\\n-    eventListener: any => void,\\n-    eventPriority: EventPriority,\\n-  ): void {\\n-    validateResponderContext();\\n-    validateEventValue(eventValue);\\n-    switch (eventPriority) {\\n-      case DiscreteEvent: {\\n-        flushDiscreteUpdatesIfNeeded(currentTimeStamp);\\n-        discreteUpdates(() =>\\n-          executeUserEventHandler(eventListener, eventValue),\\n-        );\\n-        break;\\n-      }\\n-      case UserBlockingEvent: {\\n-        const previousPriority = getCurrentUpdateLanePriority();\\n-        try {\\n-          setCurrentUpdateLanePriority(InputContinuousLanePriority);\\n-          runWithPriority(UserBlockingPriority, () =>\\n-            executeUserEventHandler(eventListener, eventValue),\\n-          );\\n-        } finally {\\n-          setCurrentUpdateLanePriority(previousPriority);\\n-        }\\n-        break;\\n-      }\\n-      case ContinuousEvent: {\\n-        executeUserEventHandler(eventListener, eventValue);\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  isTargetWithinResponder(target: null | Element | Document): boolean {\\n-    validateResponderContext();\\n-    if (target != null) {\\n-      let fiber = getClosestInstanceFromNode(target);\\n-      const responderFiber = ((currentInstance: any): ReactDOMEventResponderInstance)\\n-        .fiber;\\n-\\n-      while (fiber !== null) {\\n-        if (fiber === responderFiber || fiber.alternate === responderFiber) {\\n-          return true;\\n-        }\\n-        fiber = fiber.return;\\n-      }\\n-    }\\n-    return false;\\n-  },\\n-  isTargetWithinResponderScope(target: null | Element | Document): boolean {\\n-    validateResponderContext();\\n-    const componentInstance = ((currentInstance: any): ReactDOMEventResponderInstance);\\n-    const responder = componentInstance.responder;\\n-\\n-    if (target != null) {\\n-      let fiber = getClosestInstanceFromNode(target);\\n-      const responderFiber = ((currentInstance: any): ReactDOMEventResponderInstance)\\n-        .fiber;\\n-\\n-      while (fiber !== null) {\\n-        if (fiber === responderFiber || fiber.alternate === responderFiber) {\\n-          return true;\\n-        }\\n-        if (doesFiberHaveResponder(fiber, responder)) {\\n-          return false;\\n-        }\\n-        fiber = fiber.return;\\n-      }\\n-    }\\n-    return false;\\n-  },\\n-  isTargetWithinNode(\\n-    childTarget: Element | Document,\\n-    parentTarget: Element | Document,\\n-  ): boolean {\\n-    validateResponderContext();\\n-    const childFiber = getClosestInstanceFromNode(childTarget);\\n-    const parentFiber = getClosestInstanceFromNode(parentTarget);\\n-\\n-    if (childFiber != null && parentFiber != null) {\\n-      const parentAlternateFiber = parentFiber.alternate;\\n-      let node = childFiber;\\n-      while (node !== null) {\\n-        if (node === parentFiber || node === parentAlternateFiber) {\\n-          return true;\\n-        }\\n-        node = node.return;\\n-      }\\n-      return false;\\n-    }\\n-    // Fallback to DOM APIs\\n-    return parentTarget.contains(childTarget);\\n-  },\\n-  addRootEventTypes(rootEventTypes: Array<string>): void {\\n-    validateResponderContext();\\n-    listenToResponderEventTypesImpl(rootEventTypes, currentDocument);\\n-    for (let i = 0; i < rootEventTypes.length; i++) {\\n-      const rootEventType = rootEventTypes[i];\\n-      const eventResponderInstance = ((currentInstance: any): ReactDOMEventResponderInstance);\\n-      DEPRECATED_registerRootEventType(rootEventType, eventResponderInstance);\\n-    }\\n-  },\\n-  removeRootEventTypes(rootEventTypes: Array<string>): void {\\n-    validateResponderContext();\\n-    for (let i = 0; i < rootEventTypes.length; i++) {\\n-      const rootEventType = rootEventTypes[i];\\n-      const rootEventResponders = rootEventTypesToEventResponderInstances.get(\\n-        rootEventType,\\n-      );\\n-      const rootEventTypesSet = ((currentInstance: any): ReactDOMEventResponderInstance)\\n-        .rootEventTypes;\\n-      if (rootEventTypesSet !== null) {\\n-        rootEventTypesSet.delete(rootEventType);\\n-      }\\n-      if (rootEventResponders !== undefined) {\\n-        rootEventResponders.delete(\\n-          ((currentInstance: any): ReactDOMEventResponderInstance),\\n-        );\\n-      }\\n-    }\\n-  },\\n-  getActiveDocument,\\n-  objectAssign: Object.assign,\\n-  getTimeStamp(): number {\\n-    validateResponderContext();\\n-    return currentTimeStamp;\\n-  },\\n-  isTargetWithinHostComponent(\\n-    target: Element | Document,\\n-    elementType: string,\\n-  ): boolean {\\n-    validateResponderContext();\\n-    let fiber = getClosestInstanceFromNode(target);\\n-\\n-    while (fiber !== null) {\\n-      if (fiber.tag === HostComponent && fiber.type === elementType) {\\n-        return true;\\n-      }\\n-      fiber = fiber.return;\\n-    }\\n-    return false;\\n-  },\\n-  continuePropagation() {\\n-    currentPropagationBehavior = PropagateToNextResponder;\\n-  },\\n-  enqueueStateRestore,\\n-  getResponderNode(): Element | null {\\n-    validateResponderContext();\\n-    const responderFiber = ((currentInstance: any): ReactDOMEventResponderInstance)\\n-      .fiber;\\n-    if (responderFiber.tag === ScopeComponent) {\\n-      return null;\\n-    }\\n-    return responderFiber.stateNode;\\n-  },\\n-};\\n-\\n-function validateEventValue(eventValue: any): void {\\n-  if (typeof eventValue === \'object\' && eventValue !== null) {\\n-    const {target, type, timeStamp} = eventValue;\\n-\\n-    if (target == null || type == null || timeStamp == null) {\\n-      throw new Error(\\n-        \'context.dispatchEvent: \\"target\\", \\"timeStamp\\", and \\"type\\" fields on event object are required.\',\\n-      );\\n-    }\\n-    const showWarning = name => {\\n-      if (__DEV__) {\\n-        console.error(\\n-          \'%s is not available on event objects created from event responder modules (React Flare). \' +\\n-            \'Try wrapping in a conditional, i.e. `if (event.type !== \\"press\\") { event.%s }`\',\\n-          name,\\n-          name,\\n-        );\\n-      }\\n-    };\\n-    eventValue.isDefaultPrevented = () => {\\n-      if (__DEV__) {\\n-        showWarning(\'isDefaultPrevented()\');\\n-      }\\n-    };\\n-    eventValue.isPropagationStopped = () => {\\n-      if (__DEV__) {\\n-        showWarning(\'isPropagationStopped()\');\\n-      }\\n-    };\\n-    // $FlowFixMe: we don\'t need value, Flow thinks we do\\n-    Object.defineProperty(eventValue, \'nativeEvent\', {\\n-      get() {\\n-        if (__DEV__) {\\n-          showWarning(\'nativeEvent\');\\n-        }\\n-      },\\n-    });\\n-  }\\n-}\\n-\\n-function doesFiberHaveResponder(\\n-  fiber: Fiber,\\n-  responder: ReactDOMEventResponder,\\n-): boolean {\\n-  const tag = fiber.tag;\\n-  if (tag === HostComponent || tag === ScopeComponent) {\\n-    const dependencies = fiber.dependencies;\\n-    if (dependencies !== null) {\\n-      const respondersMap = dependencies.responders;\\n-      if (respondersMap !== null && respondersMap.has(responder)) {\\n-        return true;\\n-      }\\n-    }\\n-  }\\n-  return false;\\n-}\\n-\\n-function getActiveDocument(): Document {\\n-  return ((currentDocument: any): Document);\\n-}\\n-\\n-function createDOMResponderEvent(\\n-  domEventName: string,\\n-  nativeEvent: AnyNativeEvent,\\n-  nativeEventTarget: Element | Document,\\n-  passive: boolean,\\n-): ReactDOMResponderEvent {\\n-  const {buttons, pointerType} = (nativeEvent: any);\\n-  let eventPointerType = \'\';\\n-\\n-  if (pointerType !== undefined) {\\n-    eventPointerType = pointerType;\\n-  } else if (nativeEvent.key !== undefined) {\\n-    eventPointerType = \'keyboard\';\\n-  } else if (buttons !== undefined) {\\n-    eventPointerType = \'mouse\';\\n-  } else if ((nativeEvent: any).changedTouches !== undefined) {\\n-    eventPointerType = \'touch\';\\n-  }\\n-\\n-  return {\\n-    nativeEvent: nativeEvent,\\n-    passive,\\n-    pointerType: eventPointerType,\\n-    target: nativeEventTarget,\\n-    type: domEventName,\\n-  };\\n-}\\n-\\n-function responderEventTypesContainType(\\n-  eventTypes: Array<string>,\\n-  type: string,\\n-  isPassive: boolean,\\n-): boolean {\\n-  for (let i = 0, len = eventTypes.length; i < len; i++) {\\n-    const eventType = eventTypes[i];\\n-    if (eventType === type || (!isPassive && eventType === type + \'_active\')) {\\n-      return true;\\n-    }\\n-  }\\n-  return false;\\n-}\\n-\\n-function validateResponderTargetEventTypes(\\n-  eventType: string,\\n-  responder: ReactDOMEventResponder,\\n-  isPassive: boolean,\\n-): boolean {\\n-  const {targetEventTypes} = responder;\\n-  // Validate the target event type exists on the responder\\n-  if (targetEventTypes !== null) {\\n-    return responderEventTypesContainType(\\n-      targetEventTypes,\\n-      eventType,\\n-      isPassive,\\n-    );\\n-  }\\n-  return false;\\n-}\\n-\\n-function traverseAndHandleEventResponderInstances(\\n-  domEventName: string,\\n-  targetFiber: null | Fiber,\\n-  nativeEvent: AnyNativeEvent,\\n-  nativeEventTarget: Document | Element,\\n-  eventSystemFlags: EventSystemFlags,\\n-): void {\\n-  const isPassiveEvent = (eventSystemFlags & IS_PASSIVE) !== 0;\\n-  const isPassiveSupported = (eventSystemFlags & PASSIVE_NOT_SUPPORTED) === 0;\\n-  const isPassive = isPassiveEvent || !isPassiveSupported;\\n-\\n-  // Trigger event responders in this order:\\n-  // - Bubble target responder phase\\n-  // - Root responder phase\\n-\\n-  const visitedResponders = new Set();\\n-  const responderEvent = createDOMResponderEvent(\\n-    domEventName,\\n-    nativeEvent,\\n-    nativeEventTarget,\\n-    isPassiveEvent,\\n-  );\\n-  let node = targetFiber;\\n-  let insidePortal = false;\\n-  while (node !== null) {\\n-    const tag = node.tag;\\n-    const dependencies = node.dependencies;\\n-    if (tag === HostPortal) {\\n-      insidePortal = true;\\n-    } else if (\\n-      (tag === HostComponent || tag === ScopeComponent) &&\\n-      dependencies !== null\\n-    ) {\\n-      const respondersMap = dependencies.responders;\\n-      if (respondersMap !== null) {\\n-        const responderInstances = Array.from(respondersMap.values());\\n-        for (let i = 0, length = responderInstances.length; i < length; i++) {\\n-          const responderInstance = responderInstances[i];\\n-          const {props, responder, state} = responderInstance;\\n-          if (\\n-            !visitedResponders.has(responder) &&\\n-            validateResponderTargetEventTypes(\\n-              domEventName,\\n-              responder,\\n-              isPassive,\\n-            ) &&\\n-            (!insidePortal || responder.targetPortalPropagation)\\n-          ) {\\n-            visitedResponders.add(responder);\\n-            const onEvent = responder.onEvent;\\n-            if (onEvent !== null) {\\n-              currentInstance = responderInstance;\\n-              onEvent(responderEvent, eventResponderContext, props, state);\\n-              if (currentPropagationBehavior === PropagateToNextResponder) {\\n-                visitedResponders.delete(responder);\\n-                currentPropagationBehavior = DoNotPropagateToNextResponder;\\n-              }\\n-            }\\n-          }\\n-        }\\n-      }\\n-    }\\n-    node = node.return;\\n-  }\\n-  // Root phase\\n-  const passive = rootEventTypesToEventResponderInstances.get(domEventName);\\n-  const rootEventResponderInstances = [];\\n-  if (passive !== undefined) {\\n-    rootEventResponderInstances.push(...Array.from(passive));\\n-  }\\n-  if (!isPassive) {\\n-    const active = rootEventTypesToEventResponderInstances.get(\\n-      domEventName + \'_active\',\\n-    );\\n-    if (active !== undefined) {\\n-      rootEventResponderInstances.push(...Array.from(active));\\n-    }\\n-  }\\n-  if (rootEventResponderInstances.length > 0) {\\n-    const responderInstances = Array.from(rootEventResponderInstances);\\n-\\n-    for (let i = 0; i < responderInstances.length; i++) {\\n-      const responderInstance = responderInstances[i];\\n-      const {props, responder, state} = responderInstance;\\n-      const onRootEvent = responder.onRootEvent;\\n-      if (onRootEvent !== null) {\\n-        currentInstance = responderInstance;\\n-        onRootEvent(responderEvent, eventResponderContext, props, state);\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-export function mountEventResponder(\\n-  responder: ReactDOMEventResponder,\\n-  responderInstance: ReactDOMEventResponderInstance,\\n-  props: Object,\\n-  state: Object,\\n-) {\\n-  const onMount = responder.onMount;\\n-  if (onMount !== null) {\\n-    const previousInstance = currentInstance;\\n-    currentInstance = responderInstance;\\n-    try {\\n-      onMount(eventResponderContext, props, state);\\n-    } finally {\\n-      currentInstance = previousInstance;\\n-    }\\n-  }\\n-}\\n-\\n-export function unmountEventResponder(\\n-  responderInstance: ReactDOMEventResponderInstance,\\n-): void {\\n-  const responder = ((responderInstance.responder: any): ReactDOMEventResponder);\\n-  const onUnmount = responder.onUnmount;\\n-  if (onUnmount !== null) {\\n-    const {props, state} = responderInstance;\\n-    const previousInstance = currentInstance;\\n-    currentInstance = responderInstance;\\n-    try {\\n-      onUnmount(eventResponderContext, props, state);\\n-    } finally {\\n-      currentInstance = previousInstance;\\n-    }\\n-  }\\n-  const rootEventTypesSet = responderInstance.rootEventTypes;\\n-  if (rootEventTypesSet !== null) {\\n-    const rootEventTypes = Array.from(rootEventTypesSet);\\n-\\n-    for (let i = 0; i < rootEventTypes.length; i++) {\\n-      const topLevelEventType = rootEventTypes[i];\\n-      const rootEventResponderInstances = rootEventTypesToEventResponderInstances.get(\\n-        topLevelEventType,\\n-      );\\n-      if (rootEventResponderInstances !== undefined) {\\n-        rootEventResponderInstances.delete(responderInstance);\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-function validateResponderContext(): void {\\n-  invariant(\\n-    currentInstance !== null,\\n-    \'An event responder context was used outside of an event cycle.\',\\n-  );\\n-}\\n-\\n-export function DEPRECATED_dispatchEventForResponderEventSystem(\\n-  domEventName: string,\\n-  targetFiber: null | Fiber,\\n-  nativeEvent: AnyNativeEvent,\\n-  nativeEventTarget: Document | Element,\\n-  eventSystemFlags: EventSystemFlags,\\n-): void {\\n-  if (enableDeprecatedFlareAPI) {\\n-    const previousInstance = currentInstance;\\n-    const previousTimeStamp = currentTimeStamp;\\n-    const previousDocument = currentDocument;\\n-    const previousPropagationBehavior = currentPropagationBehavior;\\n-    currentPropagationBehavior = DoNotPropagateToNextResponder;\\n-    // nodeType 9 is DOCUMENT_NODE\\n-    currentDocument =\\n-      (nativeEventTarget: any).nodeType === 9\\n-        ? ((nativeEventTarget: any): Document)\\n-        : (nativeEventTarget: any).ownerDocument;\\n-    // We might want to control timeStamp another way here\\n-    currentTimeStamp = (nativeEvent: any).timeStamp;\\n-    try {\\n-      batchedEventUpdates(() => {\\n-        traverseAndHandleEventResponderInstances(\\n-          domEventName,\\n-          targetFiber,\\n-          nativeEvent,\\n-          nativeEventTarget,\\n-          eventSystemFlags,\\n-        );\\n-      });\\n-    } finally {\\n-      currentInstance = previousInstance;\\n-      currentTimeStamp = previousTimeStamp;\\n-      currentDocument = previousDocument;\\n-      currentPropagationBehavior = previousPropagationBehavior;\\n-    }\\n-  }\\n-}\\n-\\n-export function addRootEventTypesForResponderInstance(\\n-  responderInstance: ReactDOMEventResponderInstance,\\n-  rootEventTypes: Array<string>,\\n-): void {\\n-  for (let i = 0; i < rootEventTypes.length; i++) {\\n-    const rootEventType = rootEventTypes[i];\\n-    DEPRECATED_registerRootEventType(rootEventType, responderInstance);\\n-  }\\n-}\\n-\\n-function DEPRECATED_registerRootEventType(\\n-  rootEventType: string,\\n-  eventResponderInstance: ReactDOMEventResponderInstance,\\n-): void {\\n-  let rootEventResponderInstances = rootEventTypesToEventResponderInstances.get(\\n-    rootEventType,\\n-  );\\n-  if (rootEventResponderInstances === undefined) {\\n-    rootEventResponderInstances = new Set();\\n-    rootEventTypesToEventResponderInstances.set(\\n-      rootEventType,\\n-      rootEventResponderInstances,\\n-    );\\n-  }\\n-  let rootEventTypesSet = eventResponderInstance.rootEventTypes;\\n-  if (rootEventTypesSet === null) {\\n-    rootEventTypesSet = eventResponderInstance.rootEventTypes = new Set();\\n-  }\\n-  invariant(\\n-    !rootEventTypesSet.has(rootEventType),\\n-    \'addRootEventTypes() found a duplicate root event \' +\\n-      \'type of \\"%s\\". This might be because the event type exists in the event responder \\"rootEventTypes\\" \' +\\n-      \'array or because of a previous addRootEventTypes() using this root event type.\',\\n-    rootEventType,\\n-  );\\n-  rootEventTypesSet.add(rootEventType);\\n-  rootEventResponderInstances.add(eventResponderInstance);\\n-}\\n-\\n-export function addResponderEventSystemEvent(\\n-  document: Document,\\n-  domEventName: string,\\n-  passive: boolean,\\n-): any => void {\\n-  let eventFlags = RESPONDER_EVENT_SYSTEM;\\n-\\n-  // If passive option is not supported, then the event will be\\n-  // active and not passive, but we flag it as using not being\\n-  // supported too. This way the responder event plugins know,\\n-  // and can provide polyfills if needed.\\n-  if (passive) {\\n-    if (passiveBrowserEventsSupported) {\\n-      eventFlags |= IS_PASSIVE;\\n-    } else {\\n-      eventFlags |= PASSIVE_NOT_SUPPORTED;\\n-      passive = false;\\n-    }\\n-  }\\n-  // Check if interactive and wrap in discreteUpdates\\n-  const listener = createEventListenerWrapper(\\n-    document,\\n-    ((domEventName: any): DOMEventName),\\n-    eventFlags,\\n-  );\\n-  if (passiveBrowserEventsSupported) {\\n-    return addEventCaptureListenerWithPassiveFlag(\\n-      document,\\n-      domEventName,\\n-      listener,\\n-      passive,\\n-    );\\n-  } else {\\n-    return addEventCaptureListener(document, domEventName, listener);\\n-  }\\n-}\\n-\\n-export function removeTrappedEventListener(\\n-  targetContainer: EventTarget,\\n-  domEventName: DOMEventName,\\n-  capture: boolean,\\n-  listener: any => void,\\n-): void {\\n-  removeEventListener(targetContainer, domEventName, listener, capture);\\n-}"},{"sha":"150a73d35ded427f56f0a723821654c299589106","filename":"packages/react-dom/src/events/EventSystemFlags.js","status":"modified","additions":6,"deletions":10,"changes":16,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/EventSystemFlags.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/EventSystemFlags.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/EventSystemFlags.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -9,16 +9,12 @@\\n \\n export type EventSystemFlags = number;\\n \\n-export const PLUGIN_EVENT_SYSTEM = 1;\\n-export const RESPONDER_EVENT_SYSTEM = 1 << 1;\\n-export const IS_EVENT_HANDLE_NON_MANAGED_NODE = 1 << 2;\\n-export const IS_NON_DELEGATED = 1 << 3;\\n-export const IS_CAPTURE_PHASE = 1 << 4;\\n-export const IS_PASSIVE = 1 << 5;\\n-export const IS_REPLAYED = 1 << 6;\\n-export const IS_LEGACY_FB_SUPPORT_MODE = 1 << 7;\\n-// This is used by React Flare\\n-export const PASSIVE_NOT_SUPPORTED = 1 << 8;\\n+export const IS_EVENT_HANDLE_NON_MANAGED_NODE = 1;\\n+export const IS_NON_DELEGATED = 1 << 1;\\n+export const IS_CAPTURE_PHASE = 1 << 2;\\n+export const IS_PASSIVE = 1 << 3;\\n+export const IS_REPLAYED = 1 << 4;\\n+export const IS_LEGACY_FB_SUPPORT_MODE = 1 << 5;\\n \\n export const SHOULD_NOT_DEFER_CLICK_FOR_FB_SUPPORT_MODE =\\n   IS_LEGACY_FB_SUPPORT_MODE | IS_REPLAYED | IS_CAPTURE_PHASE;"},{"sha":"5066cc005a0c643d3a1d7f61fed56b7fae17f0a7","filename":"packages/react-dom/src/events/ReactDOMEventListener.js","status":"modified","additions":16,"deletions":67,"changes":83,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMEventListener.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMEventListener.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMEventListener.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -17,7 +17,6 @@ import type {DOMEventName} from \'../events/DOMEventNames\';\\n // CommonJS interop named imports.\\n import * as Scheduler from \'scheduler\';\\n \\n-import {DEPRECATED_dispatchEventForResponderEventSystem} from \'./DeprecatedDOMEventResponderSystem\';\\n import {\\n   isReplayableDiscreteEvent,\\n   queueDiscreteEvent,\\n@@ -34,17 +33,12 @@ import {HostRoot, SuspenseComponent} from \'react-reconciler/src/ReactWorkTags\';\\n import {\\n   type EventSystemFlags,\\n   IS_LEGACY_FB_SUPPORT_MODE,\\n-  PLUGIN_EVENT_SYSTEM,\\n-  RESPONDER_EVENT_SYSTEM,\\n } from \'./EventSystemFlags\';\\n \\n import getEventTarget from \'./getEventTarget\';\\n import {getClosestInstanceFromNode} from \'../client/ReactDOMComponentTree\';\\n \\n-import {\\n-  enableDeprecatedFlareAPI,\\n-  enableLegacyFBSupport,\\n-} from \'shared/ReactFeatureFlags\';\\n+import {enableLegacyFBSupport} from \'shared/ReactFeatureFlags\';\\n import {\\n   UserBlockingEvent,\\n   ContinuousEvent,\\n@@ -136,7 +130,7 @@ function dispatchDiscreteEvent(\\n     // flushed for this event and we don\'t need to do it again.\\n     (eventSystemFlags & IS_LEGACY_FB_SUPPORT_MODE) === 0\\n   ) {\\n-    flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp);\\n+    flushDiscreteUpdatesIfNeeded();\\n   }\\n   discreteUpdates(\\n     dispatchEvent,\\n@@ -238,35 +232,13 @@ export function dispatchEvent(\\n \\n   // This is not replayable so we\'ll invoke it but without a target,\\n   // in case the event system needs to trace it.\\n-  if (enableDeprecatedFlareAPI) {\\n-    if (eventSystemFlags & PLUGIN_EVENT_SYSTEM) {\\n-      dispatchEventForPluginEventSystem(\\n-        domEventName,\\n-        eventSystemFlags,\\n-        nativeEvent,\\n-        null,\\n-        targetContainer,\\n-      );\\n-    }\\n-    if (eventSystemFlags & RESPONDER_EVENT_SYSTEM) {\\n-      // React Flare event system\\n-      DEPRECATED_dispatchEventForResponderEventSystem(\\n-        (domEventName: any),\\n-        null,\\n-        nativeEvent,\\n-        getEventTarget(nativeEvent),\\n-        eventSystemFlags,\\n-      );\\n-    }\\n-  } else {\\n-    dispatchEventForPluginEventSystem(\\n-      domEventName,\\n-      eventSystemFlags,\\n-      nativeEvent,\\n-      null,\\n-      targetContainer,\\n-    );\\n-  }\\n+  dispatchEventForPluginEventSystem(\\n+    domEventName,\\n+    eventSystemFlags,\\n+    nativeEvent,\\n+    null,\\n+    targetContainer,\\n+  );\\n }\\n \\n // Attempt dispatching an event. Returns a SuspenseInstance or Container if it\'s blocked.\\n@@ -318,36 +290,13 @@ export function attemptToDispatchEvent(\\n       }\\n     }\\n   }\\n-\\n-  if (enableDeprecatedFlareAPI) {\\n-    if (eventSystemFlags & PLUGIN_EVENT_SYSTEM) {\\n-      dispatchEventForPluginEventSystem(\\n-        domEventName,\\n-        eventSystemFlags,\\n-        nativeEvent,\\n-        targetInst,\\n-        targetContainer,\\n-      );\\n-    }\\n-    if (eventSystemFlags & RESPONDER_EVENT_SYSTEM) {\\n-      // React Flare event system\\n-      DEPRECATED_dispatchEventForResponderEventSystem(\\n-        (domEventName: any),\\n-        targetInst,\\n-        nativeEvent,\\n-        nativeEventTarget,\\n-        eventSystemFlags,\\n-      );\\n-    }\\n-  } else {\\n-    dispatchEventForPluginEventSystem(\\n-      domEventName,\\n-      eventSystemFlags,\\n-      nativeEvent,\\n-      targetInst,\\n-      targetContainer,\\n-    );\\n-  }\\n+  dispatchEventForPluginEventSystem(\\n+    domEventName,\\n+    eventSystemFlags,\\n+    nativeEvent,\\n+    targetInst,\\n+    targetContainer,\\n+  );\\n   // We\'re not blocked on anything.\\n   return null;\\n }"},{"sha":"ded99d196188b863e319efae8a909f21576b8e41","filename":"packages/react-dom/src/events/ReactDOMEventReplaying.js","status":"modified","additions":1,"deletions":33,"changes":34,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMEventReplaying.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMEventReplaying.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMEventReplaying.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -10,15 +10,11 @@\\n import type {AnyNativeEvent} from \'../events/PluginModuleType\';\\n import type {Container, SuspenseInstance} from \'../client/ReactDOMHostConfig\';\\n import type {DOMEventName} from \'../events/DOMEventNames\';\\n-import type {ElementListenerMap} from \'../client/ReactDOMComponentTree\';\\n import type {EventSystemFlags} from \'./EventSystemFlags\';\\n import type {FiberRoot} from \'react-reconciler/src/ReactInternalTypes\';\\n import type {LanePriority} from \'react-reconciler/src/ReactFiberLane\';\\n \\n-import {\\n-  enableDeprecatedFlareAPI,\\n-  enableSelectiveHydration,\\n-} from \'shared/ReactFeatureFlags\';\\n+import {enableSelectiveHydration} from \'shared/ReactFeatureFlags\';\\n import {\\n   unstable_runWithPriority as runWithPriority,\\n   unstable_scheduleCallback as scheduleCallback,\\n@@ -34,7 +30,6 @@ import {attemptToDispatchEvent} from \'./ReactDOMEventListener\';\\n import {\\n   getInstanceFromNode,\\n   getClosestInstanceFromNode,\\n-  getEventListenerMap,\\n } from \'../client/ReactDOMComponentTree\';\\n import {HostRoot, SuspenseComponent} from \'react-reconciler/src/ReactWorkTags\';\\n \\n@@ -88,7 +83,6 @@ type PointerEvent = Event & {\\n \\n import {IS_REPLAYED} from \'./EventSystemFlags\';\\n import {listenToNativeEvent} from \'./DOMPluginEventSystem\';\\n-import {addResponderEventSystemEvent} from \'./DeprecatedDOMEventResponderSystem\';\\n \\n type QueuedReplayableEvent = {|\\n   blockedOn: null | Container | SuspenseInstance,\\n@@ -186,43 +180,17 @@ function trapReplayableEventForContainer(\\n   listenToNativeEvent(domEventName, false, ((container: any): Element), null);\\n }\\n \\n-function trapReplayableEventForDocument(\\n-  domEventName: DOMEventName,\\n-  document: Document,\\n-  listenerMap: ElementListenerMap,\\n-) {\\n-  if (enableDeprecatedFlareAPI) {\\n-    // Trap events for the responder system.\\n-    // TODO: Ideally we shouldn\'t need these to be active but\\n-    // if we only have a passive listener, we at least need it\\n-    // to still pretend to be active so that Flare gets those\\n-    // events.\\n-    const activeEventKey = domEventName + \'_active\';\\n-    if (!listenerMap.has(activeEventKey)) {\\n-      const listener = addResponderEventSystemEvent(\\n-        document,\\n-        domEventName,\\n-        false,\\n-      );\\n-      listenerMap.set(activeEventKey, {passive: false, listener});\\n-    }\\n-  }\\n-}\\n-\\n export function eagerlyTrapReplayableEvents(\\n   container: Container,\\n   document: Document,\\n ) {\\n-  const listenerMapForDoc = getEventListenerMap(document);\\n   // Discrete\\n   discreteReplayableEvents.forEach(domEventName => {\\n     trapReplayableEventForContainer(domEventName, container);\\n-    trapReplayableEventForDocument(domEventName, document, listenerMapForDoc);\\n   });\\n   // Continuous\\n   continuousReplayableEvents.forEach(domEventName => {\\n     trapReplayableEventForContainer(domEventName, container);\\n-    trapReplayableEventForDocument(domEventName, document, listenerMapForDoc);\\n   });\\n }\\n "},{"sha":"68d33a8c65a698f7fde1433e038658c59d8801ff","filename":"packages/react-dom/src/events/ReactDOMUpdateBatching.js","status":"modified","additions":2,"deletions":36,"changes":38,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMUpdateBatching.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/ReactDOMUpdateBatching.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/ReactDOMUpdateBatching.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -10,9 +10,6 @@ import {\\n   restoreStateIfNeeded,\\n } from \'./ReactDOMControlledComponent\';\\n \\n-import {enableDeprecatedFlareAPI} from \'shared/ReactFeatureFlags\';\\n-import {invokeGuardedCallbackAndCatchFirstError} from \'shared/ReactErrorUtils\';\\n-\\n // Used as a way to call batchedUpdates when we don\'t have a reference to\\n // the renderer. Such as when we\'re dispatching events or if third party\\n // libraries need to call batchedUpdates. Eventually, this API will go away when\\n@@ -77,18 +74,6 @@ export function batchedEventUpdates(fn, a, b) {\\n   }\\n }\\n \\n-// This is for the React Flare event system\\n-export function executeUserEventHandler(fn: any => void, value: any): void {\\n-  const previouslyInEventHandler = isInsideEventHandler;\\n-  try {\\n-    isInsideEventHandler = true;\\n-    const type = typeof value === \'object\' && value !== null ? value.type : \'\';\\n-    invokeGuardedCallbackAndCatchFirstError(type, fn, undefined, value);\\n-  } finally {\\n-    isInsideEventHandler = previouslyInEventHandler;\\n-  }\\n-}\\n-\\n export function discreteUpdates(fn, a, b, c, d) {\\n   const prevIsInsideEventHandler = isInsideEventHandler;\\n   isInsideEventHandler = true;\\n@@ -102,27 +87,8 @@ export function discreteUpdates(fn, a, b, c, d) {\\n   }\\n }\\n \\n-let lastFlushedEventTimeStamp = 0;\\n-export function flushDiscreteUpdatesIfNeeded(timeStamp: number) {\\n-  // event.timeStamp isn\'t overly reliable due to inconsistencies in\\n-  // how different browsers have historically provided the time stamp.\\n-  // Some browsers provide high-resolution time stamps for all events,\\n-  // some provide low-resolution time stamps for all events. FF < 52\\n-  // even mixes both time stamps together. Some browsers even report\\n-  // negative time stamps or time stamps that are 0 (iOS9) in some cases.\\n-  // Given we are only comparing two time stamps with equality (!==),\\n-  // we are safe from the resolution differences. If the time stamp is 0\\n-  // we bail-out of preventing the flush, which can affect semantics,\\n-  // such as if an earlier flush removes or adds event listeners that\\n-  // are fired in the subsequent flush. However, this is the same\\n-  // behaviour as we had before this change, so the risks are low.\\n-  if (\\n-    !isInsideEventHandler &&\\n-    (!enableDeprecatedFlareAPI ||\\n-      timeStamp === 0 ||\\n-      lastFlushedEventTimeStamp !== timeStamp)\\n-  ) {\\n-    lastFlushedEventTimeStamp = timeStamp;\\n+export function flushDiscreteUpdatesIfNeeded() {\\n+  if (!isInsideEventHandler) {\\n     flushDiscreteUpdatesImpl();\\n   }\\n }"},{"sha":"fc8a8875c6e79ee7c75cc5f270a04c30e117c1d6","filename":"packages/react-dom/src/events/__tests__/DeprecatedDOMEventResponderSystem-test.internal.js","status":"removed","additions":0,"deletions":1002,"changes":1002,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-dom/src/events/__tests__/DeprecatedDOMEventResponderSystem-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-dom/src/events/__tests__/DeprecatedDOMEventResponderSystem-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/__tests__/DeprecatedDOMEventResponderSystem-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,1002 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let ReactDOMServer;\\n-let ReactTestRenderer;\\n-let Scheduler;\\n-\\n-// FIXME: What should the public API be for setting an event\'s priority? Right\\n-// now it\'s an enum but is that what we want? Hard coding this for now.\\n-const DiscreteEvent = 0;\\n-\\n-function createEventResponder({\\n-  onEvent,\\n-  onRootEvent,\\n-  targetEventTypes,\\n-  onMount,\\n-  onUnmount,\\n-  getInitialState,\\n-  targetPortalPropagation,\\n-}) {\\n-  return React.DEPRECATED_createResponder(\'TestEventResponder\', {\\n-    targetEventTypes,\\n-    onEvent,\\n-    onRootEvent,\\n-    onMount,\\n-    onUnmount,\\n-    getInitialState,\\n-    targetPortalPropagation,\\n-  });\\n-}\\n-\\n-const createEvent = (type, data) => {\\n-  const event = document.createEvent(\'CustomEvent\');\\n-  event.initCustomEvent(type, true, true);\\n-  if (data != null) {\\n-    Object.entries(data).forEach(([key, value]) => {\\n-      event[key] = value;\\n-    });\\n-  }\\n-  return event;\\n-};\\n-\\n-function dispatchEvent(element, type) {\\n-  const event = document.createEvent(\'Event\');\\n-  event.initEvent(type, true, true);\\n-  element.dispatchEvent(event);\\n-}\\n-\\n-function dispatchClickEvent(element) {\\n-  dispatchEvent(element, \'click\');\\n-}\\n-\\n-// This is a new feature in Fiber so I put it in its own test file. It could\\n-// probably move to one of the other test files once it is official.\\n-describe(\'DOMEventResponderSystem\', () => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    jest.resetModules();\\n-    ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-    ReactFeatureFlags.enableScopeAPI = true;\\n-    React = require(\'react\');\\n-    ReactDOM = require(\'react-dom\');\\n-    ReactDOMServer = require(\'react-dom/server\');\\n-    Scheduler = require(\'scheduler\');\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'can mount and render correctly with the ReactTestRenderer\', () => {\\n-    jest.resetModules();\\n-    ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-    React = require(\'react\');\\n-    ReactTestRenderer = require(\'react-test-renderer\');\\n-    const TestResponder = createEventResponder({});\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return <div DEPRECATED_flareListeners={listener}>Hello world</div>;\\n-    }\\n-    const renderer = ReactTestRenderer.create(<Test />);\\n-    expect(renderer).toMatchRenderedOutput(<div>Hello world</div>);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'can render correctly with the ReactDOMServer\', () => {\\n-    const TestResponder = createEventResponder({});\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return <div DEPRECATED_flareListeners={listener}>Hello world</div>;\\n-    }\\n-    const output = ReactDOMServer.renderToString(<Test />);\\n-    expect(output).toBe(`<div data-reactroot=\\"\\">Hello world</div>`);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'can render correctly with the ReactDOMServer hydration\', () => {\\n-    const onEvent = jest.fn();\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent,\\n-    });\\n-    const ref = React.createRef();\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <div>\\n-          <span DEPRECATED_flareListeners={listener} ref={ref}>\\n-            Hello world\\n-          </span>\\n-        </div>\\n-      );\\n-    }\\n-    const output = ReactDOMServer.renderToString(<Test />);\\n-    expect(output).toBe(\\n-      `<div data-reactroot=\\"\\"><span>Hello world</span></div>`,\\n-    );\\n-    container.innerHTML = output;\\n-    ReactDOM.hydrate(<Test />, container);\\n-    dispatchClickEvent(ref.current);\\n-    expect(onEvent).toHaveBeenCalledTimes(1);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responders should fire on click event\', () => {\\n-    let eventResponderFiredCount = 0;\\n-    const eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventResponderFiredCount++;\\n-        eventLog.push({\\n-          name: event.type,\\n-          passive: event.passive,\\n-          phase: \'bubble\',\\n-        });\\n-      },\\n-    });\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <button ref={buttonRef} DEPRECATED_flareListeners={listener}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test />, container);\\n-    expect(container.innerHTML).toBe(\'<button>Click me!</button>\');\\n-\\n-    // Clicking the button should trigger the event responder onEvent() twice\\n-    let buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(1);\\n-    expect(eventLog.length).toBe(1);\\n-    expect(eventLog).toEqual([\\n-      {\\n-        name: \'click\',\\n-        passive: true,\\n-        phase: \'bubble\',\\n-      },\\n-    ]);\\n-\\n-    // Unmounting the container and clicking should not increment anything\\n-    ReactDOM.render(null, container);\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(1);\\n-\\n-    // Re-rendering the container and clicking should increase the counters again\\n-    ReactDOM.render(<Test />, container);\\n-    buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(2);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responders should fire on click event (passive events forced)\', () => {\\n-    // JSDOM does not support passive events, so this manually overrides the value to be true\\n-    const checkPassiveEvents = require(\'react-dom/src/events/checkPassiveEvents\');\\n-    checkPassiveEvents.passiveBrowserEventsSupported = true;\\n-\\n-    const eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventLog.push({\\n-          name: event.type,\\n-          passive: event.passive,\\n-          phase: \'bubble\',\\n-        });\\n-      },\\n-    });\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <button ref={buttonRef} DEPRECATED_flareListeners={listener}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    const buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventLog.length).toBe(1);\\n-    expect(eventLog).toEqual([\\n-      {\\n-        name: \'click\',\\n-        passive: true,\\n-        phase: \'bubble\',\\n-      },\\n-    ]);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'nested event responders should not fire multiple times\', () => {\\n-    let eventResponderFiredCount = 0;\\n-    let eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventResponderFiredCount++;\\n-        eventLog.push({\\n-          name: event.type,\\n-          passive: event.passive,\\n-          phase: \'bubble\',\\n-        });\\n-      },\\n-    });\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <button\\n-          ref={buttonRef}\\n-          DEPRECATED_flareListeners={[listener, listener2]}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    }\\n-\\n-    expect(() => {\\n-      ReactDOM.render(<Test />, container);\\n-    }).toErrorDev(\\n-      \'Duplicate event responder \\"TestEventResponder\\" found in event listeners. \' +\\n-        \'Event listeners passed to elements cannot use the same event responder more than once.\',\\n-    );\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    let buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(1);\\n-    expect(eventLog.length).toBe(1);\\n-    expect(eventLog).toEqual([\\n-      {\\n-        name: \'click\',\\n-        passive: true,\\n-        phase: \'bubble\',\\n-      },\\n-    ]);\\n-\\n-    eventLog = [];\\n-\\n-    function Test2() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          <button ref={buttonRef} DEPRECATED_flareListeners={listener}>\\n-            Click me!\\n-          </button>\\n-        </div>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test2 />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(2);\\n-    expect(eventLog.length).toBe(1);\\n-\\n-    expect(eventLog).toEqual([\\n-      {\\n-        name: \'click\',\\n-        passive: true,\\n-        phase: \'bubble\',\\n-      },\\n-    ]);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'nested event responders should fire in the correct order\', () => {\\n-    let eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponderA = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventLog.push(`A [bubble]`);\\n-      },\\n-    });\\n-\\n-    const TestResponderB = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventLog.push(`B [bubble]`);\\n-      },\\n-    });\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponderA, {});\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponderB, {});\\n-\\n-      return (\\n-        <button\\n-          ref={buttonRef}\\n-          DEPRECATED_flareListeners={[listener, listener2]}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    let buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-\\n-    expect(eventLog).toEqual([\'A [bubble]\', \'B [bubble]\']);\\n-\\n-    eventLog = [];\\n-\\n-    function Test2() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponderA, {});\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponderB, {});\\n-\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          <button ref={buttonRef} DEPRECATED_flareListeners={listener2}>\\n-            Click me!\\n-          </button>\\n-        </div>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test2 />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-\\n-    expect(eventLog).toEqual([\'B [bubble]\', \'A [bubble]\']);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'nested event responders should fire in the correct order #2\', () => {\\n-    const eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        eventLog.push(`${props.name} [bubble]`);\\n-      },\\n-    });\\n-\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        name: \'A\',\\n-      });\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponder, {\\n-        name: \'B\',\\n-      });\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          <button ref={buttonRef} DEPRECATED_flareListeners={listener2}>\\n-            Click me!\\n-          </button>\\n-        </div>\\n-      );\\n-    };\\n-\\n-    ReactDOM.render(<Test />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    const buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-\\n-    expect(eventLog).toEqual([\'B [bubble]\']);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'custom event dispatching for click -> magicClick works\', () => {\\n-    const eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        const syntheticEvent = {\\n-          target: event.target,\\n-          type: \'magicclick\',\\n-          phase: \'bubble\',\\n-          timeStamp: context.getTimeStamp(),\\n-        };\\n-        context.dispatchEvent(\\n-          syntheticEvent,\\n-          props.onMagicClick,\\n-          DiscreteEvent,\\n-        );\\n-      },\\n-    });\\n-\\n-    function handleMagicEvent(e) {\\n-      eventLog.push(\'magic event fired\', e.type, e.phase);\\n-    }\\n-\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        onMagicClick: handleMagicEvent,\\n-      });\\n-\\n-      return (\\n-        <button ref={buttonRef} DEPRECATED_flareListeners={listener}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    };\\n-\\n-    ReactDOM.render(<Test />, container);\\n-\\n-    // Clicking the button should trigger the event responder onEvent()\\n-    const buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-\\n-    expect(eventLog).toEqual([\'magic event fired\', \'magicclick\', \'bubble\']);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder onMount() function should fire\', () => {\\n-    let onMountFired = 0;\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [],\\n-      onMount: () => {\\n-        onMountFired++;\\n-      },\\n-    });\\n-\\n-    const TestResponder2 = createEventResponder({\\n-      targetEventTypes: [],\\n-      onMount: () => {\\n-        onMountFired++;\\n-      },\\n-    });\\n-\\n-    function Test({toggle}) {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponder2, {});\\n-      if (toggle) {\\n-        return <button DEPRECATED_flareListeners={[listener2, listener]} />;\\n-      }\\n-      return <button DEPRECATED_flareListeners={[listener, listener2]} />;\\n-    }\\n-\\n-    ReactDOM.render(<Test />, container);\\n-    expect(onMountFired).toEqual(2);\\n-\\n-    ReactDOM.render(<Test toggle={true} />, container);\\n-    expect(onMountFired).toEqual(2);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder onUnmount() function should fire\', () => {\\n-    let onUnmountFired = 0;\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [],\\n-      onUnmount: () => {\\n-        onUnmountFired++;\\n-      },\\n-    });\\n-\\n-    function Test({test}) {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      if (test === 0) {\\n-        return <button DEPRECATED_flareListeners={[listener]} />;\\n-      } else if (test === 1) {\\n-        return <button DEPRECATED_flareListeners={null} />;\\n-      } else if (test === 2) {\\n-        return <button DEPRECATED_flareListeners={[]} />;\\n-      } else if (test === 3) {\\n-        return <button />;\\n-      } else if (test === 4) {\\n-        return <button DEPRECATED_flareListeners={listener} />;\\n-      }\\n-    }\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(null, container);\\n-    expect(onUnmountFired).toEqual(1);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={1} />, container);\\n-    expect(onUnmountFired).toEqual(2);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={2} />, container);\\n-    expect(onUnmountFired).toEqual(3);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={3} />, container);\\n-    expect(onUnmountFired).toEqual(4);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={4} />, container);\\n-    expect(onUnmountFired).toEqual(4);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder onUnmount() function should fire using scopes\', () => {\\n-    let onUnmountFired = 0;\\n-\\n-    const TestScope = React.unstable_Scope;\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [],\\n-      onUnmount: () => {\\n-        onUnmountFired++;\\n-      },\\n-    });\\n-\\n-    function Test({test}) {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      if (test === 0) {\\n-        return <TestScope DEPRECATED_flareListeners={[listener]} />;\\n-      } else if (test === 1) {\\n-        return <TestScope DEPRECATED_flareListeners={null} />;\\n-      } else if (test === 2) {\\n-        return <TestScope DEPRECATED_flareListeners={[]} />;\\n-      } else if (test === 3) {\\n-        return <TestScope />;\\n-      } else if (test === 4) {\\n-        return <TestScope DEPRECATED_flareListeners={listener} />;\\n-      }\\n-    }\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(null, container);\\n-    expect(onUnmountFired).toEqual(1);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={1} />, container);\\n-    expect(onUnmountFired).toEqual(2);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={2} />, container);\\n-    expect(onUnmountFired).toEqual(3);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={3} />, container);\\n-    expect(onUnmountFired).toEqual(4);\\n-\\n-    ReactDOM.render(<Test test={0} />, container);\\n-    ReactDOM.render(<Test test={4} />, container);\\n-    expect(onUnmountFired).toEqual(4);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder onUnmount() function should fire with state\', () => {\\n-    let counter = 0;\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [],\\n-      getInitialState: () => ({\\n-        incrementAmount: 5,\\n-      }),\\n-      onUnmount: (context, props, state) => {\\n-        counter += state.incrementAmount;\\n-      },\\n-    });\\n-\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      return <button DEPRECATED_flareListeners={listener} />;\\n-    };\\n-\\n-    ReactDOM.render(<Test />, container);\\n-    ReactDOM.render(null, container);\\n-    expect(counter).toEqual(5);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder target listeners should correctly fire for only their events\', () => {\\n-    let clickEventComponent1Fired = 0;\\n-    let clickEventComponent2Fired = 0;\\n-    const eventLog = [];\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponderA = createEventResponder({\\n-      targetEventTypes: [\'click_active\'],\\n-      onEvent: event => {\\n-        clickEventComponent1Fired++;\\n-        eventLog.push({\\n-          name: event.type,\\n-          passive: event.passive,\\n-        });\\n-      },\\n-    });\\n-\\n-    const TestResponderB = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: event => {\\n-        clickEventComponent2Fired++;\\n-        eventLog.push({\\n-          name: event.type,\\n-          passive: event.passive,\\n-        });\\n-      },\\n-    });\\n-\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponderA, {});\\n-      const listener2 = React.DEPRECATED_useResponder(TestResponderB, {});\\n-\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          <button ref={buttonRef} DEPRECATED_flareListeners={listener2}>\\n-            Click me!\\n-          </button>\\n-        </div>\\n-      );\\n-    };\\n-\\n-    ReactDOM.render(<Test />, container);\\n-\\n-    const buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-\\n-    expect(clickEventComponent1Fired).toBe(1);\\n-    expect(clickEventComponent2Fired).toBe(1);\\n-    expect(eventLog.length).toBe(2);\\n-    expect(eventLog).toEqual([\\n-      {\\n-        name: \'click\',\\n-        passive: false,\\n-      },\\n-      {\\n-        name: \'click\',\\n-        passive: false,\\n-      },\\n-    ]);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'the event responder system should warn on accessing invalid properties\', () => {\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props) => {\\n-        const syntheticEvent = {\\n-          target: event.target,\\n-          type: \'click\',\\n-          timeStamp: context.getTimeStamp(),\\n-        };\\n-        context.dispatchEvent(syntheticEvent, props.onClick, DiscreteEvent);\\n-      },\\n-    });\\n-\\n-    let handler;\\n-    const buttonRef = React.createRef();\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        onClick: handler,\\n-      });\\n-\\n-      return (\\n-        <button DEPRECATED_flareListeners={listener} ref={buttonRef}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    };\\n-    expect(() => {\\n-      handler = event => {\\n-        event.isDefaultPrevented();\\n-      };\\n-      ReactDOM.render(<Test />, container);\\n-      dispatchClickEvent(buttonRef.current);\\n-    }).toErrorDev(\\n-      \'Warning: isDefaultPrevented() is not available on event objects created from event responder modules \' +\\n-        \'(React Flare).\' +\\n-        \' Try wrapping in a conditional, i.e. `if (event.type !== \\"press\\") { event.isDefaultPrevented() }`\',\\n-      {withoutStack: true},\\n-    );\\n-    expect(() => {\\n-      handler = event => {\\n-        event.isPropagationStopped();\\n-      };\\n-      ReactDOM.render(<Test />, container);\\n-      dispatchClickEvent(buttonRef.current);\\n-    }).toErrorDev(\\n-      \'Warning: isPropagationStopped() is not available on event objects created from event responder modules \' +\\n-        \'(React Flare).\' +\\n-        \' Try wrapping in a conditional, i.e. `if (event.type !== \\"press\\") { event.isPropagationStopped() }`\',\\n-      {withoutStack: true},\\n-    );\\n-    expect(() => {\\n-      handler = event => {\\n-        return event.nativeEvent;\\n-      };\\n-      ReactDOM.render(<Test />, container);\\n-      dispatchClickEvent(buttonRef.current);\\n-    }).toErrorDev(\\n-      \'Warning: nativeEvent is not available on event objects created from event responder modules \' +\\n-        \'(React Flare).\' +\\n-        \' Try wrapping in a conditional, i.e. `if (event.type !== \\"press\\") { event.nativeEvent }`\',\\n-      {withoutStack: true},\\n-    );\\n-    expect(container.innerHTML).toBe(\'<button>Click me!</button>\');\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should work with event responder hooks\', () => {\\n-    const buttonRef = React.createRef();\\n-    const eventLogs = [];\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'foo\'],\\n-      onEvent: (event, context, props) => {\\n-        const fooEvent = {\\n-          target: event.target,\\n-          type: \'foo\',\\n-          timeStamp: context.getTimeStamp(),\\n-        };\\n-        context.dispatchEvent(fooEvent, props.onFoo, DiscreteEvent);\\n-      },\\n-    });\\n-\\n-    const Test = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        onFoo: e => eventLogs.push(\'hook\'),\\n-      });\\n-\\n-      return <button ref={buttonRef} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-\\n-    ReactDOM.render(<Test />, container);\\n-    buttonRef.current.dispatchEvent(createEvent(\'foo\'));\\n-    expect(eventLogs).toEqual([\'hook\']);\\n-\\n-    // Clear events\\n-    eventLogs.length = 0;\\n-\\n-    const Test2 = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        onFoo: e => eventLogs.push(\'hook\'),\\n-      });\\n-\\n-      return <button ref={buttonRef} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-\\n-    ReactDOM.render(<Test2 />, container);\\n-    buttonRef.current.dispatchEvent(createEvent(\'foobar\'));\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should work with concurrent mode updates\', async () => {\\n-    const log = [];\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent(event, context, props) {\\n-        log.push(props);\\n-      },\\n-    });\\n-    const ref = React.createRef();\\n-\\n-    function Test({counter}) {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {counter});\\n-      Scheduler.unstable_yieldValue(\'Test\');\\n-      return (\\n-        <button DEPRECATED_flareListeners={listener} ref={ref}>\\n-          Press me\\n-        </button>\\n-      );\\n-    }\\n-\\n-    const root = ReactDOM.createRoot(container);\\n-    root.render(<Test counter={0} />);\\n-    expect(Scheduler).toFlushAndYield([\'Test\']);\\n-\\n-    // Click the button\\n-    dispatchClickEvent(ref.current);\\n-    expect(log).toEqual([{counter: 0}]);\\n-\\n-    // Clear log\\n-    log.length = 0;\\n-\\n-    // Increase counter\\n-    root.render(<Test counter={1} />);\\n-    // Yield before committing\\n-    expect(Scheduler).toFlushAndYieldThrough([\'Test\']);\\n-\\n-    // Click the button again\\n-    dispatchClickEvent(ref.current);\\n-    expect(log).toEqual([{counter: 0}]);\\n-\\n-    // Clear log\\n-    log.length = 0;\\n-\\n-    // Commit\\n-    expect(Scheduler).toFlushAndYield([]);\\n-    dispatchClickEvent(ref.current);\\n-    expect(log).toEqual([{counter: 1}]);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should correctly pass through event properties\', () => {\\n-    const timeStamps = [];\\n-    const ref = React.createRef();\\n-    const eventLog = [];\\n-    const logEvent = event => {\\n-      const propertiesWeCareAbout = {\\n-        counter: event.counter,\\n-        target: event.target,\\n-        timeStamp: event.timeStamp,\\n-        type: event.type,\\n-      };\\n-      timeStamps.push(event.timeStamp);\\n-      eventLog.push(propertiesWeCareAbout);\\n-    };\\n-    let counter = 0;\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent(event, context, props) {\\n-        const obj = {\\n-          counter,\\n-          timeStamp: context.getTimeStamp(),\\n-          target: context.getResponderNode(),\\n-          type: \'click-test\',\\n-        };\\n-        context.dispatchEvent(obj, props.onClick, DiscreteEvent);\\n-      },\\n-    });\\n-\\n-    const Component = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {\\n-        onClick: logEvent,\\n-      });\\n-      return <button ref={ref} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-    dispatchClickEvent(ref.current);\\n-    counter++;\\n-    dispatchClickEvent(ref.current);\\n-    counter++;\\n-    dispatchClickEvent(ref.current);\\n-    expect(typeof timeStamps[0] === \'number\').toBe(true);\\n-    expect(eventLog).toEqual([\\n-      {\\n-        counter: 0,\\n-        target: ref.current,\\n-        timeStamp: timeStamps[0],\\n-        type: \'click-test\',\\n-      },\\n-      {\\n-        counter: 1,\\n-        target: ref.current,\\n-        timeStamp: timeStamps[1],\\n-        type: \'click-test\',\\n-      },\\n-      {\\n-        counter: 2,\\n-        target: ref.current,\\n-        timeStamp: timeStamps[2],\\n-        type: \'click-test\',\\n-      },\\n-    ]);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should not propagate target events through portals by default\', () => {\\n-    const buttonRef = React.createRef();\\n-    const onEvent = jest.fn();\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent,\\n-    });\\n-    const domNode = document.createElement(\'div\');\\n-    document.body.appendChild(domNode);\\n-    const Component = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          {ReactDOM.createPortal(<button ref={buttonRef} />, domNode)}\\n-        </div>\\n-      );\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-    dispatchClickEvent(buttonRef.current);\\n-    document.body.removeChild(domNode);\\n-    expect(onEvent).not.toBeCalled();\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should propagate target events through portals when enabled\', () => {\\n-    const buttonRef = React.createRef();\\n-    const onEvent = jest.fn();\\n-    const TestResponder = createEventResponder({\\n-      targetPortalPropagation: true,\\n-      targetEventTypes: [\'click\'],\\n-      onEvent,\\n-    });\\n-    const domNode = document.createElement(\'div\');\\n-    document.body.appendChild(domNode);\\n-    const Component = () => {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-      return (\\n-        <div DEPRECATED_flareListeners={listener}>\\n-          {ReactDOM.createPortal(<button ref={buttonRef} />, domNode)}\\n-        </div>\\n-      );\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-    dispatchClickEvent(buttonRef.current);\\n-    document.body.removeChild(domNode);\\n-    expect(onEvent).toBeCalled();\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'event upgrading should work correctly\', () => {\\n-    let eventResponderFiredCount = 0;\\n-    const buttonRef = React.createRef();\\n-\\n-    const TestResponder = createEventResponder({\\n-      targetEventTypes: [\'click\'],\\n-      onEvent: (event, context, props, state) => {\\n-        eventResponderFiredCount++;\\n-        if (!state.addedRootEventTypes) {\\n-          context.addRootEventTypes([\'click_active\']);\\n-        }\\n-        state.addedRootEventTypes = true;\\n-      },\\n-    });\\n-\\n-    function Test() {\\n-      const listener = React.DEPRECATED_useResponder(TestResponder, {});\\n-\\n-      return (\\n-        <button ref={buttonRef} DEPRECATED_flareListeners={listener}>\\n-          Click me!\\n-        </button>\\n-      );\\n-    }\\n-\\n-    ReactDOM.render(<Test />, container);\\n-    expect(container.innerHTML).toBe(\'<button>Click me!</button>\');\\n-\\n-    const buttonElement = buttonRef.current;\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(1);\\n-    dispatchClickEvent(buttonElement);\\n-    expect(eventResponderFiredCount).toBe(2);\\n-  });\\n-});"},{"sha":"415a13395c7364ce1e3bfc9f47506b9d3cea7abe","filename":"packages/react-dom/src/events/checkPassiveEvents.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/checkPassiveEvents.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/events/checkPassiveEvents.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/events/checkPassiveEvents.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -8,13 +8,13 @@\\n  */\\n \\n import {canUseDOM} from \'shared/ExecutionEnvironment\';\\n-import {enableDeprecatedFlareAPI} from \'shared/ReactFeatureFlags\';\\n+import {enableCreateEventHandleAPI} from \'shared/ReactFeatureFlags\';\\n \\n export let passiveBrowserEventsSupported = false;\\n \\n // Check if browser support events with passive listeners\\n // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support\\n-if (enableDeprecatedFlareAPI && canUseDOM) {\\n+if (enableCreateEventHandleAPI && canUseDOM) {\\n   try {\\n     const options = {};\\n     // $FlowFixMe: Ignore Flow complaining about needing a value"},{"sha":"1754555dd549307c43ef55a4a9761015627d5337","filename":"packages/react-dom/src/server/ReactPartialRenderer.js","status":"modified","additions":0,"deletions":4,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/server/ReactPartialRenderer.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/server/ReactPartialRenderer.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/server/ReactPartialRenderer.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -23,7 +23,6 @@ import {\\n   disableModulePatternComponents,\\n   enableSuspenseServerRenderer,\\n   enableFundamentalAPI,\\n-  enableDeprecatedFlareAPI,\\n   enableScopeAPI,\\n } from \'shared/ReactFeatureFlags\';\\n \\n@@ -368,9 +367,6 @@ function createOpenTagMarkup(\\n     if (!hasOwnProperty.call(props, propKey)) {\\n       continue;\\n     }\\n-    if (enableDeprecatedFlareAPI && propKey === \'DEPRECATED_flareListeners\') {\\n-      continue;\\n-    }\\n     let propValue = props[propKey];\\n     if (propValue == null) {\\n       continue;"},{"sha":"8cc7be4716205045e176982d84c1734fd56406eb","filename":"packages/react-dom/src/server/ReactPartialRendererHooks.js","status":"modified","additions":0,"deletions":9,"changes":9,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/server/ReactPartialRendererHooks.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/server/ReactPartialRendererHooks.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/server/ReactPartialRendererHooks.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -14,7 +14,6 @@ import type {\\n   MutableSourceGetSnapshotFn,\\n   MutableSourceSubscribeFn,\\n   ReactContext,\\n-  ReactEventResponderListener,\\n } from \'shared/ReactTypes\';\\n import type {SuspenseConfig} from \'react-reconciler/src/ReactFiberSuspenseConfig\';\\n import type PartialRenderer from \'./ReactPartialRenderer\';\\n@@ -457,13 +456,6 @@ export function useCallback<T>(\\n   return useMemo(() => callback, deps);\\n }\\n \\n-function useResponder(responder, props): ReactEventResponderListener<any, any> {\\n-  return {\\n-    props,\\n-    responder,\\n-  };\\n-}\\n-\\n // TODO Decide on how to implement this hook for server rendering.\\n // If a mutation occurs during render, consider triggering a Suspense boundary\\n // and falling back to client rendering.\\n@@ -521,7 +513,6 @@ export const Dispatcher: DispatcherType = {\\n   useEffect: noop,\\n   // Debugging effect\\n   useDebugValue: noop,\\n-  useResponder,\\n   useDeferredValue,\\n   useTransition,\\n   useOpaqueIdentifier,"},{"sha":"2d9a7914f91e5891356391d96e582492c0658aa8","filename":"packages/react-dom/src/shared/DOMProperty.js","status":"modified","additions":1,"deletions":7,"changes":8,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/DOMProperty.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/DOMProperty.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/shared/DOMProperty.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -7,10 +7,7 @@\\n  * @flow\\n  */\\n \\n-import {\\n-  enableDeprecatedFlareAPI,\\n-  enableFilterEmptyStringAttributesDOM,\\n-} from \'shared/ReactFeatureFlags\';\\n+import {enableFilterEmptyStringAttributesDOM} from \'shared/ReactFeatureFlags\';\\n \\n type PropertyType = 0 | 1 | 2 | 3 | 4 | 5 | 6;\\n \\n@@ -252,9 +249,6 @@ const reservedProps = [\\n   \'suppressHydrationWarning\',\\n   \'style\',\\n ];\\n-if (enableDeprecatedFlareAPI) {\\n-  reservedProps.push(\'DEPRECATED_flareListeners\');\\n-}\\n \\n reservedProps.forEach(name => {\\n   properties[name] = new PropertyInfoRecord("},{"sha":"62c77094964e06f9b985d5b2e54984585db9ca90","filename":"packages/react-dom/src/shared/ReactControlledValuePropTypes.js","status":"modified","additions":2,"deletions":6,"changes":8,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/ReactControlledValuePropTypes.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/ReactControlledValuePropTypes.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/shared/ReactControlledValuePropTypes.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -5,8 +5,6 @@\\n  * LICENSE file in the root directory of this source tree.\\n  */\\n \\n-import {enableDeprecatedFlareAPI} from \'shared/ReactFeatureFlags\';\\n-\\n const hasReadOnlyValue = {\\n   button: true,\\n   checkbox: true,\\n@@ -29,8 +27,7 @@ export function checkControlledValueProps(\\n         props.onInput ||\\n         props.readOnly ||\\n         props.disabled ||\\n-        props.value == null ||\\n-        (enableDeprecatedFlareAPI && props.DEPRECATED_flareListeners)\\n+        props.value == null\\n       )\\n     ) {\\n       console.error(\\n@@ -46,8 +43,7 @@ export function checkControlledValueProps(\\n         props.onChange ||\\n         props.readOnly ||\\n         props.disabled ||\\n-        props.checked == null ||\\n-        (enableDeprecatedFlareAPI && props.DEPRECATED_flareListeners)\\n+        props.checked == null\\n       )\\n     ) {\\n       console.error("},{"sha":"774e776b1ad84140feb79b491c1a8b95b67ca5d6","filename":"packages/react-dom/src/shared/ReactDOMTypes.js","status":"modified","additions":0,"deletions":60,"changes":60,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/ReactDOMTypes.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-dom/src/shared/ReactDOMTypes.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-dom/src/shared/ReactDOMTypes.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -9,75 +9,15 @@\\n \\n import type {\\n   ReactFundamentalComponentInstance,\\n-  ReactEventResponder,\\n-  ReactEventResponderInstance,\\n-  EventPriority,\\n   ReactScopeInstance,\\n } from \'shared/ReactTypes\';\\n import type {DOMEventName} from \'../events/DOMEventNames\';\\n \\n-type AnyNativeEvent = Event | KeyboardEvent | MouseEvent | Touch;\\n-\\n-export type PointerType =\\n-  | \'\'\\n-  | \'mouse\'\\n-  | \'keyboard\'\\n-  | \'pen\'\\n-  | \'touch\'\\n-  | \'trackpad\';\\n-\\n-export type ReactDOMResponderEvent = {\\n-  nativeEvent: AnyNativeEvent,\\n-  passive: boolean,\\n-  pointerType: PointerType,\\n-  target: Element | Document,\\n-  type: string,\\n-  ...\\n-};\\n-\\n-export type ReactDOMEventResponder = ReactEventResponder<\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n->;\\n-\\n-export type ReactDOMEventResponderInstance = ReactEventResponderInstance<\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n->;\\n-\\n export type ReactDOMFundamentalComponentInstance = ReactFundamentalComponentInstance<\\n   any,\\n   any,\\n >;\\n \\n-export type ReactDOMResponderContext = {\\n-  dispatchEvent: (\\n-    eventValue: any,\\n-    listener: (any) => void,\\n-    eventPriority: EventPriority,\\n-  ) => void,\\n-  isTargetWithinNode: (\\n-    childTarget: Element | Document,\\n-    parentTarget: Element | Document,\\n-  ) => boolean,\\n-  isTargetWithinResponder: (null | Element | Document) => boolean,\\n-  isTargetWithinResponderScope: (null | Element | Document) => boolean,\\n-  addRootEventTypes: (rootEventTypes: Array<string>) => void,\\n-  removeRootEventTypes: (rootEventTypes: Array<string>) => void,\\n-  getActiveDocument(): Document,\\n-  objectAssign: Function,\\n-  getTimeStamp: () => number,\\n-  isTargetWithinHostComponent: (\\n-    target: Element | Document,\\n-    elementType: string,\\n-  ) => boolean,\\n-  continuePropagation(): void,\\n-  // Used for controller components\\n-  enqueueStateRestore(Element | Document): void,\\n-  getResponderNode(): Element | null,\\n-  ...\\n-};\\n-\\n export type ReactDOMEventHandle = (\\n   target: EventTarget | ReactScopeInstance,\\n   callback: (SyntheticEvent<EventTarget>) => void,"},{"sha":"6f49251a3f0b6ad3132ab19253d6e7490ba884ca","filename":"packages/react-interactions/events/README.md","status":"removed","additions":0,"deletions":105,"changes":105,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/README.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/README.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/README.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,105 +0,0 @@\\n-# `react-interactions/events`\\n-\\n-*This package is experimental. It is intended for use with the experimental React\\n-events API that is not available in open source builds.*\\n-\\n-Event Responders attach to a host node. They listen to native browser events\\n-dispatched on the host node of their child and transform those events into\\n-high-level events for applications.\\n-\\n-The core API is documented below. Documentation for individual Event Responders\\n-can be found [here](./docs).\\n-\\n-## Event Responder Interface\\n-\\n-Note: React Responders require the internal React flag `enableDeprecatedFlareAPI`.\\n-\\n-An Event Responder Interface is defined using an object. Each responder can define DOM\\n-events to listen to, handle the synthetic responder events, dispatch custom\\n-events, and implement a state machine.\\n-\\n-```js\\n-// types\\n-type ResponderEventType = string;\\n-\\n-type ResponderEvent = {|\\n-  nativeEvent: any,\\n-  target: Element | Document,\\n-  pointerType: string,\\n-  type: string,\\n-  passive: boolean,\\n-|};\\n-\\n-type CustomEvent = {\\n-  type: string,\\n-  target: Element,\\n-  ...\\n-}\\n-```\\n-\\n-### getInitialState?: (props: null | Object) => Object\\n-\\n-The initial state of that the Event Responder is created with.\\n-\\n-### onEvent?: (event: ResponderEvent, context: ResponderContext, props, state)\\n-\\n-Called during the bubble phase of the `targetEventTypes` dispatched on DOM\\n-elements within the Event Responder.\\n-\\n-### onMount?: (context: ResponderContext, props, state)\\n-\\n-Called after an Event Responder in mounted.\\n-\\n-### onRootEvent?: (event: ResponderEvent, context: ResponderContext, props, state)\\n-\\n-Called when any of the `rootEventTypes` are dispatched on the root of the app.\\n-\\n-### onUnmount?: (context: ResponderContext, props, state)\\n-\\n-Called before an Event Responder in unmounted.\\n-\\n-### rootEventTypes?: Array<ResponderEventType>\\n-\\n-Defines the DOM events to listen to on the root of the app.\\n-\\n-### targetEventTypes?: Array<ResponderEventType>\\n-\\n-Defines the DOM events to listen to within the Event Responder subtree.\\n-\\n-## ResponderContext\\n-\\n-The Event Responder Context is exposed via the `context` argument for certain methods\\n-on the `EventResponder` object.\\n-\\n-### addRootEventTypes(eventTypes: Array<ResponderEventType>)\\n-\\n-This can be used to dynamically listen to events on the root of the app only\\n-when it is necessary to do so.\\n-\\n-### dispatchEvent(propName: string, event: CustomEvent, { discrete: boolean })\\n-\\n-Dispatches a custom synthetic event. The `type` and `target` are required\\n-fields if the event is an object, but any other fields can be defined on the `event` that will be passed\\n-to the `listener`. You can also pass a value that is not an object, but a `boolean`. For example:\\n-\\n-```js\\n-const event = { type: \'press\', target, pointerType, x, y };\\n-context.dispatchEvent(\'onPress\', event, DiscreteEvent);\\n-```\\n-\\n-### isTargetWithinNode(target: Element, element: Element): boolean\\n-\\n-Returns `true` if `target` is a child of `element`.\\n-\\n-### isTargetWithinResponder(target: Element): boolean\\n-\\n-Returns `true` is the target element is within the subtree of the Event Responder.\\n-\\n-### isTargetWithinResponderScope(target: Element): boolean\\n-\\n-Returns `true` is the target element is within the current Event Responder\'s scope. If the target element\\n-is within the scope of the same responder, but owned by another Event Responder instance, this will return `false`.\\n-\\n-### removeRootEventTypes(eventTypes: Array<ResponderEventType>)\\n-\\n-Remove the root event types added with `addRootEventTypes`."},{"sha":"d5a0953841351724c6dbbd671786f7a4a1099819","filename":"packages/react-interactions/events/context-menu.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/context-menu.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/context-menu.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/context-menu.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/ContextMenu\';"},{"sha":"4a65690ca8fbe1d15d72f159533f3c913edf1d0e","filename":"packages/react-interactions/events/deprecated-focus.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/deprecated-focus.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/deprecated-focus.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/deprecated-focus.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/DeprecatedFocus\';"},{"sha":"99e8f1a14099beb17d59331c329d17fa980b31b9","filename":"packages/react-interactions/events/docs/ContextMenu.md","status":"removed","additions":0,"deletions":54,"changes":54,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/ContextMenu.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/ContextMenu.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/docs/ContextMenu.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,54 +0,0 @@\\n-# ContextMenu\\n-\\n-The `useContextMenu` hooks responds to context-menu events.\\n-\\n-```js\\n-// Example\\n-const Button = (props) => {\\n-  const contextmenu = useContextMenu({\\n-    disabled,\\n-    onContextMenu,\\n-    preventDefault\\n-  });\\n-\\n-  return (\\n-    <div DEPRECATED_flareListeners={contextmenu}>\\n-      {props.children}\\n-    </div>\\n-  );\\n-};\\n-```\\n-\\n-## Types\\n-\\n-```js\\n-type ContextMenuEvent = {\\n-  altKey: boolean,\\n-  buttons: 0 | 1 | 2,\\n-  ctrlKey: boolean,\\n-  metaKey: boolean,\\n-  pageX: number,\\n-  pageY: number,\\n-  pointerType: PointerType,\\n-  shiftKey: boolean,\\n-  target: Element,\\n-  timeStamp: number,\\n-  type: \'contextmenu\',\\n-  x: number,\\n-  y: number,\\n-}\\n-```\\n-\\n-## Props\\n-\\n-### disabled: boolean = false\\n-\\n-Disables the responder.\\n-\\n-### onContextMenu: (e: ContextMenuEvent) => void\\n-\\n-Called when the user performs a gesture to display a context menu.\\n-\\n-### preventDefault: boolean = true\\n-\\n-Prevents the native behavior (i.e., context menu)."},{"sha":"4d9f7e8b1cce83d2c9098d8aebcdb75809e483cd","filename":"packages/react-interactions/events/docs/Focus.md","status":"removed","additions":0,"deletions":64,"changes":64,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Focus.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Focus.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/docs/Focus.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,64 +0,0 @@\\n-# Focus\\n-\\n-The `useFocus` hook responds to focus and blur events on its child. Focus events\\n-are dispatched for all input types, with the exception of `onFocusVisibleChange`\\n-which is only dispatched when focusing with a keyboard.\\n-\\n-Focus events do not propagate between `useFocus` event responders.\\n-\\n-```js\\n-// Example\\n-const Button = (props) => {\\n-  const [ isFocusVisible, setFocusVisible ] = useState(false);\\n-  const focus = useFocus({\\n-    onBlur={props.onBlur}\\n-    onFocus={props.onFocus}\\n-    onFocusVisibleChange={setFocusVisible}\\n-  });\\n-\\n-  return (\\n-    <button\\n-      children={props.children}\\n-      DEPRECATED_flareListeners={focus}\\n-      style={{\\n-        ...(isFocusVisible && focusVisibleStyles)\\n-      }}\\n-    >\\n-  );\\n-};\\n-```\\n-\\n-## Types\\n-\\n-```js\\n-type FocusEvent = {\\n-  target: Element,\\n-  pointerType: \'mouse\' | \'touch\' | \'pen\' | \'keyboard\',\\n-  timeStamp: number,\\n-  type: \'blur\' | \'focus\' | \'focuschange\' | \'focusvisiblechange\'\\n-}\\n-```\\n-\\n-## Props\\n-\\n-### disabled: boolean = false\\n-\\n-Disables the responder.\\n-\\n-### onBlur: (e: FocusEvent) => void\\n-\\n-Called when the element loses focus.\\n-\\n-### onFocus: (e: FocusEvent) => void\\n-\\n-Called when the element gains focus.\\n-\\n-### onFocusChange: boolean => void\\n-\\n-Called when the element changes focus state (i.e., after `onBlur` and\\n-`onFocus`).\\n-\\n-### onFocusVisibleChange: boolean => void\\n-\\n-Called when the element receives or loses focus following keyboard navigation.\\n-This can be used to display focus styles only for keyboard interactions."},{"sha":"1901db8568c0a4d0c63b9b712205d861f93ececb","filename":"packages/react-interactions/events/docs/FocusWithin.md","status":"removed","additions":0,"deletions":48,"changes":48,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/FocusWithin.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/FocusWithin.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/docs/FocusWithin.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,48 +0,0 @@\\n-# FocusWithin\\n-\\n-The `useFocusWithin` hooks responds to focus and blur events on its child. Focus events\\n-are dispatched for all input types, with the exception of `onFocusVisibleChange`\\n-which is only dispatched when focusing with a keyboard.\\n-\\n-Focus events do not propagate between `useFocusWithin` event responders.\\n-\\n-```js\\n-// Example\\n-const Button = (props) => {\\n-  const [ isFocusWithin, updateFocusWithin ] = useState(false);\\n-  const [ isFocusWithinVisible, updateFocusWithinVisible ] = useState(false);\\n-  const focusWithin = useFocusWithin({\\n-    onFocusWithinChange={updateFocusWithin}\\n-    onFocusWithinVisibleChange={updateFocusWithinVisible}\\n-  });\\n-\\n-  return (\\n-    <button\\n-      children={props.children}\\n-      DEPRECATED_flareListeners={focusWithin}\\n-      style={{\\n-        ...(isFocusWithin && focusWithinStyles),\\n-        ...(isFocusWithinVisible && focusWithinVisibleStyles)\\n-      }}\\n-    >\\n-  );\\n-};\\n-```\\n-\\n-## Props\\n-\\n-### disabled: boolean = false\\n-\\n-Disables the responder.\\n-\\n-### onFocusWithinChange: boolean => void\\n-\\n-Called once the element or a descendant receives focus, and once focus moves\\n-outside of the element.\\n-\\n-### onFocusWithinVisibleChange: boolean => void\\n-\\n-Called once the element or a descendant is focused following keyboard\\n-navigation, and once focus moves outside of the element. This can be used to\\n-display focus styles only when the keyboard is being used to focus within the\\n-element\'s subtree."},{"sha":"a82586c769b9f6365eb80355752399783c169262","filename":"packages/react-interactions/events/docs/Hover.md","status":"removed","additions":0,"deletions":75,"changes":75,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Hover.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Hover.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/docs/Hover.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,75 +0,0 @@\\n-# Hover\\n-\\n-The `useHover` hook responds to hover events on the element it wraps. Hover\\n-events are only dispatched for `mouse` and `pen` pointer types. Hover begins\\n-when the pointer enters the element\'s bounds and ends when the pointer leaves.\\n-\\n-Hover events do not propagate between `useHover` event responders.\\n-\\n-```js\\n-// Example\\n-const Link = (props) => (\\n-  const [ isHovered, setHovered ] = useState(false);\\n-  const hover = useHover({\\n-    onHoverChange: setHovered\\n-  });\\n-\\n-  return (\\n-    <a\\n-      {...props}\\n-      href={props.href}\\n-      DEPRECATED_flareListeners={hover}\\n-      style={{\\n-        ...props.style,\\n-        textDecoration: isHovered ? \'underline\': \'none\'\\n-      }}\\n-    />\\n-  );\\n-);\\n-```\\n-\\n-## Types\\n-\\n-```js\\n-type HoverEventType = \'hoverstart\' | \'hoverend\' | \'hoverchange\' | \'hovermove\';\\n-\\n-type HoverEvent = {|\\n-  clientX: number,\\n-  clientY: number,\\n-  pageX: number,\\n-  pageY: number,\\n-  pointerType: PointerType,\\n-  target: Element,\\n-  timeStamp: number,\\n-  type: HoverEventType,\\n-  x: number,\\n-  y: number,\\n-|};\\n-```\\n-\\n-## Props\\n-\\n-### disabled: boolean\\n-\\n-Disables the responder.\\n-\\n-### onHoverChange: boolean => void\\n-\\n-Called when the element changes hover state (i.e., after `onHoverStart` and\\n-`onHoverEnd`).\\n-\\n-### onHoverEnd: (e: HoverEvent) => void\\n-\\n-Called once the element is no longer hovered.\\n-\\n-### onHoverMove: (e: HoverEvent) => void\\n-\\n-Called when the pointer moves within the hit bounds of the element.\\n-\\n-### onHoverStart: (e: HoverEvent) => void\\n-\\n-Called once the element is hovered.\\n-\\n-### preventDefault: boolean = true\\n-\\n-Whether to `preventDefault()` native events."},{"sha":"63aaa14ecbc3825db86f477e2c2f7bedeadb5dcf","filename":"packages/react-interactions/events/docs/Press.md","status":"removed","additions":0,"deletions":121,"changes":121,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Press.md","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/docs/Press.md","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/docs/Press.md?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,121 +0,0 @@\\n-# Press\\n-\\n-The `usePress` hook responds to press events on the element it wraps. Press\\n-events are dispatched for `mouse`, `pen`, `touch`, `trackpad`, and `keyboard`\\n-pointer types. Press events are only dispatched for keyboards when pressing the\\n-Enter or Spacebar keys. If `onPress` is not called, this signifies that the\\n-press ended outside of the element hit bounds (i.e., the user aborted the\\n-press).\\n-\\n-Press events do not propagate between `usePress` event responders.\\n-\\n-```js\\n-// Example\\n-const Button = (props) => (\\n-  const [ isPressed, setPressed ] = useState(false);\\n-  const press = usePress({\\n-    onPress={props.onPress}\\n-    onPressChange={setPressed}\\n-  });\\n-\\n-  return (\\n-    <div\\n-      {...props}\\n-      DEPRECATED_flareListeners={press}\\n-      role=\\"button\\"\\n-      tabIndex={0}\\n-      style={\\n-        ...buttonStyles,\\n-        ...(isPressed && pressedStyles)\\n-      }}\\n-    />\\n-  );\\n-);\\n-```\\n-\\n-## Types\\n-\\n-```js\\n-type PressEvent = {\\n-  altKey: boolean,\\n-  buttons: 0 | 1 | 4,\\n-  ctrlKey: boolean,\\n-  defaultPrevented: boolean,\\n-  metaKey: boolean,\\n-  pageX: number,\\n-  pageY: number,\\n-  pointerType:\\n-    | \'mouse\'\\n-    | \'touch\'\\n-    | \'pen\'\\n-    | \'trackpad\'\\n-    | \'keyboard\',\\n-  screenX: number,\\n-  screenY: number,\\n-  shiftKey: boolean,\\n-  target: Element,\\n-  timeStamp: number,\\n-  type:\\n-    | \'press\'\\n-    | \'pressstart\'\\n-    | \'pressend\'\\n-    | \'presschange\'\\n-    | \'pressmove\'\\n-    | \'contextmenu\',\\n-  x: number,\\n-  y: number\\n-}\\n-\\n-type PressOffset = {\\n-  top?: number,\\n-  right?: number,\\n-  bottom?: number,\\n-  right?: number\\n-};\\n-```\\n-\\n-## Props\\n-\\n-### disabled: boolean = false\\n-\\n-Disables the responder.\\n-\\n-### onPress: (e: PressEvent) => void\\n-\\n-Called immediately after a press is released, unless the press is released\\n-outside the hit bounds of the element (accounting for `pressRetentionOffset`.\\n-\\n-### onPressChange: boolean => void\\n-\\n-Called when the element changes press state (i.e., after `onPressStart` and\\n-`onPressEnd`).\\n-\\n-### onPressEnd: (e: PressEvent) => void\\n-\\n-Called once the element is no longer pressed (because the press was released,\\n-cancelled, or moved beyond the hit bounds).\\n-\\n-### onPressMove: (e: PressEvent) => void\\n-\\n-Called when a press moves within the hit bounds of the element. Never called for\\n-keyboard-initiated press events.  \\n-\\n-### onPressStart: (e: PressEvent) => void\\n-\\n-Called once the element is pressed down.\\n-\\n-### pressRetentionOffset: PressOffset\\n-\\n-Defines how far the pointer (while held down) may move outside the bounds of the\\n-element before it is deactivated. Once deactivated, the pointer (still held\\n-down) can be moved back within the bounds of the element to reactivate it.\\n-Ensure you pass in a constant to reduce memory allocations. Default is `20` for\\n-each offset.\\n-\\n-### preventDefault: boolean = true\\n-\\n-Whether to `preventDefault()` native events. Native behavior is prevented by\\n-default. If an anchor is the child of `Press`, internal and external navigation\\n-should be performed in `onPress`. To rely on native behavior instead, set\\n-`preventDefault` to `false`, but be aware that native behavior will take place\\n-immediately after interaction."},{"sha":"f630f2b605d762d08a29bf9f69f47c3719756ffb","filename":"packages/react-interactions/events/hover.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/hover.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/hover.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/hover.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/Hover\';"},{"sha":"80ce61ef45a85da57a458ee7c3fb1aa38bd9c743","filename":"packages/react-interactions/events/input.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/input.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/input.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/input.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/Input\';"},{"sha":"81398ac3753ba75ed8ecbcc4bb71448f31f66138","filename":"packages/react-interactions/events/press-legacy.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/press-legacy.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/press-legacy.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/press-legacy.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/PressLegacy\';"},{"sha":"e62446d7df52a7dc5f7bb1e74a790619b83b52a9","filename":"packages/react-interactions/events/src/dom/ContextMenu.js","status":"removed","additions":0,"deletions":126,"changes":126,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/ContextMenu.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/ContextMenu.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/ContextMenu.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,126 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n-  PointerType,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-import type {ReactEventResponderListener} from \'shared/ReactTypes\';\\n-\\n-import * as React from \'react\';\\n-import {DiscreteEvent} from \'shared/ReactTypes\';\\n-\\n-type ContextMenuProps = {|\\n-  disabled: boolean,\\n-  onContextMenu: (e: ContextMenuEvent) => void,\\n-  preventDefault: boolean,\\n-|};\\n-\\n-type ContextMenuState = {pointerType: PointerType, ...};\\n-\\n-type ContextMenuEvent = {|\\n-  altKey: boolean,\\n-  buttons: 0 | 1 | 2,\\n-  ctrlKey: boolean,\\n-  metaKey: boolean,\\n-  pageX: null | number,\\n-  pageY: null | number,\\n-  pointerType: PointerType,\\n-  shiftKey: boolean,\\n-  target: Element | Document,\\n-  timeStamp: number,\\n-  type: \'contextmenu\',\\n-  x: null | number,\\n-  y: null | number,\\n-|};\\n-\\n-const hasPointerEvents =\\n-  typeof window !== \'undefined\' && window.PointerEvent != null;\\n-\\n-function dispatchContextMenuEvent(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: ContextMenuProps,\\n-  state: ContextMenuState,\\n-): void {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  const target = event.target;\\n-  const timeStamp = context.getTimeStamp();\\n-  const pointerType = state.pointerType;\\n-\\n-  const gestureState = {\\n-    altKey: nativeEvent.altKey,\\n-    buttons: nativeEvent.buttons != null ? nativeEvent.buttons : 0,\\n-    ctrlKey: nativeEvent.ctrlKey,\\n-    metaKey: nativeEvent.metaKey,\\n-    pageX: nativeEvent.pageX,\\n-    pageY: nativeEvent.pageY,\\n-    pointerType,\\n-    shiftKey: nativeEvent.shiftKey,\\n-    target,\\n-    timeStamp,\\n-    type: \'contextmenu\',\\n-    x: nativeEvent.clientX,\\n-    y: nativeEvent.clientY,\\n-  };\\n-\\n-  context.dispatchEvent(gestureState, props.onContextMenu, DiscreteEvent);\\n-}\\n-\\n-const contextMenuImpl = {\\n-  targetEventTypes: hasPointerEvents\\n-    ? [\'contextmenu_active\', \'pointerdown\']\\n-    : [\'contextmenu_active\', \'touchstart\', \'mousedown\'],\\n-  getInitialState(): ContextMenuState {\\n-    return {\\n-      pointerType: \'\',\\n-    };\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: ContextMenuProps,\\n-    state: ContextMenuState,\\n-  ): void {\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const pointerType = event.pointerType;\\n-    const type = event.type;\\n-\\n-    if (props.disabled) {\\n-      return;\\n-    }\\n-\\n-    if (type === \'contextmenu\') {\\n-      const onContextMenu = props.onContextMenu;\\n-      const preventDefault = props.preventDefault;\\n-      if (preventDefault !== false && !nativeEvent.defaultPrevented) {\\n-        nativeEvent.preventDefault();\\n-      }\\n-      if (typeof onContextMenu === \'function\') {\\n-        dispatchContextMenuEvent(event, context, props, state);\\n-      }\\n-      state.pointerType = \'\';\\n-    } else {\\n-      state.pointerType = pointerType;\\n-    }\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const ContextMenuResponder = React.DEPRECATED_createResponder(\\n-  \'ContextMenu\',\\n-  contextMenuImpl,\\n-);\\n-\\n-export function useContextMenu(\\n-  props: ContextMenuProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(ContextMenuResponder, props);\\n-}"},{"sha":"bbc35dd1348d7ec4e787be96307c8b92c4b705e5","filename":"packages/react-interactions/events/src/dom/DeprecatedFocus.js","status":"removed","additions":0,"deletions":718,"changes":718,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/DeprecatedFocus.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/DeprecatedFocus.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/DeprecatedFocus.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,718 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n-  PointerType,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-import type {ReactEventResponderListener} from \'shared/ReactTypes\';\\n-\\n-import * as React from \'react\';\\n-import {DiscreteEvent} from \'shared/ReactTypes\';\\n-\\n-/**\\n- * Types\\n- */\\n-\\n-type FocusEvent = {|\\n-  relatedTarget: null | Element | Document,\\n-  target: Element | Document,\\n-  type: FocusEventType | FocusWithinEventType,\\n-  pointerType: PointerType,\\n-  timeStamp: number,\\n-  continuePropagation: () => void,\\n-|};\\n-\\n-type FocusState = {\\n-  detachedTarget: null | Element | Document,\\n-  focusTarget: null | Element | Document,\\n-  isFocused: boolean,\\n-  isFocusVisible: boolean,\\n-  pointerType: PointerType,\\n-  addedRootEvents?: boolean,\\n-};\\n-\\n-type FocusProps = {\\n-  disabled: boolean,\\n-  onBlur: (e: FocusEvent) => void,\\n-  onFocus: (e: FocusEvent) => void,\\n-  onFocusChange: boolean => void,\\n-  onFocusVisibleChange: boolean => void,\\n-  ...\\n-};\\n-\\n-type FocusEventType = \'focus\' | \'blur\' | \'focuschange\' | \'focusvisiblechange\';\\n-\\n-type FocusWithinProps = {\\n-  disabled?: boolean,\\n-  onFocusWithin?: (e: FocusEvent) => void,\\n-  onAfterBlurWithin?: (e: FocusEvent) => void,\\n-  onBeforeBlurWithin?: (e: FocusEvent) => void,\\n-  onBlurWithin?: (e: FocusEvent) => void,\\n-  onFocusWithinChange?: boolean => void,\\n-  onFocusWithinVisibleChange?: boolean => void,\\n-  ...\\n-};\\n-\\n-type FocusWithinEventType =\\n-  | \'focuswithinvisiblechange\'\\n-  | \'focuswithinchange\'\\n-  | \'blurwithin\'\\n-  | \'focuswithin\'\\n-  | \'beforeblurwithin\'\\n-  | \'afterblurwithin\';\\n-\\n-/**\\n- * Shared between Focus and FocusWithin\\n- */\\n-\\n-let isGlobalFocusVisible = true;\\n-let hasTrackedGlobalFocusVisible = false;\\n-let globalFocusVisiblePointerType = \'\';\\n-let isEmulatingMouseEvents = false;\\n-\\n-const isMac =\\n-  typeof window !== \'undefined\' && window.navigator != null\\n-    ? /^Mac/.test(window.navigator.platform)\\n-    : false;\\n-\\n-let passiveBrowserEventsSupported = false;\\n-\\n-const canUseDOM: boolean = !!(\\n-  typeof window !== \'undefined\' &&\\n-  typeof window.document !== \'undefined\' &&\\n-  typeof window.document.createElement !== \'undefined\'\\n-);\\n-\\n-// Check if browser support events with passive listeners\\n-// https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support\\n-if (canUseDOM) {\\n-  try {\\n-    const options = {};\\n-    // $FlowFixMe: Ignore Flow complaining about needing a value\\n-    Object.defineProperty(options, \'passive\', {\\n-      get: function() {\\n-        passiveBrowserEventsSupported = true;\\n-      },\\n-    });\\n-    window.addEventListener(\'test\', options, options);\\n-    window.removeEventListener(\'test\', options, options);\\n-  } catch (e) {\\n-    passiveBrowserEventsSupported = false;\\n-  }\\n-}\\n-\\n-const hasPointerEvents =\\n-  typeof window !== \'undefined\' && window.PointerEvent != null;\\n-\\n-const focusVisibleEvents = hasPointerEvents\\n-  ? [\'keydown\', \'keyup\', \'pointermove\', \'pointerdown\', \'pointerup\']\\n-  : [\'keydown\', \'keyup\', \'mousedown\', \'touchmove\', \'touchstart\', \'touchend\'];\\n-\\n-const targetEventTypes = [\'focus\', \'blur\', \'beforeblur\', ...focusVisibleEvents];\\n-\\n-const rootEventTypes = [\'afterblur\'];\\n-\\n-function addWindowEventListener(types, callback, options) {\\n-  types.forEach(type => {\\n-    window.addEventListener(type, callback, options);\\n-  });\\n-}\\n-\\n-function trackGlobalFocusVisible() {\\n-  if (!hasTrackedGlobalFocusVisible) {\\n-    hasTrackedGlobalFocusVisible = true;\\n-    addWindowEventListener(\\n-      focusVisibleEvents,\\n-      handleGlobalFocusVisibleEvent,\\n-      passiveBrowserEventsSupported ? {capture: true, passive: true} : true,\\n-    );\\n-  }\\n-}\\n-\\n-function handleGlobalFocusVisibleEvent(\\n-  nativeEvent: MouseEvent | TouchEvent | KeyboardEvent,\\n-): void {\\n-  const {type} = nativeEvent;\\n-\\n-  switch (type) {\\n-    case \'pointermove\':\\n-    case \'pointerdown\':\\n-    case \'pointerup\': {\\n-      isGlobalFocusVisible = false;\\n-      globalFocusVisiblePointerType = (nativeEvent: any).pointerType;\\n-      break;\\n-    }\\n-\\n-    case \'keydown\':\\n-    case \'keyup\': {\\n-      const {metaKey, altKey, ctrlKey} = nativeEvent;\\n-      const validKey = !(metaKey || (!isMac && altKey) || ctrlKey);\\n-\\n-      if (validKey) {\\n-        globalFocusVisiblePointerType = \'keyboard\';\\n-        isGlobalFocusVisible = true;\\n-      }\\n-      break;\\n-    }\\n-\\n-    // fallbacks for no PointerEvent support\\n-    case \'touchmove\':\\n-    case \'touchstart\':\\n-    case \'touchend\': {\\n-      isEmulatingMouseEvents = true;\\n-      isGlobalFocusVisible = false;\\n-      globalFocusVisiblePointerType = \'touch\';\\n-      break;\\n-    }\\n-    case \'mousedown\': {\\n-      if (!isEmulatingMouseEvents) {\\n-        isGlobalFocusVisible = false;\\n-        globalFocusVisiblePointerType = \'mouse\';\\n-      } else {\\n-        isEmulatingMouseEvents = false;\\n-      }\\n-      break;\\n-    }\\n-  }\\n-}\\n-\\n-function isFunction(obj): boolean {\\n-  return typeof obj === \'function\';\\n-}\\n-\\n-function createFocusEvent(\\n-  context: ReactDOMResponderContext,\\n-  type: FocusEventType | FocusWithinEventType,\\n-  target: Element | Document,\\n-  pointerType: PointerType,\\n-  relatedTarget: null | Element | Document,\\n-): FocusEvent {\\n-  return {\\n-    relatedTarget,\\n-    target,\\n-    type,\\n-    pointerType,\\n-    timeStamp: context.getTimeStamp(),\\n-    // We don\'t use stopPropagation, as the default behavior\\n-    // is to not propagate. Plus, there might be confusion\\n-    // using stopPropagation as we don\'t actually stop\\n-    // native propagation from working, but instead only\\n-    // allow propagation to the others keyboard responders.\\n-    continuePropagation() {\\n-      context.continuePropagation();\\n-    },\\n-  };\\n-}\\n-\\n-function handleFocusVisibleTargetEvent(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  state: FocusState,\\n-  callback: boolean => void,\\n-): void {\\n-  const {type} = event;\\n-  isGlobalFocusVisible = false;\\n-\\n-  // Focus should stop being visible if a pointer is used on the element\\n-  // after it was focused using a keyboard.\\n-  const focusTarget = state.focusTarget;\\n-  if (\\n-    focusTarget !== null &&\\n-    (type === \'mousedown\' || type === \'touchstart\' || type === \'pointerdown\')\\n-  ) {\\n-    callback(false);\\n-  }\\n-}\\n-\\n-function handleFocusVisibleTargetEvents(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  state: FocusState,\\n-  callback: boolean => void,\\n-): void {\\n-  const {type} = event;\\n-  state.pointerType = globalFocusVisiblePointerType;\\n-\\n-  switch (type) {\\n-    case \'pointermove\':\\n-    case \'pointerdown\':\\n-    case \'pointerup\': {\\n-      handleFocusVisibleTargetEvent(event, context, state, callback);\\n-      break;\\n-    }\\n-\\n-    case \'keydown\':\\n-    case \'keyup\': {\\n-      const nativeEvent = event.nativeEvent;\\n-      const focusTarget = state.focusTarget;\\n-      const {metaKey, altKey, ctrlKey} = (nativeEvent: any);\\n-      const validKey = !(metaKey || (!isMac && altKey) || ctrlKey);\\n-\\n-      if (validKey) {\\n-        if (focusTarget !== null) {\\n-          callback(true);\\n-        }\\n-      }\\n-      break;\\n-    }\\n-\\n-    // fallbacks for no PointerEvent support\\n-    case \'touchmove\':\\n-    case \'touchstart\':\\n-    case \'touchend\': {\\n-      handleFocusVisibleTargetEvent(event, context, state, callback);\\n-      break;\\n-    }\\n-    case \'mousedown\': {\\n-      if (!isEmulatingMouseEvents) {\\n-        handleFocusVisibleTargetEvent(event, context, state, callback);\\n-      }\\n-      break;\\n-    }\\n-  }\\n-}\\n-\\n-/**\\n- * Focus Responder\\n- */\\n-\\n-function dispatchFocusEvents(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusProps,\\n-  state: FocusState,\\n-) {\\n-  const pointerType = state.pointerType;\\n-  const target = ((state.focusTarget: any): Element | Document);\\n-  const onFocus = props.onFocus;\\n-  if (isFunction(onFocus)) {\\n-    const syntheticEvent = createFocusEvent(\\n-      context,\\n-      \'focus\',\\n-      target,\\n-      pointerType,\\n-      null,\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onFocus, DiscreteEvent);\\n-  }\\n-  dispatchFocusChange(context, props, true);\\n-  if (state.isFocusVisible) {\\n-    dispatchFocusVisibleChangeEvent(context, props, true);\\n-  }\\n-}\\n-\\n-function dispatchBlurEvents(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusProps,\\n-  state: FocusState,\\n-) {\\n-  const pointerType = state.pointerType;\\n-  const target = ((state.focusTarget: any): Element | Document);\\n-  const onBlur = props.onBlur;\\n-  if (isFunction(onBlur)) {\\n-    const syntheticEvent = createFocusEvent(\\n-      context,\\n-      \'blur\',\\n-      target,\\n-      pointerType,\\n-      null,\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onBlur, DiscreteEvent);\\n-  }\\n-  dispatchFocusChange(context, props, false);\\n-  if (state.isFocusVisible) {\\n-    dispatchFocusVisibleChangeEvent(context, props, false);\\n-  }\\n-}\\n-\\n-function dispatchFocusWithinEvents(\\n-  context: ReactDOMResponderContext,\\n-  event: ReactDOMResponderEvent,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-) {\\n-  const pointerType = state.pointerType;\\n-  const target = ((state.focusTarget: any): Element | Document) || event.target;\\n-  const onFocusWithin = (props.onFocusWithin: any);\\n-  if (isFunction(onFocusWithin)) {\\n-    const syntheticEvent = createFocusEvent(\\n-      context,\\n-      \'focuswithin\',\\n-      target,\\n-      pointerType,\\n-      null,\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onFocusWithin, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchBlurWithinEvents(\\n-  context: ReactDOMResponderContext,\\n-  event: ReactDOMResponderEvent,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-) {\\n-  const pointerType = state.pointerType;\\n-  const target = ((state.focusTarget: any): Element | Document) || event.target;\\n-  const onBlurWithin = (props.onBlurWithin: any);\\n-  if (isFunction(onBlurWithin)) {\\n-    const syntheticEvent = createFocusEvent(\\n-      context,\\n-      \'blurwithin\',\\n-      target,\\n-      pointerType,\\n-      null,\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onBlurWithin, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchAfterBlurWithinEvents(\\n-  context: ReactDOMResponderContext,\\n-  event: ReactDOMResponderEvent,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-) {\\n-  const pointerType = state.pointerType;\\n-  const onAfterBlurWithin = (props.onAfterBlurWithin: any);\\n-  const relatedTarget = state.detachedTarget;\\n-  if (isFunction(onAfterBlurWithin) && relatedTarget !== null) {\\n-    const syntheticEvent = createFocusEvent(\\n-      context,\\n-      \'afterblurwithin\',\\n-      relatedTarget,\\n-      pointerType,\\n-      relatedTarget,\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onAfterBlurWithin, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchFocusChange(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusProps,\\n-  value: boolean,\\n-): void {\\n-  const onFocusChange = props.onFocusChange;\\n-  if (isFunction(onFocusChange)) {\\n-    context.dispatchEvent(value, onFocusChange, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchFocusVisibleChangeEvent(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusProps,\\n-  value: boolean,\\n-) {\\n-  const onFocusVisibleChange = props.onFocusVisibleChange;\\n-  if (isFunction(onFocusVisibleChange)) {\\n-    context.dispatchEvent(value, onFocusVisibleChange, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function unmountFocusResponder(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusProps,\\n-  state: FocusState,\\n-) {\\n-  if (state.isFocused) {\\n-    dispatchBlurEvents(context, props, state);\\n-  }\\n-}\\n-\\n-const focusResponderImpl = {\\n-  targetEventTypes,\\n-  targetPortalPropagation: true,\\n-  getInitialState(): FocusState {\\n-    return {\\n-      detachedTarget: null,\\n-      focusTarget: null,\\n-      isFocused: false,\\n-      isFocusVisible: false,\\n-      pointerType: \'\',\\n-      addedRootEvents: false,\\n-    };\\n-  },\\n-  onMount() {\\n-    trackGlobalFocusVisible();\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: FocusProps,\\n-    state: FocusState,\\n-  ): void {\\n-    const {type, target} = event;\\n-\\n-    if (props.disabled) {\\n-      if (state.isFocused) {\\n-        dispatchBlurEvents(context, props, state);\\n-        state.isFocused = false;\\n-        state.focusTarget = null;\\n-      }\\n-      return;\\n-    }\\n-\\n-    switch (type) {\\n-      case \'focus\': {\\n-        state.focusTarget = context.getResponderNode();\\n-        // Limit focus events to the direct child of the event component.\\n-        // Browser focus is not expected to bubble.\\n-        if (!state.isFocused && state.focusTarget === target) {\\n-          state.isFocused = true;\\n-          state.isFocusVisible = isGlobalFocusVisible;\\n-          dispatchFocusEvents(context, props, state);\\n-        }\\n-        isEmulatingMouseEvents = false;\\n-        break;\\n-      }\\n-      case \'blur\': {\\n-        if (state.isFocused) {\\n-          dispatchBlurEvents(context, props, state);\\n-          state.isFocusVisible = isGlobalFocusVisible;\\n-          state.isFocused = false;\\n-        }\\n-        // This covers situations where focus is lost to another document in\\n-        // the same window (e.g., iframes). Any action that restores focus to\\n-        // the document (e.g., touch or click) first causes \'focus\' to be\\n-        // dispatched, which means the \'pointerType\' we provide is stale\\n-        // (it reflects the *previous* pointer). We cannot determine the\\n-        // \'pointerType\' in this case, so a blur with no\\n-        // relatedTarget is used as a signal to reset the \'pointerType\'.\\n-        if (event.nativeEvent.relatedTarget == null) {\\n-          state.pointerType = \'\';\\n-        }\\n-        isEmulatingMouseEvents = false;\\n-        break;\\n-      }\\n-      default:\\n-        handleFocusVisibleTargetEvents(\\n-          event,\\n-          context,\\n-          state,\\n-          isFocusVisible => {\\n-            if (state.isFocused && state.isFocusVisible !== isFocusVisible) {\\n-              state.isFocusVisible = isFocusVisible;\\n-              dispatchFocusVisibleChangeEvent(context, props, isFocusVisible);\\n-            }\\n-          },\\n-        );\\n-    }\\n-  },\\n-  onUnmount(\\n-    context: ReactDOMResponderContext,\\n-    props: FocusProps,\\n-    state: FocusState,\\n-  ) {\\n-    unmountFocusResponder(context, props, state);\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const FocusResponder = React.DEPRECATED_createResponder(\\n-  \'Focus\',\\n-  focusResponderImpl,\\n-);\\n-\\n-export function useFocus(\\n-  props: FocusProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(FocusResponder, props);\\n-}\\n-\\n-/**\\n- * FocusWithin Responder\\n- */\\n-\\n-function dispatchFocusWithinChangeEvent(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-  value: boolean,\\n-) {\\n-  const onFocusWithinChange = (props.onFocusWithinChange: any);\\n-  if (isFunction(onFocusWithinChange)) {\\n-    context.dispatchEvent(value, onFocusWithinChange, DiscreteEvent);\\n-  }\\n-  if (state.isFocusVisible) {\\n-    dispatchFocusWithinVisibleChangeEvent(context, props, state, value);\\n-  }\\n-}\\n-\\n-function dispatchFocusWithinVisibleChangeEvent(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-  value: boolean,\\n-) {\\n-  const onFocusWithinVisibleChange = (props.onFocusWithinVisibleChange: any);\\n-  if (isFunction(onFocusWithinVisibleChange)) {\\n-    context.dispatchEvent(value, onFocusWithinVisibleChange, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function unmountFocusWithinResponder(\\n-  context: ReactDOMResponderContext,\\n-  props: FocusWithinProps,\\n-  state: FocusState,\\n-) {\\n-  if (state.isFocused) {\\n-    dispatchFocusWithinChangeEvent(context, props, state, false);\\n-  }\\n-}\\n-\\n-const focusWithinResponderImpl = {\\n-  targetEventTypes,\\n-  targetPortalPropagation: true,\\n-  getInitialState(): FocusState {\\n-    return {\\n-      detachedTarget: null,\\n-      focusTarget: null,\\n-      isFocused: false,\\n-      isFocusVisible: false,\\n-      pointerType: \'\',\\n-    };\\n-  },\\n-  onMount() {\\n-    trackGlobalFocusVisible();\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: FocusWithinProps,\\n-    state: FocusState,\\n-  ): void {\\n-    const {nativeEvent, type} = event;\\n-    const relatedTarget = (nativeEvent: any).relatedTarget;\\n-\\n-    if (props.disabled) {\\n-      if (state.isFocused) {\\n-        dispatchFocusWithinChangeEvent(context, props, state, false);\\n-        state.isFocused = false;\\n-        state.focusTarget = null;\\n-      }\\n-      return;\\n-    }\\n-\\n-    switch (type) {\\n-      case \'focus\': {\\n-        state.focusTarget = context.getResponderNode();\\n-        // Limit focus events to the direct child of the event component.\\n-        // Browser focus is not expected to bubble.\\n-        if (!state.isFocused) {\\n-          state.isFocused = true;\\n-          state.isFocusVisible = isGlobalFocusVisible;\\n-          dispatchFocusWithinChangeEvent(context, props, state, true);\\n-        }\\n-        if (!state.isFocusVisible && isGlobalFocusVisible) {\\n-          state.isFocusVisible = isGlobalFocusVisible;\\n-          dispatchFocusWithinVisibleChangeEvent(context, props, state, true);\\n-        }\\n-        dispatchFocusWithinEvents(context, event, props, state);\\n-        break;\\n-      }\\n-      case \'blur\': {\\n-        if (\\n-          state.isFocused &&\\n-          !context.isTargetWithinResponder(relatedTarget)\\n-        ) {\\n-          dispatchFocusWithinChangeEvent(context, props, state, false);\\n-          dispatchBlurWithinEvents(context, event, props, state);\\n-          state.isFocused = false;\\n-        }\\n-        break;\\n-      }\\n-      case \'beforeblur\': {\\n-        const onBeforeBlurWithin = (props.onBeforeBlurWithin: any);\\n-        if (isFunction(onBeforeBlurWithin)) {\\n-          const syntheticEvent = createFocusEvent(\\n-            context,\\n-            \'beforeblurwithin\',\\n-            event.target,\\n-            state.pointerType,\\n-            null,\\n-          );\\n-          state.detachedTarget = event.target;\\n-          context.dispatchEvent(\\n-            syntheticEvent,\\n-            onBeforeBlurWithin,\\n-            DiscreteEvent,\\n-          );\\n-          if (!state.addedRootEvents) {\\n-            state.addedRootEvents = true;\\n-            context.addRootEventTypes(rootEventTypes);\\n-          }\\n-        } else {\\n-          // We want to propagate to next focusWithin responder\\n-          // if this responder doesn\'t handle beforeblur\\n-          context.continuePropagation();\\n-        }\\n-        break;\\n-      }\\n-      default:\\n-        handleFocusVisibleTargetEvents(\\n-          event,\\n-          context,\\n-          state,\\n-          isFocusVisible => {\\n-            if (state.isFocused && state.isFocusVisible !== isFocusVisible) {\\n-              state.isFocusVisible = isFocusVisible;\\n-              dispatchFocusWithinVisibleChangeEvent(\\n-                context,\\n-                props,\\n-                state,\\n-                isFocusVisible,\\n-              );\\n-            }\\n-          },\\n-        );\\n-    }\\n-  },\\n-  onRootEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: FocusWithinProps,\\n-    state: FocusState,\\n-  ): void {\\n-    if (event.type === \'afterblur\') {\\n-      const detachedTarget = state.detachedTarget;\\n-      if (\\n-        detachedTarget !== null &&\\n-        detachedTarget === event.nativeEvent.relatedTarget\\n-      ) {\\n-        dispatchAfterBlurWithinEvents(context, event, props, state);\\n-        state.detachedTarget = null;\\n-        if (state.addedRootEvents) {\\n-          state.addedRootEvents = false;\\n-          context.removeRootEventTypes(rootEventTypes);\\n-        }\\n-      }\\n-    }\\n-  },\\n-  onUnmount(\\n-    context: ReactDOMResponderContext,\\n-    props: FocusWithinProps,\\n-    state: FocusState,\\n-  ) {\\n-    unmountFocusWithinResponder(context, props, state);\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const FocusWithinResponder = React.DEPRECATED_createResponder(\\n-  \'FocusWithin\',\\n-  focusWithinResponderImpl,\\n-);\\n-\\n-export function useFocusWithin(\\n-  props: FocusWithinProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(FocusWithinResponder, props);\\n-}"},{"sha":"d749c772ca8be353fecbb57dcda3aaebf069650d","filename":"packages/react-interactions/events/src/dom/Hover.js","status":"removed","additions":0,"deletions":391,"changes":391,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Hover.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Hover.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/Hover.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,391 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n-  PointerType,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-import type {ReactEventResponderListener} from \'shared/ReactTypes\';\\n-\\n-import * as React from \'react\';\\n-import {UserBlockingEvent} from \'shared/ReactTypes\';\\n-\\n-type HoverProps = {\\n-  disabled: boolean,\\n-  preventDefault: boolean,\\n-  onHoverChange: boolean => void,\\n-  onHoverEnd: (e: HoverEvent) => void,\\n-  onHoverMove: (e: HoverEvent) => void,\\n-  onHoverStart: (e: HoverEvent) => void,\\n-  ...\\n-};\\n-\\n-type HoverState = {\\n-  hoverTarget: null | Element | Document,\\n-  isActiveHovered: boolean,\\n-  isHovered: boolean,\\n-  isTouched?: boolean,\\n-  ignoreEmulatedMouseEvents?: boolean,\\n-  ...\\n-};\\n-\\n-type HoverEventType = \'hoverstart\' | \'hoverend\' | \'hoverchange\' | \'hovermove\';\\n-\\n-type HoverEvent = {|\\n-  clientX: null | number,\\n-  clientY: null | number,\\n-  pageX: null | number,\\n-  pageY: null | number,\\n-  pointerType: PointerType,\\n-  screenX: null | number,\\n-  screenY: null | number,\\n-  target: Element | Document,\\n-  timeStamp: number,\\n-  type: HoverEventType,\\n-  x: null | number,\\n-  y: null | number,\\n-|};\\n-\\n-const hasPointerEvents =\\n-  typeof window !== \'undefined\' && window.PointerEvent != null;\\n-\\n-function isFunction(obj): boolean {\\n-  return typeof obj === \'function\';\\n-}\\n-\\n-function createHoverEvent(\\n-  event: ?ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  type: HoverEventType,\\n-  target: Element | Document,\\n-): HoverEvent {\\n-  let clientX = null;\\n-  let clientY = null;\\n-  let pageX = null;\\n-  let pageY = null;\\n-  let screenX = null;\\n-  let screenY = null;\\n-  let pointerType = \'\';\\n-\\n-  if (event) {\\n-    const nativeEvent = (event.nativeEvent: any);\\n-    pointerType = event.pointerType;\\n-    ({clientX, clientY, pageX, pageY, screenX, screenY} = nativeEvent);\\n-  }\\n-\\n-  return {\\n-    pointerType,\\n-    target,\\n-    type,\\n-    timeStamp: context.getTimeStamp(),\\n-    clientX,\\n-    clientY,\\n-    pageX,\\n-    pageY,\\n-    screenX,\\n-    screenY,\\n-    x: clientX,\\n-    y: clientY,\\n-  };\\n-}\\n-\\n-function dispatchHoverChangeEvent(\\n-  event: null | ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: HoverProps,\\n-  state: HoverState,\\n-): void {\\n-  const onHoverChange = props.onHoverChange;\\n-  if (isFunction(onHoverChange)) {\\n-    const bool = state.isActiveHovered;\\n-    context.dispatchEvent(bool, onHoverChange, UserBlockingEvent);\\n-  }\\n-}\\n-\\n-function dispatchHoverStartEvents(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: HoverProps,\\n-  state: HoverState,\\n-): boolean {\\n-  const target = state.hoverTarget;\\n-  if (event !== null) {\\n-    const {nativeEvent} = event;\\n-    if (\\n-      context.isTargetWithinResponderScope((nativeEvent: any).relatedTarget)\\n-    ) {\\n-      return false;\\n-    }\\n-  }\\n-\\n-  state.isHovered = true;\\n-\\n-  if (!state.isActiveHovered) {\\n-    state.isActiveHovered = true;\\n-    const onHoverStart = props.onHoverStart;\\n-    if (isFunction(onHoverStart)) {\\n-      const syntheticEvent = createHoverEvent(\\n-        event,\\n-        context,\\n-        \'hoverstart\',\\n-        ((target: any): Element | Document),\\n-      );\\n-      context.dispatchEvent(syntheticEvent, onHoverStart, UserBlockingEvent);\\n-    }\\n-    dispatchHoverChangeEvent(event, context, props, state);\\n-  }\\n-  return true;\\n-}\\n-\\n-function dispatchHoverMoveEvent(event, context, props, state) {\\n-  const target = state.hoverTarget;\\n-  const onHoverMove = props.onHoverMove;\\n-  if (isFunction(onHoverMove)) {\\n-    const syntheticEvent = createHoverEvent(\\n-      event,\\n-      context,\\n-      \'hovermove\',\\n-      ((target: any): Element | Document),\\n-    );\\n-    context.dispatchEvent(syntheticEvent, onHoverMove, UserBlockingEvent);\\n-  }\\n-}\\n-\\n-function dispatchHoverEndEvents(\\n-  event: null | ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: HoverProps,\\n-  state: HoverState,\\n-): boolean {\\n-  const target = state.hoverTarget;\\n-  if (event !== null) {\\n-    const {nativeEvent} = event;\\n-    if (\\n-      context.isTargetWithinResponderScope((nativeEvent: any).relatedTarget)\\n-    ) {\\n-      return false;\\n-    }\\n-  }\\n-\\n-  state.isHovered = false;\\n-\\n-  if (state.isActiveHovered) {\\n-    state.isActiveHovered = false;\\n-    const onHoverEnd = props.onHoverEnd;\\n-    if (isFunction(onHoverEnd)) {\\n-      const syntheticEvent = createHoverEvent(\\n-        event,\\n-        context,\\n-        \'hoverend\',\\n-        ((target: any): Element | Document),\\n-      );\\n-      context.dispatchEvent(syntheticEvent, onHoverEnd, UserBlockingEvent);\\n-    }\\n-    dispatchHoverChangeEvent(event, context, props, state);\\n-    state.hoverTarget = null;\\n-    state.isTouched = false;\\n-  }\\n-  return true;\\n-}\\n-\\n-function unmountResponder(\\n-  context: ReactDOMResponderContext,\\n-  props: HoverProps,\\n-  state: HoverState,\\n-): void {\\n-  if (state.isHovered) {\\n-    dispatchHoverEndEvents(null, context, props, state);\\n-  }\\n-}\\n-\\n-const rootPointerEventTypes = [\'pointerout\', \'pointermove\', \'pointercancel\'];\\n-\\n-const hoverResponderImpl = {\\n-  targetEventTypes: [\'pointerover\'],\\n-  getInitialState() {\\n-    return {\\n-      isActiveHovered: false,\\n-      isHovered: false,\\n-    };\\n-  },\\n-  allowMultipleHostChildren: false,\\n-  allowEventHooks: true,\\n-  onRootEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: HoverProps,\\n-    state: HoverState,\\n-  ): void {\\n-    const {type} = event;\\n-\\n-    switch (type) {\\n-      // MOVE\\n-      case \'pointermove\': {\\n-        if (state.isHovered && state.hoverTarget !== null) {\\n-          dispatchHoverMoveEvent(event, context, props, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      // END\\n-      case \'pointercancel\':\\n-      case \'pointerout\': {\\n-        if (state.isHovered) {\\n-          if (\\n-            dispatchHoverEndEvents(event, context, props, state) ||\\n-            type === \'pointercancel\'\\n-          ) {\\n-            context.removeRootEventTypes(rootPointerEventTypes);\\n-          }\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: HoverProps,\\n-    state: HoverState,\\n-  ): void {\\n-    const {pointerType, type} = event;\\n-\\n-    if (props.disabled) {\\n-      if (state.isHovered) {\\n-        context.removeRootEventTypes(rootPointerEventTypes);\\n-        dispatchHoverEndEvents(event, context, props, state);\\n-      }\\n-      return;\\n-    }\\n-\\n-    switch (type) {\\n-      // START\\n-      case \'pointerover\': {\\n-        if (!state.isHovered && pointerType !== \'touch\') {\\n-          state.hoverTarget = context.getResponderNode();\\n-          if (dispatchHoverStartEvents(event, context, props, state)) {\\n-            context.addRootEventTypes(rootPointerEventTypes);\\n-          }\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onUnmount: unmountResponder,\\n-};\\n-\\n-const rootMouseEventTypes = [\'mousemove\', \'mouseout\'];\\n-\\n-const hoverResponderFallbackImpl = {\\n-  targetEventTypes: [\'mouseover\', \'mousemove\', \'touchstart\'],\\n-  getInitialState() {\\n-    return {\\n-      isActiveHovered: false,\\n-      isHovered: false,\\n-      isTouched: false,\\n-      ignoreEmulatedMouseEvents: false,\\n-    };\\n-  },\\n-  allowMultipleHostChildren: false,\\n-  allowEventHooks: true,\\n-  onRootEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: HoverProps,\\n-    state: HoverState,\\n-  ): void {\\n-    const {type} = event;\\n-\\n-    switch (type) {\\n-      // MOVE\\n-      case \'mousemove\': {\\n-        if (\\n-          state.isHovered &&\\n-          state.hoverTarget !== null &&\\n-          !state.ignoreEmulatedMouseEvents\\n-        ) {\\n-          dispatchHoverMoveEvent(event, context, props, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      // END\\n-      case \'mouseout\': {\\n-        if (state.isHovered) {\\n-          if (dispatchHoverEndEvents(event, context, props, state)) {\\n-            context.removeRootEventTypes(rootMouseEventTypes);\\n-          }\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: HoverProps,\\n-    state: HoverState,\\n-  ): void {\\n-    const {type} = event;\\n-\\n-    if (props.disabled) {\\n-      if (state.isHovered) {\\n-        context.removeRootEventTypes(rootMouseEventTypes);\\n-        dispatchHoverEndEvents(event, context, props, state);\\n-        state.ignoreEmulatedMouseEvents = false;\\n-      }\\n-      state.isTouched = false;\\n-      return;\\n-    }\\n-\\n-    switch (type) {\\n-      // START\\n-      case \'mouseover\': {\\n-        if (!state.isHovered && !state.ignoreEmulatedMouseEvents) {\\n-          state.hoverTarget = context.getResponderNode();\\n-          if (dispatchHoverStartEvents(event, context, props, state)) {\\n-            context.addRootEventTypes(rootMouseEventTypes);\\n-          }\\n-        }\\n-        break;\\n-      }\\n-\\n-      // MOVE\\n-      case \'mousemove\': {\\n-        if (!state.isHovered && type === \'mousemove\') {\\n-          state.ignoreEmulatedMouseEvents = false;\\n-          state.isTouched = false;\\n-        }\\n-        break;\\n-      }\\n-\\n-      case \'touchstart\': {\\n-        if (!state.isHovered) {\\n-          state.isTouched = true;\\n-          state.ignoreEmulatedMouseEvents = true;\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onUnmount: unmountResponder,\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const HoverResponder = React.DEPRECATED_createResponder(\\n-  \'Hover\',\\n-  hasPointerEvents ? hoverResponderImpl : hoverResponderFallbackImpl,\\n-);\\n-\\n-export function useHover(\\n-  props: HoverProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(HoverResponder, props);\\n-}"},{"sha":"c07e2aa0aedaeaa91c448c6471283fa1d778ee04","filename":"packages/react-interactions/events/src/dom/Input.js","status":"removed","additions":0,"deletions":225,"changes":225,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Input.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Input.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/Input.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,225 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-\\n-import * as React from \'react\';\\n-import {DiscreteEvent} from \'shared/ReactTypes\';\\n-import type {ReactEventResponderListener} from \'shared/ReactTypes\';\\n-\\n-type InputEventType = \'change\' | \'beforechange\' | \'valuechange\';\\n-\\n-type InputResponderProps = {\\n-  disabled: boolean,\\n-  onBeforeChange: (e: InputEvent) => void,\\n-  onChange: (e: InputEvent) => void,\\n-  onValueChange: (value: string | boolean) => void,\\n-  ...\\n-};\\n-\\n-type InputEvent = {|\\n-  data: string,\\n-  isComposing: boolean,\\n-  inputType: string,\\n-  dataTransfer: null | string,\\n-  target: Element | Document,\\n-  type: InputEventType,\\n-  timeStamp: number,\\n-|};\\n-\\n-const targetEventTypes = [\'input\', \'change\', \'beforeinput\', \'click\'];\\n-\\n-const supportedInputTypes = new Set([\\n-  \'color\',\\n-  \'date\',\\n-  \'datetime\',\\n-  \'datetime-local\',\\n-  \'email\',\\n-  \'month\',\\n-  \'number\',\\n-  \'password\',\\n-  \'range\',\\n-  \'search\',\\n-  \'tel\',\\n-  \'text\',\\n-  \'time\',\\n-  \'url\',\\n-  \'week\',\\n-]);\\n-\\n-function isFunction(obj): boolean {\\n-  return typeof obj === \'function\';\\n-}\\n-\\n-function createInputEvent(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  type: InputEventType,\\n-  target: Document | Element,\\n-): InputEvent {\\n-  const {data, dataTransfer, inputType, isComposing} = (event: any).nativeEvent;\\n-  return {\\n-    data,\\n-    dataTransfer,\\n-    inputType,\\n-    isComposing,\\n-    target,\\n-    timeStamp: context.getTimeStamp(),\\n-    type,\\n-  };\\n-}\\n-\\n-function dispatchInputEvent(\\n-  event: ReactDOMResponderEvent,\\n-  listener: InputEvent => void,\\n-  context: ReactDOMResponderContext,\\n-  type: InputEventType,\\n-  target: Element | Document,\\n-): void {\\n-  const syntheticEvent = createInputEvent(event, context, type, target);\\n-  context.dispatchEvent(syntheticEvent, listener, DiscreteEvent);\\n-}\\n-\\n-function getNodeName(elem: Element | Document): string {\\n-  return elem.nodeName && elem.nodeName.toLowerCase();\\n-}\\n-\\n-function isTextInputElement(elem: Element | Document): boolean {\\n-  const nodeName = getNodeName(elem);\\n-  const type = (elem: any).type;\\n-  return (\\n-    nodeName === \'textarea\' ||\\n-    (nodeName === \'input\' && (type == null || supportedInputTypes.has(type)))\\n-  );\\n-}\\n-\\n-function isCheckable(elem: Element | Document): boolean {\\n-  const nodeName = getNodeName(elem);\\n-  const type = (elem: any).type;\\n-  return nodeName === \'input\' && (type === \'checkbox\' || type === \'radio\');\\n-}\\n-\\n-function shouldUseChangeEvent(elem: Element | Document): boolean {\\n-  const nodeName = getNodeName(elem);\\n-  return (\\n-    nodeName === \'select\' ||\\n-    (nodeName === \'input\' && (elem: any).type === \'file\')\\n-  );\\n-}\\n-\\n-function dispatchChangeEvent(\\n-  context: ReactDOMResponderContext,\\n-  props: InputResponderProps,\\n-  target: Element | Document,\\n-): void {\\n-  const onValueChange = props.onValueChange;\\n-  if (isFunction(onValueChange)) {\\n-    const value = getValueFromNode(target);\\n-    context.dispatchEvent(value, onValueChange, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchBothChangeEvents(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: InputResponderProps,\\n-  target: Document | Element,\\n-): void {\\n-  context.enqueueStateRestore(target);\\n-  const onChange = props.onChange;\\n-  if (isFunction(onChange)) {\\n-    dispatchInputEvent(event, onChange, context, \'change\', target);\\n-  }\\n-  dispatchChangeEvent(context, props, target);\\n-}\\n-\\n-function updateValueIfChanged(elem: Element | Document): boolean {\\n-  // React\'s internal value tracker\\n-  const valueTracker = (elem: any)._valueTracker;\\n-  if (valueTracker == null) {\\n-    return true;\\n-  }\\n-  const prevValue = valueTracker.getValue();\\n-  const nextValue = getValueFromNode(elem);\\n-\\n-  if (prevValue !== nextValue) {\\n-    valueTracker.setValue(nextValue);\\n-    return true;\\n-  }\\n-  return false;\\n-}\\n-\\n-function getValueFromNode(node: Element | Document): string {\\n-  let value = \'\';\\n-  if (!node) {\\n-    return value;\\n-  }\\n-\\n-  if (isCheckable(node)) {\\n-    value = (node: any).checked ? \'true\' : \'false\';\\n-  } else {\\n-    value = (node: any).value;\\n-  }\\n-\\n-  return value;\\n-}\\n-\\n-const inputResponderImpl = {\\n-  targetEventTypes,\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: InputResponderProps,\\n-  ): void {\\n-    const {type, target} = event;\\n-\\n-    if (props.disabled) {\\n-      return;\\n-    }\\n-    const currentTarget = context.getResponderNode();\\n-    if (target !== currentTarget || currentTarget === null) {\\n-      return;\\n-    }\\n-    switch (type) {\\n-      default: {\\n-        if (shouldUseChangeEvent(target) && type === \'change\') {\\n-          dispatchBothChangeEvents(event, context, props, currentTarget);\\n-        } else if (\\n-          isTextInputElement(target) &&\\n-          (type === \'input\' || type === \'change\') &&\\n-          updateValueIfChanged(target)\\n-        ) {\\n-          dispatchBothChangeEvents(event, context, props, currentTarget);\\n-        } else if (\\n-          isCheckable(target) &&\\n-          type === \'click\' &&\\n-          updateValueIfChanged(target)\\n-        ) {\\n-          dispatchBothChangeEvents(event, context, props, currentTarget);\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const InputResponder = React.DEPRECATED_createResponder(\\n-  \'Input\',\\n-  inputResponderImpl,\\n-);\\n-\\n-export function useInput(\\n-  props: InputResponderProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(InputResponder, props);\\n-}"},{"sha":"15616d097973fbd6295be778017e96cbb3a12b78","filename":"packages/react-interactions/events/src/dom/PressLegacy.js","status":"removed","additions":0,"deletions":924,"changes":924,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/PressLegacy.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/PressLegacy.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/PressLegacy.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,924 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderEvent,\\n-  ReactDOMResponderContext,\\n-  PointerType,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-import type {\\n-  EventPriority,\\n-  ReactEventResponderListener,\\n-} from \'shared/ReactTypes\';\\n-\\n-import * as React from \'react\';\\n-import {DiscreteEvent, UserBlockingEvent} from \'shared/ReactTypes\';\\n-\\n-type PressProps = {|\\n-  disabled: boolean,\\n-  pressRetentionOffset: {\\n-    top: number,\\n-    right: number,\\n-    bottom: number,\\n-    left: number,\\n-    ...\\n-  },\\n-  preventDefault: boolean,\\n-  onPress: (e: PressEvent) => void,\\n-  onPressChange: boolean => void,\\n-  onPressEnd: (e: PressEvent) => void,\\n-  onPressMove: (e: PressEvent) => void,\\n-  onPressStart: (e: PressEvent) => void,\\n-|};\\n-\\n-type PressState = {\\n-  activationPosition: null | $ReadOnly<{|\\n-    x: number,\\n-    y: number,\\n-  |}>,\\n-  addedRootEvents: boolean,\\n-  buttons: 0 | 1 | 4,\\n-  isActivePressed: boolean,\\n-  isActivePressStart: boolean,\\n-  isPressed: boolean,\\n-  isPressWithinResponderRegion: boolean,\\n-  pointerType: PointerType,\\n-  pressTarget: null | Element | Document,\\n-  responderRegionOnActivation: null | $ReadOnly<{|\\n-    bottom: number,\\n-    left: number,\\n-    right: number,\\n-    top: number,\\n-  |}>,\\n-  responderRegionOnDeactivation: null | $ReadOnly<{|\\n-    bottom: number,\\n-    left: number,\\n-    right: number,\\n-    top: number,\\n-  |}>,\\n-  ignoreEmulatedMouseEvents: boolean,\\n-  activePointerId: null | number,\\n-  shouldPreventClick: boolean,\\n-  touchEvent: null | Touch,\\n-  ...\\n-};\\n-\\n-type PressEventType =\\n-  | \'press\'\\n-  | \'pressmove\'\\n-  | \'pressstart\'\\n-  | \'pressend\'\\n-  | \'presschange\';\\n-\\n-type PressEvent = {|\\n-  altKey: boolean,\\n-  buttons: 0 | 1 | 4,\\n-  clientX: null | number,\\n-  clientY: null | number,\\n-  ctrlKey: boolean,\\n-  defaultPrevented: boolean,\\n-  metaKey: boolean,\\n-  pageX: null | number,\\n-  pageY: null | number,\\n-  pointerType: PointerType,\\n-  screenX: null | number,\\n-  screenY: null | number,\\n-  shiftKey: boolean,\\n-  target: Element | Document,\\n-  timeStamp: number,\\n-  type: PressEventType,\\n-  x: null | number,\\n-  y: null | number,\\n-  preventDefault: () => void,\\n-  stopPropagation: () => void,\\n-|};\\n-\\n-const hasPointerEvents =\\n-  typeof window !== \'undefined\' && window.PointerEvent !== undefined;\\n-\\n-const isMac =\\n-  typeof window !== \'undefined\' && window.navigator != null\\n-    ? /^Mac/.test(window.navigator.platform)\\n-    : false;\\n-\\n-const DEFAULT_PRESS_RETENTION_OFFSET = {\\n-  bottom: 20,\\n-  top: 20,\\n-  left: 20,\\n-  right: 20,\\n-};\\n-\\n-const targetEventTypes = hasPointerEvents\\n-  ? [\'keydown_active\', \'pointerdown_active\', \'click_active\']\\n-  : [\'keydown_active\', \'touchstart\', \'mousedown_active\', \'click_active\'];\\n-\\n-const rootEventTypes = hasPointerEvents\\n-  ? [\\n-      \'pointerup_active\',\\n-      \'pointermove\',\\n-      \'pointercancel\',\\n-      \'click\',\\n-      \'keyup\',\\n-      \'scroll\',\\n-      \'blur\',\\n-    ]\\n-  : [\\n-      \'click\',\\n-      \'keyup\',\\n-      \'scroll\',\\n-      \'mousemove\',\\n-      \'touchmove\',\\n-      \'touchcancel\',\\n-      // Used as a \'cancel\' signal for mouse interactions\\n-      \'dragstart\',\\n-      \'mouseup_active\',\\n-      \'touchend\',\\n-      \'blur\',\\n-    ];\\n-\\n-function isFunction(obj): boolean {\\n-  return typeof obj === \'function\';\\n-}\\n-\\n-function createPressEvent(\\n-  context: ReactDOMResponderContext,\\n-  type: PressEventType,\\n-  target: Element | Document,\\n-  pointerType: PointerType,\\n-  event: ?ReactDOMResponderEvent,\\n-  touchEvent: null | Touch,\\n-  defaultPrevented: boolean,\\n-  state: PressState,\\n-): PressEvent {\\n-  const timeStamp = context.getTimeStamp();\\n-  let clientX = null;\\n-  let clientY = null;\\n-  let pageX = null;\\n-  let pageY = null;\\n-  let screenX = null;\\n-  let screenY = null;\\n-  let altKey = false;\\n-  let ctrlKey = false;\\n-  let metaKey = false;\\n-  let shiftKey = false;\\n-  let nativeEvent;\\n-\\n-  if (event) {\\n-    nativeEvent = (event.nativeEvent: any);\\n-    ({altKey, ctrlKey, metaKey, shiftKey} = nativeEvent);\\n-    // Only check for one property, checking for all of them is costly. We can assume\\n-    // if clientX exists, so do the rest.\\n-    const eventObject = (touchEvent: any) || (nativeEvent: any);\\n-    if (eventObject) {\\n-      ({clientX, clientY, pageX, pageY, screenX, screenY} = eventObject);\\n-    }\\n-  }\\n-  const pressEvent = {\\n-    altKey,\\n-    buttons: state.buttons,\\n-    clientX,\\n-    clientY,\\n-    ctrlKey,\\n-    defaultPrevented,\\n-    metaKey,\\n-    pageX,\\n-    pageY,\\n-    pointerType,\\n-    screenX,\\n-    screenY,\\n-    shiftKey,\\n-    target,\\n-    timeStamp,\\n-    type,\\n-    x: clientX,\\n-    y: clientY,\\n-    preventDefault() {\\n-      state.shouldPreventClick = true;\\n-      if (nativeEvent) {\\n-        pressEvent.defaultPrevented = true;\\n-        nativeEvent.preventDefault();\\n-      }\\n-    },\\n-    stopPropagation() {\\n-      // NO-OP, we should remove this in the future\\n-      if (__DEV__) {\\n-        console.error(\\n-          \'stopPropagation is not available on event objects created from event responder modules (React Flare). \' +\\n-            \'Try wrapping in a conditional, i.e. `if (event.type !== \\"press\\") { event.stopPropagation() }`\',\\n-        );\\n-      }\\n-    },\\n-  };\\n-  return pressEvent;\\n-}\\n-\\n-function dispatchEvent(\\n-  event: ?ReactDOMResponderEvent,\\n-  listener: any => void,\\n-  context: ReactDOMResponderContext,\\n-  state: PressState,\\n-  name: PressEventType,\\n-  eventPriority: EventPriority,\\n-): void {\\n-  const target = ((state.pressTarget: any): Element | Document);\\n-  const pointerType = state.pointerType;\\n-  const defaultPrevented =\\n-    (event != null && event.nativeEvent.defaultPrevented === true) ||\\n-    (name === \'press\' && state.shouldPreventClick);\\n-  const touchEvent = state.touchEvent;\\n-  const syntheticEvent = createPressEvent(\\n-    context,\\n-    name,\\n-    target,\\n-    pointerType,\\n-    event,\\n-    touchEvent,\\n-    defaultPrevented,\\n-    state,\\n-  );\\n-  context.dispatchEvent(syntheticEvent, listener, eventPriority);\\n-}\\n-\\n-function dispatchPressChangeEvent(\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  const onPressChange = props.onPressChange;\\n-  if (isFunction(onPressChange)) {\\n-    const bool = state.isActivePressed;\\n-    context.dispatchEvent(bool, onPressChange, DiscreteEvent);\\n-  }\\n-}\\n-\\n-function dispatchPressStartEvents(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  state.isPressed = true;\\n-\\n-  if (!state.isActivePressStart) {\\n-    state.isActivePressStart = true;\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const {clientX: x, clientY: y} = state.touchEvent || nativeEvent;\\n-    const wasActivePressed = state.isActivePressed;\\n-    state.isActivePressed = true;\\n-    if (x !== undefined && y !== undefined) {\\n-      state.activationPosition = {x, y};\\n-    }\\n-    const onPressStart = props.onPressStart;\\n-\\n-    if (isFunction(onPressStart)) {\\n-      dispatchEvent(\\n-        event,\\n-        onPressStart,\\n-        context,\\n-        state,\\n-        \'pressstart\',\\n-        DiscreteEvent,\\n-      );\\n-    }\\n-    if (!wasActivePressed) {\\n-      dispatchPressChangeEvent(context, props, state);\\n-    }\\n-  }\\n-}\\n-\\n-function dispatchPressEndEvents(\\n-  event: ?ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  state.isActivePressStart = false;\\n-  state.isPressed = false;\\n-\\n-  if (state.isActivePressed) {\\n-    state.isActivePressed = false;\\n-    const onPressEnd = props.onPressEnd;\\n-\\n-    if (isFunction(onPressEnd)) {\\n-      dispatchEvent(\\n-        event,\\n-        onPressEnd,\\n-        context,\\n-        state,\\n-        \'pressend\',\\n-        DiscreteEvent,\\n-      );\\n-    }\\n-    dispatchPressChangeEvent(context, props, state);\\n-  }\\n-\\n-  state.responderRegionOnDeactivation = null;\\n-}\\n-\\n-function dispatchCancel(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  state.touchEvent = null;\\n-  if (state.isPressed) {\\n-    state.ignoreEmulatedMouseEvents = false;\\n-    dispatchPressEndEvents(event, context, props, state);\\n-  }\\n-  removeRootEventTypes(context, state);\\n-}\\n-\\n-function isValidKeyboardEvent(nativeEvent: Object): boolean {\\n-  const {key, target} = nativeEvent;\\n-  const {tagName, isContentEditable} = target;\\n-  // Accessibility for keyboards. Space and Enter only.\\n-  // \\"Spacebar\\" is for IE 11\\n-  return (\\n-    (key === \'Enter\' || key === \' \' || key === \'Spacebar\') &&\\n-    tagName !== \'INPUT\' &&\\n-    tagName !== \'TEXTAREA\' &&\\n-    isContentEditable !== true\\n-  );\\n-}\\n-\\n-// TODO: account for touch hit slop\\n-function calculateResponderRegion(\\n-  context: ReactDOMResponderContext,\\n-  target: Element,\\n-  props: PressProps,\\n-) {\\n-  const pressRetentionOffset = context.objectAssign(\\n-    {},\\n-    DEFAULT_PRESS_RETENTION_OFFSET,\\n-    props.pressRetentionOffset,\\n-  );\\n-\\n-  let {left, right, bottom, top} = target.getBoundingClientRect();\\n-\\n-  if (pressRetentionOffset) {\\n-    if (pressRetentionOffset.bottom != null) {\\n-      bottom += pressRetentionOffset.bottom;\\n-    }\\n-    if (pressRetentionOffset.left != null) {\\n-      left -= pressRetentionOffset.left;\\n-    }\\n-    if (pressRetentionOffset.right != null) {\\n-      right += pressRetentionOffset.right;\\n-    }\\n-    if (pressRetentionOffset.top != null) {\\n-      top -= pressRetentionOffset.top;\\n-    }\\n-  }\\n-\\n-  return {\\n-    bottom,\\n-    top,\\n-    left,\\n-    right,\\n-  };\\n-}\\n-\\n-function getTouchFromPressEvent(nativeEvent: TouchEvent): null | Touch {\\n-  const targetTouches = nativeEvent.targetTouches;\\n-  if (targetTouches.length > 0) {\\n-    return targetTouches[0];\\n-  }\\n-  return null;\\n-}\\n-\\n-function unmountResponder(\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  if (state.isPressed) {\\n-    removeRootEventTypes(context, state);\\n-    dispatchPressEndEvents(null, context, props, state);\\n-  }\\n-}\\n-\\n-function addRootEventTypes(\\n-  context: ReactDOMResponderContext,\\n-  state: PressState,\\n-): void {\\n-  if (!state.addedRootEvents) {\\n-    state.addedRootEvents = true;\\n-    context.addRootEventTypes(rootEventTypes);\\n-  }\\n-}\\n-\\n-function removeRootEventTypes(\\n-  context: ReactDOMResponderContext,\\n-  state: PressState,\\n-): void {\\n-  if (state.addedRootEvents) {\\n-    state.addedRootEvents = false;\\n-    context.removeRootEventTypes(rootEventTypes);\\n-  }\\n-}\\n-\\n-function getTouchById(\\n-  nativeEvent: TouchEvent,\\n-  pointerId: null | number,\\n-): null | Touch {\\n-  const changedTouches = nativeEvent.changedTouches;\\n-  for (let i = 0; i < changedTouches.length; i++) {\\n-    const touch = changedTouches[i];\\n-    if (touch.identifier === pointerId) {\\n-      return touch;\\n-    }\\n-  }\\n-  return null;\\n-}\\n-\\n-function getTouchTarget(context: ReactDOMResponderContext, touchEvent: Touch) {\\n-  const doc = context.getActiveDocument();\\n-  return doc.elementFromPoint(touchEvent.clientX, touchEvent.clientY);\\n-}\\n-\\n-function updateIsPressWithinResponderRegion(\\n-  nativeEventOrTouchEvent: Event | Touch,\\n-  context: ReactDOMResponderContext,\\n-  props: PressProps,\\n-  state: PressState,\\n-): void {\\n-  // Calculate the responder region we use for deactivation if not\\n-  // already done during move event.\\n-  if (state.responderRegionOnDeactivation == null) {\\n-    state.responderRegionOnDeactivation = calculateResponderRegion(\\n-      context,\\n-      ((state.pressTarget: any): Element),\\n-      props,\\n-    );\\n-  }\\n-  const {responderRegionOnActivation, responderRegionOnDeactivation} = state;\\n-  let left, top, right, bottom;\\n-\\n-  if (responderRegionOnActivation != null) {\\n-    left = responderRegionOnActivation.left;\\n-    top = responderRegionOnActivation.top;\\n-    right = responderRegionOnActivation.right;\\n-    bottom = responderRegionOnActivation.bottom;\\n-\\n-    if (responderRegionOnDeactivation != null) {\\n-      left = Math.min(left, responderRegionOnDeactivation.left);\\n-      top = Math.min(top, responderRegionOnDeactivation.top);\\n-      right = Math.max(right, responderRegionOnDeactivation.right);\\n-      bottom = Math.max(bottom, responderRegionOnDeactivation.bottom);\\n-    }\\n-  }\\n-  const {clientX: x, clientY: y} = (nativeEventOrTouchEvent: any);\\n-\\n-  state.isPressWithinResponderRegion =\\n-    left != null &&\\n-    right != null &&\\n-    top != null &&\\n-    bottom != null &&\\n-    x !== null &&\\n-    y !== null &&\\n-    x >= left &&\\n-    x <= right &&\\n-    y >= top &&\\n-    y <= bottom;\\n-}\\n-\\n-// After some investigation work, screen reader virtual\\n-// clicks (NVDA, Jaws, VoiceOver) do not have co-ords associated with the click\\n-// event and \\"detail\\" is always 0 (where normal clicks are > 0)\\n-function isScreenReaderVirtualClick(nativeEvent): boolean {\\n-  // JAWS/NVDA with Firefox.\\n-  if (nativeEvent.mozInputSource === 0 && nativeEvent.isTrusted) {\\n-    return true;\\n-  }\\n-  // Chrome\\n-  return (\\n-    nativeEvent.detail === 0 &&\\n-    nativeEvent.screenX === 0 &&\\n-    nativeEvent.screenY === 0 &&\\n-    nativeEvent.clientX === 0 &&\\n-    nativeEvent.clientY === 0\\n-  );\\n-}\\n-\\n-function targetIsDocument(target: null | Node): boolean {\\n-  // When target is null, it is the root\\n-  return target === null || target.nodeType === 9;\\n-}\\n-\\n-const pressResponderImpl = {\\n-  targetEventTypes,\\n-  getInitialState(): PressState {\\n-    return {\\n-      activationPosition: null,\\n-      addedRootEvents: false,\\n-      buttons: 0,\\n-      isActivePressed: false,\\n-      isActivePressStart: false,\\n-      isPressed: false,\\n-      isPressWithinResponderRegion: true,\\n-      pointerType: \'\',\\n-      pressTarget: null,\\n-      responderRegionOnActivation: null,\\n-      responderRegionOnDeactivation: null,\\n-      ignoreEmulatedMouseEvents: false,\\n-      activePointerId: null,\\n-      shouldPreventClick: false,\\n-      touchEvent: null,\\n-    };\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: PressProps,\\n-    state: PressState,\\n-  ): void {\\n-    const {pointerType, type} = event;\\n-\\n-    if (props.disabled) {\\n-      removeRootEventTypes(context, state);\\n-      dispatchPressEndEvents(event, context, props, state);\\n-      state.ignoreEmulatedMouseEvents = false;\\n-      return;\\n-    }\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const isPressed = state.isPressed;\\n-\\n-    switch (type) {\\n-      // START\\n-      case \'pointerdown\':\\n-      case \'keydown\':\\n-      case \'mousedown\':\\n-      case \'touchstart\': {\\n-        if (!isPressed) {\\n-          const isTouchEvent = type === \'touchstart\';\\n-          const isPointerEvent = type === \'pointerdown\';\\n-          const isKeyboardEvent = pointerType === \'keyboard\';\\n-          const isMouseEvent = pointerType === \'mouse\';\\n-\\n-          // Ignore emulated mouse events\\n-          if (type === \'mousedown\' && state.ignoreEmulatedMouseEvents) {\\n-            return;\\n-          }\\n-\\n-          state.shouldPreventClick = false;\\n-          if (isTouchEvent) {\\n-            state.ignoreEmulatedMouseEvents = true;\\n-          } else if (isKeyboardEvent) {\\n-            // Ignore unrelated key events\\n-            if (isValidKeyboardEvent(nativeEvent)) {\\n-              const {\\n-                altKey,\\n-                ctrlKey,\\n-                metaKey,\\n-                shiftKey,\\n-              } = (nativeEvent: MouseEvent);\\n-              if (\\n-                props.preventDefault !== false &&\\n-                !shiftKey &&\\n-                !metaKey &&\\n-                !ctrlKey &&\\n-                !altKey\\n-              ) {\\n-                // Prevent spacebar press from scrolling the window\\n-                const key = nativeEvent.key;\\n-                if (key === \' \' || key === \'Spacebar\') {\\n-                  nativeEvent.preventDefault();\\n-                }\\n-                state.shouldPreventClick = true;\\n-              }\\n-            } else {\\n-              return;\\n-            }\\n-          }\\n-\\n-          // We set these here, before the button check so we have this\\n-          // data around for handling of the context menu\\n-          state.pointerType = pointerType;\\n-          const pressTarget = (state.pressTarget = context.getResponderNode());\\n-          if (isPointerEvent) {\\n-            state.activePointerId = nativeEvent.pointerId;\\n-          } else if (isTouchEvent) {\\n-            const touchEvent = getTouchFromPressEvent(nativeEvent);\\n-            if (touchEvent === null) {\\n-              return;\\n-            }\\n-            state.touchEvent = touchEvent;\\n-            state.activePointerId = touchEvent.identifier;\\n-          }\\n-\\n-          // Ignore any device buttons except primary/middle and touch/pen contact.\\n-          // Additionally we ignore primary-button + ctrl-key with Macs as that\\n-          // acts like right-click and opens the contextmenu.\\n-          if (\\n-            nativeEvent.buttons === 2 ||\\n-            nativeEvent.buttons > 4 ||\\n-            (isMac && isMouseEvent && nativeEvent.ctrlKey)\\n-          ) {\\n-            return;\\n-          }\\n-          // Exclude document targets\\n-          if (!targetIsDocument(pressTarget)) {\\n-            state.responderRegionOnActivation = calculateResponderRegion(\\n-              context,\\n-              ((pressTarget: any): Element),\\n-              props,\\n-            );\\n-          }\\n-          state.responderRegionOnDeactivation = null;\\n-          state.isPressWithinResponderRegion = true;\\n-          state.buttons = nativeEvent.buttons;\\n-          if (nativeEvent.button === 1) {\\n-            state.buttons = 4;\\n-          }\\n-          dispatchPressStartEvents(event, context, props, state);\\n-          addRootEventTypes(context, state);\\n-        } else {\\n-          // Prevent spacebar press from scrolling the window\\n-          const key = nativeEvent.key;\\n-          if (\\n-            isValidKeyboardEvent(nativeEvent) &&\\n-            (key === \' \' || key === \'Spacebar\')\\n-          ) {\\n-            nativeEvent.preventDefault();\\n-          }\\n-        }\\n-        break;\\n-      }\\n-\\n-      case \'click\': {\\n-        if (state.shouldPreventClick) {\\n-          nativeEvent.preventDefault();\\n-        }\\n-        const onPress = props.onPress;\\n-\\n-        if (isFunction(onPress) && isScreenReaderVirtualClick(nativeEvent)) {\\n-          state.pointerType = \'keyboard\';\\n-          state.pressTarget = context.getResponderNode();\\n-          const preventDefault = props.preventDefault;\\n-\\n-          if (preventDefault !== false) {\\n-            nativeEvent.preventDefault();\\n-          }\\n-          dispatchEvent(event, onPress, context, state, \'press\', DiscreteEvent);\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onRootEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: PressProps,\\n-    state: PressState,\\n-  ): void {\\n-    const {pointerType, type} = event;\\n-    let target = event.target;\\n-\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const isPressed = state.isPressed;\\n-    const activePointerId = state.activePointerId;\\n-    const previousPointerType = state.pointerType;\\n-\\n-    switch (type) {\\n-      // MOVE\\n-      case \'pointermove\':\\n-      case \'mousemove\':\\n-      case \'touchmove\': {\\n-        let touchEvent;\\n-        // Ignore emulated events (pointermove will dispatch touch and mouse events)\\n-        // Ignore pointermove events during a keyboard press.\\n-        if (previousPointerType !== pointerType) {\\n-          return;\\n-        }\\n-        if (\\n-          type === \'pointermove\' &&\\n-          activePointerId !== nativeEvent.pointerId\\n-        ) {\\n-          return;\\n-        } else if (type === \'touchmove\') {\\n-          touchEvent = getTouchById(nativeEvent, activePointerId);\\n-          if (touchEvent === null) {\\n-            return;\\n-          }\\n-          state.touchEvent = touchEvent;\\n-        }\\n-        const pressTarget = state.pressTarget;\\n-\\n-        if (pressTarget !== null && !targetIsDocument(pressTarget)) {\\n-          if (\\n-            pointerType === \'mouse\' &&\\n-            context.isTargetWithinNode(target, pressTarget)\\n-          ) {\\n-            state.isPressWithinResponderRegion = true;\\n-          } else {\\n-            // Calculate the responder region we use for deactivation, as the\\n-            // element dimensions may have changed since activation.\\n-            updateIsPressWithinResponderRegion(\\n-              touchEvent || nativeEvent,\\n-              context,\\n-              props,\\n-              state,\\n-            );\\n-          }\\n-        }\\n-\\n-        if (state.isPressWithinResponderRegion) {\\n-          if (isPressed) {\\n-            const onPressMove = props.onPressMove;\\n-\\n-            if (isFunction(onPressMove)) {\\n-              dispatchEvent(\\n-                event,\\n-                onPressMove,\\n-                context,\\n-                state,\\n-                \'pressmove\',\\n-                UserBlockingEvent,\\n-              );\\n-            }\\n-          } else {\\n-            dispatchPressStartEvents(event, context, props, state);\\n-          }\\n-        } else {\\n-          dispatchPressEndEvents(event, context, props, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      // END\\n-      case \'pointerup\':\\n-      case \'keyup\':\\n-      case \'mouseup\':\\n-      case \'touchend\': {\\n-        if (isPressed) {\\n-          const buttons = state.buttons;\\n-          let isKeyboardEvent = false;\\n-          let touchEvent;\\n-          if (\\n-            type === \'pointerup\' &&\\n-            activePointerId !== nativeEvent.pointerId\\n-          ) {\\n-            return;\\n-          } else if (type === \'touchend\') {\\n-            touchEvent = getTouchById(nativeEvent, activePointerId);\\n-            if (touchEvent === null) {\\n-              return;\\n-            }\\n-            state.touchEvent = touchEvent;\\n-            target = getTouchTarget(context, touchEvent);\\n-          } else if (type === \'keyup\') {\\n-            // Ignore unrelated keyboard events\\n-            if (!isValidKeyboardEvent(nativeEvent)) {\\n-              return;\\n-            }\\n-            isKeyboardEvent = true;\\n-            removeRootEventTypes(context, state);\\n-          } else if (buttons === 4) {\\n-            // Remove the root events here as no \'click\' event is dispatched when this \'button\' is pressed.\\n-            removeRootEventTypes(context, state);\\n-          }\\n-\\n-          // Determine whether to call preventDefault on subsequent native events.\\n-          if (\\n-            target !== null &&\\n-            context.isTargetWithinResponder(target) &&\\n-            context.isTargetWithinHostComponent(target, \'a\')\\n-          ) {\\n-            const {\\n-              altKey,\\n-              ctrlKey,\\n-              metaKey,\\n-              shiftKey,\\n-            } = (nativeEvent: MouseEvent);\\n-            // Check \\"open in new window/tab\\" and \\"open context menu\\" key modifiers\\n-            const preventDefault = props.preventDefault;\\n-\\n-            if (\\n-              preventDefault !== false &&\\n-              !shiftKey &&\\n-              !metaKey &&\\n-              !ctrlKey &&\\n-              !altKey\\n-            ) {\\n-              state.shouldPreventClick = true;\\n-            }\\n-          }\\n-\\n-          const pressTarget = state.pressTarget;\\n-          dispatchPressEndEvents(event, context, props, state);\\n-          const onPress = props.onPress;\\n-\\n-          if (pressTarget !== null && isFunction(onPress)) {\\n-            if (\\n-              !isKeyboardEvent &&\\n-              pressTarget !== null &&\\n-              target !== null &&\\n-              !targetIsDocument(pressTarget)\\n-            ) {\\n-              if (\\n-                pointerType === \'mouse\' &&\\n-                context.isTargetWithinNode(target, pressTarget)\\n-              ) {\\n-                state.isPressWithinResponderRegion = true;\\n-              } else {\\n-                // If the event target isn\'t within the press target, check if we\'re still\\n-                // within the responder region. The region may have changed if the\\n-                // element\'s layout was modified after activation.\\n-                updateIsPressWithinResponderRegion(\\n-                  touchEvent || nativeEvent,\\n-                  context,\\n-                  props,\\n-                  state,\\n-                );\\n-              }\\n-            }\\n-\\n-            if (state.isPressWithinResponderRegion && buttons !== 4) {\\n-              dispatchEvent(\\n-                event,\\n-                onPress,\\n-                context,\\n-                state,\\n-                \'press\',\\n-                DiscreteEvent,\\n-              );\\n-            }\\n-          }\\n-          state.touchEvent = null;\\n-        } else if (type === \'mouseup\') {\\n-          state.ignoreEmulatedMouseEvents = false;\\n-        }\\n-        break;\\n-      }\\n-\\n-      case \'click\': {\\n-        // \\"keyup\\" occurs after \\"click\\"\\n-        if (previousPointerType !== \'keyboard\') {\\n-          removeRootEventTypes(context, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      // CANCEL\\n-      case \'scroll\': {\\n-        // We ignore incoming scroll events when using mouse events\\n-        if (previousPointerType === \'mouse\') {\\n-          return;\\n-        }\\n-        const pressTarget = state.pressTarget;\\n-        const scrollTarget = nativeEvent.target;\\n-        const doc = context.getActiveDocument();\\n-        // If the scroll target is the document or if the press target\\n-        // is inside the scroll target, then this a scroll that should\\n-        // trigger a cancel.\\n-        if (\\n-          pressTarget !== null &&\\n-          (scrollTarget === doc ||\\n-            context.isTargetWithinNode(pressTarget, scrollTarget))\\n-        ) {\\n-          dispatchCancel(event, context, props, state);\\n-        }\\n-        break;\\n-      }\\n-      case \'pointercancel\':\\n-      case \'touchcancel\':\\n-      case \'dragstart\': {\\n-        dispatchCancel(event, context, props, state);\\n-        break;\\n-      }\\n-      case \'blur\': {\\n-        // If we encounter a blur that happens on the pressed target\\n-        // then disengage the blur.\\n-        if (isPressed && target === state.pressTarget) {\\n-          dispatchCancel(event, context, props, state);\\n-        }\\n-      }\\n-    }\\n-  },\\n-  onUnmount(\\n-    context: ReactDOMResponderContext,\\n-    props: PressProps,\\n-    state: PressState,\\n-  ) {\\n-    unmountResponder(context, props, state);\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const PressResponder = React.DEPRECATED_createResponder(\\n-  \'Press\',\\n-  pressResponderImpl,\\n-);\\n-\\n-export function usePress(\\n-  props: PressProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(PressResponder, props);\\n-}"},{"sha":"d2bb32e45ed58d26f4c3bc5bb43387c39a1273a3","filename":"packages/react-interactions/events/src/dom/Tap.js","status":"removed","additions":0,"deletions":734,"changes":734,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Tap.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/Tap.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/Tap.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,734 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {\\n-  ReactDOMResponderContext,\\n-  ReactDOMResponderEvent,\\n-  PointerType,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-import type {ReactEventResponderListener} from \'shared/ReactTypes\';\\n-\\n-import * as React from \'react\';\\n-import {\\n-  buttonsEnum,\\n-  dispatchDiscreteEvent,\\n-  dispatchUserBlockingEvent,\\n-  getTouchById,\\n-  hasModifierKey,\\n-  hasPointerEvents,\\n-} from \'./shared\';\\n-\\n-type TapProps = $ReadOnly<{|\\n-  disabled?: boolean,\\n-  maximumDistance?: number,\\n-  preventDefault?: boolean,\\n-  onAuxiliaryTap?: (e: TapEvent) => void,\\n-  onTapCancel?: (e: TapEvent) => void,\\n-  onTapChange?: boolean => void,\\n-  onTapEnd?: (e: TapEvent) => void,\\n-  onTapStart?: (e: TapEvent) => void,\\n-  onTapUpdate?: (e: TapEvent) => void,\\n-|}>;\\n-\\n-type TapGestureState = {|\\n-  altKey: boolean,\\n-  ctrlKey: boolean,\\n-  height: number,\\n-  metaKey: boolean,\\n-  pageX: number,\\n-  pageY: number,\\n-  pointerType: PointerType,\\n-  pressure: number,\\n-  screenX: number,\\n-  screenY: number,\\n-  shiftKey: boolean,\\n-  tangentialPressure: number,\\n-  target: null | Element,\\n-  tiltX: number,\\n-  tiltY: number,\\n-  timeStamp: number,\\n-  twist: number,\\n-  width: number,\\n-  x: number,\\n-  y: number,\\n-|};\\n-\\n-type TapState = {|\\n-  activePointerId: null | number,\\n-  buttons: 0 | 1 | 4,\\n-  gestureState: TapGestureState,\\n-  ignoreEmulatedEvents: boolean,\\n-  initialPosition: {|x: number, y: number|},\\n-  isActive: boolean,\\n-  isAuxiliaryActive: boolean,\\n-  pointerType: PointerType,\\n-  responderTarget: null | Element,\\n-  rootEvents: null | Array<string>,\\n-  shouldPreventDefault: boolean,\\n-|};\\n-\\n-type TapEventType =\\n-  | \'tap:auxiliary\'\\n-  | \'tap:cancel\'\\n-  | \'tap:change\'\\n-  | \'tap:end\'\\n-  | \'tap:start\'\\n-  | \'tap:update\';\\n-\\n-type TapEvent = {|\\n-  ...TapGestureState,\\n-  defaultPrevented: boolean,\\n-  type: TapEventType,\\n-|};\\n-\\n-/**\\n- * Native event dependencies\\n- */\\n-\\n-const targetEventTypes = hasPointerEvents\\n-  ? [\'pointerdown\']\\n-  : [\'mousedown\', \'touchstart\'];\\n-\\n-const rootEventTypes = hasPointerEvents\\n-  ? [\\n-      \'click_active\',\\n-      \'contextmenu\',\\n-      \'pointerup\',\\n-      \'pointermove\',\\n-      \'pointercancel\',\\n-      \'scroll\',\\n-      \'blur\',\\n-    ]\\n-  : [\\n-      \'click_active\',\\n-      \'contextmenu\',\\n-      \'mouseup\',\\n-      \'mousemove\',\\n-      \'dragstart\',\\n-      \'touchend\',\\n-      \'touchmove\',\\n-      \'touchcancel\',\\n-      \'scroll\',\\n-      \'blur\',\\n-    ];\\n-\\n-/**\\n- * Responder and gesture state\\n- */\\n-\\n-function createInitialState(): TapState {\\n-  return {\\n-    activePointerId: null,\\n-    buttons: 0,\\n-    ignoreEmulatedEvents: false,\\n-    isActive: false,\\n-    isAuxiliaryActive: false,\\n-    initialPosition: {x: 0, y: 0},\\n-    pointerType: \'\',\\n-    responderTarget: null,\\n-    rootEvents: null,\\n-    shouldPreventDefault: true,\\n-    gestureState: {\\n-      altKey: false,\\n-      ctrlKey: false,\\n-      height: 1,\\n-      metaKey: false,\\n-      pageX: 0,\\n-      pageY: 0,\\n-      pointerType: \'\',\\n-      pressure: 0,\\n-      screenX: 0,\\n-      screenY: 0,\\n-      shiftKey: false,\\n-      tangentialPressure: 0,\\n-      target: null,\\n-      tiltX: 0,\\n-      tiltY: 0,\\n-      timeStamp: 0,\\n-      twist: 0,\\n-      width: 1,\\n-      x: 0,\\n-      y: 0,\\n-    },\\n-  };\\n-}\\n-\\n-function createPointerEventGestureState(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-  event: ReactDOMResponderEvent,\\n-): TapGestureState {\\n-  const timeStamp = context.getTimeStamp();\\n-  const nativeEvent = (event.nativeEvent: any);\\n-  const {\\n-    altKey,\\n-    ctrlKey,\\n-    height,\\n-    metaKey,\\n-    pageX,\\n-    pageY,\\n-    pointerType,\\n-    pressure,\\n-    screenX,\\n-    screenY,\\n-    shiftKey,\\n-    tangentialPressure,\\n-    tiltX,\\n-    tiltY,\\n-    twist,\\n-    width,\\n-    clientX,\\n-    clientY,\\n-  } = nativeEvent;\\n-\\n-  return {\\n-    altKey,\\n-    ctrlKey,\\n-    height,\\n-    metaKey,\\n-    pageX,\\n-    pageY,\\n-    pointerType,\\n-    pressure,\\n-    screenX,\\n-    screenY,\\n-    shiftKey,\\n-    tangentialPressure,\\n-    target: state.responderTarget,\\n-    tiltX,\\n-    tiltY,\\n-    timeStamp,\\n-    twist,\\n-    width,\\n-    x: clientX,\\n-    y: clientY,\\n-  };\\n-}\\n-\\n-function createFallbackGestureState(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-  event: ReactDOMResponderEvent,\\n-): TapGestureState {\\n-  const timeStamp = context.getTimeStamp();\\n-  const nativeEvent = (event.nativeEvent: any);\\n-  const eType = event.type;\\n-  const {altKey, ctrlKey, metaKey, shiftKey} = nativeEvent;\\n-  const isCancelType = eType === \'dragstart\' || eType === \'touchcancel\';\\n-  const isEndType = eType === \'mouseup\' || eType === \'touchend\';\\n-  const isTouchEvent = event.pointerType === \'touch\';\\n-\\n-  let pointerEvent = nativeEvent;\\n-  if (!hasPointerEvents && isTouchEvent) {\\n-    const touch = getTouchById(nativeEvent, state.activePointerId);\\n-    if (touch != null) {\\n-      pointerEvent = touch;\\n-    }\\n-  }\\n-\\n-  const {\\n-    pageX,\\n-    pageY,\\n-    // $FlowExpectedError: missing from \'Touch\' typedef\\n-    radiusX,\\n-    // $FlowExpectedError: missing from \'Touch\' typedef\\n-    radiusY,\\n-    // $FlowExpectedError: missing from \'Touch\' typedef\\n-    rotationAngle,\\n-    screenX,\\n-    screenY,\\n-    clientX,\\n-    clientY,\\n-  } = pointerEvent;\\n-\\n-  return {\\n-    altKey,\\n-    ctrlKey,\\n-    height: !isCancelType && radiusY != null ? radiusY * 2 : 1,\\n-    metaKey,\\n-    pageX: isCancelType ? 0 : pageX,\\n-    pageY: isCancelType ? 0 : pageY,\\n-    pointerType: event.pointerType,\\n-    pressure: isEndType || isCancelType ? 0 : isTouchEvent ? 1 : 0.5,\\n-    screenX: isCancelType ? 0 : screenX,\\n-    screenY: isCancelType ? 0 : screenY,\\n-    shiftKey,\\n-    tangentialPressure: 0,\\n-    target: state.responderTarget,\\n-    tiltX: 0,\\n-    tiltY: 0,\\n-    timeStamp,\\n-    twist: rotationAngle != null ? rotationAngle : 0,\\n-    width: !isCancelType && radiusX != null ? radiusX * 2 : 1,\\n-    x: isCancelType ? 0 : clientX,\\n-    y: isCancelType ? 0 : clientY,\\n-  };\\n-}\\n-\\n-const createGestureState = hasPointerEvents\\n-  ? createPointerEventGestureState\\n-  : createFallbackGestureState;\\n-\\n-/**\\n- * Managing root events\\n- */\\n-\\n-function addRootEventTypes(\\n-  rootEvents: Array<string>,\\n-  context: ReactDOMResponderContext,\\n-  state: TapState,\\n-): void {\\n-  if (!state.rootEvents) {\\n-    state.rootEvents = rootEvents;\\n-    context.addRootEventTypes(state.rootEvents);\\n-  }\\n-}\\n-\\n-function removeRootEventTypes(\\n-  context: ReactDOMResponderContext,\\n-  state: TapState,\\n-): void {\\n-  if (state.rootEvents != null) {\\n-    context.removeRootEventTypes(state.rootEvents);\\n-    state.rootEvents = null;\\n-  }\\n-}\\n-\\n-/**\\n- * Managing pointers\\n- */\\n-\\n-function getHitTarget(\\n-  event: ReactDOMResponderEvent,\\n-  context: ReactDOMResponderContext,\\n-  state: TapState,\\n-): null | Element | Document {\\n-  if (!hasPointerEvents && event.pointerType === \'touch\') {\\n-    const doc = context.getActiveDocument();\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const touch = getTouchById(nativeEvent, state.activePointerId);\\n-    if (touch != null) {\\n-      return doc.elementFromPoint(touch.clientX, touch.clientY);\\n-    } else {\\n-      return null;\\n-    }\\n-  }\\n-  return event.target;\\n-}\\n-\\n-function isActivePointer(\\n-  event: ReactDOMResponderEvent,\\n-  state: TapState,\\n-): boolean {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  const activePointerId = state.activePointerId;\\n-\\n-  if (hasPointerEvents) {\\n-    const eventPointerId = nativeEvent.pointerId;\\n-    if (activePointerId != null && eventPointerId != null) {\\n-      return (\\n-        state.pointerType === event.pointerType &&\\n-        activePointerId === eventPointerId\\n-      );\\n-    } else {\\n-      return true;\\n-    }\\n-  } else {\\n-    if (event.pointerType === \'touch\') {\\n-      const touch = getTouchById(nativeEvent, activePointerId);\\n-      return touch != null;\\n-    } else {\\n-      // accept all events that don\'t have pointer ids\\n-      return true;\\n-    }\\n-  }\\n-}\\n-\\n-function isAuxiliary(buttons: number, event: ReactDOMResponderEvent): boolean {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  const isPrimaryPointer =\\n-    buttons === buttonsEnum.primary || event.pointerType === \'touch\';\\n-  return (\\n-    // middle-click\\n-    buttons === buttonsEnum.auxiliary ||\\n-    // open-in-new-tab\\n-    (isPrimaryPointer && nativeEvent.metaKey) ||\\n-    // open-in-new-window\\n-    (isPrimaryPointer && nativeEvent.shiftKey)\\n-  );\\n-}\\n-\\n-function shouldActivate(event: ReactDOMResponderEvent): boolean {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  const isPrimaryPointer =\\n-    nativeEvent.buttons === buttonsEnum.primary ||\\n-    event.pointerType === \'touch\';\\n-  return isPrimaryPointer && !hasModifierKey(event);\\n-}\\n-\\n-/**\\n- * Communicating gesture state back to components\\n- */\\n-\\n-function dispatchStart(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-): void {\\n-  const type = \'tap:start\';\\n-  const onTapStart = props.onTapStart;\\n-  if (onTapStart != null) {\\n-    const payload = context.objectAssign({}, state.gestureState, {type});\\n-    dispatchDiscreteEvent(context, payload, onTapStart);\\n-  }\\n-  dispatchChange(context, props, state);\\n-}\\n-\\n-function dispatchChange(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-): void {\\n-  const onTapChange = props.onTapChange;\\n-  if (onTapChange != null) {\\n-    const payload = state.isActive;\\n-    dispatchDiscreteEvent(context, payload, onTapChange);\\n-  }\\n-}\\n-\\n-function dispatchUpdate(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-) {\\n-  const type = \'tap:update\';\\n-  const onTapUpdate = props.onTapUpdate;\\n-  if (onTapUpdate != null) {\\n-    const payload = context.objectAssign({}, state.gestureState, {type});\\n-    dispatchUserBlockingEvent(context, payload, onTapUpdate);\\n-  }\\n-}\\n-\\n-function dispatchEnd(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-): void {\\n-  const type = \'tap:end\';\\n-  const onTapEnd = props.onTapEnd;\\n-  dispatchChange(context, props, state);\\n-  if (onTapEnd != null) {\\n-    const defaultPrevented = state.shouldPreventDefault === true;\\n-    const payload = context.objectAssign({}, state.gestureState, {\\n-      defaultPrevented,\\n-      type,\\n-    });\\n-    dispatchDiscreteEvent(context, payload, onTapEnd);\\n-  }\\n-}\\n-\\n-function dispatchCancel(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-): void {\\n-  const type = \'tap:cancel\';\\n-  const onTapCancel = props.onTapCancel;\\n-  dispatchChange(context, props, state);\\n-  if (onTapCancel != null) {\\n-    const payload = context.objectAssign({}, state.gestureState, {type});\\n-    dispatchDiscreteEvent(context, payload, onTapCancel);\\n-  }\\n-}\\n-\\n-function dispatchAuxiliaryTap(\\n-  context: ReactDOMResponderContext,\\n-  props: TapProps,\\n-  state: TapState,\\n-): void {\\n-  const type = \'tap:auxiliary\';\\n-  const onAuxiliaryTap = props.onAuxiliaryTap;\\n-  if (onAuxiliaryTap != null) {\\n-    const payload = context.objectAssign({}, state.gestureState, {\\n-      defaultPrevented: false,\\n-      type,\\n-    });\\n-    dispatchDiscreteEvent(context, payload, onAuxiliaryTap);\\n-  }\\n-}\\n-\\n-/**\\n- * Responder implementation\\n- */\\n-\\n-const responderImpl = {\\n-  targetEventTypes,\\n-  getInitialState(): TapState {\\n-    return createInitialState();\\n-  },\\n-  onEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: TapProps,\\n-    state: TapState,\\n-  ): void {\\n-    if (props.disabled) {\\n-      removeRootEventTypes(context, state);\\n-      if (state.isActive) {\\n-        state.isActive = false;\\n-        dispatchCancel(context, props, state);\\n-      }\\n-      return;\\n-    }\\n-\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const eventTarget: Element = nativeEvent.target;\\n-    const eventType = event.type;\\n-\\n-    switch (eventType) {\\n-      // START\\n-      case \'pointerdown\':\\n-      case \'mousedown\':\\n-      case \'touchstart\': {\\n-        if (eventType === \'mousedown\' && state.ignoreEmulatedEvents) {\\n-          return;\\n-        }\\n-\\n-        if (!state.isActive) {\\n-          if (hasPointerEvents) {\\n-            const pointerId = nativeEvent.pointerId;\\n-            state.activePointerId = pointerId;\\n-            // Make mouse and touch pointers consistent.\\n-            // Flow bug: https://github.com/facebook/flow/issues/8055\\n-            // $FlowExpectedError\\n-            eventTarget.releasePointerCapture(pointerId);\\n-          } else {\\n-            if (eventType === \'touchstart\') {\\n-              const targetTouches = nativeEvent.targetTouches;\\n-              if (targetTouches.length === 1) {\\n-                state.activePointerId = targetTouches[0].identifier;\\n-              } else {\\n-                return;\\n-              }\\n-            }\\n-          }\\n-\\n-          const activate = shouldActivate(event);\\n-          const buttons =\\n-            nativeEvent.button === 1\\n-              ? buttonsEnum.auxiliary\\n-              : nativeEvent.buttons;\\n-          const activateAuxiliary = isAuxiliary(buttons, event);\\n-\\n-          if (activate || activateAuxiliary) {\\n-            state.buttons = buttons;\\n-            state.pointerType = event.pointerType;\\n-            state.responderTarget = context.getResponderNode();\\n-            addRootEventTypes(rootEventTypes, context, state);\\n-            if (!hasPointerEvents) {\\n-              if (eventType === \'touchstart\') {\\n-                state.ignoreEmulatedEvents = true;\\n-              }\\n-            }\\n-          }\\n-\\n-          if (activateAuxiliary) {\\n-            state.isAuxiliaryActive = true;\\n-          } else if (activate) {\\n-            const gestureState = createGestureState(\\n-              context,\\n-              props,\\n-              state,\\n-              event,\\n-            );\\n-            state.isActive = true;\\n-            state.shouldPreventDefault = props.preventDefault !== false;\\n-            state.gestureState = gestureState;\\n-            state.initialPosition.x = gestureState.x;\\n-            state.initialPosition.y = gestureState.y;\\n-            dispatchStart(context, props, state);\\n-          }\\n-        } else if (\\n-          !isActivePointer(event, state) ||\\n-          (eventType === \'touchstart\' && nativeEvent.targetTouches.length > 1)\\n-        ) {\\n-          // Cancel the gesture if a second pointer becomes active on the target.\\n-          state.isActive = false;\\n-          dispatchCancel(context, props, state);\\n-        }\\n-        break;\\n-      }\\n-    }\\n-  },\\n-  onRootEvent(\\n-    event: ReactDOMResponderEvent,\\n-    context: ReactDOMResponderContext,\\n-    props: TapProps,\\n-    state: TapState,\\n-  ): void {\\n-    const nativeEvent: any = event.nativeEvent;\\n-    const eventType = event.type;\\n-    const hitTarget = getHitTarget(event, context, state);\\n-\\n-    switch (eventType) {\\n-      // UPDATE\\n-      case \'pointermove\':\\n-      case \'mousemove\':\\n-      case \'touchmove\': {\\n-        if (!hasPointerEvents) {\\n-          if (eventType === \'mousemove\' && state.ignoreEmulatedEvents) {\\n-            return;\\n-          }\\n-        }\\n-\\n-        if (state.isActive && isActivePointer(event, state)) {\\n-          state.gestureState = createGestureState(context, props, state, event);\\n-          let shouldUpdate = true;\\n-\\n-          if (!context.isTargetWithinResponder(hitTarget)) {\\n-            shouldUpdate = false;\\n-          } else if (\\n-            props.maximumDistance != null &&\\n-            props.maximumDistance >= 10\\n-          ) {\\n-            const maxDistance = props.maximumDistance;\\n-            const initialPosition = state.initialPosition;\\n-            const currentPosition = state.gestureState;\\n-            const moveX = initialPosition.x - currentPosition.x;\\n-            const moveY = initialPosition.y - currentPosition.y;\\n-            const moveDistance = Math.sqrt(moveX * moveX + moveY * moveY);\\n-            if (moveDistance > maxDistance) {\\n-              shouldUpdate = false;\\n-            }\\n-          }\\n-\\n-          if (shouldUpdate) {\\n-            dispatchUpdate(context, props, state);\\n-          } else {\\n-            state.isActive = false;\\n-            dispatchCancel(context, props, state);\\n-          }\\n-        }\\n-        break;\\n-      }\\n-\\n-      // END\\n-      case \'pointerup\':\\n-      case \'mouseup\':\\n-      case \'touchend\': {\\n-        if (state.isActive && isActivePointer(event, state)) {\\n-          state.gestureState = createGestureState(context, props, state, event);\\n-          state.isActive = false;\\n-          if (isAuxiliary(state.buttons, event)) {\\n-            dispatchCancel(context, props, state);\\n-            dispatchAuxiliaryTap(context, props, state);\\n-            // Remove the root events here as no \'click\' event is dispatched\\n-            removeRootEventTypes(context, state);\\n-          } else if (\\n-            !context.isTargetWithinResponder(hitTarget) ||\\n-            hasModifierKey(event)\\n-          ) {\\n-            dispatchCancel(context, props, state);\\n-          } else {\\n-            dispatchEnd(context, props, state);\\n-          }\\n-        } else if (\\n-          state.isAuxiliaryActive &&\\n-          isAuxiliary(state.buttons, event)\\n-        ) {\\n-          state.isAuxiliaryActive = false;\\n-          state.gestureState = createGestureState(context, props, state, event);\\n-          dispatchAuxiliaryTap(context, props, state);\\n-          // Remove the root events here as no \'click\' event is dispatched\\n-          removeRootEventTypes(context, state);\\n-        }\\n-\\n-        if (!hasPointerEvents) {\\n-          if (eventType === \'mouseup\') {\\n-            state.ignoreEmulatedEvents = false;\\n-          }\\n-        }\\n-        break;\\n-      }\\n-\\n-      // CANCEL\\n-      case \'contextmenu\':\\n-      case \'pointercancel\':\\n-      case \'touchcancel\':\\n-      case \'dragstart\': {\\n-        if (state.isActive && isActivePointer(event, state)) {\\n-          state.gestureState = createGestureState(context, props, state, event);\\n-          state.isActive = false;\\n-          dispatchCancel(context, props, state);\\n-          removeRootEventTypes(context, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      // CANCEL\\n-      case \'scroll\': {\\n-        if (\\n-          state.isActive &&\\n-          state.responderTarget != null &&\\n-          // We ignore incoming scroll events when using mouse events\\n-          state.pointerType !== \'mouse\' &&\\n-          // If the scroll target is the document or if the pointer target\\n-          // is within the \'scroll\' target, then cancel the gesture\\n-          context.isTargetWithinNode(state.responderTarget, nativeEvent.target)\\n-        ) {\\n-          state.gestureState = createGestureState(context, props, state, event);\\n-          state.isActive = false;\\n-          dispatchCancel(context, props, state);\\n-          removeRootEventTypes(context, state);\\n-        }\\n-        break;\\n-      }\\n-\\n-      case \'click\': {\\n-        if (state.shouldPreventDefault) {\\n-          nativeEvent.preventDefault();\\n-        }\\n-        removeRootEventTypes(context, state);\\n-        break;\\n-      }\\n-      case \'blur\': {\\n-        // If we encounter a blur that happens on the pressed target\\n-        // then disengage the blur.\\n-        if (state.isActive && nativeEvent.target === state.responderTarget) {\\n-          dispatchCancel(context, props, state);\\n-        }\\n-      }\\n-    }\\n-  },\\n-  onUnmount(\\n-    context: ReactDOMResponderContext,\\n-    props: TapProps,\\n-    state: TapState,\\n-  ): void {\\n-    removeRootEventTypes(context, state);\\n-    if (state.isActive) {\\n-      state.isActive = false;\\n-      dispatchCancel(context, props, state);\\n-    }\\n-  },\\n-};\\n-\\n-// $FlowFixMe Can\'t add generic types without causing a parsing/syntax errors\\n-export const TapResponder = React.DEPRECATED_createResponder(\\n-  \'Tap\',\\n-  responderImpl,\\n-);\\n-\\n-export function useTap(\\n-  props: TapProps,\\n-): ?ReactEventResponderListener<any, any> {\\n-  return React.DEPRECATED_useResponder(TapResponder, props);\\n-}"},{"sha":"379203bf330ea3dc37fb90923ca1d330b19478c7","filename":"packages/react-interactions/events/src/dom/__tests__/ContextMenu-test.internal.js","status":"removed","additions":0,"deletions":204,"changes":204,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/ContextMenu-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/ContextMenu-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/ContextMenu-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,204 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {\\n-  buttonsType,\\n-  createEventTarget,\\n-  platform,\\n-  setPointerEvent,\\n-} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let useContextMenu;\\n-\\n-function initializeModules(hasPointerEvents) {\\n-  setPointerEvent(hasPointerEvents);\\n-  jest.resetModules();\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    useContextMenu = require(\'react-interactions/events/context-menu\')\\n-      .useContextMenu;\\n-  }\\n-}\\n-\\n-const forcePointerEvents = true;\\n-const table = [[forcePointerEvents], [!forcePointerEvents]];\\n-\\n-describe.each(table)(\'ContextMenu responder\', hasPointerEvents => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    initializeModules(hasPointerEvents);\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  describe(\'all platforms\', () => {\\n-    // @gate experimental\\n-    it(\'mouse right-click\', () => {\\n-      const onContextMenu = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({onContextMenu});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({preventDefault});\\n-      expect(preventDefault).toHaveBeenCalledTimes(1);\\n-      expect(onContextMenu).toHaveBeenCalledTimes(1);\\n-      expect(onContextMenu).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          buttons: buttonsType.secondary,\\n-          pointerType: \'mouse\',\\n-          type: \'contextmenu\',\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'touch long-press\', () => {\\n-      const onContextMenu = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({onContextMenu});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({preventDefault}, {pointerType: \'touch\'});\\n-      expect(preventDefault).toHaveBeenCalledTimes(1);\\n-      expect(onContextMenu).toHaveBeenCalledTimes(1);\\n-      expect(onContextMenu).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          buttons: buttonsType.none,\\n-          pointerType: \'touch\',\\n-          type: \'contextmenu\',\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'\\"disabled\\" is true\', () => {\\n-      const onContextMenu = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({\\n-          onContextMenu,\\n-          disabled: true,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu();\\n-      expect(onContextMenu).toHaveBeenCalledTimes(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'\\"preventDefault\\" is false\', () => {\\n-      const preventDefault = jest.fn();\\n-      const onContextMenu = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({\\n-          onContextMenu,\\n-          preventDefault: false,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({preventDefault});\\n-      expect(preventDefault).toHaveBeenCalledTimes(0);\\n-      expect(onContextMenu).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  describe(\'mac platform\', () => {\\n-    beforeEach(() => {\\n-      platform.set(\'mac\');\\n-      jest.resetModules();\\n-    });\\n-\\n-    afterEach(() => {\\n-      platform.clear();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'mouse modified left-click\', () => {\\n-      const onContextMenu = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({onContextMenu});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({}, {modified: true});\\n-      expect(onContextMenu).toHaveBeenCalledTimes(1);\\n-      expect(onContextMenu).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          buttons: buttonsType.primary,\\n-          pointerType: \'mouse\',\\n-          type: \'contextmenu\',\\n-        }),\\n-      );\\n-    });\\n-  });\\n-\\n-  describe(\'windows platform\', () => {\\n-    beforeEach(() => {\\n-      platform.set(\'windows\');\\n-      jest.resetModules();\\n-    });\\n-\\n-    afterEach(() => {\\n-      platform.clear();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'mouse modified left-click\', () => {\\n-      const onContextMenu = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useContextMenu({onContextMenu});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({}, {modified: true});\\n-      expect(onContextMenu).toHaveBeenCalledTimes(0);\\n-    });\\n-  });\\n-});"},{"sha":"a7500a1af9a2346fcf64c0b3c3db42ea5ee32424","filename":"packages/react-interactions/events/src/dom/__tests__/Focus-test.internal.js","status":"removed","additions":0,"deletions":403,"changes":403,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Focus-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Focus-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/Focus-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,403 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {\\n-  createEventTarget,\\n-  setPointerEvent,\\n-  platform,\\n-} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let FocusResponder;\\n-let useFocus;\\n-\\n-function initializeModules(hasPointerEvents) {\\n-  setPointerEvent(hasPointerEvents);\\n-  jest.resetModules();\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    FocusResponder = require(\'react-interactions/events/deprecated-focus\')\\n-      .FocusResponder;\\n-    useFocus = require(\'react-interactions/events/deprecated-focus\').useFocus;\\n-  }\\n-}\\n-\\n-const forcePointerEvents = true;\\n-const table = [[forcePointerEvents], [!forcePointerEvents]];\\n-\\n-describe.each(table)(\'Focus responder\', hasPointerEvents => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    initializeModules(hasPointerEvents);\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onBlur, onFocus, ref;\\n-\\n-    const componentInit = () => {\\n-      onBlur = jest.fn();\\n-      onFocus = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocus({\\n-          disabled: true,\\n-          onBlur,\\n-          onFocus,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'does not call callbacks\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      target.blur();\\n-      expect(onFocus).not.toBeCalled();\\n-      expect(onBlur).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onBlur\', () => {\\n-    let onBlur, ref;\\n-\\n-    const componentInit = () => {\\n-      onBlur = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocus({\\n-          onBlur,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"blur\\" event\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      target.blur();\\n-      expect(onBlur).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  describe(\'onFocus\', () => {\\n-    let onFocus, ref, innerRef;\\n-\\n-    const componentInit = () => {\\n-      onFocus = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocus({\\n-          onFocus,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            <a ref={innerRef} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"focus\\" event\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      expect(onFocus).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called if descendants of target receive focus\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(innerRef.current);\\n-      target.focus();\\n-      expect(onFocus).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called with the correct pointerType: mouse\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup();\\n-      expect(onFocus).toHaveBeenCalledTimes(1);\\n-      expect(onFocus).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'mouse\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called with the correct pointerType: touch\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const pointerType = \'touch\';\\n-      target.pointerdown({pointerType});\\n-      target.pointerup({pointerType});\\n-      expect(onFocus).toHaveBeenCalledTimes(1);\\n-      expect(onFocus).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'touch\'}),\\n-      );\\n-    });\\n-\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      it(\'is called with the correct pointerType: pen\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const pointerType = \'pen\';\\n-        target.pointerdown({pointerType});\\n-        target.pointerup({pointerType});\\n-        expect(onFocus).toHaveBeenCalledTimes(1);\\n-        expect(onFocus).toHaveBeenCalledWith(\\n-          expect.objectContaining({pointerType: \'pen\'}),\\n-        );\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    it(\'is called with the correct pointerType using a keyboard\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'LeftArrow\'});\\n-      target.focus();\\n-      expect(onFocus).toHaveBeenCalledTimes(1);\\n-      expect(onFocus).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'keyboard\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called with the correct pointerType using Tab+altKey on Mac\', () => {\\n-      platform.set(\'mac\');\\n-      jest.resetModules();\\n-      initializeModules();\\n-      componentInit();\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Tab\', altKey: true});\\n-      target.focus();\\n-\\n-      expect(onFocus).toHaveBeenCalledTimes(1);\\n-      expect(onFocus).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          pointerType: \'keyboard\',\\n-        }),\\n-      );\\n-\\n-      platform.clear();\\n-    });\\n-  });\\n-\\n-  describe(\'onFocusChange\', () => {\\n-    let onFocusChange, ref, innerRef;\\n-\\n-    const componentInit = () => {\\n-      onFocusChange = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocus({\\n-          onFocusChange,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            <div ref={innerRef} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"blur\\" and \\"focus\\" events\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      expect(onFocusChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusChange).toHaveBeenCalledWith(true);\\n-      target.blur();\\n-      expect(onFocusChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"blur\\" and \\"focus\\" events on descendants\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(innerRef.current);\\n-      target.focus();\\n-      expect(onFocusChange).toHaveBeenCalledTimes(0);\\n-      target.blur();\\n-      expect(onFocusChange).toHaveBeenCalledTimes(0);\\n-    });\\n-  });\\n-\\n-  describe(\'onFocusVisibleChange\', () => {\\n-    let onFocusVisibleChange, ref, innerRef;\\n-\\n-    const componentInit = () => {\\n-      onFocusVisibleChange = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocus({\\n-          onFocusVisibleChange,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            <div ref={innerRef} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"focus\\" and \\"blur\\" if keyboard navigation is active\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const containerTarget = createEventTarget(container);\\n-      // use keyboard first\\n-      containerTarget.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusVisibleChange).toHaveBeenCalledWith(true);\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusVisibleChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called if non-keyboard event is dispatched on target previously focused with keyboard\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const containerTarget = createEventTarget(container);\\n-      // use keyboard first\\n-      containerTarget.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusVisibleChange).toHaveBeenCalledWith(true);\\n-      // then use pointer on the target, focus should no longer be visible\\n-      target.pointerdown();\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusVisibleChange).toHaveBeenCalledWith(false);\\n-      // onFocusVisibleChange should not be called again\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(2);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"focus\\" and \\"blur\\" events without keyboard\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const containerTarget = createEventTarget(container);\\n-      target.pointerdown();\\n-      target.pointerup();\\n-      containerTarget.pointerdown();\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"blur\\" and \\"focus\\" events on descendants\', () => {\\n-      componentInit();\\n-      const innerTarget = createEventTarget(innerRef.current);\\n-      const containerTarget = createEventTarget(container);\\n-      containerTarget.keydown({key: \'Tab\'});\\n-      innerTarget.focus();\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(0);\\n-      innerTarget.blur({relatedTarget: container});\\n-      expect(onFocusVisibleChange).toHaveBeenCalledTimes(0);\\n-    });\\n-  });\\n-\\n-  describe(\'nested Focus components\', () => {\\n-    // @gate experimental\\n-    it(\'propagates events in the correct order\', () => {\\n-      const events = [];\\n-      const innerRef = React.createRef();\\n-      const outerRef = React.createRef();\\n-      const createEventHandler = msg => () => {\\n-        events.push(msg);\\n-      };\\n-\\n-      const Inner = () => {\\n-        const listener = useFocus({\\n-          onBlur: createEventHandler(\'inner: onBlur\'),\\n-          onFocus: createEventHandler(\'inner: onFocus\'),\\n-          onFocusChange: createEventHandler(\'inner: onFocusChange\'),\\n-        });\\n-        return <div ref={innerRef} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-\\n-      const Outer = () => {\\n-        const listener = useFocus({\\n-          onBlur: createEventHandler(\'outer: onBlur\'),\\n-          onFocus: createEventHandler(\'outer: onFocus\'),\\n-          onFocusChange: createEventHandler(\'outer: onFocusChange\'),\\n-        });\\n-        return (\\n-          <div ref={outerRef} DEPRECATED_flareListeners={listener}>\\n-            <Inner />\\n-          </div>\\n-        );\\n-      };\\n-\\n-      ReactDOM.render(<Outer />, container);\\n-\\n-      const innerTarget = createEventTarget(innerRef.current);\\n-      const outerTarget = createEventTarget(outerRef.current);\\n-\\n-      outerTarget.focus();\\n-      outerTarget.blur();\\n-      innerTarget.focus();\\n-      innerTarget.blur();\\n-      expect(events).toEqual([\\n-        \'outer: onFocus\',\\n-        \'outer: onFocusChange\',\\n-        \'outer: onBlur\',\\n-        \'outer: onFocusChange\',\\n-        \'inner: onFocus\',\\n-        \'inner: onFocusChange\',\\n-        \'inner: onBlur\',\\n-        \'inner: onFocusChange\',\\n-      ]);\\n-    });\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'expect displayName to show up for event component\', () => {\\n-    expect(FocusResponder.displayName).toBe(\'Focus\');\\n-  });\\n-});"},{"sha":"9ef287eb028bf8b663324cfab0864d594c8df46d","filename":"packages/react-interactions/events/src/dom/__tests__/FocusWithin-test.internal.js","status":"removed","additions":0,"deletions":574,"changes":574,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/FocusWithin-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/FocusWithin-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/FocusWithin-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,574 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {createEventTarget, setPointerEvent} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let FocusWithinResponder;\\n-let useFocusWithin;\\n-let ReactTestRenderer;\\n-let act;\\n-\\n-const initializeModules = hasPointerEvents => {\\n-  setPointerEvent(hasPointerEvents);\\n-  jest.resetModules();\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  ReactFeatureFlags.enableScopeAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-  ReactTestRenderer = require(\'react-test-renderer\');\\n-  act = ReactTestRenderer.act;\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    FocusWithinResponder = require(\'react-interactions/events/deprecated-focus\')\\n-      .FocusWithinResponder;\\n-    useFocusWithin = require(\'react-interactions/events/deprecated-focus\')\\n-      .useFocusWithin;\\n-  }\\n-};\\n-\\n-const forcePointerEvents = true;\\n-const table = [[forcePointerEvents], [!forcePointerEvents]];\\n-\\n-describe.each(table)(\'FocusWithin responder\', hasPointerEvents => {\\n-  let container;\\n-  let container2;\\n-\\n-  beforeEach(() => {\\n-    initializeModules();\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-    container2 = document.createElement(\'div\');\\n-    document.body.appendChild(container2);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    document.body.removeChild(container2);\\n-    container = null;\\n-    container2 = null;\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onFocusWithinChange, onFocusWithinVisibleChange, ref;\\n-\\n-    const componentInit = () => {\\n-      onFocusWithinChange = jest.fn();\\n-      onFocusWithinVisibleChange = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useFocusWithin({\\n-          disabled: true,\\n-          onFocusWithinChange,\\n-          onFocusWithinVisibleChange,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'prevents custom events being dispatched\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      target.blur();\\n-      expect(onFocusWithinChange).not.toBeCalled();\\n-      expect(onFocusWithinVisibleChange).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onFocusWithinChange\', () => {\\n-    let onFocusWithinChange, ref, innerRef, innerRef2;\\n-\\n-    const Component = ({show}) => {\\n-      const listener = useFocusWithin({\\n-        onFocusWithinChange,\\n-      });\\n-      return (\\n-        <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-          {show && <input ref={innerRef} />}\\n-          <div ref={innerRef2} />\\n-        </div>\\n-      );\\n-    };\\n-\\n-    const componentInit = () => {\\n-      onFocusWithinChange = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      innerRef2 = React.createRef();\\n-      ReactDOM.render(<Component show={true} />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"blur\\" and \\"focus\\" events on focus target\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.focus();\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(true);\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"blur\\" and \\"focus\\" events on descendants\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(innerRef.current);\\n-      target.focus();\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(true);\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is only called once when focus moves within and outside the subtree\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const innerNode1 = innerRef.current;\\n-      const innerNode2 = innerRef.current;\\n-      const target = createEventTarget(node);\\n-      const innerTarget1 = createEventTarget(innerNode1);\\n-      const innerTarget2 = createEventTarget(innerNode2);\\n-\\n-      // focus shifts into subtree\\n-      innerTarget1.focus();\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(true);\\n-      // focus moves around subtree\\n-      innerTarget1.blur({relatedTarget: innerNode2});\\n-      innerTarget2.focus();\\n-      innerTarget2.blur({relatedTarget: node});\\n-      target.focus();\\n-      target.blur({relatedTarget: innerNode1});\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(1);\\n-      // focus shifts outside subtree\\n-      innerTarget1.blur({relatedTarget: container});\\n-      expect(onFocusWithinChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinChange).toHaveBeenCalledWith(false);\\n-    });\\n-  });\\n-\\n-  describe(\'onFocusWithinVisibleChange\', () => {\\n-    let onFocusWithinVisibleChange, ref, innerRef, innerRef2;\\n-\\n-    const Component = ({show}) => {\\n-      const listener = useFocusWithin({\\n-        onFocusWithinVisibleChange,\\n-      });\\n-      return (\\n-        <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-          {show && <input ref={innerRef} />}\\n-          <div ref={innerRef2} />\\n-        </div>\\n-      );\\n-    };\\n-\\n-    const componentInit = () => {\\n-      onFocusWithinVisibleChange = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      innerRef2 = React.createRef();\\n-      ReactDOM.render(<Component show={true} />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"focus\\" and \\"blur\\" on focus target if keyboard was used\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const containerTarget = createEventTarget(container);\\n-      // use keyboard first\\n-      containerTarget.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(true);\\n-      target.blur({relatedTarget: container});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"focus\\" and \\"blur\\" on descendants if keyboard was used\', () => {\\n-      componentInit();\\n-      const innerTarget = createEventTarget(innerRef.current);\\n-      const containerTarget = createEventTarget(container);\\n-      // use keyboard first\\n-      containerTarget.keydown({key: \'Tab\'});\\n-      innerTarget.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(true);\\n-      innerTarget.blur({relatedTarget: container});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called if non-keyboard event is dispatched on target previously focused with keyboard\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const innerNode1 = innerRef.current;\\n-      const innerNode2 = innerRef2.current;\\n-\\n-      const target = createEventTarget(node);\\n-      const innerTarget1 = createEventTarget(innerNode1);\\n-      const innerTarget2 = createEventTarget(innerNode2);\\n-      // use keyboard first\\n-      target.focus();\\n-      target.keydown({key: \'Tab\'});\\n-      target.blur({relatedTarget: innerNode1});\\n-      innerTarget1.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(true);\\n-      // then use pointer on the next target, focus should no longer be visible\\n-      innerTarget2.pointerdown();\\n-      innerTarget1.blur({relatedTarget: innerNode2});\\n-      innerTarget2.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(false);\\n-      // then use keyboard again\\n-      innerTarget2.keydown({key: \'Tab\', shiftKey: true});\\n-      innerTarget2.blur({relatedTarget: innerNode1});\\n-      innerTarget1.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(3);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(true);\\n-      // then use pointer on the target, focus should no longer be visible\\n-      innerTarget1.pointerdown();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(4);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(false);\\n-      // onFocusVisibleChange should not be called again\\n-      innerTarget1.blur({relatedTarget: container});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(4);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"focus\\" and \\"blur\\" events without keyboard\', () => {\\n-      componentInit();\\n-      const innerTarget = createEventTarget(innerRef.current);\\n-      innerTarget.pointerdown();\\n-      innerTarget.pointerup();\\n-      innerTarget.blur({relatedTarget: container});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is only called once when focus moves within and outside the subtree\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const innerNode1 = innerRef.current;\\n-      const innerNode2 = innerRef2.current;\\n-      const target = createEventTarget(node);\\n-      const innerTarget1 = createEventTarget(innerNode1);\\n-      const innerTarget2 = createEventTarget(innerNode2);\\n-\\n-      // focus shifts into subtree\\n-      innerTarget1.focus();\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(1);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(true);\\n-      // focus moves around subtree\\n-      innerTarget1.blur({relatedTarget: innerNode2});\\n-      innerTarget2.focus();\\n-      innerTarget2.blur({relatedTarget: node});\\n-      target.focus();\\n-      target.blur({relatedTarget: innerNode1});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(1);\\n-      // focus shifts outside subtree\\n-      innerTarget1.blur({relatedTarget: container});\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledTimes(2);\\n-      expect(onFocusWithinVisibleChange).toHaveBeenCalledWith(false);\\n-    });\\n-  });\\n-\\n-  describe(\'onBeforeBlurWithin\', () => {\\n-    let onBeforeBlurWithin, onAfterBlurWithin, ref, innerRef, innerRef2;\\n-\\n-    beforeEach(() => {\\n-      onBeforeBlurWithin = jest.fn();\\n-      onAfterBlurWithin = jest.fn();\\n-      ref = React.createRef();\\n-      innerRef = React.createRef();\\n-      innerRef2 = React.createRef();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after a focused element is unmounted\', () => {\\n-      const Component = ({show}) => {\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin,\\n-          onAfterBlurWithin,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            {show && <input ref={innerRef} />}\\n-            <div ref={innerRef2} />\\n-          </div>\\n-        );\\n-      };\\n-\\n-      ReactDOM.render(<Component show={true} />, container);\\n-\\n-      const inner = innerRef.current;\\n-      const target = createEventTarget(inner);\\n-      target.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-      ReactDOM.render(<Component show={false} />, container);\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledWith(\\n-        expect.objectContaining({relatedTarget: inner}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after a nested focused element is unmounted\', () => {\\n-      const Component = ({show}) => {\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin,\\n-          onAfterBlurWithin,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            {show && (\\n-              <div>\\n-                <input ref={innerRef} />\\n-              </div>\\n-            )}\\n-            <div ref={innerRef2} />\\n-          </div>\\n-        );\\n-      };\\n-\\n-      ReactDOM.render(<Component show={true} />, container);\\n-\\n-      const inner = innerRef.current;\\n-      const target = createEventTarget(inner);\\n-      target.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-      ReactDOM.render(<Component show={false} />, container);\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledWith(\\n-        expect.objectContaining({relatedTarget: inner}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after many elements are unmounted\', () => {\\n-      const buttonRef = React.createRef();\\n-      const inputRef = React.createRef();\\n-\\n-      const Component = ({show}) => {\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin,\\n-          onAfterBlurWithin,\\n-        });\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            {show && <button>Press me!</button>}\\n-            {show && <button>Press me!</button>}\\n-            {show && <input ref={inputRef} />}\\n-            {show && <button>Press me!</button>}\\n-            {!show && <button ref={buttonRef}>Press me!</button>}\\n-            {show && <button>Press me!</button>}\\n-            <button>Press me!</button>\\n-            <button>Press me!</button>\\n-          </div>\\n-        );\\n-      };\\n-\\n-      ReactDOM.render(<Component show={true} />, container);\\n-\\n-      inputRef.current.focus();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-      ReactDOM.render(<Component show={false} />, container);\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after a nested focused element is unmounted (with scope query)\', () => {\\n-      const TestScope = React.unstable_Scope;\\n-      const testScopeQuery = (type, props) => true;\\n-      let targetNodes;\\n-      let targetNode;\\n-\\n-      const Component = ({show}) => {\\n-        const scopeRef = React.useRef(null);\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin(event) {\\n-            const scope = scopeRef.current;\\n-            targetNode = innerRef.current;\\n-            targetNodes = scope.DO_NOT_USE_queryAllNodes(testScopeQuery);\\n-          },\\n-        });\\n-\\n-        return (\\n-          <TestScope ref={scopeRef} DEPRECATED_flareListeners={[listener]}>\\n-            {show && <input ref={innerRef} />}\\n-          </TestScope>\\n-        );\\n-      };\\n-\\n-      ReactDOM.render(<Component show={true} />, container);\\n-\\n-      const inner = innerRef.current;\\n-      const target = createEventTarget(inner);\\n-      target.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      ReactDOM.render(<Component show={false} />, container);\\n-      expect(targetNodes).toEqual([targetNode]);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after a focused suspended element is hidden\', () => {\\n-      const Suspense = React.Suspense;\\n-      let suspend = false;\\n-      let resolve;\\n-      const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n-\\n-      function Child() {\\n-        if (suspend) {\\n-          throw promise;\\n-        } else {\\n-          return <input ref={innerRef} />;\\n-        }\\n-      }\\n-\\n-      const Component = ({show}) => {\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin,\\n-          onAfterBlurWithin,\\n-        });\\n-\\n-        return (\\n-          <div DEPRECATED_flareListeners={listener}>\\n-            <Suspense fallback=\\"Loading...\\">\\n-              <Child />\\n-            </Suspense>\\n-          </div>\\n-        );\\n-      };\\n-\\n-      const root = ReactDOM.createRoot(container2);\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-      expect(container2.innerHTML).toBe(\'<div><input></div>\');\\n-\\n-      const inner = innerRef.current;\\n-      const target = createEventTarget(inner);\\n-      target.keydown({key: \'Tab\'});\\n-      target.focus();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-\\n-      suspend = true;\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-      expect(container2.innerHTML).toBe(\\n-        \'<div><input style=\\"display: none;\\">Loading...</div>\',\\n-      );\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(1);\\n-      resolve();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after a focused suspended element is hidden then shown\', () => {\\n-      const Suspense = React.Suspense;\\n-      let suspend = false;\\n-      let resolve;\\n-      const promise = new Promise(resolvePromise => (resolve = resolvePromise));\\n-      const buttonRef = React.createRef();\\n-\\n-      function Child() {\\n-        if (suspend) {\\n-          throw promise;\\n-        } else {\\n-          return <input ref={innerRef} />;\\n-        }\\n-      }\\n-\\n-      const Component = ({show}) => {\\n-        const listener = useFocusWithin({\\n-          onBeforeBlurWithin,\\n-          onAfterBlurWithin,\\n-        });\\n-\\n-        return (\\n-          <div ref={ref} DEPRECATED_flareListeners={listener}>\\n-            <Suspense fallback={<button ref={buttonRef}>Loading...</button>}>\\n-              <Child />\\n-            </Suspense>\\n-          </div>\\n-        );\\n-      };\\n-\\n-      const root = ReactDOM.createRoot(container2);\\n-\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-\\n-      suspend = true;\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(0);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(0);\\n-\\n-      buttonRef.current.focus();\\n-      suspend = false;\\n-      act(() => {\\n-        root.render(<Component />);\\n-      });\\n-      jest.runAllTimers();\\n-      expect(onBeforeBlurWithin).toHaveBeenCalledTimes(1);\\n-      expect(onAfterBlurWithin).toHaveBeenCalledTimes(1);\\n-\\n-      resolve();\\n-    });\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'expect displayName to show up for event component\', () => {\\n-    expect(FocusWithinResponder.displayName).toBe(\'FocusWithin\');\\n-  });\\n-});"},{"sha":"19f6269f2db99c5472cbbbd1548062be9f2894ae","filename":"packages/react-interactions/events/src/dom/__tests__/Hover-test.internal.js","status":"removed","additions":0,"deletions":430,"changes":430,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Hover-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Hover-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/Hover-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,430 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {createEventTarget, setPointerEvent} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let HoverResponder;\\n-let useHover;\\n-\\n-function initializeModules(hasPointerEvents) {\\n-  jest.resetModules();\\n-  setPointerEvent(hasPointerEvents);\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    HoverResponder = require(\'react-interactions/events/hover\').HoverResponder;\\n-    useHover = require(\'react-interactions/events/hover\').useHover;\\n-  }\\n-}\\n-\\n-const forcePointerEvents = true;\\n-const table = [[forcePointerEvents], [!forcePointerEvents]];\\n-\\n-describe.each(table)(\'Hover responder\', hasPointerEvents => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    initializeModules(hasPointerEvents);\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onHoverChange, onHoverStart, onHoverMove, onHoverEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onHoverChange = jest.fn();\\n-      onHoverStart = jest.fn();\\n-      onHoverMove = jest.fn();\\n-      onHoverEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useHover({\\n-          disabled: true,\\n-          onHoverChange,\\n-          onHoverStart,\\n-          onHoverMove,\\n-          onHoverEnd,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'does not call callbacks\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerenter();\\n-      target.pointerexit();\\n-      expect(onHoverChange).not.toBeCalled();\\n-      expect(onHoverStart).not.toBeCalled();\\n-      expect(onHoverMove).not.toBeCalled();\\n-      expect(onHoverEnd).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onHoverStart\', () => {\\n-    let onHoverStart, ref;\\n-\\n-    const componentInit = () => {\\n-      onHoverStart = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useHover({\\n-          onHoverStart: onHoverStart,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called for mouse pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerenter();\\n-      expect(onHoverStart).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called for touch pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\'});\\n-      expect(onHoverStart).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called if a mouse pointer is used after a touch pointer\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\'});\\n-      target.pointerenter();\\n-      expect(onHoverStart).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  describe(\'onHoverChange\', () => {\\n-    let onHoverChange, ref;\\n-\\n-    const componentInit = () => {\\n-      onHoverChange = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useHover({\\n-          onHoverChange,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called for mouse pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerenter();\\n-      expect(onHoverChange).toHaveBeenCalledTimes(1);\\n-      expect(onHoverChange).toHaveBeenCalledWith(true);\\n-      target.pointerexit();\\n-      expect(onHoverChange).toHaveBeenCalledTimes(2);\\n-      expect(onHoverChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called for touch pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\'});\\n-      expect(onHoverChange).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onHoverEnd\', () => {\\n-    let onHoverEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onHoverEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useHover({\\n-          onHoverEnd,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called for mouse pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerenter();\\n-      target.pointerexit();\\n-      expect(onHoverEnd).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      it(\'is called once for cancelled mouse pointers\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerenter();\\n-        target.pointercancel();\\n-        expect(onHoverEnd).toHaveBeenCalledTimes(1);\\n-\\n-        // only called once if cancel follows exit\\n-        onHoverEnd.mockReset();\\n-        target.pointerenter();\\n-        target.pointerexit();\\n-        target.pointercancel();\\n-        expect(onHoverEnd).toHaveBeenCalledTimes(1);\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    it(\'is not called for touch pointers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\'});\\n-      expect(onHoverEnd).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should correctly work with React Portals\', () => {\\n-      componentInit();\\n-      const portalNode = document.createElement(\'div\');\\n-      const divRef = React.createRef();\\n-      const spanRef = React.createRef();\\n-\\n-      function Test() {\\n-        const listener = useHover({\\n-          onHoverEnd,\\n-        });\\n-        return (\\n-          <div ref={divRef} DEPRECATED_flareListeners={listener}>\\n-            {ReactDOM.createPortal(<span ref={spanRef} />, portalNode)}\\n-          </div>\\n-        );\\n-      }\\n-      ReactDOM.render(<Test />, container);\\n-      const div = createEventTarget(divRef.current);\\n-      div.pointerenter();\\n-      const span = createEventTarget(spanRef.current);\\n-      span.pointerexit();\\n-      expect(onHoverEnd).not.toBeCalled();\\n-      const body = createEventTarget(document.body);\\n-      body.pointerexit();\\n-      expect(onHoverEnd).toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onHoverMove\', () => {\\n-    // @gate experimental\\n-    it(\'is called after the active pointer moves\\"\', () => {\\n-      const onHoverMove = jest.fn();\\n-      const ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useHover({\\n-          onHoverMove,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerenter();\\n-      target.pointerhover({x: 0, y: 0});\\n-      target.pointerhover({x: 1, y: 1});\\n-      expect(onHoverMove).toHaveBeenCalledTimes(2);\\n-      expect(onHoverMove).toHaveBeenCalledWith(\\n-        expect.objectContaining({type: \'hovermove\'}),\\n-      );\\n-    });\\n-  });\\n-\\n-  describe(\'nested Hover components\', () => {\\n-    // @gate experimental\\n-    it(\'not propagate by default\', () => {\\n-      const events = [];\\n-      const innerRef = React.createRef();\\n-      const outerRef = React.createRef();\\n-      const createEventHandler = msg => () => {\\n-        events.push(msg);\\n-      };\\n-\\n-      const Inner = () => {\\n-        const listener = useHover({\\n-          onHoverStart: createEventHandler(\'inner: onHoverStart\'),\\n-          onHoverEnd: createEventHandler(\'inner: onHoverEnd\'),\\n-          onHoverChange: createEventHandler(\'inner: onHoverChange\'),\\n-        });\\n-        return <div ref={innerRef} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-\\n-      const Outer = () => {\\n-        const listener = useHover({\\n-          onHoverStart: createEventHandler(\'outer: onHoverStart\'),\\n-          onHoverEnd: createEventHandler(\'outer: onHoverEnd\'),\\n-          onHoverChange: createEventHandler(\'outer: onHoverChange\'),\\n-        });\\n-        return (\\n-          <div ref={outerRef} DEPRECATED_flareListeners={listener}>\\n-            <Inner />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Outer />, container);\\n-\\n-      const innerNode = innerRef.current;\\n-      const outerNode = outerRef.current;\\n-      const innerTarget = createEventTarget(innerNode);\\n-      const outerTarget = createEventTarget(outerNode);\\n-\\n-      outerTarget.pointerenter({relatedTarget: container});\\n-      outerTarget.pointerexit({relatedTarget: innerNode});\\n-      innerTarget.pointerenter({relatedTarget: outerNode});\\n-      innerTarget.pointerexit({relatedTarget: outerNode});\\n-      outerTarget.pointerenter({relatedTarget: innerNode});\\n-      outerTarget.pointerexit({relatedTarget: container});\\n-\\n-      expect(events).toEqual([\\n-        \'outer: onHoverStart\',\\n-        \'outer: onHoverChange\',\\n-        \'outer: onHoverEnd\',\\n-        \'outer: onHoverChange\',\\n-        \'inner: onHoverStart\',\\n-        \'inner: onHoverChange\',\\n-        \'inner: onHoverEnd\',\\n-        \'inner: onHoverChange\',\\n-        \'outer: onHoverStart\',\\n-        \'outer: onHoverChange\',\\n-        \'outer: onHoverEnd\',\\n-        \'outer: onHoverChange\',\\n-      ]);\\n-    });\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'expect displayName to show up for event component\', () => {\\n-    expect(HoverResponder.displayName).toBe(\'Hover\');\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should correctly pass through event properties\', () => {\\n-    const timeStamps = [];\\n-    const ref = React.createRef();\\n-    const eventLog = [];\\n-    const logEvent = event => {\\n-      const propertiesWeCareAbout = {\\n-        x: event.x,\\n-        y: event.y,\\n-        pageX: event.pageX,\\n-        pageY: event.pageY,\\n-        clientX: event.clientX,\\n-        clientY: event.clientY,\\n-        pointerType: event.pointerType,\\n-        target: event.target,\\n-        timeStamp: event.timeStamp,\\n-        type: event.type,\\n-      };\\n-      timeStamps.push(event.timeStamp);\\n-      eventLog.push(propertiesWeCareAbout);\\n-    };\\n-    const Component = () => {\\n-      const listener = useHover({\\n-        onHoverStart: logEvent,\\n-        onHoverEnd: logEvent,\\n-        onHoverMove: logEvent,\\n-      });\\n-      return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const node = ref.current;\\n-    const target = createEventTarget(node);\\n-\\n-    target.pointerenter({x: 10, y: 10});\\n-    target.pointerhover({x: 10, y: 10});\\n-    target.pointerhover({x: 20, y: 20});\\n-    target.pointerexit({x: 20, y: 20});\\n-\\n-    expect(eventLog).toEqual([\\n-      {\\n-        x: 10,\\n-        y: 10,\\n-        pageX: 10,\\n-        pageY: 10,\\n-        clientX: 10,\\n-        clientY: 10,\\n-        target: node,\\n-        timeStamp: timeStamps[0],\\n-        type: \'hoverstart\',\\n-        pointerType: \'mouse\',\\n-      },\\n-      {\\n-        x: 10,\\n-        y: 10,\\n-        pageX: 10,\\n-        pageY: 10,\\n-        clientX: 10,\\n-        clientY: 10,\\n-        target: node,\\n-        timeStamp: timeStamps[1],\\n-        type: \'hovermove\',\\n-        pointerType: \'mouse\',\\n-      },\\n-      {\\n-        x: 20,\\n-        y: 20,\\n-        pageX: 20,\\n-        pageY: 20,\\n-        clientX: 20,\\n-        clientY: 20,\\n-        target: node,\\n-        timeStamp: timeStamps[2],\\n-        type: \'hovermove\',\\n-        pointerType: \'mouse\',\\n-      },\\n-      {\\n-        x: 20,\\n-        y: 20,\\n-        pageX: 20,\\n-        pageY: 20,\\n-        clientX: 20,\\n-        clientY: 20,\\n-        target: node,\\n-        timeStamp: timeStamps[3],\\n-        type: \'hoverend\',\\n-        pointerType: \'mouse\',\\n-      },\\n-    ]);\\n-  });\\n-});"},{"sha":"bcbe4d52243adefe65ea46354042c18726e13f98","filename":"packages/react-interactions/events/src/dom/__tests__/Input-test.internal.js","status":"removed","additions":0,"deletions":1001,"changes":1001,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Input-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Input-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/Input-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,1001 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let InputResponder;\\n-let useInput;\\n-let Scheduler;\\n-\\n-const setUntrackedChecked = Object.getOwnPropertyDescriptor(\\n-  HTMLInputElement.prototype,\\n-  \'checked\',\\n-).set;\\n-\\n-const setUntrackedValue = Object.getOwnPropertyDescriptor(\\n-  HTMLInputElement.prototype,\\n-  \'value\',\\n-).set;\\n-\\n-const setUntrackedTextareaValue = Object.getOwnPropertyDescriptor(\\n-  HTMLTextAreaElement.prototype,\\n-  \'value\',\\n-).set;\\n-\\n-const modulesInit = () => {\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-  Scheduler = require(\'scheduler\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    InputResponder = require(\'react-interactions/events/input\').InputResponder;\\n-    useInput = require(\'react-interactions/events/input\').useInput;\\n-  }\\n-};\\n-\\n-describe(\'Input event responder\', () => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    jest.resetModules();\\n-    modulesInit();\\n-\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onChange, onValueChange, ref;\\n-\\n-    const componentInit = () => {\\n-      onChange = jest.fn();\\n-      onValueChange = jest.fn();\\n-      ref = React.createRef();\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          disabled: true,\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return <input ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'prevents custom events being dispatched\', () => {\\n-      componentInit();\\n-      ref.current.dispatchEvent(\\n-        new Event(\'change\', {bubbles: true, cancelable: true}),\\n-      );\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(onChange).not.toBeCalled();\\n-      expect(onValueChange).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  // These were taken from the original ChangeEventPlugin-test.\\n-  // They\'ve been updated and cleaned up for React Flare.\\n-  describe(\'onChange\', () => {\\n-    // We try to avoid firing \\"duplicate\\" React change events.\\n-    // However, to tell which events are \\"duplicates\\" and should be ignored,\\n-    // we are tracking the \\"current\\" input value, and only respect events\\n-    // that occur after it changes. In most of these tests, we verify that we\\n-    // keep track of the \\"current\\" value and only fire events when it changes.\\n-    // See https://github.com/facebook/react/pull/5746.\\n-\\n-    // @gate experimental\\n-    it(\'should consider initial text value to be current\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"text\\"\\n-            ref={ref}\\n-            defaultValue=\\"foo\\"\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      ref.current.dispatchEvent(\\n-        new Event(\'change\', {bubbles: true, cancelable: true}),\\n-      );\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      if (ReactFeatureFlags.disableInputAttributeSyncing) {\\n-        // TODO: figure out why. This might be a bug.\\n-        expect(onChangeCalled).toBe(1);\\n-        expect(onValueChangeCalled).toBe(1);\\n-      } else {\\n-        expect(onChangeCalled).toBe(0);\\n-        expect(onValueChangeCalled).toBe(0);\\n-      }\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should consider initial checkbox checked=true to be current\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"checkbox\\"\\n-            ref={ref}\\n-            defaultChecked={true}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      // Secretly, set `checked` to false, so that dispatching the `click` will\\n-      // make it `true` again. Thus, at the time of the event, React should not\\n-      // consider it a change from the initial `true` value.\\n-      setUntrackedChecked.call(ref.current, false);\\n-      ref.current.dispatchEvent(\\n-        new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      // There should be no React change events because the value stayed the same.\\n-      expect(onChangeCalled).toBe(0);\\n-      expect(onValueChangeCalled).toBe(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should consider initial checkbox checked=false to be current\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"checkbox\\"\\n-            ref={ref}\\n-            defaultChecked={false}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      // Secretly, set `checked` to true, so that dispatching the `click` will\\n-      // make it `false` again. Thus, at the time of the event, React should not\\n-      // consider it a change from the initial `false` value.\\n-      setUntrackedChecked.call(ref.current, true);\\n-      ref.current.dispatchEvent(\\n-        new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      // There should be no React change events because the value stayed the same.\\n-      expect(onChangeCalled).toBe(0);\\n-      expect(onValueChangeCalled).toBe(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should fire change for checkbox input\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"checkbox\\"\\n-            ref={ref}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      ref.current.dispatchEvent(\\n-        new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      // Note: unlike with text input events, dispatching `click` actually\\n-      // toggles the checkbox and updates its `checked` value.\\n-      expect(ref.current.checked).toBe(true);\\n-      expect(onChangeCalled).toBe(1);\\n-      expect(onValueChangeCalled).toBe(1);\\n-\\n-      expect(ref.current.checked).toBe(true);\\n-      ref.current.dispatchEvent(\\n-        new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(ref.current.checked).toBe(false);\\n-      expect(onChangeCalled).toBe(2);\\n-      expect(onValueChangeCalled).toBe(2);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should not fire change setting the value programmatically\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"text\\"\\n-            defaultValue=\\"foo\\"\\n-            ref={ref}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      // Set it programmatically.\\n-      ref.current.value = \'bar\';\\n-      // Even if a DOM input event fires, React sees that the real input value now\\n-      // (\'bar\') is the same as the \\"current\\" one we already recorded.\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(ref.current.value).toBe(\'bar\');\\n-      // In this case we don\'t expect to get a React event.\\n-      expect(onChangeCalled).toBe(0);\\n-      expect(onValueChangeCalled).toBe(0);\\n-\\n-      // However, we can simulate user typing by calling the underlying setter.\\n-      setUntrackedValue.call(ref.current, \'foo\');\\n-      // Now, when the event fires, the real input value (\'foo\') differs from the\\n-      // \\"current\\" one we previously recorded (\'bar\').\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(ref.current.value).toBe(\'foo\');\\n-      // In this case React should fire an event for it.\\n-      expect(onChangeCalled).toBe(1);\\n-      expect(onValueChangeCalled).toBe(1);\\n-\\n-      // Verify again that extra events without real changes are ignored.\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(onChangeCalled).toBe(1);\\n-      expect(onValueChangeCalled).toBe(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should not distinguish equal string and number values\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"text\\"\\n-            defaultValue=\\"42\\"\\n-            ref={ref}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      // When we set `value` as a property, React updates the \\"current\\" value\\n-      // that it tracks internally. The \\"current\\" value is later used to determine\\n-      // whether a change event is a duplicate or not.\\n-      // Even though we set value to a number, we still shouldn\'t get a change\\n-      // event because as a string, it\'s equal to the initial value (\'42\').\\n-      ref.current.value = 42;\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(ref.current.value).toBe(\'42\');\\n-      expect(onChangeCalled).toBe(0);\\n-      expect(onValueChangeCalled).toBe(0);\\n-    });\\n-\\n-    // See a similar input test above for a detailed description of why.\\n-    // @gate experimental\\n-    it(\'should not fire change when setting checked programmatically\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"checkbox\\"\\n-            defaultChecked={false}\\n-            ref={ref}\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      // Set the value, updating the \\"current\\" value that React tracks to true.\\n-      ref.current.checked = true;\\n-      // Under the hood, uncheck the box so that the click will \\"check\\" it again.\\n-      setUntrackedChecked.call(ref.current, false);\\n-      ref.current.dispatchEvent(\\n-        new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(ref.current.checked).toBe(true);\\n-      // We don\'t expect a React event because at the time of the click, the real\\n-      // checked value (true) was the same as the last recorded \\"current\\" value\\n-      // (also true).\\n-      expect(onChangeCalled).toBe(0);\\n-      expect(onValueChangeCalled).toBe(0);\\n-\\n-      // However, simulating a normal click should fire a React event because the\\n-      // real value (false) would have changed from the last tracked value (true).\\n-      ref.current.click();\\n-      expect(onChangeCalled).toBe(1);\\n-      expect(onValueChangeCalled).toBe(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should only fire change for checked radio button once\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input type=\\"radio\\" ref={ref} DEPRECATED_flareListeners={listener} />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      setUntrackedChecked.call(ref.current, true);\\n-      ref.current.dispatchEvent(\\n-        new Event(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      ref.current.dispatchEvent(\\n-        new Event(\'click\', {bubbles: true, cancelable: true}),\\n-      );\\n-      expect(onChangeCalled).toBe(1);\\n-      expect(onValueChangeCalled).toBe(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should track radio button cousins in a group\', () => {\\n-      let onChangeCalled1 = 0;\\n-      let onValueChangeCalled1 = 0;\\n-      let onChangeCalled2 = 0;\\n-      let onValueChangeCalled2 = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange1(e) {\\n-        onChangeCalled1++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange1(e) {\\n-        onValueChangeCalled1++;\\n-      }\\n-\\n-      function onChange2(e) {\\n-        onChangeCalled2++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange2(e) {\\n-        onValueChangeCalled2++;\\n-      }\\n-\\n-      function Radio1() {\\n-        const listener = useInput({\\n-          onChange: onChange1,\\n-          onValueChange: onValueChange1,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"radio\\"\\n-            name=\\"group\\"\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-\\n-      function Radio2() {\\n-        const listener = useInput({\\n-          onChange: onChange2,\\n-          onValueChange: onValueChange2,\\n-        });\\n-        return (\\n-          <input\\n-            type=\\"radio\\"\\n-            name=\\"group\\"\\n-            DEPRECATED_flareListeners={listener}\\n-          />\\n-        );\\n-      }\\n-\\n-      function Component() {\\n-        return (\\n-          <div ref={ref}>\\n-            <Radio1 />\\n-            <Radio2 />\\n-          </div>\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const option1 = ref.current.childNodes[0];\\n-      const option2 = ref.current.childNodes[1];\\n-\\n-      // Select first option.\\n-      option1.click();\\n-      expect(onChangeCalled1).toBe(1);\\n-      expect(onValueChangeCalled1).toBe(1);\\n-      expect(onChangeCalled2).toBe(0);\\n-      expect(onValueChangeCalled2).toBe(0);\\n-\\n-      // Select second option.\\n-      option2.click();\\n-      expect(onChangeCalled1).toBe(1);\\n-      expect(onValueChangeCalled1).toBe(1);\\n-      expect(onChangeCalled2).toBe(1);\\n-      expect(onValueChangeCalled2).toBe(1);\\n-\\n-      // Select the first option.\\n-      // It should receive the React change event again.\\n-      option1.click();\\n-      expect(onChangeCalled1).toBe(2);\\n-      expect(onValueChangeCalled1).toBe(2);\\n-      expect(onChangeCalled2).toBe(1);\\n-      expect(onValueChangeCalled2).toBe(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should deduplicate input value change events\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      [\'text\', \'number\', \'range\'].forEach(type => {\\n-        onChangeCalled = 0;\\n-        onValueChangeCalled = 0;\\n-        function Component() {\\n-          const listener = useInput({\\n-            onChange,\\n-            onValueChange,\\n-          });\\n-          return (\\n-            <input\\n-              type={type}\\n-              name=\\"group\\"\\n-              ref={ref}\\n-              DEPRECATED_flareListeners={listener}\\n-            />\\n-          );\\n-        }\\n-        ReactDOM.render(<Component />, container);\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        setUntrackedValue.call(ref.current, \'42\');\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        expect(onChangeCalled).toBe(1);\\n-        expect(onValueChangeCalled).toBe(1);\\n-        ReactDOM.unmountComponentAtNode(container);\\n-\\n-        onChangeCalled = 0;\\n-        onValueChangeCalled = 0;\\n-        function Component2() {\\n-          const listener = useInput({\\n-            onChange,\\n-            onValueChange,\\n-          });\\n-          return (\\n-            <input type={type} ref={ref} DEPRECATED_flareListeners={listener} />\\n-          );\\n-        }\\n-        ReactDOM.render(<Component2 />, container);\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        setUntrackedValue.call(ref.current, \'42\');\\n-        ref.current.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        expect(onChangeCalled).toBe(1);\\n-        expect(onValueChangeCalled).toBe(1);\\n-        ReactDOM.unmountComponentAtNode(container);\\n-\\n-        onChangeCalled = 0;\\n-        onValueChangeCalled = 0;\\n-        function Component3() {\\n-          const listener = useInput({\\n-            onChange,\\n-            onValueChange,\\n-          });\\n-          return (\\n-            <input type={type} ref={ref} DEPRECATED_flareListeners={listener} />\\n-          );\\n-        }\\n-        ReactDOM.render(<Component3 />, container);\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        setUntrackedValue.call(ref.current, \'42\');\\n-        ref.current.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Should be ignored (no change):\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        expect(onChangeCalled).toBe(1);\\n-        expect(onValueChangeCalled).toBe(1);\\n-        ReactDOM.unmountComponentAtNode(container);\\n-      });\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should listen for both change and input events when supported\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input type=\\"range\\" ref={ref} DEPRECATED_flareListeners={listener} />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      setUntrackedValue.call(ref.current, 10);\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      setUntrackedValue.call(ref.current, 20);\\n-      ref.current.dispatchEvent(\\n-        new Event(\'change\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      expect(onChangeCalled).toBe(2);\\n-      expect(onValueChangeCalled).toBe(2);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'should only fire events when the value changes for range inputs\', () => {\\n-      let onChangeCalled = 0;\\n-      let onValueChangeCalled = 0;\\n-      const ref = React.createRef();\\n-\\n-      function onChange(e) {\\n-        onChangeCalled++;\\n-        expect(e.type).toBe(\'change\');\\n-      }\\n-\\n-      function onValueChange(e) {\\n-        onValueChangeCalled++;\\n-      }\\n-\\n-      function Component() {\\n-        const listener = useInput({\\n-          onChange,\\n-          onValueChange,\\n-        });\\n-        return (\\n-          <input type=\\"range\\" ref={ref} DEPRECATED_flareListeners={listener} />\\n-        );\\n-      }\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      setUntrackedValue.call(ref.current, \'40\');\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      ref.current.dispatchEvent(\\n-        new Event(\'change\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      setUntrackedValue.call(ref.current, \'foo\');\\n-      ref.current.dispatchEvent(\\n-        new Event(\'input\', {bubbles: true, cancelable: true}),\\n-      );\\n-      ref.current.dispatchEvent(\\n-        new Event(\'change\', {bubbles: true, cancelable: true}),\\n-      );\\n-\\n-      expect(onChangeCalled).toBe(2);\\n-      expect(onValueChangeCalled).toBe(2);\\n-    });\\n-\\n-    // @gate experimental || build === \\"production\\"\\n-    it(\'does not crash for nodes with custom value property\', () => {\\n-      let originalCreateElement;\\n-      // https://github.com/facebook/react/issues/10196\\n-      try {\\n-        originalCreateElement = document.createElement;\\n-        document.createElement = function() {\\n-          const node = originalCreateElement.apply(this, arguments);\\n-          Object.defineProperty(node, \'value\', {\\n-            get() {},\\n-            set() {},\\n-          });\\n-          return node;\\n-        };\\n-        const ref = React.createRef();\\n-        const div = document.createElement(\'div\');\\n-        // Mount\\n-        ReactDOM.render(\\n-          <input type=\\"text\\" ref={ref} responders={<InputResponder />} />,\\n-          div,\\n-        );\\n-        // Update\\n-        ReactDOM.render(\\n-          <input type=\\"text\\" ref={ref} responders={<InputResponder />} />,\\n-          div,\\n-        );\\n-        // Change\\n-        ref.current.dispatchEvent(\\n-          new Event(\'change\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Unmount\\n-        ReactDOM.unmountComponentAtNode(div);\\n-      } finally {\\n-        document.createElement = originalCreateElement;\\n-      }\\n-    });\\n-\\n-    describe(\'concurrent mode\', () => {\\n-      // @gate experimental\\n-      // @gate experimental\\n-      it(\'text input\', () => {\\n-        const root = ReactDOM.createRoot(container);\\n-        let input;\\n-\\n-        function Component({innerRef, onChange, controlledValue}) {\\n-          const listener = useInput({\\n-            onChange,\\n-          });\\n-          return (\\n-            <input\\n-              type=\\"text\\"\\n-              ref={innerRef}\\n-              value={controlledValue}\\n-              DEPRECATED_flareListeners={listener}\\n-            />\\n-          );\\n-        }\\n-\\n-        class ControlledInput extends React.Component {\\n-          state = {value: \'initial\'};\\n-          onChange = event => this.setState({value: event.target.value});\\n-          render() {\\n-            Scheduler.unstable_yieldValue(`render: ${this.state.value}`);\\n-            const controlledValue =\\n-              this.state.value === \'changed\' ? \'changed [!]\' : this.state.value;\\n-            return (\\n-              <Component\\n-                onChange={this.onChange}\\n-                innerRef={el => (input = el)}\\n-                controlledValue={controlledValue}\\n-              />\\n-            );\\n-          }\\n-        }\\n-\\n-        // Initial mount. Test that this is async.\\n-        root.render(<ControlledInput />);\\n-        // Should not have flushed yet.\\n-        expect(Scheduler).toHaveYielded([]);\\n-        expect(input).toBe(undefined);\\n-        // Flush callbacks.\\n-        expect(Scheduler).toFlushAndYield([\'render: initial\']);\\n-        expect(input.value).toBe(\'initial\');\\n-\\n-        // Trigger a change event.\\n-        setUntrackedValue.call(input, \'changed\');\\n-        input.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Change should synchronously flush\\n-        expect(Scheduler).toHaveYielded([\'render: changed\']);\\n-        // Value should be the controlled value, not the original one\\n-        expect(input.value).toBe(\'changed [!]\');\\n-      });\\n-\\n-      // @gate experimental\\n-      // @gate experimental\\n-      it(\'checkbox input\', () => {\\n-        const root = ReactDOM.createRoot(container);\\n-        let input;\\n-\\n-        function Component({innerRef, onChange, controlledValue}) {\\n-          const listener = useInput({\\n-            onChange,\\n-          });\\n-          return (\\n-            <input\\n-              type=\\"checkbox\\"\\n-              ref={innerRef}\\n-              checked={controlledValue}\\n-              DEPRECATED_flareListeners={listener}\\n-            />\\n-          );\\n-        }\\n-\\n-        class ControlledInput extends React.Component {\\n-          state = {checked: false};\\n-          onChange = event => {\\n-            this.setState({checked: event.target.checked});\\n-          };\\n-          render() {\\n-            Scheduler.unstable_yieldValue(`render: ${this.state.checked}`);\\n-            const controlledValue = this.props.reverse\\n-              ? !this.state.checked\\n-              : this.state.checked;\\n-            return (\\n-              <Component\\n-                controlledValue={controlledValue}\\n-                onChange={this.onChange}\\n-                innerRef={el => (input = el)}\\n-              />\\n-            );\\n-          }\\n-        }\\n-\\n-        // Initial mount. Test that this is async.\\n-        root.render(<ControlledInput reverse={false} />);\\n-        // Should not have flushed yet.\\n-        expect(Scheduler).toHaveYielded([]);\\n-        expect(input).toBe(undefined);\\n-        // Flush callbacks.\\n-        expect(Scheduler).toFlushAndYield([\'render: false\']);\\n-        expect(input.checked).toBe(false);\\n-\\n-        // Trigger a change event.\\n-        input.dispatchEvent(\\n-          new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Change should synchronously flush\\n-        expect(Scheduler).toHaveYielded([\'render: true\']);\\n-        expect(input.checked).toBe(true);\\n-\\n-        // Now let\'s make sure we\'re using the controlled value.\\n-        root.render(<ControlledInput reverse={true} />);\\n-        expect(Scheduler).toFlushAndYield([\'render: true\']);\\n-\\n-        // Trigger another change event.\\n-        input.dispatchEvent(\\n-          new MouseEvent(\'click\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Change should synchronously flush\\n-        expect(Scheduler).toHaveYielded([\'render: true\']);\\n-        expect(input.checked).toBe(false);\\n-      });\\n-\\n-      // @gate experimental\\n-      // @gate experimental\\n-      it(\'textarea\', () => {\\n-        const root = ReactDOM.createRoot(container);\\n-        let textarea;\\n-\\n-        function Component({innerRef, onChange, controlledValue}) {\\n-          const listener = useInput({\\n-            onChange,\\n-          });\\n-          return (\\n-            <textarea\\n-              type=\\"text\\"\\n-              ref={innerRef}\\n-              value={controlledValue}\\n-              DEPRECATED_flareListeners={listener}\\n-            />\\n-          );\\n-        }\\n-\\n-        class ControlledTextarea extends React.Component {\\n-          state = {value: \'initial\'};\\n-          onChange = event => this.setState({value: event.target.value});\\n-          render() {\\n-            Scheduler.unstable_yieldValue(`render: ${this.state.value}`);\\n-            const controlledValue =\\n-              this.state.value === \'changed\' ? \'changed [!]\' : this.state.value;\\n-            return (\\n-              <Component\\n-                onChange={this.onChange}\\n-                innerRef={el => (textarea = el)}\\n-                controlledValue={controlledValue}\\n-              />\\n-            );\\n-          }\\n-        }\\n-\\n-        // Initial mount. Test that this is async.\\n-        root.render(<ControlledTextarea />);\\n-        // Should not have flushed yet.\\n-        expect(Scheduler).toHaveYielded([]);\\n-        expect(textarea).toBe(undefined);\\n-        // Flush callbacks.\\n-        expect(Scheduler).toFlushAndYield([\'render: initial\']);\\n-        expect(textarea.value).toBe(\'initial\');\\n-\\n-        // Trigger a change event.\\n-        setUntrackedTextareaValue.call(textarea, \'changed\');\\n-        textarea.dispatchEvent(\\n-          new Event(\'input\', {bubbles: true, cancelable: true}),\\n-        );\\n-        // Change should synchronously flush\\n-        expect(Scheduler).toHaveYielded([\'render: changed\']);\\n-        // Value should be the controlled value, not the original one\\n-        expect(textarea.value).toBe(\'changed [!]\');\\n-      });\\n-    });\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'expect displayName to show up for event component\', () => {\\n-    expect(InputResponder.displayName).toBe(\'Input\');\\n-  });\\n-});"},{"sha":"bda54c8b468af175604fc9f78a4b5e377c1e8c1e","filename":"packages/react-interactions/events/src/dom/__tests__/MixedResponders-test-internal.js","status":"removed","additions":0,"deletions":255,"changes":255,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/MixedResponders-test-internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/MixedResponders-test-internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/MixedResponders-test-internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,255 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {createEventTarget} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let Scheduler;\\n-\\n-describe(\'mixing responders with the heritage event system\', () => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-    React = require(\'react\');\\n-    ReactDOM = require(\'react-dom\');\\n-    Scheduler = require(\'scheduler\');\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    document.body.removeChild(container);\\n-    container = null;\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should properly only flush sync once when the event systems are mixed\', () => {\\n-    const useTap = require(\'react-interactions/events/tap\').useTap;\\n-    const ref = React.createRef();\\n-    let renderCounts = 0;\\n-\\n-    function MyComponent() {\\n-      const [, updateCounter] = React.useState(0);\\n-      renderCounts++;\\n-\\n-      function handleTap() {\\n-        updateCounter(count => count + 1);\\n-      }\\n-\\n-      const listener = useTap({\\n-        onTapEnd: handleTap,\\n-      });\\n-\\n-      return (\\n-        <div>\\n-          <button\\n-            ref={ref}\\n-            DEPRECATED_flareListeners={listener}\\n-            onClick={() => {\\n-              updateCounter(count => count + 1);\\n-            }}>\\n-            Press me\\n-          </button>\\n-        </div>\\n-      );\\n-    }\\n-\\n-    const newContainer = document.createElement(\'div\');\\n-    const root = ReactDOM.createRoot(newContainer);\\n-    document.body.appendChild(newContainer);\\n-    root.render(<MyComponent />);\\n-    Scheduler.unstable_flushAll();\\n-\\n-    const target = createEventTarget(ref.current);\\n-    target.pointerdown({timeStamp: 100});\\n-    target.pointerup({timeStamp: 100});\\n-    target.click({timeStamp: 100});\\n-\\n-    if (__DEV__) {\\n-      expect(renderCounts).toBe(2);\\n-    } else {\\n-      expect(renderCounts).toBe(1);\\n-    }\\n-    Scheduler.unstable_flushAll();\\n-    if (__DEV__) {\\n-      expect(renderCounts).toBe(4);\\n-    } else {\\n-      expect(renderCounts).toBe(2);\\n-    }\\n-\\n-    target.pointerdown({timeStamp: 100});\\n-    target.pointerup({timeStamp: 100});\\n-    // Ensure the timeStamp logic works\\n-    target.click({timeStamp: 101});\\n-\\n-    if (__DEV__) {\\n-      expect(renderCounts).toBe(6);\\n-    } else {\\n-      expect(renderCounts).toBe(3);\\n-    }\\n-\\n-    Scheduler.unstable_flushAll();\\n-    document.body.removeChild(newContainer);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\\n-    \'should only flush before outermost discrete event handler when mixing \' +\\n-      \'event systems\',\\n-    async () => {\\n-      const {useState} = React;\\n-      const useTap = require(\'react-interactions/events/tap\').useTap;\\n-\\n-      const button = React.createRef();\\n-\\n-      function MyComponent() {\\n-        const [pressesCount, updatePressesCount] = useState(0);\\n-        const [clicksCount, updateClicksCount] = useState(0);\\n-\\n-        function handleTap() {\\n-          // This dispatches a synchronous, discrete event in the legacy event\\n-          // system. However, because it\'s nested inside the new event system,\\n-          // its updates should not flush until the end of the outer handler.\\n-          const target = createEventTarget(button.current);\\n-          target.click();\\n-          // Text context should not have changed\\n-          Scheduler.unstable_yieldValue(newContainer.textContent);\\n-          updatePressesCount(pressesCount + 1);\\n-        }\\n-\\n-        const tap = useTap({\\n-          onTapEnd: handleTap,\\n-        });\\n-\\n-        return (\\n-          <div>\\n-            <button\\n-              DEPRECATED_flareListeners={tap}\\n-              ref={button}\\n-              onClick={() => updateClicksCount(clicksCount + 1)}>\\n-              Presses: {pressesCount}, Clicks: {clicksCount}\\n-            </button>\\n-          </div>\\n-        );\\n-      }\\n-\\n-      const newContainer = document.createElement(\'div\');\\n-      document.body.appendChild(newContainer);\\n-      const root = ReactDOM.createRoot(newContainer);\\n-\\n-      root.render(<MyComponent />);\\n-      expect(Scheduler).toFlushWithoutYielding();\\n-      expect(newContainer.textContent).toEqual(\'Presses: 0, Clicks: 0\');\\n-\\n-      const target = createEventTarget(button.current);\\n-      target.pointerdown({timeStamp: 100});\\n-      target.pointerup({timeStamp: 100});\\n-\\n-      expect(Scheduler).toHaveYielded([\'Presses: 0, Clicks: 0\']);\\n-      expect(Scheduler).toFlushWithoutYielding();\\n-      expect(newContainer.textContent).toEqual(\'Presses: 1, Clicks: 1\');\\n-    },\\n-  );\\n-\\n-  describe(\'mixing the Input and Press responders\', () => {\\n-    // @gate experimental\\n-    it(\'is async for non-input events\', () => {\\n-      const useTap = require(\'react-interactions/events/tap\').useTap;\\n-      const useInput = require(\'react-interactions/events/input\').useInput;\\n-      const root = ReactDOM.createRoot(container);\\n-      let input;\\n-\\n-      function Component({innerRef, onChange, controlledValue, listeners}) {\\n-        const inputListener = useInput({onChange});\\n-        return (\\n-          <input\\n-            type=\\"text\\"\\n-            ref={innerRef}\\n-            value={controlledValue}\\n-            DEPRECATED_flareListeners={[inputListener, listeners]}\\n-          />\\n-        );\\n-      }\\n-\\n-      function PressWrapper({innerRef, onTap, onChange, controlledValue}) {\\n-        const tap = useTap({\\n-          onTapEnd: onTap,\\n-        });\\n-        return (\\n-          <Component\\n-            onChange={onChange}\\n-            innerRef={el => (input = el)}\\n-            controlledValue={controlledValue}\\n-            listeners={tap}\\n-          />\\n-        );\\n-      }\\n-\\n-      class ControlledInput extends React.Component {\\n-        state = {value: \'initial\'};\\n-        onChange = event => this.setState({value: event.target.value});\\n-        reset = () => {\\n-          this.setState({value: \'\'});\\n-        };\\n-        render() {\\n-          Scheduler.unstable_yieldValue(`render: ${this.state.value}`);\\n-          const controlledValue =\\n-            this.state.value === \'changed\' ? \'changed [!]\' : this.state.value;\\n-          return (\\n-            <PressWrapper\\n-              onTap={this.reset}\\n-              onChange={this.onChange}\\n-              innerRef={el => (input = el)}\\n-              controlledValue={controlledValue}\\n-            />\\n-          );\\n-        }\\n-      }\\n-\\n-      // Initial mount. Test that this is async.\\n-      root.render(<ControlledInput />);\\n-      // Should not have flushed yet.\\n-      expect(Scheduler).toHaveYielded([]);\\n-      expect(input).toBe(undefined);\\n-      // Flush callbacks.\\n-      expect(Scheduler).toFlushAndYield([\'render: initial\']);\\n-      expect(input.value).toBe(\'initial\');\\n-\\n-      // Trigger a click event\\n-      input.dispatchEvent(\\n-        new MouseEvent(\'mousedown\', {\\n-          bubbles: true,\\n-          cancelable: true,\\n-          buttons: 1,\\n-        }),\\n-      );\\n-      input.dispatchEvent(\\n-        new MouseEvent(\'mouseup\', {\\n-          bubbles: true,\\n-          cancelable: true,\\n-          buttons: 0,\\n-        }),\\n-      );\\n-      // Nothing should have changed\\n-      expect(Scheduler).toHaveYielded([]);\\n-      expect(input.value).toBe(\'initial\');\\n-\\n-      // Flush callbacks.\\n-      // Now the click update has flushed.\\n-      expect(Scheduler).toFlushAndYield([\'render: \']);\\n-      expect(input.value).toBe(\'\');\\n-    });\\n-  });\\n-});"},{"sha":"3e37a028db50f90c6f417cef9b0d36f12452ca6d","filename":"packages/react-interactions/events/src/dom/__tests__/PressLegacy-test.internal.js","status":"removed","additions":0,"deletions":1346,"changes":1346,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/PressLegacy-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/PressLegacy-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/PressLegacy-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,1346 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {\\n-  buttonType,\\n-  buttonsType,\\n-  createEventTarget,\\n-  resetActivePointers,\\n-  setPointerEvent,\\n-} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let PressResponder;\\n-let usePress;\\n-\\n-function initializeModules(hasPointerEvents) {\\n-  jest.resetModules();\\n-  setPointerEvent(hasPointerEvents);\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    PressResponder = require(\'react-interactions/events/press-legacy\')\\n-      .PressResponder;\\n-    usePress = require(\'react-interactions/events/press-legacy\').usePress;\\n-  }\\n-}\\n-\\n-function removePressMoveStrings(eventString) {\\n-  if (eventString === \'onPressMove\') {\\n-    return false;\\n-  }\\n-  return true;\\n-}\\n-\\n-const forcePointerEvents = true;\\n-const environmentTable = [[forcePointerEvents], [!forcePointerEvents]];\\n-\\n-const pointerTypesTable = [[\'mouse\'], [\'touch\']];\\n-\\n-describe.each(environmentTable)(\'Press responder\', hasPointerEvents => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    initializeModules(hasPointerEvents);\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    container = null;\\n-    resetActivePointers();\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onPressStart, onPress, onPressEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onPressStart = jest.fn();\\n-      onPress = jest.fn();\\n-      onPressEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          disabled: true,\\n-          onPressStart,\\n-          onPress,\\n-          onPressEnd,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'does not call callbacks\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup();\\n-      expect(onPressStart).not.toBeCalled();\\n-      expect(onPress).not.toBeCalled();\\n-      expect(onPressEnd).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onPressStart\', () => {\\n-    let onPressStart, ref;\\n-\\n-    const componentInit = () => {\\n-      onPressStart = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPressStart,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer down: mouse\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-      expect(onPressStart).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'mouse\', type: \'pressstart\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer down: touch\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-      expect(onPressStart).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'touch\', type: \'pressstart\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after middle-button pointer down\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({\\n-        button: buttonType.auxiliary,\\n-        buttons: buttonsType.auxiliary,\\n-        pointerType: \'mouse\',\\n-      });\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-      expect(onPressStart).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          buttons: buttonsType.auxiliary,\\n-          pointerType: \'mouse\',\\n-          type: \'pressstart\',\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after pointer move following middle-button press\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const target = createEventTarget(node);\\n-      target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-      target.pointerdown({\\n-        button: buttonType.auxiliary,\\n-        buttons: buttonsType.auxiliary,\\n-        pointerType: \'mouse\',\\n-      });\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      target.pointerhover({x: 110, y: 110});\\n-      target.pointerhover({x: 50, y: 50});\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'ignores any events not caused by primary/middle-click or touch/pen contact\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({buttons: buttonsType.secondary});\\n-      target.pointerup({buttons: buttonsType.secondary});\\n-      target.pointerdown({buttons: buttonsType.eraser});\\n-      target.pointerup({buttons: buttonsType.eraser});\\n-      expect(onPressStart).toHaveBeenCalledTimes(0);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called once after \\"keydown\\" events for Enter\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keydown({key: \'Enter\'});\\n-      target.keydown({key: \'Enter\'});\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-      expect(onPressStart).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'keyboard\', type: \'pressstart\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called once after \\"keydown\\" events for Spacebar\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const preventDefault = jest.fn();\\n-      target.keydown({key: \' \', preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      target.keydown({key: \' \', preventDefault});\\n-      expect(onPressStart).toHaveBeenCalledTimes(1);\\n-      expect(onPressStart).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          pointerType: \'keyboard\',\\n-          type: \'pressstart\',\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"keydown\\" for other keys\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'a\'});\\n-      expect(onPressStart).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'onPressEnd\', () => {\\n-    let onPressEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onPressEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPressEnd,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer up: mouse\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'mouse\', type: \'pressend\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer up: touch\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'touch\', type: \'pressend\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after middle-button pointer up\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({\\n-        buttons: buttonsType.auxiliary,\\n-        pointerType: \'mouse\',\\n-      });\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          buttons: buttonsType.auxiliary,\\n-          pointerType: \'mouse\',\\n-          type: \'pressend\',\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"keyup\\" event for Enter\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      // click occurs before keyup\\n-      target.click();\\n-      target.keyup({key: \'Enter\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'keyboard\', type: \'pressend\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after \\"keyup\\" event for Spacebar\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \' \'});\\n-      target.keyup({key: \' \'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'keyboard\', type: \'pressend\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after \\"keyup\\" event for other keys\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keyup({key: \'a\'});\\n-      expect(onPressEnd).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called with keyboard modifiers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keyup({\\n-        key: \'Enter\',\\n-        metaKey: true,\\n-        ctrlKey: true,\\n-        altKey: true,\\n-        shiftKey: true,\\n-      });\\n-      expect(onPressEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          pointerType: \'keyboard\',\\n-          type: \'pressend\',\\n-          metaKey: true,\\n-          ctrlKey: true,\\n-          altKey: true,\\n-          shiftKey: true,\\n-        }),\\n-      );\\n-    });\\n-  });\\n-\\n-  describe(\'onPressChange\', () => {\\n-    let onPressChange, ref;\\n-\\n-    const componentInit = () => {\\n-      onPressChange = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPressChange,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer down and up: mouse\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(1);\\n-      expect(onPressChange).toHaveBeenCalledWith(true);\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(2);\\n-      expect(onPressChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer down and up: touch\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(1);\\n-      expect(onPressChange).toHaveBeenCalledWith(true);\\n-      target.pointerup({pointerType: \'touch\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(2);\\n-      expect(onPressChange).toHaveBeenCalledWith(false);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after valid \\"keydown\\" and \\"keyup\\" events\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(1);\\n-      expect(onPressChange).toHaveBeenCalledWith(true);\\n-      target.keyup({key: \'Enter\'});\\n-      expect(onPressChange).toHaveBeenCalledTimes(2);\\n-      expect(onPressChange).toHaveBeenCalledWith(false);\\n-    });\\n-  });\\n-\\n-  describe(\'onPress\', () => {\\n-    let onPress, ref;\\n-\\n-    const componentInit = () => {\\n-      onPress = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPress,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      ref.current.getBoundingClientRect = () => ({\\n-        top: 0,\\n-        left: 0,\\n-        bottom: 100,\\n-        right: 100,\\n-      });\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer up: mouse\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      target.pointerup({pointerType: \'mouse\', x: 10, y: 10});\\n-      expect(onPress).toHaveBeenCalledTimes(1);\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'mouse\', type: \'press\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer up: touch\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointerup({pointerType: \'touch\', x: 10, y: 10});\\n-      expect(onPress).toHaveBeenCalledTimes(1);\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'touch\', type: \'press\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after middle-button press\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({\\n-        buttons: buttonsType.auxiliary,\\n-        pointerType: \'mouse\',\\n-      });\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      expect(onPress).not.toHaveBeenCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after virtual middle-button press\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({\\n-        button: buttonType.auxiliary,\\n-        buttons: 0,\\n-        pointerType: \'mouse\',\\n-      });\\n-      target.pointerup({pointerType: \'mouse\'});\\n-      expect(onPress).not.toHaveBeenCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after valid \\"keyup\\" event\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keyup({key: \'Enter\'});\\n-      expect(onPress).toHaveBeenCalledTimes(1);\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'keyboard\', type: \'press\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called after invalid \\"keyup\\" event\', () => {\\n-      componentInit();\\n-      const inputRef = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return <input ref={inputRef} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      const target = createEventTarget(inputRef.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keyup({key: \'Enter\'});\\n-      target.keydown({key: \' \'});\\n-      target.keyup({key: \' \'});\\n-      expect(onPress).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called with modifier keys\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({metaKey: true, pointerType: \'mouse\'});\\n-      target.pointerup({metaKey: true, pointerType: \'mouse\'});\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          pointerType: \'mouse\',\\n-          type: \'press\',\\n-          metaKey: true,\\n-        }),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called if target rect is not right but the target is (for mouse events)\', () => {\\n-      componentInit();\\n-      const buttonRef = React.createRef();\\n-      const divRef = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return (\\n-          <div ref={divRef} DEPRECATED_flareListeners={listener}>\\n-            <button ref={buttonRef} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(divRef.current);\\n-      target.setBoundingClientRect({x: 0, y: 0, width: 0, height: 0});\\n-      const innerTarget = createEventTarget(buttonRef.current);\\n-      innerTarget.pointerdown({pointerType: \'mouse\'});\\n-      innerTarget.pointerup({pointerType: \'mouse\'});\\n-      expect(onPress).toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called once after virtual screen reader \\"click\\" event\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const preventDefault = jest.fn();\\n-      target.virtualclick({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onPress).toHaveBeenCalledTimes(1);\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({\\n-          pointerType: \'keyboard\',\\n-          type: \'press\',\\n-        }),\\n-      );\\n-    });\\n-  });\\n-\\n-  describe(\'onPressMove\', () => {\\n-    let onPressMove, ref;\\n-\\n-    const componentInit = () => {\\n-      onPressMove = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPressMove,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      ref.current.getBoundingClientRect = () => ({\\n-        top: 0,\\n-        left: 0,\\n-        bottom: 100,\\n-        right: 100,\\n-      });\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer move: mouse\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const target = createEventTarget(node);\\n-      target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      target.pointermove({pointerType: \'mouse\', x: 10, y: 10});\\n-      target.pointermove({pointerType: \'mouse\', x: 20, y: 20});\\n-      expect(onPressMove).toHaveBeenCalledTimes(2);\\n-      expect(onPressMove).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'mouse\', type: \'pressmove\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is called after pointer move: touch\', () => {\\n-      componentInit();\\n-      const node = ref.current;\\n-      const target = createEventTarget(node);\\n-      target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointermove({pointerType: \'touch\', x: 10, y: 10});\\n-      target.pointermove({pointerType: \'touch\', x: 20, y: 20});\\n-      expect(onPressMove).toHaveBeenCalledTimes(2);\\n-      expect(onPressMove).toHaveBeenCalledWith(\\n-        expect.objectContaining({pointerType: \'touch\', type: \'pressmove\'}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'is not called if pointer move occurs during keyboard press\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-      target.keydown({key: \'Enter\'});\\n-      target.pointermove({\\n-        buttons: buttonsType.none,\\n-        pointerType: \'mouse\',\\n-        x: 10,\\n-        y: 10,\\n-      });\\n-      expect(onPressMove).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe.each(pointerTypesTable)(\'press with movement: %s\', pointerType => {\\n-    let events, ref, outerRef;\\n-\\n-    const componentInit = () => {\\n-      events = [];\\n-      ref = React.createRef();\\n-      outerRef = React.createRef();\\n-      const createEventHandler = msg => () => {\\n-        events.push(msg);\\n-      };\\n-      const Component = () => {\\n-        const listener = usePress({\\n-          onPress: createEventHandler(\'onPress\'),\\n-          onPressChange: createEventHandler(\'onPressChange\'),\\n-          onPressMove: createEventHandler(\'onPressMove\'),\\n-          onPressStart: createEventHandler(\'onPressStart\'),\\n-          onPressEnd: createEventHandler(\'onPressEnd\'),\\n-        });\\n-        return (\\n-          <div ref={outerRef}>\\n-            <div ref={ref} DEPRECATED_flareListeners={listener} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    const rectMock = {width: 100, height: 100, x: 50, y: 50};\\n-    const pressRectOffset = 20;\\n-    const coordinatesInside = {\\n-      x: rectMock.x - pressRectOffset,\\n-      y: rectMock.y - pressRectOffset,\\n-    };\\n-    const coordinatesOutside = {\\n-      x: rectMock.x - pressRectOffset - 1,\\n-      y: rectMock.y - pressRectOffset - 1,\\n-    };\\n-\\n-    describe(\'within bounds of hit rect\', () => {\\n-      /** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n-       *  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\\n-       *  \u2502  \u2502 VisualRect \u2502  \u2502\\n-       *  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\\n-       *  \u2502     HitRect    X \u2502 <= Move to X and release\\n-       *  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n-       */\\n-      // @gate experimental\\n-      it(\'\\"onPress*\\" events are called immediately\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        target.pointermove({pointerType, ...coordinatesInside});\\n-        target.pointerup({pointerType, ...coordinatesInside});\\n-        expect(events).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressMove\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPress\',\\n-        ]);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'\\"onPress*\\" events are correctly called with target change\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const outerTarget = createEventTarget(outerRef.current);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        target.pointermove({pointerType, ...coordinatesInside});\\n-        // TODO: this sequence may differ in the future between PointerEvent and mouse fallback when\\n-        // use \'setPointerCapture\'.\\n-        if (pointerType === \'touch\') {\\n-          target.pointermove({pointerType, ...coordinatesOutside});\\n-        } else {\\n-          outerTarget.pointermove({pointerType, ...coordinatesOutside});\\n-        }\\n-        target.pointermove({pointerType, ...coordinatesInside});\\n-        target.pointerup({pointerType, ...coordinatesInside});\\n-\\n-        expect(events.filter(removePressMoveStrings)).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPress\',\\n-        ]);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'press retention offset can be configured\', () => {\\n-        componentInit();\\n-        const localEvents = [];\\n-        const localRef = React.createRef();\\n-        const createEventHandler = msg => () => {\\n-          localEvents.push(msg);\\n-        };\\n-        const pressRetentionOffset = {top: 40, bottom: 40, left: 40, right: 40};\\n-\\n-        const Component = () => {\\n-          const listener = usePress({\\n-            onPress: createEventHandler(\'onPress\'),\\n-            onPressChange: createEventHandler(\'onPressChange\'),\\n-            onPressMove: createEventHandler(\'onPressMove\'),\\n-            onPressStart: createEventHandler(\'onPressStart\'),\\n-            onPressEnd: createEventHandler(\'onPressEnd\'),\\n-            pressRetentionOffset,\\n-          });\\n-          return <div ref={localRef} DEPRECATED_flareListeners={listener} />;\\n-        };\\n-        ReactDOM.render(<Component />, container);\\n-\\n-        const target = createEventTarget(localRef.current);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        target.pointermove({\\n-          pointerType,\\n-          x: rectMock.x,\\n-          y: rectMock.y,\\n-        });\\n-        target.pointerup({pointerType, ...coordinatesInside});\\n-        expect(localEvents).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressMove\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPress\',\\n-        ]);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'responder region accounts for decrease in element dimensions\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        // emulate smaller dimensions change on activation\\n-        target.setBoundingClientRect({width: 80, height: 80, y: 60, x: 60});\\n-        const coordinates = {x: rectMock.x, y: rectMock.y};\\n-        // move to an area within the pre-activation region\\n-        target.pointermove({pointerType, ...coordinates});\\n-        target.pointerup({pointerType, ...coordinates});\\n-        expect(events).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressMove\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPress\',\\n-        ]);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'responder region accounts for increase in element dimensions\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        // emulate larger dimensions change on activation\\n-        target.setBoundingClientRect({width: 200, height: 200, y: 0, x: 0});\\n-        const coordinates = {x: rectMock.x - 50, y: rectMock.y - 50};\\n-        // move to an area within the post-activation region\\n-        target.pointermove({pointerType, ...coordinates});\\n-        target.pointerup({pointerType, ...coordinates});\\n-        expect(events).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressMove\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-          \'onPress\',\\n-        ]);\\n-      });\\n-    });\\n-\\n-    describe(\'beyond bounds of hit rect\', () => {\\n-      /** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n-       *  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\\n-       *  \u2502  \u2502 VisualRect \u2502  \u2502\\n-       *  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\\n-       *  \u2502     HitRect      \u2502\\n-       *  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n-       *                   X   <= Move to X and release\\n-       */\\n-      // @gate experimental\\n-      it(\'\\"onPress\\" is not called on release\', () => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const targetContainer = createEventTarget(container);\\n-        target.setBoundingClientRect(rectMock);\\n-        target.pointerdown({pointerType});\\n-        target.pointermove({pointerType, ...coordinatesInside});\\n-        if (pointerType === \'mouse\') {\\n-          // TODO: use setPointerCapture so this is only true for fallback mouse events.\\n-          targetContainer.pointermove({pointerType, ...coordinatesOutside});\\n-          targetContainer.pointerup({pointerType, ...coordinatesOutside});\\n-        } else {\\n-          target.pointermove({pointerType, ...coordinatesOutside});\\n-          target.pointerup({pointerType, ...coordinatesOutside});\\n-        }\\n-        expect(events.filter(removePressMoveStrings)).toEqual([\\n-          \'onPressStart\',\\n-          \'onPressChange\',\\n-          \'onPressEnd\',\\n-          \'onPressChange\',\\n-        ]);\\n-      });\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'\\"onPress\\" is called on re-entry to hit rect\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const targetContainer = createEventTarget(container);\\n-      target.setBoundingClientRect(rectMock);\\n-      target.pointerdown({pointerType});\\n-      target.pointermove({pointerType, ...coordinatesInside});\\n-      if (pointerType === \'mouse\') {\\n-        // TODO: use setPointerCapture so this is only true for fallback mouse events.\\n-        targetContainer.pointermove({pointerType, ...coordinatesOutside});\\n-      } else {\\n-        target.pointermove({pointerType, ...coordinatesOutside});\\n-      }\\n-      target.pointermove({pointerType, ...coordinatesInside});\\n-      target.pointerup({pointerType, ...coordinatesInside});\\n-\\n-      expect(events).toEqual([\\n-        \'onPressStart\',\\n-        \'onPressChange\',\\n-        \'onPressMove\',\\n-        \'onPressEnd\',\\n-        \'onPressChange\',\\n-        \'onPressStart\',\\n-        \'onPressChange\',\\n-        \'onPressEnd\',\\n-        \'onPressChange\',\\n-        \'onPress\',\\n-      ]);\\n-    });\\n-  });\\n-\\n-  describe(\'nested responders\', () => {\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      it(\'dispatch events in the correct order\', () => {\\n-        const events = [];\\n-        const ref = React.createRef();\\n-        const createEventHandler = msg => () => {\\n-          events.push(msg);\\n-        };\\n-\\n-        const Inner = () => {\\n-          const listener = usePress({\\n-            onPress: createEventHandler(\'inner: onPress\'),\\n-            onPressChange: createEventHandler(\'inner: onPressChange\'),\\n-            onPressMove: createEventHandler(\'inner: onPressMove\'),\\n-            onPressStart: createEventHandler(\'inner: onPressStart\'),\\n-            onPressEnd: createEventHandler(\'inner: onPressEnd\'),\\n-          });\\n-          return (\\n-            <div\\n-              ref={ref}\\n-              DEPRECATED_flareListeners={listener}\\n-              onPointerDown={createEventHandler(\'pointerdown\')}\\n-              onPointerUp={createEventHandler(\'pointerup\')}\\n-              onKeyDown={createEventHandler(\'keydown\')}\\n-              onKeyUp={createEventHandler(\'keyup\')}\\n-            />\\n-          );\\n-        };\\n-\\n-        const Outer = () => {\\n-          const listener = usePress({\\n-            onPress: createEventHandler(\'outer: onPress\'),\\n-            onPressChange: createEventHandler(\'outer: onPressChange\'),\\n-            onPressMove: createEventHandler(\'outer: onPressMove\'),\\n-            onPressStart: createEventHandler(\'outer: onPressStart\'),\\n-            onPressEnd: createEventHandler(\'outer: onPressEnd\'),\\n-          });\\n-          return (\\n-            <div DEPRECATED_flareListeners={listener}>\\n-              <Inner />\\n-            </div>\\n-          );\\n-        };\\n-        ReactDOM.render(<Outer />, container);\\n-\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-        target.pointerdown();\\n-        target.pointerup();\\n-        expect(events).toEqual([\\n-          \'inner: onPressStart\',\\n-          \'inner: onPressChange\',\\n-          \'pointerdown\',\\n-          \'inner: onPressEnd\',\\n-          \'inner: onPressChange\',\\n-          \'inner: onPress\',\\n-          \'pointerup\',\\n-        ]);\\n-      });\\n-    }\\n-\\n-    describe(\'correctly not propagate\', () => {\\n-      // @gate experimental\\n-      it(\'for onPress\', () => {\\n-        const ref = React.createRef();\\n-        const onPress = jest.fn();\\n-\\n-        const Inner = () => {\\n-          const listener = usePress({onPress});\\n-          return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-        };\\n-\\n-        const Outer = () => {\\n-          const listener = usePress({onPress});\\n-          return (\\n-            <div DEPRECATED_flareListeners={listener}>\\n-              <Inner />\\n-            </div>\\n-          );\\n-        };\\n-        ReactDOM.render(<Outer />, container);\\n-\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect({x: 0, y: 0, width: 100, height: 100});\\n-        target.pointerdown();\\n-        target.pointerup();\\n-        expect(onPress).toHaveBeenCalledTimes(1);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'for onPressStart/onPressEnd\', () => {\\n-        const ref = React.createRef();\\n-        const onPressStart = jest.fn();\\n-        const onPressEnd = jest.fn();\\n-\\n-        const Inner = () => {\\n-          const listener = usePress({onPressStart, onPressEnd});\\n-          return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-        };\\n-\\n-        const Outer = () => {\\n-          const listener = usePress({onPressStart, onPressEnd});\\n-          return (\\n-            <div DEPRECATED_flareListeners={listener}>\\n-              <Inner />\\n-            </div>\\n-          );\\n-        };\\n-        ReactDOM.render(<Outer />, container);\\n-\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown();\\n-        expect(onPressStart).toHaveBeenCalledTimes(1);\\n-        expect(onPressEnd).toHaveBeenCalledTimes(0);\\n-        target.pointerup();\\n-        expect(onPressStart).toHaveBeenCalledTimes(1);\\n-        expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-      });\\n-\\n-      // @gate experimental\\n-      it(\'for onPressChange\', () => {\\n-        const ref = React.createRef();\\n-        const onPressChange = jest.fn();\\n-\\n-        const Inner = () => {\\n-          const listener = usePress({onPressChange});\\n-          return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-        };\\n-\\n-        const Outer = () => {\\n-          const listener = usePress({onPressChange});\\n-          return (\\n-            <div DEPRECATED_flareListeners={listener}>\\n-              <Inner />\\n-            </div>\\n-          );\\n-        };\\n-        ReactDOM.render(<Outer />, container);\\n-\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown();\\n-        expect(onPressChange).toHaveBeenCalledTimes(1);\\n-        target.pointerup();\\n-        expect(onPressChange).toHaveBeenCalledTimes(2);\\n-      });\\n-    });\\n-  });\\n-\\n-  describe(\'link components\', () => {\\n-    // @gate experimental\\n-    it(\'prevents native behavior by default\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: true}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'prevents native behaviour for keyboard events by default\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.keyup({key: \'Enter\'});\\n-      target.click({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: true}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'deeply prevents native behaviour by default\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const buttonRef = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return (\\n-          <a href=\\"#\\">\\n-            <button ref={buttonRef} DEPRECATED_flareListeners={listener} />\\n-          </a>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(buttonRef.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'prevents native behaviour by default with nested elements\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return (\\n-          <a href=\\"#\\" DEPRECATED_flareListeners={listener}>\\n-            <div ref={ref} />\\n-          </a>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: true}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'uses native behaviour for interactions with modifier keys\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      [\'metaKey\', \'ctrlKey\', \'shiftKey\'].forEach(modifierKey => {\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({[modifierKey]: true});\\n-        target.pointerup({[modifierKey]: true, preventDefault});\\n-        expect(preventDefault).not.toBeCalled();\\n-        expect(onPress).toHaveBeenCalledWith(\\n-          expect.objectContaining({defaultPrevented: false}),\\n-        );\\n-      });\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'uses native behaviour for pointer events if preventDefault is false\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress, preventDefault: false});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).not.toBeCalled();\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: false}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'uses native behaviour for keyboard events if preventDefault is false\', () => {\\n-      const onPress = jest.fn();\\n-      const preventDefault = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPress, preventDefault: false});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.keydown({key: \'Enter\'});\\n-      target.click({preventDefault});\\n-      target.keyup({key: \'Enter\'});\\n-      expect(preventDefault).not.toBeCalled();\\n-      expect(onPress).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: false}),\\n-      );\\n-    });\\n-  });\\n-\\n-  describe(\'responder cancellation\', () => {\\n-    // @gate experimental\\n-    it(\'ends on pointer cancel: mouse\', () => {\\n-      const onPressEnd = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPressEnd});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'mouse\'});\\n-      target.pointercancel({pointerType: \'mouse\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    it(\'ends on pointer cancel: touch\', () => {\\n-      const onPressEnd = jest.fn();\\n-      const ref = React.createRef();\\n-\\n-      const Component = () => {\\n-        const listener = usePress({onPressEnd});\\n-        return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      target.pointercancel({pointerType: \'touch\'});\\n-      expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'does end on \\"scroll\\" to document (not mouse)\', () => {\\n-    const onPressEnd = jest.fn();\\n-    const ref = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress({onPressEnd});\\n-      return <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(ref.current);\\n-    const targetDocument = createEventTarget(document);\\n-    target.pointerdown({pointerType: \'touch\'});\\n-    targetDocument.scroll();\\n-    expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'does end on \\"scroll\\" to a parent container (not mouse)\', () => {\\n-    const onPressEnd = jest.fn();\\n-    const ref = React.createRef();\\n-    const containerRef = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress({onPressEnd});\\n-      return (\\n-        <div ref={containerRef}>\\n-          <a ref={ref} DEPRECATED_flareListeners={listener} />\\n-        </div>\\n-      );\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(ref.current);\\n-    const targetContainer = createEventTarget(containerRef.current);\\n-    target.pointerdown({pointerType: \'touch\'});\\n-    targetContainer.scroll();\\n-    expect(onPressEnd).toHaveBeenCalledTimes(1);\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'does not end on \\"scroll\\" to an element outside\', () => {\\n-    const onPressEnd = jest.fn();\\n-    const ref = React.createRef();\\n-    const outsideRef = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress({onPressEnd});\\n-      return (\\n-        <div>\\n-          <a ref={ref} DEPRECATED_flareListeners={listener} />\\n-          <span ref={outsideRef} />\\n-        </div>\\n-      );\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(ref.current);\\n-    const targetOutside = createEventTarget(outsideRef.current);\\n-    target.pointerdown();\\n-    targetOutside.scroll();\\n-    expect(onPressEnd).not.toBeCalled();\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'expect displayName to show up for event component\', () => {\\n-    expect(PressResponder.displayName).toBe(\'Press\');\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'should not trigger an invariant in addRootEventTypes()\', () => {\\n-    const ref = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress();\\n-      return <button ref={ref} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(ref.current);\\n-    target.pointerdown();\\n-    target.pointermove();\\n-    target.pointerup();\\n-    target.pointerdown();\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'event.preventDefault works as expected\', () => {\\n-    const onPress = jest.fn(e => e.preventDefault());\\n-    const onPressStart = jest.fn(e => e.preventDefault());\\n-    const onPressEnd = jest.fn(e => e.preventDefault());\\n-    const preventDefault = jest.fn();\\n-    const buttonRef = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress({onPress, onPressStart, onPressEnd});\\n-      return <button ref={buttonRef} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(buttonRef.current);\\n-    target.pointerdown();\\n-    target.pointerup({preventDefault});\\n-    expect(preventDefault).toBeCalled();\\n-    expect(onPressStart).toBeCalled();\\n-    expect(onPressEnd).toBeCalled();\\n-  });\\n-\\n-  // @gate experimental\\n-  it(\'when blur occurs on a pressed target, we should disengage press\', () => {\\n-    const onPress = jest.fn();\\n-    const onPressStart = jest.fn();\\n-    const onPressEnd = jest.fn();\\n-    const buttonRef = React.createRef();\\n-\\n-    const Component = () => {\\n-      const listener = usePress({onPress, onPressStart, onPressEnd});\\n-      return <button ref={buttonRef} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(buttonRef.current);\\n-    target.pointerdown();\\n-    expect(onPressStart).toBeCalled();\\n-    target.blur();\\n-    expect(onPressEnd).toBeCalled();\\n-    target.pointerup();\\n-    expect(onPress).not.toBeCalled();\\n-  });\\n-});"},{"sha":"66a9c6476f4137c9686d1ff63ad200ae64abbfc0","filename":"packages/react-interactions/events/src/dom/__tests__/Tap-test.internal.js","status":"removed","additions":0,"deletions":1010,"changes":1010,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Tap-test.internal.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/__tests__/Tap-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/__tests__/Tap-test.internal.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,1010 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {\\n-  buttonType,\\n-  buttonsType,\\n-  createEventTarget,\\n-  describeWithPointerEvent,\\n-  setPointerEvent,\\n-  testWithPointerType,\\n-  resetActivePointers,\\n-} from \'dom-event-testing-library\';\\n-\\n-let React;\\n-let ReactFeatureFlags;\\n-let ReactDOM;\\n-let useTap;\\n-\\n-function initializeModules(hasPointerEvents) {\\n-  jest.resetModules();\\n-  setPointerEvent(hasPointerEvents);\\n-  ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n-  ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n-  React = require(\'react\');\\n-  ReactDOM = require(\'react-dom\');\\n-\\n-  // TODO: This import throws outside of experimental mode. Figure out better\\n-  // strategy for gated imports.\\n-  if (__EXPERIMENTAL__) {\\n-    useTap = require(\'react-interactions/events/tap\').useTap;\\n-  }\\n-}\\n-\\n-const coordinatesInside = {x: 51, y: 51};\\n-const coordinatesOutside = {x: 49, y: 49};\\n-\\n-function tapAndMoveOutside({\\n-  hasPointerEvents,\\n-  pointerType,\\n-  downTarget,\\n-  upTarget,\\n-}) {\\n-  downTarget.setBoundingClientRect({width: 100, height: 100, x: 50, y: 50});\\n-  downTarget.pointerdown({pointerType, ...coordinatesInside});\\n-  downTarget.pointermove({pointerType, ...coordinatesInside});\\n-  // NOTE: this assumes the PointerEvent implementation calls\\n-  // \'releasePointerCapture\' for touch pointers\\n-  if (!hasPointerEvents && pointerType === \'touch\') {\\n-    document.elementFromPoint = () => upTarget.node;\\n-    downTarget.pointermove({pointerType, ...coordinatesOutside});\\n-  } else {\\n-    upTarget.pointermove({pointerType, ...coordinatesOutside});\\n-  }\\n-}\\n-\\n-function tapAndReleaseOutside({\\n-  hasPointerEvents,\\n-  pointerType,\\n-  downTarget,\\n-  upTarget,\\n-}) {\\n-  tapAndMoveOutside({hasPointerEvents, pointerType, downTarget, upTarget});\\n-  if (!hasPointerEvents && pointerType === \'touch\') {\\n-    downTarget.pointerup({pointerType, ...coordinatesOutside});\\n-  } else {\\n-    upTarget.pointerup({pointerType, ...coordinatesOutside});\\n-  }\\n-}\\n-\\n-describeWithPointerEvent(\'Tap responder\', hasPointerEvents => {\\n-  let container;\\n-\\n-  beforeEach(() => {\\n-    initializeModules(hasPointerEvents);\\n-    container = document.createElement(\'div\');\\n-    document.body.appendChild(container);\\n-  });\\n-\\n-  afterEach(() => {\\n-    ReactDOM.render(null, container);\\n-    document.body.removeChild(container);\\n-    container = null;\\n-    resetActivePointers();\\n-  });\\n-\\n-  // @gate experimental\\n-  test(\'supports repeated use\', () => {\\n-    const ref = React.createRef();\\n-    const Component = () => {\\n-      const listener = useTap();\\n-      return <button ref={ref} DEPRECATED_flareListeners={listener} />;\\n-    };\\n-    ReactDOM.render(<Component />, container);\\n-\\n-    const target = createEventTarget(ref.current);\\n-    function interact() {\\n-      target.pointerdown();\\n-      target.pointermove();\\n-      target.pointerup();\\n-    }\\n-    expect(() => {\\n-      interact();\\n-      interact();\\n-    }).not.toThrow();\\n-  });\\n-\\n-  describe(\'disabled\', () => {\\n-    let onTapStart, onTapChange, onTapUpdate, onTapCancel, onTapEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onTapStart = jest.fn();\\n-      onTapChange = jest.fn();\\n-      onTapUpdate = jest.fn();\\n-      onTapCancel = jest.fn();\\n-      onTapEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({\\n-          disabled: true,\\n-          onTapStart,\\n-          onTapChange,\\n-          onTapUpdate,\\n-          onTapCancel,\\n-          onTapEnd,\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // @gate experimental\\n-    test(\'does not call callbacks\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup();\\n-      expect(onTapStart).not.toBeCalled();\\n-      expect(onTapChange).not.toBeCalled();\\n-      expect(onTapUpdate).not.toBeCalled();\\n-      expect(onTapCancel).not.toBeCalled();\\n-      expect(onTapEnd).not.toBeCalled();\\n-    });\\n-  });\\n-\\n-  describe(\'maximumDistance\', () => {\\n-    let onTapCancel, onTapUpdate, ref;\\n-\\n-    function render(props) {\\n-      const Component = () => {\\n-        const listener = useTap(props);\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    }\\n-\\n-    const componentInit = () => {\\n-      onTapCancel = jest.fn();\\n-      onTapUpdate = jest.fn();\\n-      ref = React.createRef();\\n-      render({\\n-        maximumDistance: 20,\\n-        onTapCancel,\\n-        onTapUpdate,\\n-      });\\n-    };\\n-\\n-    // @gate experimental\\n-    test(\'ignores values less than 10\', () => {\\n-      componentInit();\\n-      render({\\n-        maximumDistance: 5,\\n-        onTapCancel,\\n-        onTapUpdate,\\n-      });\\n-      const target = createEventTarget(ref.current);\\n-      const pointerType = \'mouse\';\\n-      target.pointerdown({pointerType, x: 0, y: 0});\\n-      target.pointermove({pointerType, x: 10, y: 10});\\n-      expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-      expect(onTapCancel).toHaveBeenCalledTimes(0);\\n-    });\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'below threshold\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({pointerType, x: 0, y: 0});\\n-        target.pointermove({pointerType, x: 10, y: 10});\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-        expect(onTapCancel).toHaveBeenCalledTimes(0);\\n-      });\\n-\\n-      testWithPointerType(\'above threshold\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({pointerType, x: 0, y: 0});\\n-        target.pointermove({pointerType, x: 15, y: 14});\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(0);\\n-        expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-      });\\n-    }\\n-  });\\n-\\n-  describe(\'onAuxiliaryTap\', () => {\\n-    let onAuxiliaryTap, ref;\\n-\\n-    const componentInit = () => {\\n-      onAuxiliaryTap = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({onAuxiliaryTap});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // @gate experimental\\n-    test(\'auxiliary-button pointer up\', () => {\\n-      componentInit();\\n-      const pointerType = \'mouse\';\\n-      const button = buttonType.auxiliary;\\n-      const buttons = buttonsType.auxiliary;\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({button, buttons, pointerType});\\n-      target.pointerup({button, buttons, pointerType});\\n-      expect(onAuxiliaryTap).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'modifier-button pointer up\', () => {\\n-      componentInit();\\n-      const pointerType = \'mouse\';\\n-      const button = buttonType.primary;\\n-      const buttons = buttonsType.primary;\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown({button, buttons, pointerType});\\n-      target.pointerup({button, buttons, metaKey: true, pointerType});\\n-      expect(onAuxiliaryTap).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  describe(\'onTapStart\', () => {\\n-    let onTapStart, ref;\\n-\\n-    const componentInit = () => {\\n-      onTapStart = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({onTapStart});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'pointer down\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const nativeEvent = {\\n-          button: buttonType.primary,\\n-          buttons: buttonsType.primary,\\n-          pageX: 10,\\n-          pageY: 10,\\n-          pointerType,\\n-          x: 10,\\n-          y: 10,\\n-        };\\n-        target.pointerdown(nativeEvent);\\n-        // \'pointerup\' is only for the MouseEvent/TouchEvent fallback\\n-        // implementation. We also dispatch \'pointerup\' so that this test covers\\n-        // the case where browsers dispatch an emulated mousedown (and mouseup)\\n-        // event *after* a touch ends.\\n-        target.pointerup(nativeEvent);\\n-        expect(onTapStart).toHaveBeenCalledTimes(1);\\n-        expect(onTapStart).toHaveBeenCalledWith(\\n-          expect.objectContaining({\\n-            altKey: false,\\n-            ctrlKey: false,\\n-            height: pointerType === \'mouse\' ? 1 : 23,\\n-            metaKey: false,\\n-            pageX: 10,\\n-            pageY: 10,\\n-            pointerType,\\n-            pressure: pointerType === \'touch\' ? 1 : 0.5,\\n-            screenX: 10,\\n-            screenY: 60,\\n-            shiftKey: false,\\n-            tangentialPressure: 0,\\n-            target: target.node,\\n-            tiltX: 0,\\n-            tiltY: 0,\\n-            timeStamp: expect.any(Number),\\n-            twist: 0,\\n-            type: \'tap:start\',\\n-            width: pointerType === \'mouse\' ? 1 : 23,\\n-            x: 10,\\n-            y: 10,\\n-          }),\\n-        );\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    test(\'second pointer on target\', () => {\\n-      componentInit();\\n-      const pointerType = \'touch\';\\n-      const target = createEventTarget(ref.current);\\n-      const button = buttonType.primary;\\n-      const buttons = buttonsType.primary;\\n-      target.pointerdown({button, buttons, pointerId: 1, pointerType});\\n-      expect(onTapStart).toHaveBeenCalledTimes(1);\\n-      target.pointerdown({button, buttons, pointerId: 2, pointerType});\\n-      expect(onTapStart).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'ignored buttons and modifiers\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        if (pointerType !== \'touch\') {\\n-          // right-click\\n-          target.pointerdown({\\n-            button: buttonType.secondary,\\n-            buttons: buttonsType.secondary,\\n-            pointerType,\\n-          });\\n-          target.pointerup({pointerType});\\n-          // middle-click\\n-          target.pointerdown({\\n-            button: buttonType.auxiliary,\\n-            buttons: buttonsType.auxiliary,\\n-            pointerType,\\n-          });\\n-          target.pointerup({pointerType});\\n-          // virtual middle-click with misleading \'buttons\' value\\n-          target.pointerdown({\\n-            button: buttonType.auxiliary,\\n-            buttons: 0,\\n-            pointerType,\\n-          });\\n-          target.pointerup({pointerType});\\n-          // pen eraser\\n-          target.pointerdown({\\n-            button: buttonType.eraser,\\n-            buttons: buttonsType.eraser,\\n-            pointerType,\\n-          });\\n-          target.pointerup({pointerType});\\n-        }\\n-        // alt-click\\n-        target.pointerdown({\\n-          button: buttonType.primary,\\n-          buttons: buttonsType.primary,\\n-          altKey: true,\\n-          pointerType,\\n-        });\\n-        target.pointerup({pointerType});\\n-        // ctrl-click\\n-        target.pointerdown({\\n-          button: buttonType.primary,\\n-          buttons: buttonsType.primary,\\n-          ctrlKey: true,\\n-          pointerType,\\n-        });\\n-        target.pointerup({pointerType});\\n-        // meta-click\\n-        target.pointerdown({\\n-          button: buttonType.primary,\\n-          buttons: buttonsType.primary,\\n-          metaKey: true,\\n-          pointerType,\\n-        });\\n-        target.pointerup({pointerType});\\n-        // shift-click\\n-        target.pointerdown({\\n-          button: buttonType.primary,\\n-          buttons: buttonsType.primary,\\n-          shiftKey: true,\\n-          pointerType,\\n-        });\\n-        target.pointerup({pointerType});\\n-\\n-        expect(onTapStart).toHaveBeenCalledTimes(0);\\n-      });\\n-    }\\n-  });\\n-\\n-  describe(\'onTapEnd\', () => {\\n-    let onTapEnd, ref;\\n-\\n-    const componentInit = () => {\\n-      onTapEnd = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({onTapEnd});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'pointer up\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const button = buttonType.primary;\\n-        const buttons = buttonsType.primary;\\n-        target.pointerdown({button, buttons, pointerType});\\n-        target.pointerup({\\n-          button,\\n-          buttons,\\n-          pageX: 10,\\n-          pageY: 10,\\n-          pointerType,\\n-          x: 10,\\n-          y: 10,\\n-        });\\n-        expect(onTapEnd).toHaveBeenCalledTimes(1);\\n-        expect(onTapEnd).toHaveBeenCalledWith(\\n-          expect.objectContaining({\\n-            altKey: false,\\n-            ctrlKey: false,\\n-            height: pointerType === \'mouse\' ? 1 : 23,\\n-            metaKey: false,\\n-            pageX: 10,\\n-            pageY: 10,\\n-            pointerType,\\n-            pressure: 0,\\n-            screenX: 10,\\n-            screenY: 60,\\n-            shiftKey: false,\\n-            tangentialPressure: 0,\\n-            target: target.node,\\n-            tiltX: 0,\\n-            tiltY: 0,\\n-            timeStamp: expect.any(Number),\\n-            twist: 0,\\n-            type: \'tap:end\',\\n-            width: pointerType === \'mouse\' ? 1 : 23,\\n-            x: 10,\\n-            y: 10,\\n-          }),\\n-        );\\n-      });\\n-\\n-      testWithPointerType(\'zero-dimension hit rect\', pointerType => {\\n-        componentInit();\\n-        const targetRef = React.createRef();\\n-        const innerRef = React.createRef();\\n-\\n-        const Component = () => {\\n-          const listener = useTap({onTapEnd});\\n-          return (\\n-            <div ref={targetRef} DEPRECATED_flareListeners={listener}>\\n-              <button ref={innerRef} />\\n-            </div>\\n-          );\\n-        };\\n-        ReactDOM.render(<Component />, container);\\n-        document.elementFromPoint = () => innerRef.current;\\n-\\n-        const target = createEventTarget(targetRef.current);\\n-        target.setBoundingClientRect({x: 0, y: 0, width: 0, height: 0});\\n-        const innerTarget = createEventTarget(innerRef.current);\\n-        innerTarget.pointerdown({pointerType});\\n-        innerTarget.pointerup({pointerType});\\n-        expect(onTapEnd).toBeCalled();\\n-      });\\n-\\n-      testWithPointerType(\'pointer up outside target\', pointerType => {\\n-        componentInit();\\n-        const downTarget = createEventTarget(ref.current);\\n-        const upTarget = createEventTarget(container);\\n-        tapAndReleaseOutside({\\n-          hasPointerEvents,\\n-          downTarget,\\n-          upTarget,\\n-          pointerType,\\n-        });\\n-        expect(onTapEnd).not.toBeCalled();\\n-      });\\n-    }\\n-\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      test(\'second pointer up off target\', () => {\\n-        componentInit();\\n-        const pointerType = \'touch\';\\n-        const target = createEventTarget(ref.current);\\n-        const offTarget = createEventTarget(container);\\n-        const button = buttonType.primary;\\n-        const buttons = buttonsType.primary;\\n-\\n-        target.pointerdown({button, buttons, pointerId: 1, pointerType});\\n-        offTarget.pointerdown({button, buttons, pointerId: 2, pointerType});\\n-        offTarget.pointerup({\\n-          button,\\n-          buttons,\\n-          pageX: 10,\\n-          pageY: 10,\\n-          pointerId: 2,\\n-          pointerType,\\n-          x: 10,\\n-          y: 10,\\n-        });\\n-        expect(onTapEnd).toHaveBeenCalledTimes(0);\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    test(\'ignored buttons and modifiers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      // right-click\\n-      target.pointerdown({\\n-        button: buttonType.secondary,\\n-        buttons: buttonsType.secondary,\\n-      });\\n-      target.pointerup({\\n-        button: buttonType.secondary,\\n-        buttons: buttonsType.secondary,\\n-      });\\n-      // middle-click\\n-      target.pointerdown({\\n-        button: buttonType.auxiliary,\\n-        buttons: buttonsType.auxiliary,\\n-      });\\n-      target.pointerup({\\n-        button: buttonType.auxiliary,\\n-        buttons: buttonsType.auxiliary,\\n-      });\\n-      // pen eraser\\n-      target.pointerdown({\\n-        button: buttonType.eraser,\\n-        buttons: buttonsType.eraser,\\n-      });\\n-      target.pointerup({\\n-        button: buttonType.eraser,\\n-        buttons: buttonsType.eraser,\\n-      });\\n-      // alt-click\\n-      target.pointerdown({\\n-        button: buttonType.primary,\\n-        buttons: buttonsType.primary,\\n-      });\\n-      target.pointerup({altKey: true, button: buttonType.primary});\\n-      // ctrl-click\\n-      target.pointerdown({\\n-        button: buttonType.primary,\\n-        buttons: buttonsType.primary,\\n-      });\\n-      target.pointerup({ctrlKey: true, button: buttonType.primary});\\n-      // meta-click\\n-      target.pointerdown({\\n-        button: buttonType.primary,\\n-        buttons: buttonsType.primary,\\n-      });\\n-      target.pointerup({metaKey: true, button: buttonType.primary});\\n-      // shift-click\\n-      target.pointerdown({\\n-        button: buttonType.primary,\\n-        buttons: buttonsType.primary,\\n-      });\\n-      target.pointerup({shiftKey: true, button: buttonType.primary});\\n-\\n-      expect(onTapEnd).toHaveBeenCalledTimes(0);\\n-    });\\n-  });\\n-\\n-  describe(\'onTapUpdate\', () => {\\n-    let onTapUpdate, ref;\\n-    const rect = {x: 0, y: 0, width: 100, height: 100};\\n-    const coordinates = {x: 10, y: 10};\\n-\\n-    const componentInit = () => {\\n-      onTapUpdate = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({onTapUpdate});\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'requires activation\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect(rect);\\n-        if (pointerType !== \'touch\') {\\n-          target.pointerhover({pointerType, ...coordinates});\\n-          target.pointermove({pointerType, ...coordinates});\\n-        }\\n-        expect(onTapUpdate).not.toBeCalled();\\n-      });\\n-\\n-      testWithPointerType(\'pointer move\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.setBoundingClientRect(rect);\\n-        target.pointerdown({pointerType});\\n-\\n-        target.pointermove({pointerType, x: 10, y: 10});\\n-        expect(onTapUpdate).toHaveBeenCalledWith(\\n-          expect.objectContaining({\\n-            altKey: false,\\n-            ctrlKey: false,\\n-            height: pointerType === \'mouse\' ? 1 : 23,\\n-            metaKey: false,\\n-            pageX: 10,\\n-            pageY: 10,\\n-            pointerType,\\n-            pressure: pointerType === \'touch\' ? 1 : 0.5,\\n-            screenX: 10,\\n-            screenY: 60,\\n-            shiftKey: false,\\n-            tangentialPressure: 0,\\n-            target: target.node,\\n-            tiltX: 0,\\n-            tiltY: 0,\\n-            timeStamp: expect.any(Number),\\n-            twist: 0,\\n-            type: \'tap:update\',\\n-            width: pointerType === \'mouse\' ? 1 : 23,\\n-            x: 10,\\n-            y: 10,\\n-          }),\\n-        );\\n-\\n-        target.pointermove({pointerType, x: 20, y: 20});\\n-        expect(onTapUpdate).toHaveBeenCalledWith(\\n-          expect.objectContaining({pointerType, x: 20, y: 20}),\\n-        );\\n-\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(2);\\n-      });\\n-\\n-      testWithPointerType(\'pointer moves outside target\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        const containerTarget = createEventTarget(container);\\n-        target.setBoundingClientRect(rect);\\n-        target.pointerdown({pointerType});\\n-        target.pointermove({pointerType, x: 10, y: 10});\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-\\n-        // NOTE: this assumes the PointerEvent implementation calls\\n-        // \'releasePointerCapture\' for touch pointers\\n-        if (!hasPointerEvents && pointerType === \'touch\') {\\n-          document.elementFromPoint = () => containerTarget.node;\\n-          target.pointermove({pointerType, x: 101, y: 101});\\n-        } else {\\n-          containerTarget.pointermove({pointerType, x: 101, y: 101});\\n-        }\\n-\\n-        // No extra \'onTapUpdate\' calls when the pointer is outside the target\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-      });\\n-    }\\n-\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      test(\'second pointer off target\', () => {\\n-        componentInit();\\n-        const pointerType = \'touch\';\\n-        const target = createEventTarget(ref.current);\\n-        const offTarget = createEventTarget(container);\\n-        const button = buttonType.primary;\\n-        const buttons = buttonsType.primary;\\n-        target.pointerdown({button, buttons, pointerId: 1, pointerType});\\n-        offTarget.pointerdown({button, buttons, pointerId: 2, pointerType});\\n-        target.pointermove({pointerId: 1, pointerType, x: 10, y: 10});\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-        offTarget.pointermove({pointerId: 2, pointerType, x: 10, y: 10});\\n-        expect(onTapUpdate).toHaveBeenCalledTimes(1);\\n-      });\\n-    }\\n-  });\\n-\\n-  describe(\'onTapChange\', () => {\\n-    let eventsLog, onTapChange, ref;\\n-\\n-    const logger = msg => () => {\\n-      eventsLog.push(msg);\\n-    };\\n-\\n-    const componentInit = () => {\\n-      eventsLog = [];\\n-      onTapChange = jest.fn();\\n-      ref = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({\\n-          onTapChange(e) {\\n-            logger(\'change\')();\\n-            onTapChange(e);\\n-          },\\n-          onTapStart: logger(\'start\'),\\n-          onTapEnd: logger(\'end\'),\\n-          onTapCancel: logger(\'cancel\'),\\n-        });\\n-        return <div ref={ref} DEPRECATED_flareListeners={listener} />;\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-      document.elementFromPoint = () => ref.current;\\n-    };\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'pointer down/up\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({pointerType});\\n-        expect(onTapChange).toHaveBeenCalledTimes(1);\\n-        expect(onTapChange).toHaveBeenCalledWith(true);\\n-        target.pointerup({pointerType, x: 0, y: 0});\\n-        expect(onTapChange).toHaveBeenCalledTimes(2);\\n-        expect(onTapChange).toHaveBeenCalledWith(false);\\n-        expect(eventsLog).toEqual([\'start\', \'change\', \'change\', \'end\']);\\n-      });\\n-\\n-      testWithPointerType(\'pointer cancel\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({pointerType});\\n-        expect(onTapChange).toHaveBeenCalledTimes(1);\\n-        expect(onTapChange).toHaveBeenCalledWith(true);\\n-        target.pointercancel({pointerType});\\n-        expect(onTapChange).toHaveBeenCalledTimes(2);\\n-        expect(onTapChange).toHaveBeenCalledWith(false);\\n-        expect(eventsLog).toEqual([\'start\', \'change\', \'change\', \'cancel\']);\\n-      });\\n-\\n-      testWithPointerType(\'pointer move outside target\', pointerType => {\\n-        componentInit();\\n-        const downTarget = createEventTarget(ref.current);\\n-        const upTarget = createEventTarget(container);\\n-        tapAndMoveOutside({\\n-          hasPointerEvents,\\n-          downTarget,\\n-          upTarget,\\n-          pointerType,\\n-        });\\n-        expect(onTapChange).toHaveBeenCalledTimes(2);\\n-      });\\n-    }\\n-  });\\n-\\n-  describe(\'onTapCancel\', () => {\\n-    let onTapCancel, onTapUpdate, parentRef, ref, siblingRef;\\n-\\n-    const componentInit = () => {\\n-      onTapCancel = jest.fn();\\n-      onTapUpdate = jest.fn();\\n-      parentRef = React.createRef();\\n-      ref = React.createRef();\\n-      siblingRef = React.createRef();\\n-      const Component = () => {\\n-        const listener = useTap({onTapCancel, onTapUpdate});\\n-        return (\\n-          <div ref={parentRef}>\\n-            <div ref={ref} DEPRECATED_flareListeners={listener} />\\n-            <span ref={siblingRef} />\\n-          </div>\\n-        );\\n-      };\\n-      ReactDOM.render(<Component />, container);\\n-    };\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'pointer cancel\', pointerType => {\\n-        componentInit();\\n-        const target = createEventTarget(ref.current);\\n-        target.pointerdown({pointerType});\\n-        target.pointercancel({pointerType});\\n-        expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-        expect(onTapCancel).toHaveBeenCalledWith(\\n-          expect.objectContaining({\\n-            altKey: false,\\n-            ctrlKey: false,\\n-            height: 1,\\n-            metaKey: false,\\n-            pageX: 0,\\n-            pageY: 0,\\n-            pointerType,\\n-            pressure: 0,\\n-            screenX: 0,\\n-            screenY: 0,\\n-            shiftKey: false,\\n-            tangentialPressure: 0,\\n-            target: target.node,\\n-            tiltX: 0,\\n-            tiltY: 0,\\n-            timeStamp: expect.any(Number),\\n-            twist: 0,\\n-            type: \'tap:cancel\',\\n-            width: 1,\\n-            x: 0,\\n-            y: 0,\\n-          }),\\n-        );\\n-        target.pointermove({pointerType, x: 5, y: 5});\\n-        expect(onTapUpdate).not.toBeCalled();\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    test(\'second pointer on target\', () => {\\n-      componentInit();\\n-      const pointerType = \'touch\';\\n-      const target = createEventTarget(ref.current);\\n-      const button = buttonType.primary;\\n-      const buttons = buttonsType.primary;\\n-      target.pointerdown({button, buttons, pointerId: 1, pointerType});\\n-      target.pointerdown({button, buttons, pointerId: 2, pointerType});\\n-      expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    if (hasPointerEvents) {\\n-      // @gate experimental\\n-      test(\'second pointer off target\', () => {\\n-        componentInit();\\n-        const pointerType = \'touch\';\\n-        const target = createEventTarget(ref.current);\\n-        const offTarget = createEventTarget(container);\\n-        const button = buttonType.primary;\\n-        const buttons = buttonsType.primary;\\n-        target.pointerdown({button, buttons, pointerId: 1, pointerType});\\n-        offTarget.pointerdown({button, buttons, pointerId: 2, pointerType});\\n-        expect(onTapCancel).toHaveBeenCalledTimes(0);\\n-      });\\n-    }\\n-\\n-    // TODO: Get rid of this condition somehow. Perhaps with a dynamic version\\n-    // of the @gate pragma.\\n-    if (__EXPERIMENTAL__) {\\n-      testWithPointerType(\'pointer move outside target\', pointerType => {\\n-        componentInit();\\n-        const downTarget = createEventTarget(ref.current);\\n-        const upTarget = createEventTarget(container);\\n-        tapAndMoveOutside({\\n-          hasPointerEvents,\\n-          downTarget,\\n-          upTarget,\\n-          pointerType,\\n-        });\\n-        expect(onTapCancel).toBeCalled();\\n-      });\\n-    }\\n-\\n-    // @gate experimental\\n-    test(\'ignored modifiers\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const button = buttonType.primary;\\n-      const buttons = buttonsType.primary;\\n-      // alt-click\\n-      target.pointerdown({button, buttons});\\n-      target.pointerup({altKey: true, button});\\n-      // ctrl-click\\n-      target.pointerdown({button, buttons});\\n-      target.pointerup({ctrlKey: true, button});\\n-      // meta-click\\n-      target.pointerdown({button, buttons});\\n-      target.pointerup({metaKey: true, button});\\n-      // shift-click\\n-      target.pointerdown({buttons});\\n-      target.pointerup({shiftKey: true, button});\\n-\\n-      expect(onTapCancel).toHaveBeenCalledTimes(4);\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'long press context menu\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.contextmenu({}, {pointerType: \'touch\'});\\n-      expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'parent scroll (non-mouse)\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const parentTarget = createEventTarget(parentRef.current);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      parentTarget.scroll();\\n-      expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'sibling scroll\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const siblingTarget = createEventTarget(siblingRef.current);\\n-      target.pointerdown();\\n-      siblingTarget.scroll();\\n-      expect(onTapCancel).not.toBeCalled();\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'document scroll (non-mouse)\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const documentTarget = createEventTarget(document);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      documentTarget.scroll();\\n-      expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-    });\\n-\\n-    // Scroll on an element not managed by React\\n-    // @gate experimental\\n-    test(\'root container scroll (non-mouse)\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      const containerTarget = createEventTarget(container);\\n-      target.pointerdown({pointerType: \'touch\'});\\n-      containerTarget.scroll();\\n-      expect(onTapCancel).toHaveBeenCalledTimes(1);\\n-    });\\n-  });\\n-\\n-  describe(\'preventDefault\', () => {\\n-    let onTapEnd, ref, innerRef, preventDefault, remount;\\n-\\n-    const componentInit = () => {\\n-      remount = function(shouldPreventDefault) {\\n-        onTapEnd = jest.fn();\\n-        preventDefault = jest.fn();\\n-        ref = React.createRef();\\n-        innerRef = React.createRef();\\n-        const Component = () => {\\n-          const listener = useTap({\\n-            onTapEnd,\\n-            preventDefault: shouldPreventDefault,\\n-          });\\n-          return (\\n-            <a href=\\"#\\" ref={ref} DEPRECATED_flareListeners={listener}>\\n-              <div ref={innerRef} />\\n-            </a>\\n-          );\\n-        };\\n-        ReactDOM.render(<Component />, container);\\n-      };\\n-      remount();\\n-    };\\n-\\n-    // @gate experimental\\n-    test(\'prevents native behavior by default\', () => {\\n-      componentInit();\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onTapEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: true}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'prevents native behaviour by default (inner target)\', () => {\\n-      componentInit();\\n-      const innerTarget = createEventTarget(innerRef.current);\\n-      innerTarget.pointerdown();\\n-      innerTarget.pointerup({preventDefault});\\n-      expect(preventDefault).toBeCalled();\\n-      expect(onTapEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: true}),\\n-      );\\n-    });\\n-\\n-    // @gate experimental\\n-    test(\'allows native behaviour if false\', () => {\\n-      componentInit();\\n-      remount(false);\\n-\\n-      const target = createEventTarget(ref.current);\\n-      target.pointerdown();\\n-      target.pointerup({preventDefault});\\n-      expect(preventDefault).not.toBeCalled();\\n-      expect(onTapEnd).toHaveBeenCalledWith(\\n-        expect.objectContaining({defaultPrevented: false}),\\n-      );\\n-    });\\n-  });\\n-});"},{"sha":"5032293689a6da8241db58538cafeff63bf9c3a4","filename":"packages/react-interactions/events/src/dom/shared/index.js","status":"removed","additions":0,"deletions":87,"changes":87,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/shared/index.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/src/dom/shared/index.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/src/dom/shared/index.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,87 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @emails react-core\\n- */\\n-\\n-\'use strict\';\\n-\\n-import {DiscreteEvent, UserBlockingEvent} from \'shared/ReactTypes\';\\n-import type {\\n-  ReactDOMResponderContext,\\n-  ReactDOMResponderEvent,\\n-} from \'react-dom/src/shared/ReactDOMTypes\';\\n-\\n-export const hasPointerEvents =\\n-  typeof window !== \'undefined\' && window.PointerEvent !== undefined;\\n-\\n-export const isMac =\\n-  typeof window !== \'undefined\' && window.navigator != null\\n-    ? /^Mac/.test(window.navigator.platform)\\n-    : false;\\n-\\n-export const buttonsEnum = {\\n-  none: 0,\\n-  primary: 1,\\n-  secondary: 2,\\n-  auxiliary: 4,\\n-};\\n-\\n-export function dispatchDiscreteEvent(\\n-  context: ReactDOMResponderContext,\\n-  payload: ReactDOMResponderEvent,\\n-  callback: any => void,\\n-) {\\n-  context.dispatchEvent(payload, callback, DiscreteEvent);\\n-}\\n-\\n-export function dispatchUserBlockingEvent(\\n-  context: ReactDOMResponderContext,\\n-  payload: ReactDOMResponderEvent,\\n-  callback: any => void,\\n-) {\\n-  context.dispatchEvent(payload, callback, UserBlockingEvent);\\n-}\\n-\\n-export function getTouchById(\\n-  nativeEvent: TouchEvent,\\n-  pointerId: null | number,\\n-): null | Touch {\\n-  if (pointerId != null) {\\n-    const changedTouches = nativeEvent.changedTouches;\\n-    for (let i = 0; i < changedTouches.length; i++) {\\n-      const touch = changedTouches[i];\\n-      if (touch.identifier === pointerId) {\\n-        return touch;\\n-      }\\n-    }\\n-    return null;\\n-  }\\n-  return null;\\n-}\\n-\\n-export function hasModifierKey(event: ReactDOMResponderEvent): boolean {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  const {altKey, ctrlKey, metaKey, shiftKey} = nativeEvent;\\n-  return (\\n-    altKey === true || ctrlKey === true || metaKey === true || shiftKey === true\\n-  );\\n-}\\n-\\n-// Keyboards, Assitive Technologies, and element.click() all produce a \\"virtual\\"\\n-// click event. This is a method of inferring such clicks. Every browser except\\n-// IE 11 only sets a zero value of \\"detail\\" for click events that are \\"virtual\\".\\n-// However, IE 11 uses a zero value for all click events. For IE 11 we rely on\\n-// the quirk that it produces click events that are of type PointerEvent, and\\n-// where only the \\"virtual\\" click lacks a pointerType field.\\n-export function isVirtualClick(event: ReactDOMResponderEvent): boolean {\\n-  const nativeEvent: any = event.nativeEvent;\\n-  // JAWS/NVDA with Firefox.\\n-  if (nativeEvent.mozInputSource === 0 && nativeEvent.isTrusted) {\\n-    return true;\\n-  }\\n-  return nativeEvent.detail === 0 && !nativeEvent.pointerType;\\n-}"},{"sha":"ac39f7c9d3ea635e64623cc0a67dd8658eff1ed7","filename":"packages/react-interactions/events/tap.js","status":"removed","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/tap.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-interactions/events/tap.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-interactions/events/tap.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,10 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-export * from \'./src/dom/Tap\';"},{"sha":"dcdceb7a60dbd5ae758e3866a9aaa19d8e848536","filename":"packages/react-native-renderer/src/ReactFabricHostConfig.js","status":"modified","additions":0,"deletions":16,"changes":16,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/ReactFabricHostConfig.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/ReactFabricHostConfig.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-native-renderer/src/ReactFabricHostConfig.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -435,22 +435,6 @@ export function replaceContainerChildren(\\n   newChildren: ChildSet,\\n ): void {}\\n \\n-export function DEPRECATED_mountResponderInstance(\\n-  responder: any,\\n-  responderInstance: any,\\n-  props: Object,\\n-  state: Object,\\n-  instance: Instance,\\n-) {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n-export function DEPRECATED_unmountResponderInstance(\\n-  responderInstance: any,\\n-): void {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n export function getFundamentalComponentInstance(fundamentalInstance: any) {\\n   throw new Error(\'Not yet implemented.\');\\n }"},{"sha":"0369755c136a04fe34b1544f0e3c19e4a19c5518","filename":"packages/react-native-renderer/src/ReactNativeHostConfig.js","status":"modified","additions":0,"deletions":16,"changes":16,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/ReactNativeHostConfig.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/ReactNativeHostConfig.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-native-renderer/src/ReactNativeHostConfig.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -492,22 +492,6 @@ export function unhideTextInstance(\\n   throw new Error(\'Not yet implemented.\');\\n }\\n \\n-export function DEPRECATED_mountResponderInstance(\\n-  responder: any,\\n-  responderInstance: any,\\n-  props: Object,\\n-  state: Object,\\n-  instance: Instance,\\n-) {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n-export function DEPRECATED_unmountResponderInstance(\\n-  responderInstance: any,\\n-): void {\\n-  throw new Error(\'Not yet implemented.\');\\n-}\\n-\\n export function getFundamentalComponentInstance(fundamentalInstance: any) {\\n   throw new Error(\'Not yet implemented.\');\\n }"},{"sha":"6f09626539b019111cce3f5633173982b89c56b5","filename":"packages/react-native-renderer/src/__tests__/ResponderEventPlugin-test.internal.js","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/__tests__/ResponderEventPlugin-test.internal.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/__tests__/ResponderEventPlugin-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-native-renderer/src/__tests__/ResponderEventPlugin-test.internal.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -13,7 +13,6 @@\\n // though the responder plugin is only used in React Native. Sadness ensues.\\n // The coverage is valuable though, so we will keep it for now.\\n const {HostComponent} = require(\'react-reconciler/src/ReactWorkTags\');\\n-const {PLUGIN_EVENT_SYSTEM} = require(\'react-dom/src/events/EventSystemFlags\');\\n \\n let EventBatching;\\n let EventPluginUtils;\\n@@ -320,7 +319,7 @@ const run = function(config, hierarchyConfig, nativeEventConfig) {\\n     nativeEventConfig.targetInst,\\n     nativeEventConfig.nativeEvent,\\n     nativeEventConfig.target,\\n-    PLUGIN_EVENT_SYSTEM,\\n+    0,\\n   );\\n \\n   // At this point the negotiation events have been dispatched as part of the"},{"sha":"89bbdd203b14d2a10b3bc20b63e698bad26f9580","filename":"packages/react-native-renderer/src/legacy-events/ReactGenericBatching.js","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/legacy-events/ReactGenericBatching.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-native-renderer/src/legacy-events/ReactGenericBatching.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-native-renderer/src/legacy-events/ReactGenericBatching.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -64,7 +64,7 @@ export function discreteUpdates(fn, a, b, c, d) {\\n   }\\n }\\n \\n-export function flushDiscreteUpdatesIfNeeded(timeStamp: number) {\\n+export function flushDiscreteUpdatesIfNeeded() {\\n   if (!isInsideEventHandler) {\\n     flushDiscreteUpdatesImpl();\\n   }"},{"sha":"cf9552fb2f9b912c18824700d9ee7cf5f7876b8c","filename":"packages/react-noop-renderer/src/createReactNoop.js","status":"modified","additions":0,"deletions":8,"changes":8,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-noop-renderer/src/createReactNoop.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-noop-renderer/src/createReactNoop.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-noop-renderer/src/createReactNoop.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -375,14 +375,6 @@ function createReactNoop(reconciler: Function, useMutation: boolean) {\\n     warnsIfNotActing: true,\\n     supportsHydration: false,\\n \\n-    DEPRECATED_mountResponderInstance(): void {\\n-      // NO-OP\\n-    },\\n-\\n-    DEPRECATED_unmountResponderInstance(): void {\\n-      // NO-OP\\n-    },\\n-\\n     getFundamentalComponentInstance(fundamentalInstance): Instance {\\n       const {impl, props, state} = fundamentalInstance;\\n       return impl.getInstance(null, props, state);"},{"sha":"586825a336209f0f55a2c1c7527d72c8282f5519","filename":"packages/react-reconciler/src/ReactFiber.new.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiber.new.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiber.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiber.new.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -326,7 +326,6 @@ export function createWorkInProgress(current: Fiber, pendingProps: any): Fiber {\\n       : {\\n           lanes: currentDependencies.lanes,\\n           firstContext: currentDependencies.firstContext,\\n-          responders: currentDependencies.responders,\\n         };\\n \\n   // These will be overridden during the parent\'s reconciliation\\n@@ -422,7 +421,6 @@ export function resetWorkInProgress(workInProgress: Fiber, renderLanes: Lanes) {\\n         : {\\n             lanes: currentDependencies.lanes,\\n             firstContext: currentDependencies.firstContext,\\n-            responders: currentDependencies.responders,\\n           };\\n \\n     if (enableProfilerTimer) {"},{"sha":"818f001fa337608fdfac3e1a65f663787346a2f4","filename":"packages/react-reconciler/src/ReactFiber.old.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiber.old.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiber.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiber.old.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -320,7 +320,6 @@ export function createWorkInProgress(current: Fiber, pendingProps: any): Fiber {\\n       : {\\n           lanes: currentDependencies.lanes,\\n           firstContext: currentDependencies.firstContext,\\n-          responders: currentDependencies.responders,\\n         };\\n \\n   // These will be overridden during the parent\'s reconciliation\\n@@ -416,7 +415,6 @@ export function resetWorkInProgress(workInProgress: Fiber, renderLanes: Lanes) {\\n         : {\\n             lanes: currentDependencies.lanes,\\n             firstContext: currentDependencies.firstContext,\\n-            responders: currentDependencies.responders,\\n           };\\n \\n     if (enableProfilerTimer) {"},{"sha":"6fda9c97cd1f0d4a01ca5a3e73837e2dbf2b0b2a","filename":"packages/react-reconciler/src/ReactFiberCommitWork.new.js","status":"modified","additions":0,"deletions":27,"changes":27,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCommitWork.new.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCommitWork.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCommitWork.new.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -31,7 +31,6 @@ import {\\n   enableProfilerTimer,\\n   enableProfilerCommitHooks,\\n   enableSuspenseServerRenderer,\\n-  enableDeprecatedFlareAPI,\\n   enableFundamentalAPI,\\n   enableSuspenseCallback,\\n   enableScopeAPI,\\n@@ -124,10 +123,6 @@ import {\\n   Layout as HookLayout,\\n } from \'./ReactHookEffectTags\';\\n import {didWarnAboutReassigningProps} from \'./ReactFiberBeginWork.new\';\\n-import {\\n-  updateDeprecatedEventListeners,\\n-  unmountDeprecatedResponderListeners,\\n-} from \'./ReactFiberDeprecatedEvents.new\';\\n import {\\n   NoEffect as NoSubtreeTag,\\n   Passive as PassiveSubtreeTag,\\n@@ -904,9 +899,6 @@ function commitUnmount(\\n       return;\\n     }\\n     case HostComponent: {\\n-      if (enableDeprecatedFlareAPI) {\\n-        unmountDeprecatedResponderListeners(current);\\n-      }\\n       safelyDetachRef(current);\\n       return;\\n     }\\n@@ -945,9 +937,6 @@ function commitUnmount(\\n     }\\n     case ScopeComponent: {\\n       if (enableScopeAPI) {\\n-        if (enableDeprecatedFlareAPI) {\\n-          unmountDeprecatedResponderListeners(current);\\n-        }\\n         safelyDetachRef(current);\\n       }\\n       return;\\n@@ -1533,13 +1522,6 @@ function commitWork(current: Fiber | null, finishedWork: Fiber): void {\\n             finishedWork,\\n           );\\n         }\\n-        if (enableDeprecatedFlareAPI) {\\n-          const prevListeners = oldProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners) {\\n-            updateDeprecatedEventListeners(nextListeners, finishedWork, null);\\n-          }\\n-        }\\n       }\\n       return;\\n     }\\n@@ -1596,15 +1578,6 @@ function commitWork(current: Fiber | null, finishedWork: Fiber): void {\\n     case ScopeComponent: {\\n       if (enableScopeAPI) {\\n         const scopeInstance = finishedWork.stateNode;\\n-        if (enableDeprecatedFlareAPI) {\\n-          const newProps = finishedWork.memoizedProps;\\n-          const oldProps = current !== null ? current.memoizedProps : newProps;\\n-          const prevListeners = oldProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners || current === null) {\\n-            updateDeprecatedEventListeners(nextListeners, finishedWork, null);\\n-          }\\n-        }\\n         prepareScopeUpdate(scopeInstance, finishedWork);\\n         return;\\n       }"},{"sha":"f255f8b622200b8389c980e1650453712a483724","filename":"packages/react-reconciler/src/ReactFiberCommitWork.old.js","status":"modified","additions":0,"deletions":27,"changes":27,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCommitWork.old.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCommitWork.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCommitWork.old.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -31,7 +31,6 @@ import {\\n   enableProfilerTimer,\\n   enableProfilerCommitHooks,\\n   enableSuspenseServerRenderer,\\n-  enableDeprecatedFlareAPI,\\n   enableFundamentalAPI,\\n   enableSuspenseCallback,\\n   enableScopeAPI,\\n@@ -126,10 +125,6 @@ import {\\n   Passive as HookPassive,\\n } from \'./ReactHookEffectTags\';\\n import {didWarnAboutReassigningProps} from \'./ReactFiberBeginWork.old\';\\n-import {\\n-  updateDeprecatedEventListeners,\\n-  unmountDeprecatedResponderListeners,\\n-} from \'./ReactFiberDeprecatedEvents.old\';\\n \\n let didWarnAboutUndefinedSnapshotBeforeUpdate: Set<mixed> | null = null;\\n if (__DEV__) {\\n@@ -922,9 +917,6 @@ function commitUnmount(\\n       return;\\n     }\\n     case HostComponent: {\\n-      if (enableDeprecatedFlareAPI) {\\n-        unmountDeprecatedResponderListeners(current);\\n-      }\\n       safelyDetachRef(current);\\n       return;\\n     }\\n@@ -963,9 +955,6 @@ function commitUnmount(\\n     }\\n     case ScopeComponent: {\\n       if (enableScopeAPI) {\\n-        if (enableDeprecatedFlareAPI) {\\n-          unmountDeprecatedResponderListeners(current);\\n-        }\\n         safelyDetachRef(current);\\n       }\\n       return;\\n@@ -1556,13 +1545,6 @@ function commitWork(current: Fiber | null, finishedWork: Fiber): void {\\n             finishedWork,\\n           );\\n         }\\n-        if (enableDeprecatedFlareAPI) {\\n-          const prevListeners = oldProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners) {\\n-            updateDeprecatedEventListeners(nextListeners, finishedWork, null);\\n-          }\\n-        }\\n       }\\n       return;\\n     }\\n@@ -1619,15 +1601,6 @@ function commitWork(current: Fiber | null, finishedWork: Fiber): void {\\n     case ScopeComponent: {\\n       if (enableScopeAPI) {\\n         const scopeInstance = finishedWork.stateNode;\\n-        if (enableDeprecatedFlareAPI) {\\n-          const newProps = finishedWork.memoizedProps;\\n-          const oldProps = current !== null ? current.memoizedProps : newProps;\\n-          const prevListeners = oldProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners || current === null) {\\n-            updateDeprecatedEventListeners(nextListeners, finishedWork, null);\\n-          }\\n-        }\\n         prepareScopeUpdate(scopeInstance, finishedWork);\\n         return;\\n       }"},{"sha":"4f833fa7c6c32fa1152ca6add754d7d059c5e5ed","filename":"packages/react-reconciler/src/ReactFiberCompleteWork.new.js","status":"modified","additions":2,"deletions":57,"changes":59,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCompleteWork.new.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCompleteWork.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCompleteWork.new.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -126,7 +126,6 @@ import {\\n   enableSchedulerTracing,\\n   enableSuspenseCallback,\\n   enableSuspenseServerRenderer,\\n-  enableDeprecatedFlareAPI,\\n   enableFundamentalAPI,\\n   enableScopeAPI,\\n   enableBlocksAPI,\\n@@ -142,7 +141,6 @@ import {\\n import {createFundamentalStateInstance} from \'./ReactFiberFundamental.new\';\\n import {OffscreenLane} from \'./ReactFiberLane\';\\n import {resetChildFibers} from \'./ReactChildFiber.new\';\\n-import {updateDeprecatedEventListeners} from \'./ReactFiberDeprecatedEvents.new\';\\n import {createScopeInstance} from \'./ReactFiberScope.new\';\\n import {transferActualDuration} from \'./ReactProfilerTimer.new\';\\n \\n@@ -737,14 +735,6 @@ function completeWork(\\n           rootContainerInstance,\\n         );\\n \\n-        if (enableDeprecatedFlareAPI) {\\n-          const prevListeners = current.memoizedProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners) {\\n-            markUpdate(workInProgress);\\n-          }\\n-        }\\n-\\n         if (current.ref !== workInProgress.ref) {\\n           markRef(workInProgress);\\n         }\\n@@ -779,16 +769,6 @@ function completeWork(\\n             // commit-phase we mark this as such.\\n             markUpdate(workInProgress);\\n           }\\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n         } else {\\n           const instance = createInstance(\\n             type,\\n@@ -800,20 +780,8 @@ function completeWork(\\n \\n           appendAllChildren(instance, workInProgress, false, false);\\n \\n-          // This needs to be set before we mount Flare event listeners\\n           workInProgress.stateNode = instance;\\n \\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n-\\n           // Certain renderers require commit-time effects for initial mount.\\n           // (eg DOM renderer supports auto-focus for certain elements).\\n           // Make sure such renderers get scheduled for later work.\\n@@ -1289,37 +1257,14 @@ function completeWork(\\n         if (current === null) {\\n           const scopeInstance: ReactScopeInstance = createScopeInstance();\\n           workInProgress.stateNode = scopeInstance;\\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              const rootContainerInstance = getRootHostContainer();\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n           prepareScopeUpdate(scopeInstance, workInProgress);\\n           if (workInProgress.ref !== null) {\\n             markRef(workInProgress);\\n             markUpdate(workInProgress);\\n           }\\n         } else {\\n-          if (enableDeprecatedFlareAPI) {\\n-            const prevListeners =\\n-              current.memoizedProps.DEPRECATED_flareListeners;\\n-            const nextListeners = newProps.DEPRECATED_flareListeners;\\n-            if (\\n-              prevListeners !== nextListeners ||\\n-              workInProgress.ref !== null\\n-            ) {\\n-              markUpdate(workInProgress);\\n-            }\\n-          } else {\\n-            if (workInProgress.ref !== null) {\\n-              markUpdate(workInProgress);\\n-            }\\n+          if (workInProgress.ref !== null) {\\n+            markUpdate(workInProgress);\\n           }\\n           if (current.ref !== workInProgress.ref) {\\n             markRef(workInProgress);"},{"sha":"82bc29f7495e597cd972db5471ebfecada06924b","filename":"packages/react-reconciler/src/ReactFiberCompleteWork.old.js","status":"modified","additions":2,"deletions":57,"changes":59,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCompleteWork.old.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberCompleteWork.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberCompleteWork.old.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -124,7 +124,6 @@ import {\\n   enableSchedulerTracing,\\n   enableSuspenseCallback,\\n   enableSuspenseServerRenderer,\\n-  enableDeprecatedFlareAPI,\\n   enableFundamentalAPI,\\n   enableScopeAPI,\\n   enableBlocksAPI,\\n@@ -140,7 +139,6 @@ import {\\n import {createFundamentalStateInstance} from \'./ReactFiberFundamental.old\';\\n import {OffscreenLane} from \'./ReactFiberLane\';\\n import {resetChildFibers} from \'./ReactChildFiber.old\';\\n-import {updateDeprecatedEventListeners} from \'./ReactFiberDeprecatedEvents.old\';\\n import {createScopeInstance} from \'./ReactFiberScope.old\';\\n import {transferActualDuration} from \'./ReactProfilerTimer.old\';\\n \\n@@ -716,14 +714,6 @@ function completeWork(\\n           rootContainerInstance,\\n         );\\n \\n-        if (enableDeprecatedFlareAPI) {\\n-          const prevListeners = current.memoizedProps.DEPRECATED_flareListeners;\\n-          const nextListeners = newProps.DEPRECATED_flareListeners;\\n-          if (prevListeners !== nextListeners) {\\n-            markUpdate(workInProgress);\\n-          }\\n-        }\\n-\\n         if (current.ref !== workInProgress.ref) {\\n           markRef(workInProgress);\\n         }\\n@@ -758,16 +748,6 @@ function completeWork(\\n             // commit-phase we mark this as such.\\n             markUpdate(workInProgress);\\n           }\\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n         } else {\\n           const instance = createInstance(\\n             type,\\n@@ -779,20 +759,8 @@ function completeWork(\\n \\n           appendAllChildren(instance, workInProgress, false, false);\\n \\n-          // This needs to be set before we mount Flare event listeners\\n           workInProgress.stateNode = instance;\\n \\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n-\\n           // Certain renderers require commit-time effects for initial mount.\\n           // (eg DOM renderer supports auto-focus for certain elements).\\n           // Make sure such renderers get scheduled for later work.\\n@@ -1262,37 +1230,14 @@ function completeWork(\\n         if (current === null) {\\n           const scopeInstance: ReactScopeInstance = createScopeInstance();\\n           workInProgress.stateNode = scopeInstance;\\n-          if (enableDeprecatedFlareAPI) {\\n-            const listeners = newProps.DEPRECATED_flareListeners;\\n-            if (listeners != null) {\\n-              const rootContainerInstance = getRootHostContainer();\\n-              updateDeprecatedEventListeners(\\n-                listeners,\\n-                workInProgress,\\n-                rootContainerInstance,\\n-              );\\n-            }\\n-          }\\n           prepareScopeUpdate(scopeInstance, workInProgress);\\n           if (workInProgress.ref !== null) {\\n             markRef(workInProgress);\\n             markUpdate(workInProgress);\\n           }\\n         } else {\\n-          if (enableDeprecatedFlareAPI) {\\n-            const prevListeners =\\n-              current.memoizedProps.DEPRECATED_flareListeners;\\n-            const nextListeners = newProps.DEPRECATED_flareListeners;\\n-            if (\\n-              prevListeners !== nextListeners ||\\n-              workInProgress.ref !== null\\n-            ) {\\n-              markUpdate(workInProgress);\\n-            }\\n-          } else {\\n-            if (workInProgress.ref !== null) {\\n-              markUpdate(workInProgress);\\n-            }\\n+          if (workInProgress.ref !== null) {\\n+            markUpdate(workInProgress);\\n           }\\n           if (current.ref !== workInProgress.ref) {\\n             markRef(workInProgress);"},{"sha":"7177f66b7aac9bc9c8e1920faacca9831050fe54","filename":"packages/react-reconciler/src/ReactFiberDeprecatedEvents.new.js","status":"removed","additions":0,"deletions":234,"changes":234,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-reconciler/src/ReactFiberDeprecatedEvents.new.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-reconciler/src/ReactFiberDeprecatedEvents.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberDeprecatedEvents.new.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,234 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {Fiber} from \'./ReactInternalTypes\';\\n-import type {Container, Instance} from \'./ReactFiberHostConfig\';\\n-import type {\\n-  ReactEventResponder,\\n-  ReactEventResponderInstance,\\n-  ReactEventResponderListener,\\n-} from \'shared/ReactTypes\';\\n-\\n-import {\\n-  DEPRECATED_mountResponderInstance,\\n-  DEPRECATED_unmountResponderInstance,\\n-} from \'./ReactFiberHostConfig\';\\n-import {NoLanes} from \'./ReactFiberLane\';\\n-\\n-import {REACT_RESPONDER_TYPE} from \'shared/ReactSymbols\';\\n-\\n-import invariant from \'shared/invariant\';\\n-import {HostComponent, HostRoot} from \'./ReactWorkTags\';\\n-\\n-const emptyObject = {};\\n-const isArray = Array.isArray;\\n-\\n-export function createResponderInstance(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderProps: Object,\\n-  responderState: Object,\\n-  fiber: Fiber,\\n-): ReactEventResponderInstance<any, any> {\\n-  return {\\n-    fiber,\\n-    props: responderProps,\\n-    responder,\\n-    rootEventTypes: null,\\n-    state: responderState,\\n-  };\\n-}\\n-\\n-function mountEventResponder(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderProps: Object,\\n-  fiber: Fiber,\\n-  respondersMap: Map<\\n-    ReactEventResponder<any, any>,\\n-    ReactEventResponderInstance<any, any>,\\n-  >,\\n-  rootContainerInstance: null | Container,\\n-) {\\n-  let responderState = emptyObject;\\n-  const getInitialState = responder.getInitialState;\\n-  if (getInitialState !== null) {\\n-    responderState = getInitialState(responderProps);\\n-  }\\n-  const responderInstance = createResponderInstance(\\n-    responder,\\n-    responderProps,\\n-    responderState,\\n-    fiber,\\n-  );\\n-\\n-  if (!rootContainerInstance) {\\n-    let node = fiber;\\n-    while (node !== null) {\\n-      const tag = node.tag;\\n-      if (tag === HostComponent) {\\n-        rootContainerInstance = node.stateNode;\\n-        break;\\n-      } else if (tag === HostRoot) {\\n-        rootContainerInstance = node.stateNode.containerInfo;\\n-        break;\\n-      }\\n-      node = node.return;\\n-    }\\n-  }\\n-\\n-  DEPRECATED_mountResponderInstance(\\n-    responder,\\n-    responderInstance,\\n-    responderProps,\\n-    responderState,\\n-    ((rootContainerInstance: any): Instance),\\n-  );\\n-  respondersMap.set(responder, responderInstance);\\n-}\\n-\\n-function updateEventListener(\\n-  listener: ReactEventResponderListener<any, any>,\\n-  fiber: Fiber,\\n-  visitedResponders: Set<ReactEventResponder<any, any>>,\\n-  respondersMap: Map<\\n-    ReactEventResponder<any, any>,\\n-    ReactEventResponderInstance<any, any>,\\n-  >,\\n-  rootContainerInstance: null | Container,\\n-): void {\\n-  let responder;\\n-  let props;\\n-\\n-  if (listener) {\\n-    responder = listener.responder;\\n-    props = listener.props;\\n-  }\\n-  invariant(\\n-    responder && responder.$$typeof === REACT_RESPONDER_TYPE,\\n-    \'An invalid value was used as an event listener. Expect one or many event \' +\\n-      \'listeners created via React.unstable_useResponder().\',\\n-  );\\n-  const listenerProps = ((props: any): Object);\\n-  if (visitedResponders.has(responder)) {\\n-    // show warning\\n-    if (__DEV__) {\\n-      console.error(\\n-        \'Duplicate event responder \\"%s\\" found in event listeners. \' +\\n-          \'Event listeners passed to elements cannot use the same event responder more than once.\',\\n-        responder.displayName,\\n-      );\\n-    }\\n-    return;\\n-  }\\n-  visitedResponders.add(responder);\\n-  const responderInstance = respondersMap.get(responder);\\n-\\n-  if (responderInstance === undefined) {\\n-    // Mount (happens in either complete or commit phase)\\n-    mountEventResponder(\\n-      responder,\\n-      listenerProps,\\n-      fiber,\\n-      respondersMap,\\n-      rootContainerInstance,\\n-    );\\n-  } else {\\n-    // Update (happens during commit phase only)\\n-    responderInstance.props = listenerProps;\\n-    responderInstance.fiber = fiber;\\n-  }\\n-}\\n-\\n-export function updateDeprecatedEventListeners(\\n-  listeners: any,\\n-  fiber: Fiber,\\n-  rootContainerInstance: null | Container,\\n-): void {\\n-  const visitedResponders = new Set();\\n-  let dependencies = fiber.dependencies;\\n-  if (listeners != null) {\\n-    if (dependencies === null) {\\n-      dependencies = fiber.dependencies = {\\n-        lanes: NoLanes,\\n-        firstContext: null,\\n-        responders: new Map(),\\n-      };\\n-    }\\n-    let respondersMap = dependencies.responders;\\n-    if (respondersMap === null) {\\n-      dependencies.responders = respondersMap = new Map();\\n-    }\\n-    if (isArray(listeners)) {\\n-      for (let i = 0, length = listeners.length; i < length; i++) {\\n-        const listener = listeners[i];\\n-        updateEventListener(\\n-          listener,\\n-          fiber,\\n-          visitedResponders,\\n-          respondersMap,\\n-          rootContainerInstance,\\n-        );\\n-      }\\n-    } else {\\n-      updateEventListener(\\n-        listeners,\\n-        fiber,\\n-        visitedResponders,\\n-        respondersMap,\\n-        rootContainerInstance,\\n-      );\\n-    }\\n-  }\\n-  if (dependencies !== null) {\\n-    const respondersMap = dependencies.responders;\\n-    if (respondersMap !== null) {\\n-      // Unmount\\n-      const mountedResponders = Array.from(respondersMap.keys());\\n-      for (let i = 0, length = mountedResponders.length; i < length; i++) {\\n-        const mountedResponder = mountedResponders[i];\\n-        if (!visitedResponders.has(mountedResponder)) {\\n-          const responderInstance = ((respondersMap.get(\\n-            mountedResponder,\\n-          ): any): ReactEventResponderInstance<any, any>);\\n-          DEPRECATED_unmountResponderInstance(responderInstance);\\n-          respondersMap.delete(mountedResponder);\\n-        }\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-export function createDeprecatedResponderListener(\\n-  responder: ReactEventResponder<any, any>,\\n-  props: Object,\\n-): ReactEventResponderListener<any, any> {\\n-  const eventResponderListener = {\\n-    responder,\\n-    props,\\n-  };\\n-  if (__DEV__) {\\n-    Object.freeze(eventResponderListener);\\n-  }\\n-  return eventResponderListener;\\n-}\\n-\\n-export function unmountDeprecatedResponderListeners(fiber: Fiber) {\\n-  const dependencies = fiber.dependencies;\\n-\\n-  if (dependencies !== null) {\\n-    const respondersMap = dependencies.responders;\\n-    if (respondersMap !== null) {\\n-      const responderInstances = Array.from(respondersMap.values());\\n-      for (let i = 0, length = responderInstances.length; i < length; i++) {\\n-        const responderInstance = responderInstances[i];\\n-        DEPRECATED_unmountResponderInstance(responderInstance);\\n-      }\\n-      dependencies.responders = null;\\n-    }\\n-  }\\n-}"},{"sha":"7177f66b7aac9bc9c8e1920faacca9831050fe54","filename":"packages/react-reconciler/src/ReactFiberDeprecatedEvents.old.js","status":"removed","additions":0,"deletions":234,"changes":234,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-reconciler/src/ReactFiberDeprecatedEvents.old.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react-reconciler/src/ReactFiberDeprecatedEvents.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberDeprecatedEvents.old.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,234 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- *\\n- * @flow\\n- */\\n-\\n-import type {Fiber} from \'./ReactInternalTypes\';\\n-import type {Container, Instance} from \'./ReactFiberHostConfig\';\\n-import type {\\n-  ReactEventResponder,\\n-  ReactEventResponderInstance,\\n-  ReactEventResponderListener,\\n-} from \'shared/ReactTypes\';\\n-\\n-import {\\n-  DEPRECATED_mountResponderInstance,\\n-  DEPRECATED_unmountResponderInstance,\\n-} from \'./ReactFiberHostConfig\';\\n-import {NoLanes} from \'./ReactFiberLane\';\\n-\\n-import {REACT_RESPONDER_TYPE} from \'shared/ReactSymbols\';\\n-\\n-import invariant from \'shared/invariant\';\\n-import {HostComponent, HostRoot} from \'./ReactWorkTags\';\\n-\\n-const emptyObject = {};\\n-const isArray = Array.isArray;\\n-\\n-export function createResponderInstance(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderProps: Object,\\n-  responderState: Object,\\n-  fiber: Fiber,\\n-): ReactEventResponderInstance<any, any> {\\n-  return {\\n-    fiber,\\n-    props: responderProps,\\n-    responder,\\n-    rootEventTypes: null,\\n-    state: responderState,\\n-  };\\n-}\\n-\\n-function mountEventResponder(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderProps: Object,\\n-  fiber: Fiber,\\n-  respondersMap: Map<\\n-    ReactEventResponder<any, any>,\\n-    ReactEventResponderInstance<any, any>,\\n-  >,\\n-  rootContainerInstance: null | Container,\\n-) {\\n-  let responderState = emptyObject;\\n-  const getInitialState = responder.getInitialState;\\n-  if (getInitialState !== null) {\\n-    responderState = getInitialState(responderProps);\\n-  }\\n-  const responderInstance = createResponderInstance(\\n-    responder,\\n-    responderProps,\\n-    responderState,\\n-    fiber,\\n-  );\\n-\\n-  if (!rootContainerInstance) {\\n-    let node = fiber;\\n-    while (node !== null) {\\n-      const tag = node.tag;\\n-      if (tag === HostComponent) {\\n-        rootContainerInstance = node.stateNode;\\n-        break;\\n-      } else if (tag === HostRoot) {\\n-        rootContainerInstance = node.stateNode.containerInfo;\\n-        break;\\n-      }\\n-      node = node.return;\\n-    }\\n-  }\\n-\\n-  DEPRECATED_mountResponderInstance(\\n-    responder,\\n-    responderInstance,\\n-    responderProps,\\n-    responderState,\\n-    ((rootContainerInstance: any): Instance),\\n-  );\\n-  respondersMap.set(responder, responderInstance);\\n-}\\n-\\n-function updateEventListener(\\n-  listener: ReactEventResponderListener<any, any>,\\n-  fiber: Fiber,\\n-  visitedResponders: Set<ReactEventResponder<any, any>>,\\n-  respondersMap: Map<\\n-    ReactEventResponder<any, any>,\\n-    ReactEventResponderInstance<any, any>,\\n-  >,\\n-  rootContainerInstance: null | Container,\\n-): void {\\n-  let responder;\\n-  let props;\\n-\\n-  if (listener) {\\n-    responder = listener.responder;\\n-    props = listener.props;\\n-  }\\n-  invariant(\\n-    responder && responder.$$typeof === REACT_RESPONDER_TYPE,\\n-    \'An invalid value was used as an event listener. Expect one or many event \' +\\n-      \'listeners created via React.unstable_useResponder().\',\\n-  );\\n-  const listenerProps = ((props: any): Object);\\n-  if (visitedResponders.has(responder)) {\\n-    // show warning\\n-    if (__DEV__) {\\n-      console.error(\\n-        \'Duplicate event responder \\"%s\\" found in event listeners. \' +\\n-          \'Event listeners passed to elements cannot use the same event responder more than once.\',\\n-        responder.displayName,\\n-      );\\n-    }\\n-    return;\\n-  }\\n-  visitedResponders.add(responder);\\n-  const responderInstance = respondersMap.get(responder);\\n-\\n-  if (responderInstance === undefined) {\\n-    // Mount (happens in either complete or commit phase)\\n-    mountEventResponder(\\n-      responder,\\n-      listenerProps,\\n-      fiber,\\n-      respondersMap,\\n-      rootContainerInstance,\\n-    );\\n-  } else {\\n-    // Update (happens during commit phase only)\\n-    responderInstance.props = listenerProps;\\n-    responderInstance.fiber = fiber;\\n-  }\\n-}\\n-\\n-export function updateDeprecatedEventListeners(\\n-  listeners: any,\\n-  fiber: Fiber,\\n-  rootContainerInstance: null | Container,\\n-): void {\\n-  const visitedResponders = new Set();\\n-  let dependencies = fiber.dependencies;\\n-  if (listeners != null) {\\n-    if (dependencies === null) {\\n-      dependencies = fiber.dependencies = {\\n-        lanes: NoLanes,\\n-        firstContext: null,\\n-        responders: new Map(),\\n-      };\\n-    }\\n-    let respondersMap = dependencies.responders;\\n-    if (respondersMap === null) {\\n-      dependencies.responders = respondersMap = new Map();\\n-    }\\n-    if (isArray(listeners)) {\\n-      for (let i = 0, length = listeners.length; i < length; i++) {\\n-        const listener = listeners[i];\\n-        updateEventListener(\\n-          listener,\\n-          fiber,\\n-          visitedResponders,\\n-          respondersMap,\\n-          rootContainerInstance,\\n-        );\\n-      }\\n-    } else {\\n-      updateEventListener(\\n-        listeners,\\n-        fiber,\\n-        visitedResponders,\\n-        respondersMap,\\n-        rootContainerInstance,\\n-      );\\n-    }\\n-  }\\n-  if (dependencies !== null) {\\n-    const respondersMap = dependencies.responders;\\n-    if (respondersMap !== null) {\\n-      // Unmount\\n-      const mountedResponders = Array.from(respondersMap.keys());\\n-      for (let i = 0, length = mountedResponders.length; i < length; i++) {\\n-        const mountedResponder = mountedResponders[i];\\n-        if (!visitedResponders.has(mountedResponder)) {\\n-          const responderInstance = ((respondersMap.get(\\n-            mountedResponder,\\n-          ): any): ReactEventResponderInstance<any, any>);\\n-          DEPRECATED_unmountResponderInstance(responderInstance);\\n-          respondersMap.delete(mountedResponder);\\n-        }\\n-      }\\n-    }\\n-  }\\n-}\\n-\\n-export function createDeprecatedResponderListener(\\n-  responder: ReactEventResponder<any, any>,\\n-  props: Object,\\n-): ReactEventResponderListener<any, any> {\\n-  const eventResponderListener = {\\n-    responder,\\n-    props,\\n-  };\\n-  if (__DEV__) {\\n-    Object.freeze(eventResponderListener);\\n-  }\\n-  return eventResponderListener;\\n-}\\n-\\n-export function unmountDeprecatedResponderListeners(fiber: Fiber) {\\n-  const dependencies = fiber.dependencies;\\n-\\n-  if (dependencies !== null) {\\n-    const respondersMap = dependencies.responders;\\n-    if (respondersMap !== null) {\\n-      const responderInstances = Array.from(respondersMap.values());\\n-      for (let i = 0, length = responderInstances.length; i < length; i++) {\\n-        const responderInstance = responderInstances[i];\\n-        DEPRECATED_unmountResponderInstance(responderInstance);\\n-      }\\n-      dependencies.responders = null;\\n-    }\\n-  }\\n-}"},{"sha":"0f1309ff70b02d57a32be919a6f1e2ce383aea9e","filename":"packages/react-reconciler/src/ReactFiberHooks.new.js","status":"modified","additions":0,"deletions":67,"changes":67,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberHooks.new.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberHooks.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberHooks.new.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -11,9 +11,7 @@ import type {\\n   MutableSource,\\n   MutableSourceGetSnapshotFn,\\n   MutableSourceSubscribeFn,\\n-  ReactEventResponder,\\n   ReactContext,\\n-  ReactEventResponderListener,\\n } from \'shared/ReactTypes\';\\n import type {Fiber, Dispatcher} from \'./ReactInternalTypes\';\\n import type {Lanes, Lane} from \'./ReactFiberLane\';\\n@@ -46,7 +44,6 @@ import {\\n   DefaultLanePriority,\\n } from \'./ReactFiberLane\';\\n import {readContext} from \'./ReactFiberNewContext.new\';\\n-import {createDeprecatedResponderListener} from \'./ReactFiberDeprecatedEvents.new\';\\n import {\\n   Update as UpdateEffect,\\n   Passive as PassiveEffect,\\n@@ -129,7 +126,6 @@ export type HookType =\\n   | \'useMemo\'\\n   | \'useImperativeHandle\'\\n   | \'useDebugValue\'\\n-  | \'useResponder\'\\n   | \'useDeferredValue\'\\n   | \'useTransition\'\\n   | \'useMutableSource\'\\n@@ -1787,7 +1783,6 @@ export const ContextOnlyDispatcher: Dispatcher = {\\n   useRef: throwInvalidHookError,\\n   useState: throwInvalidHookError,\\n   useDebugValue: throwInvalidHookError,\\n-  useResponder: throwInvalidHookError,\\n   useDeferredValue: throwInvalidHookError,\\n   useTransition: throwInvalidHookError,\\n   useMutableSource: throwInvalidHookError,\\n@@ -1809,7 +1804,6 @@ const HooksDispatcherOnMount: Dispatcher = {\\n   useRef: mountRef,\\n   useState: mountState,\\n   useDebugValue: mountDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: mountDeferredValue,\\n   useTransition: mountTransition,\\n   useMutableSource: mountMutableSource,\\n@@ -1831,7 +1825,6 @@ const HooksDispatcherOnUpdate: Dispatcher = {\\n   useRef: updateRef,\\n   useState: updateState,\\n   useDebugValue: updateDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: updateDeferredValue,\\n   useTransition: updateTransition,\\n   useMutableSource: updateMutableSource,\\n@@ -1853,7 +1846,6 @@ const HooksDispatcherOnRerender: Dispatcher = {\\n   useRef: updateRef,\\n   useState: rerenderState,\\n   useDebugValue: updateDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: rerenderDeferredValue,\\n   useTransition: rerenderTransition,\\n   useMutableSource: updateMutableSource,\\n@@ -1988,14 +1980,6 @@ if (__DEV__) {\\n       mountHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      mountHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       mountHookTypesDev();\\n@@ -2120,14 +2104,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2252,14 +2228,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2385,14 +2353,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2528,15 +2488,6 @@ if (__DEV__) {\\n       mountHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      mountHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();\\n@@ -2676,15 +2627,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();\\n@@ -2825,15 +2767,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();"},{"sha":"328ae20d675467f458d96de1ce4416e85b061c0e","filename":"packages/react-reconciler/src/ReactFiberHooks.old.js","status":"modified","additions":0,"deletions":67,"changes":67,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberHooks.old.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberHooks.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberHooks.old.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -11,9 +11,7 @@ import type {\\n   MutableSource,\\n   MutableSourceGetSnapshotFn,\\n   MutableSourceSubscribeFn,\\n-  ReactEventResponder,\\n   ReactContext,\\n-  ReactEventResponderListener,\\n } from \'shared/ReactTypes\';\\n import type {Fiber, Dispatcher} from \'./ReactInternalTypes\';\\n import type {Lanes, Lane} from \'./ReactFiberLane\';\\n@@ -46,7 +44,6 @@ import {\\n   DefaultLanePriority,\\n } from \'./ReactFiberLane\';\\n import {readContext} from \'./ReactFiberNewContext.old\';\\n-import {createDeprecatedResponderListener} from \'./ReactFiberDeprecatedEvents.old\';\\n import {\\n   Update as UpdateEffect,\\n   Passive as PassiveEffect,\\n@@ -128,7 +125,6 @@ export type HookType =\\n   | \'useMemo\'\\n   | \'useImperativeHandle\'\\n   | \'useDebugValue\'\\n-  | \'useResponder\'\\n   | \'useDeferredValue\'\\n   | \'useTransition\'\\n   | \'useMutableSource\'\\n@@ -1785,7 +1781,6 @@ export const ContextOnlyDispatcher: Dispatcher = {\\n   useRef: throwInvalidHookError,\\n   useState: throwInvalidHookError,\\n   useDebugValue: throwInvalidHookError,\\n-  useResponder: throwInvalidHookError,\\n   useDeferredValue: throwInvalidHookError,\\n   useTransition: throwInvalidHookError,\\n   useMutableSource: throwInvalidHookError,\\n@@ -1807,7 +1802,6 @@ const HooksDispatcherOnMount: Dispatcher = {\\n   useRef: mountRef,\\n   useState: mountState,\\n   useDebugValue: mountDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: mountDeferredValue,\\n   useTransition: mountTransition,\\n   useMutableSource: mountMutableSource,\\n@@ -1829,7 +1823,6 @@ const HooksDispatcherOnUpdate: Dispatcher = {\\n   useRef: updateRef,\\n   useState: updateState,\\n   useDebugValue: updateDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: updateDeferredValue,\\n   useTransition: updateTransition,\\n   useMutableSource: updateMutableSource,\\n@@ -1851,7 +1844,6 @@ const HooksDispatcherOnRerender: Dispatcher = {\\n   useRef: updateRef,\\n   useState: rerenderState,\\n   useDebugValue: updateDebugValue,\\n-  useResponder: createDeprecatedResponderListener,\\n   useDeferredValue: rerenderDeferredValue,\\n   useTransition: rerenderTransition,\\n   useMutableSource: updateMutableSource,\\n@@ -1986,14 +1978,6 @@ if (__DEV__) {\\n       mountHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      mountHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       mountHookTypesDev();\\n@@ -2118,14 +2102,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2250,14 +2226,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2383,14 +2351,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       updateHookTypesDev();\\n@@ -2526,15 +2486,6 @@ if (__DEV__) {\\n       mountHookTypesDev();\\n       return mountDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      mountHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();\\n@@ -2674,15 +2625,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();\\n@@ -2823,15 +2765,6 @@ if (__DEV__) {\\n       updateHookTypesDev();\\n       return updateDebugValue(value, formatterFn);\\n     },\\n-    useResponder<E, C>(\\n-      responder: ReactEventResponder<E, C>,\\n-      props,\\n-    ): ReactEventResponderListener<E, C> {\\n-      currentHookNameInDev = \'useResponder\';\\n-      warnInvalidHookAccess();\\n-      updateHookTypesDev();\\n-      return createDeprecatedResponderListener(responder, props);\\n-    },\\n     useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T {\\n       currentHookNameInDev = \'useDeferredValue\';\\n       warnInvalidHookAccess();"},{"sha":"63ffe2d356aaed3b82ab2ac87864c834c78063e7","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.new.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberWorkLoop.new.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.new.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -2483,7 +2483,7 @@ function commitMutationEffectsImpl(\\n       commitDetachRef(current);\\n     }\\n     if (enableScopeAPI) {\\n-      // TODO: This is a temporary solution that allows us to transition away\\n+      // TODO: This is a temporary solution that allowed us to transition away\\n       // from React Flare on www.\\n       if (fiber.tag === ScopeComponent) {\\n         commitAttachRef(fiber);\\n@@ -2633,7 +2633,7 @@ function commitLayoutEffectsImpl(\\n   }\\n \\n   if (enableScopeAPI) {\\n-    // TODO: This is a temporary solution that allows us to transition away\\n+    // TODO: This is a temporary solution that allowed us to transition away\\n     // from React Flare on www.\\n     if (effectTag & Ref && fiber.tag !== ScopeComponent) {\\n       commitAttachRef(fiber);"},{"sha":"80ad473992efda317caa4807113d0a3ee322bb54","filename":"packages/react-reconciler/src/ReactFiberWorkLoop.old.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactFiberWorkLoop.old.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactFiberWorkLoop.old.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -2342,7 +2342,7 @@ function commitMutationEffects(root: FiberRoot, renderPriorityLevel) {\\n         commitDetachRef(current);\\n       }\\n       if (enableScopeAPI) {\\n-        // TODO: This is a temporary solution that allows us to transition away\\n+        // TODO: This is a temporary solution that allowed us to transition away\\n         // from React Flare on www.\\n         if (nextEffect.tag === ScopeComponent) {\\n           commitAttachRef(nextEffect);\\n@@ -2429,7 +2429,7 @@ function commitLayoutEffects(root: FiberRoot, committedLanes: Lanes) {\\n     }\\n \\n     if (enableScopeAPI) {\\n-      // TODO: This is a temporary solution that allows us to transition away\\n+      // TODO: This is a temporary solution that allowed us to transition away\\n       // from React Flare on www.\\n       if (effectTag & Ref && nextEffect.tag !== ScopeComponent) {\\n         commitAttachRef(nextEffect);"},{"sha":"51cce04255b65d74764e8b3586dd80a68829cbba","filename":"packages/react-reconciler/src/ReactInternalTypes.js","status":"modified","additions":0,"deletions":11,"changes":11,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactInternalTypes.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/ReactInternalTypes.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/ReactInternalTypes.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -10,9 +10,6 @@\\n import type {Source} from \'shared/ReactElementType\';\\n import type {\\n   RefObject,\\n-  ReactEventResponder,\\n-  ReactEventResponderListener,\\n-  ReactEventResponderInstance,\\n   ReactContext,\\n   MutableSourceSubscribeFn,\\n   MutableSourceGetSnapshotFn,\\n@@ -44,10 +41,6 @@ export type ContextDependency<T> = {\\n export type Dependencies = {\\n   lanes: Lanes,\\n   firstContext: ContextDependency<mixed> | null,\\n-  responders: Map<\\n-    ReactEventResponder<any, any>,\\n-    ReactEventResponderInstance<any, any>,\\n-  > | null,\\n   ...\\n };\\n \\n@@ -298,10 +291,6 @@ export type Dispatcher = {|\\n     deps: Array<mixed> | void | null,\\n   ): void,\\n   useDebugValue<T>(value: T, formatterFn: ?(value: T) => mixed): void,\\n-  useResponder<E, C>(\\n-    responder: ReactEventResponder<E, C>,\\n-    props: Object,\\n-  ): ReactEventResponderListener<E, C>,\\n   useDeferredValue<T>(value: T, config: TimeoutConfig | void | null): T,\\n   useTransition(\\n     config: SuspenseConfig | void | null,"},{"sha":"2eeba5236285f1752e05f17c8dc62ff2d1238a1e","filename":"packages/react-reconciler/src/__tests__/ReactScope-test.internal.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/__tests__/ReactScope-test.internal.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/__tests__/ReactScope-test.internal.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/__tests__/ReactScope-test.internal.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -19,7 +19,6 @@ describe(\'ReactScope\', () => {\\n     jest.resetModules();\\n     ReactFeatureFlags = require(\'shared/ReactFeatureFlags\');\\n     ReactFeatureFlags.enableScopeAPI = true;\\n-    ReactFeatureFlags.enableDeprecatedFlareAPI = true;\\n     React = require(\'react\');\\n     Scheduler = require(\'scheduler\');\\n   });"},{"sha":"60e06740ad76906930cf7f6ba35285f0893971b6","filename":"packages/react-reconciler/src/forks/ReactFiberHostConfig.custom.js","status":"modified","additions":0,"deletions":4,"changes":4,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/forks/ReactFiberHostConfig.custom.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-reconciler/src/forks/ReactFiberHostConfig.custom.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-reconciler/src/forks/ReactFiberHostConfig.custom.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -61,10 +61,6 @@ export const warnsIfNotActing = $$$hostConfig.warnsIfNotActing;\\n export const supportsMutation = $$$hostConfig.supportsMutation;\\n export const supportsPersistence = $$$hostConfig.supportsPersistence;\\n export const supportsHydration = $$$hostConfig.supportsHydration;\\n-export const DEPRECATED_mountResponderInstance =\\n-  $$$hostConfig.DEPRECATED_mountResponderInstance;\\n-export const DEPRECATED_unmountResponderInstance =\\n-  $$$hostConfig.DEPRECATED_unmountResponderInstance;\\n export const getFundamentalComponentInstance =\\n   $$$hostConfig.getFundamentalComponentInstance;\\n export const mountFundamentalComponent ="},{"sha":"b244810736d8aa5bc067fbd7bc7064ac8e8fb75c","filename":"packages/react-test-renderer/src/ReactTestHostConfig.js","status":"modified","additions":2,"deletions":45,"changes":47,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-test-renderer/src/ReactTestHostConfig.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react-test-renderer/src/ReactTestHostConfig.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react-test-renderer/src/ReactTestHostConfig.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -7,13 +7,8 @@\\n  * @flow\\n  */\\n \\n-import type {\\n-  ReactEventResponder,\\n-  ReactEventResponderInstance,\\n-  ReactFundamentalComponentInstance,\\n-} from \'shared/ReactTypes\';\\n+import type {ReactFundamentalComponentInstance} from \'shared/ReactTypes\';\\n \\n-import {enableDeprecatedFlareAPI} from \'shared/ReactFeatureFlags\';\\n import {REACT_OPAQUE_ID_TYPE} from \'shared/ReactSymbols\';\\n \\n export type Type = string;\\n@@ -58,7 +53,6 @@ export * from \'react-reconciler/src/ReactFiberHostConfigWithNoPersistence\';\\n export * from \'react-reconciler/src/ReactFiberHostConfigWithNoHydration\';\\n export * from \'react-reconciler/src/ReactFiberHostConfigWithNoTestSelectors\';\\n \\n-const EVENT_COMPONENT_CONTEXT = {};\\n const NO_CONTEXT = {};\\n const UPDATE_SIGNAL = {};\\n const nodeToInstanceMap = new WeakMap();\\n@@ -161,19 +155,9 @@ export function createInstance(\\n   hostContext: Object,\\n   internalInstanceHandle: Object,\\n ): Instance {\\n-  let propsToUse = props;\\n-  if (enableDeprecatedFlareAPI) {\\n-    if (props.DEPRECATED_flareListeners != null) {\\n-      // We want to remove the \\"DEPRECATED_flareListeners\\" prop\\n-      // as we don\'t want it in the test renderer\'s\\n-      // instance props.\\n-      const {DEPRECATED_flareListeners, ...otherProps} = props; // eslint-disable-line\\n-      propsToUse = otherProps;\\n-    }\\n-  }\\n   return {\\n     type,\\n-    props: propsToUse,\\n+    props,\\n     isHidden: false,\\n     children: [],\\n     internalInstanceHandle,\\n@@ -224,17 +208,6 @@ export function createTextInstance(\\n   hostContext: Object,\\n   internalInstanceHandle: Object,\\n ): TextInstance {\\n-  if (__DEV__) {\\n-    if (enableDeprecatedFlareAPI) {\\n-      if (hostContext === EVENT_COMPONENT_CONTEXT) {\\n-        console.error(\\n-          \'validateDOMNesting: React event components cannot have text DOM nodes as children. \' +\\n-            \'Wrap the child text \\"%s\\" in an element.\',\\n-          text,\\n-        );\\n-      }\\n-    }\\n-  }\\n   return {\\n     text,\\n     isHidden: false,\\n@@ -311,22 +284,6 @@ export function unhideTextInstance(\\n   textInstance.isHidden = false;\\n }\\n \\n-export function DEPRECATED_mountResponderInstance(\\n-  responder: ReactEventResponder<any, any>,\\n-  responderInstance: ReactEventResponderInstance<any, any>,\\n-  props: Object,\\n-  state: Object,\\n-  instance: Instance,\\n-) {\\n-  // noop\\n-}\\n-\\n-export function DEPRECATED_unmountResponderInstance(\\n-  responderInstance: ReactEventResponderInstance<any, any>,\\n-): void {\\n-  // noop\\n-}\\n-\\n export function getFundamentalComponentInstance(\\n   fundamentalInstance: ReactFundamentalComponentInstance<any, any>,\\n ): Instance {"},{"sha":"b06b59a10ab9a4ec6361f6f161e5b73000235fc5","filename":"packages/react/index.classic.fb.js","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.classic.fb.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.classic.fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/index.classic.fb.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -52,9 +52,6 @@ export {\\n   // enableBlocksAPI\\n   block,\\n   block as unstable_block,\\n-  // enableDeprecatedFlareAPI\\n-  DEPRECATED_useResponder,\\n-  DEPRECATED_createResponder,\\n   // enableScopeAPI\\n   unstable_Scope,\\n   unstable_useOpaqueIdentifier,"},{"sha":"a02725917e8bc9305cf0178d230c3e7cc9b92eab","filename":"packages/react/index.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/index.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -80,8 +80,6 @@ export {\\n   block,\\n   block as unstable_block,\\n   unstable_LegacyHidden,\\n-  DEPRECATED_useResponder,\\n-  DEPRECATED_createResponder,\\n   unstable_createFundamental,\\n   unstable_Scope,\\n   unstable_useOpaqueIdentifier,"},{"sha":"916e6dcebe1f694d2ce1326f3aa3c85392a80bae","filename":"packages/react/index.modern.fb.js","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.modern.fb.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/index.modern.fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/index.modern.fb.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -51,9 +51,6 @@ export {\\n   // enableBlocksAPI\\n   block,\\n   block as unstable_block,\\n-  // enableDeprecatedFlareAPI\\n-  DEPRECATED_useResponder,\\n-  DEPRECATED_createResponder,\\n   // enableScopeAPI\\n   unstable_Scope,\\n   unstable_useOpaqueIdentifier,"},{"sha":"db7cf977ff9c53d432b62e73569d6506f14bdc9b","filename":"packages/react/src/React.js","status":"modified","additions":0,"deletions":5,"changes":5,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/src/React.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/src/React.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/src/React.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -45,7 +45,6 @@ import {\\n   useReducer,\\n   useRef,\\n   useState,\\n-  useResponder,\\n   useTransition,\\n   useDeferredValue,\\n   useOpaqueIdentifier,\\n@@ -59,7 +58,6 @@ import {\\n import {createMutableSource} from \'./ReactMutableSource\';\\n import ReactSharedInternals from \'./ReactSharedInternals\';\\n import {createFundamental} from \'./ReactFundamental\';\\n-import {createEventResponder} from \'./ReactEventResponder\';\\n \\n // TODO: Move this branching into the other module instead and just re-export.\\n const createElement = __DEV__ ? createElementWithValidation : createElementProd;\\n@@ -115,9 +113,6 @@ export {\\n   withSuspenseConfig as unstable_withSuspenseConfig,\\n   // enableBlocksAPI\\n   block,\\n-  // enableDeprecatedFlareAPI\\n-  useResponder as DEPRECATED_useResponder,\\n-  createEventResponder as DEPRECATED_createResponder,\\n   // enableFundamentalAPI\\n   createFundamental as unstable_createFundamental,\\n   // enableScopeAPI"},{"sha":"8444d0b82dce9366bad1876fa2c0e0da33cbf753","filename":"packages/react/src/ReactEventResponder.js","status":"removed","additions":0,"deletions":46,"changes":46,"blob_url":"https://github.com/facebook/react/blob/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react/src/ReactEventResponder.js","raw_url":"https://github.com/facebook/react/raw/8d57ca519a3f8e7f76f81f404d048dfc35303d98/packages/react/src/ReactEventResponder.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/src/ReactEventResponder.js?ref=8d57ca519a3f8e7f76f81f404d048dfc35303d98","patch":"@@ -1,46 +0,0 @@\\n-/**\\n- * Copyright (c) Facebook, Inc. and its affiliates.\\n- *\\n- * This source code is licensed under the MIT license found in the\\n- * LICENSE file in the root directory of this source tree.\\n- * @flow\\n- */\\n-\\n-import type {ReactEventResponder} from \'shared/ReactTypes\';\\n-import {REACT_RESPONDER_TYPE} from \'shared/ReactSymbols\';\\n-import {hasBadMapPolyfill} from \'./BadMapPolyfill\';\\n-\\n-export function createEventResponder<E, C>(\\n-  displayName: string,\\n-  responderConfig: Object,\\n-): ReactEventResponder<E, C> {\\n-  const {\\n-    getInitialState,\\n-    onEvent,\\n-    onMount,\\n-    onUnmount,\\n-    onRootEvent,\\n-    rootEventTypes,\\n-    targetEventTypes,\\n-    targetPortalPropagation,\\n-  } = responderConfig;\\n-  const eventResponder = {\\n-    $$typeof: REACT_RESPONDER_TYPE,\\n-    displayName,\\n-    getInitialState: getInitialState || null,\\n-    onEvent: onEvent || null,\\n-    onMount: onMount || null,\\n-    onRootEvent: onRootEvent || null,\\n-    onUnmount: onUnmount || null,\\n-    rootEventTypes: rootEventTypes || null,\\n-    targetEventTypes: targetEventTypes || null,\\n-    targetPortalPropagation: targetPortalPropagation || false,\\n-  };\\n-  // We use responder as a Map key later on. When we have a bad\\n-  // polyfill, then we can\'t use it as a key as the polyfill tries\\n-  // to add a property to the object.\\n-  if (__DEV__ && !hasBadMapPolyfill) {\\n-    Object.freeze(eventResponder);\\n-  }\\n-  return eventResponder;\\n-}"},{"sha":"703bafacb91944df328bff6755c7435304d2e5d6","filename":"packages/react/src/ReactHooks.js","status":"modified","additions":0,"deletions":20,"changes":20,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/src/ReactHooks.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/react/src/ReactHooks.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/react/src/ReactHooks.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -12,13 +12,10 @@ import type {\\n   MutableSourceGetSnapshotFn,\\n   MutableSourceSubscribeFn,\\n   ReactContext,\\n-  ReactEventResponder,\\n-  ReactEventResponderListener,\\n } from \'shared/ReactTypes\';\\n import type {OpaqueIDType} from \'react-reconciler/src/ReactFiberHostConfig\';\\n \\n import invariant from \'shared/invariant\';\\n-import {REACT_RESPONDER_TYPE} from \'shared/ReactSymbols\';\\n \\n import ReactCurrentDispatcher from \'./ReactCurrentDispatcher\';\\n \\n@@ -154,23 +151,6 @@ export function useDebugValue<T>(\\n \\n export const emptyObject = {};\\n \\n-export function useResponder(\\n-  responder: ReactEventResponder<any, any>,\\n-  listenerProps: ?Object,\\n-): ?ReactEventResponderListener<any, any> {\\n-  const dispatcher = resolveDispatcher();\\n-  if (__DEV__) {\\n-    if (responder == null || responder.$$typeof !== REACT_RESPONDER_TYPE) {\\n-      console.error(\\n-        \'useResponder: invalid first argument. Expected an event responder, but instead got %s\',\\n-        responder,\\n-      );\\n-      return;\\n-    }\\n-  }\\n-  return dispatcher.useResponder(responder, listenerProps || emptyObject);\\n-}\\n-\\n export function useTransition(\\n   config: ?Object,\\n ): [(() => void) => void, boolean] {"},{"sha":"cfa3160020f6fdb35f3162de526a420326287ac0","filename":"packages/shared/ReactFeatureFlags.js","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactFeatureFlags.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactFeatureFlags.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/ReactFeatureFlags.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -54,9 +54,6 @@ export const enableSchedulerDebugging = false;\\n // Disable javascript: URL strings in href for XSS protection.\\n export const disableJavaScriptURLs = false;\\n \\n-// Experimental React Flare event system and event components support.\\n-export const enableDeprecatedFlareAPI = false;\\n-\\n // Experimental Host Component support.\\n export const enableFundamentalAPI = false;\\n "},{"sha":"49e4eba689efc14a94f3285125f93a514bad823e","filename":"packages/shared/ReactSymbols.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactSymbols.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactSymbols.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/ReactSymbols.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -28,7 +28,6 @@ export let REACT_LAZY_TYPE = 0xead4;\\n export let REACT_BLOCK_TYPE = 0xead9;\\n export let REACT_SERVER_BLOCK_TYPE = 0xeada;\\n export let REACT_FUNDAMENTAL_TYPE = 0xead5;\\n-export let REACT_RESPONDER_TYPE = 0xead6;\\n export let REACT_SCOPE_TYPE = 0xead7;\\n export let REACT_OPAQUE_ID_TYPE = 0xeae0;\\n export let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\\n@@ -52,7 +51,6 @@ if (typeof Symbol === \'function\' && Symbol.for) {\\n   REACT_BLOCK_TYPE = symbolFor(\'react.block\');\\n   REACT_SERVER_BLOCK_TYPE = symbolFor(\'react.server.block\');\\n   REACT_FUNDAMENTAL_TYPE = symbolFor(\'react.fundamental\');\\n-  REACT_RESPONDER_TYPE = symbolFor(\'react.responder\');\\n   REACT_SCOPE_TYPE = symbolFor(\'react.scope\');\\n   REACT_OPAQUE_ID_TYPE = symbolFor(\'react.opaque.id\');\\n   REACT_DEBUG_TRACING_MODE_TYPE = symbolFor(\'react.debug_trace_mode\');"},{"sha":"c03ab5056f6f4616bd540b5c0081513f0dbbc2b5","filename":"packages/shared/ReactTypes.js","status":"modified","additions":0,"deletions":31,"changes":31,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactTypes.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/ReactTypes.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/ReactTypes.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -86,37 +86,6 @@ export type RefObject = {|\\n   current: any,\\n |};\\n \\n-export type ReactEventResponderInstance<E, C> = {|\\n-  fiber: Object,\\n-  props: Object,\\n-  responder: ReactEventResponder<E, C>,\\n-  rootEventTypes: null | Set<string>,\\n-  state: Object,\\n-|};\\n-\\n-export type ReactEventResponderListener<E, C> = {|\\n-  props: Object,\\n-  responder: ReactEventResponder<E, C>,\\n-|};\\n-\\n-export type ReactEventResponder<E, C> = {\\n-  $$typeof: Symbol | number,\\n-  displayName: string,\\n-  targetEventTypes: null | Array<string>,\\n-  targetPortalPropagation: boolean,\\n-  rootEventTypes: null | Array<string>,\\n-  getInitialState: null | ((props: Object) => Object),\\n-  onEvent:\\n-    | null\\n-    | ((event: E, context: C, props: Object, state: Object) => void),\\n-  onRootEvent:\\n-    | null\\n-    | ((event: E, context: C, props: Object, state: Object) => void),\\n-  onMount: null | ((context: C, props: Object, state: Object) => void),\\n-  onUnmount: null | ((context: C, props: Object, state: Object) => void),\\n-  ...\\n-};\\n-\\n export type EventPriority = 0 | 1 | 2;\\n \\n export const DiscreteEvent: EventPriority = 0;"},{"sha":"ad7a9acbdaa8fbd46c14be064786e56f466edc44","filename":"packages/shared/forks/ReactFeatureFlags.native-fb.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.native-fb.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.native-fb.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-fb.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -27,7 +27,6 @@ export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;\\n export const warnAboutDeprecatedLifecycles = true;\\n-export const enableDeprecatedFlareAPI = false;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = false;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"6770510a6a5c0699347b84fdd1994a336ccf216d","filename":"packages/shared/forks/ReactFeatureFlags.native-oss.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.native-oss.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.native-oss.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.native-oss.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n export const enableSchedulerDebugging = false;\\n-export const enableDeprecatedFlareAPI = false;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = false;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"2a84daa9510d8e6a11938077f605e7b4869c3d65","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n export const enableSchedulerDebugging = false;\\n-export const enableDeprecatedFlareAPI = false;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = false;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"4513b441605175bda50c558406ce69d716863808","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.native.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n export const enableSchedulerDebugging = false;\\n-export const enableDeprecatedFlareAPI = false;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = false;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"85e3008dc33bb4f4c9b1d9b235114691e34fe3f1","filename":"packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.test-renderer.www.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const enableSchedulerDebugging = false;\\n export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n-export const enableDeprecatedFlareAPI = true;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = true;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"130179ac35fb3ab7644dae064d46725431a6f9a4","filename":"packages/shared/forks/ReactFeatureFlags.testing.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.testing.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.testing.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const disableJavaScriptURLs = false;\\n export const disableInputAttributeSyncing = false;\\n export const enableSchedulerDebugging = false;\\n-export const enableDeprecatedFlareAPI = false;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = false;\\n export const enableCreateEventHandleAPI = false;"},{"sha":"7c182f1f555103e0f58c7d4425bba2a93990c468","filename":"packages/shared/forks/ReactFeatureFlags.testing.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.testing.www.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.testing.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.testing.www.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -26,7 +26,6 @@ export const enableLazyElements = false;\\n export const disableJavaScriptURLs = true;\\n export const disableInputAttributeSyncing = false;\\n export const enableSchedulerDebugging = false;\\n-export const enableDeprecatedFlareAPI = true;\\n export const enableFundamentalAPI = false;\\n export const enableScopeAPI = true;\\n export const enableCreateEventHandleAPI = true;"},{"sha":"0570d8d01a83af2ce3020467c744e5c959e70413","filename":"packages/shared/forks/ReactFeatureFlags.www.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.www.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/forks/ReactFeatureFlags.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/forks/ReactFeatureFlags.www.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -60,8 +60,6 @@ export const disableJavaScriptURLs = true;\\n \\n export const disableModulePatternComponents = true;\\n \\n-export const enableDeprecatedFlareAPI = true;\\n-\\n export const enableCreateEventHandleAPI = true;\\n \\n export const enableFundamentalAPI = false;"},{"sha":"e433cb374f8bf72988f07c4c5dfba327a26776bb","filename":"packages/shared/isValidElementType.js","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/isValidElementType.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/packages/shared/isValidElementType.js","contents_url":"https://api.github.com/repos/facebook/react/contents/packages/shared/isValidElementType.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -20,7 +20,6 @@ import {\\n   REACT_MEMO_TYPE,\\n   REACT_LAZY_TYPE,\\n   REACT_FUNDAMENTAL_TYPE,\\n-  REACT_RESPONDER_TYPE,\\n   REACT_SCOPE_TYPE,\\n   REACT_BLOCK_TYPE,\\n   REACT_SERVER_BLOCK_TYPE,\\n@@ -55,7 +54,6 @@ export default function isValidElementType(type: mixed) {\\n       type.$$typeof === REACT_CONTEXT_TYPE ||\\n       type.$$typeof === REACT_FORWARD_REF_TYPE ||\\n       type.$$typeof === REACT_FUNDAMENTAL_TYPE ||\\n-      type.$$typeof === REACT_RESPONDER_TYPE ||\\n       type.$$typeof === REACT_BLOCK_TYPE ||\\n       type[(0: any)] === REACT_SERVER_BLOCK_TYPE\\n     ) {"},{"sha":"1cd9becd724f411b42379580100aa82a645df32b","filename":"scripts/error-codes/codes.json","status":"modified","additions":0,"deletions":6,"changes":6,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/error-codes/codes.json","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/error-codes/codes.json","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/error-codes/codes.json?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -322,8 +322,6 @@\\n   \\"321\\": \\"Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\\\\n1. You might have mismatching versions of React and the renderer (such as React DOM)\\\\n2. You might be breaking the Rules of Hooks\\\\n3. You might have more than one copy of React in the same app\\\\nSee https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.\\",\\n   \\"322\\": \\"forwardRef requires a render function but was given %s.\\",\\n   \\"323\\": \\"React has blocked a javascript: URL as a security precaution.\\",\\n-  \\"324\\": \\"An event responder context was used outside of an event cycle. Use context.setTimeout() to use asynchronous responder context outside of event cycle .\\",\\n-  \\"325\\": \\"addRootEventTypes() found a duplicate root event type of \\\\\\"%s\\\\\\". This might be because the event type exists in the event responder \\\\\\"rootEventTypes\\\\\\" array or because of a previous addRootEventTypes() using this root event type.\\",\\n   \\"326\\": \\"Expected a valid priority level\\",\\n   \\"327\\": \\"Should not already be working.\\",\\n   \\"328\\": \\"Should have a work-in-progress.\\",\\n@@ -334,17 +332,13 @@\\n   \\"333\\": \\"This should have a parent host component initialized. This error is likely caused by a bug in React. Please file an issue.\\",\\n   \\"334\\": \\"accumulate(...): Accumulated items must not be null or undefined.\\",\\n   \\"335\\": \\"ReactDOMServer does not yet support the event API.\\",\\n-  \\"336\\": \\"The \\\\\\"%s\\\\\\" event responder cannot be used via the \\\\\\"useEvent\\\\\\" hook.\\",\\n-  \\"337\\": \\"An invalid event responder was provided to host component\\",\\n   \\"338\\": \\"ReactDOMServer does not yet support the fundamental API.\\",\\n-  \\"339\\": \\"An invalid value was used as an event listener. Expect one or many event listeners created via React.unstable_useResponder().\\",\\n   \\"340\\": \\"Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.\\",\\n   \\"341\\": \\"We just came from a parent so we must have had a parent. This is a bug in React.\\",\\n   \\"342\\": \\"A React component suspended while rendering, but no fallback UI was specified.\\\\n\\\\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.\\",\\n   \\"343\\": \\"ReactDOMServer does not yet support scope components.\\",\\n   \\"344\\": \\"Expected prepareToHydrateHostSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.\\",\\n   \\"345\\": \\"Root did not complete. This is a bug in React.\\",\\n-  \\"346\\": \\"An event responder context was used outside of an event cycle.\\",\\n   \\"348\\": \\"ensureListeningTo(): received a container that was not an element node. This is likely a bug in React.\\",\\n   \\"349\\": \\"Expected a work-in-progress root. This is a bug in React. Please file an issue.\\",\\n   \\"350\\": \\"Cannot read from mutable source during the current render without tearing. This is a bug in React. Please file an issue.\\","},{"sha":"de8a70d40be752e57959e28980127cda5c95debe","filename":"scripts/jest/setupTests.www.js","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/jest/setupTests.www.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/jest/setupTests.www.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/jest/setupTests.www.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -16,7 +16,6 @@ jest.mock(\'shared/ReactFeatureFlags\', () => {\\n   wwwFlags.disableLegacyContext = defaultFlags.disableLegacyContext;\\n   wwwFlags.warnAboutUnmockedScheduler = defaultFlags.warnAboutUnmockedScheduler;\\n   wwwFlags.disableJavaScriptURLs = defaultFlags.disableJavaScriptURLs;\\n-  wwwFlags.enableDeprecatedFlareAPI = defaultFlags.enableDeprecatedFlareAPI;\\n \\n   return wwwFlags;\\n });"},{"sha":"803847eccd7d1a2fa0ba6be102c5b86a02a8dbee","filename":"scripts/rollup/build.js","status":"modified","additions":0,"deletions":6,"changes":6,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/rollup/build.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/rollup/build.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/build.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -370,8 +370,6 @@ function getPlugins(\\n     useForks(forks),\\n     // Ensure we don\'t try to bundle any fbjs modules.\\n     forbidFBJSImports(),\\n-    // Replace any externals with their valid internal FB mappings\\n-    isFBWWWBundle && replace(Bundles.fbBundleExternalsMap),\\n     // Use Node resolution mechanism.\\n     resolve({\\n       skip: externals,\\n@@ -564,10 +562,6 @@ async function createBundle(bundle, bundleType) {\\n     const deps = Modules.getDependencies(bundleType, bundle.entry);\\n     externals = externals.concat(deps);\\n   }\\n-  if (isFBWWWBundle) {\\n-    // Add any mapped fb bundle externals\\n-    externals = externals.concat(Object.values(Bundles.fbBundleExternalsMap));\\n-  }\\n \\n   const importSideEffects = Modules.getImportSideEffects();\\n   const pureExternalModules = Object.keys(importSideEffects).filter("},{"sha":"328fb4c626cb71b25dd609012349baf80d4f3922","filename":"scripts/rollup/bundles.js","status":"modified","additions":0,"deletions":68,"changes":68,"blob_url":"https://github.com/facebook/react/blob/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/rollup/bundles.js","raw_url":"https://github.com/facebook/react/raw/b61174fb7b09580c1ec2a8f55e73204b706d2935/scripts/rollup/bundles.js","contents_url":"https://api.github.com/repos/facebook/react/contents/scripts/rollup/bundles.js?ref=b61174fb7b09580c1ec2a8f55e73204b706d2935","patch":"@@ -704,75 +704,8 @@ const bundles = [\\n     global: \'SchedulerTracing\',\\n     externals: [],\\n   },\\n-\\n-  /******* React Events (experimental) *******/\\n-\\n-  {\\n-    bundleTypes: [\\n-      UMD_DEV,\\n-      UMD_PROD,\\n-      NODE_DEV,\\n-      NODE_PROD,\\n-      FB_WWW_DEV,\\n-      FB_WWW_PROD,\\n-    ],\\n-    moduleType: NON_FIBER_RENDERER,\\n-    entry: \'react-interactions/events/context-menu\',\\n-    global: \'ReactEventsContextMenu\',\\n-    externals: [\'react\'],\\n-  },\\n-\\n-  {\\n-    bundleTypes: [\\n-      UMD_DEV,\\n-      UMD_PROD,\\n-      NODE_DEV,\\n-      NODE_PROD,\\n-      FB_WWW_DEV,\\n-      FB_WWW_PROD,\\n-    ],\\n-    moduleType: NON_FIBER_RENDERER,\\n-    entry: \'react-interactions/events/deprecated-focus\',\\n-    global: \'ReactEventsFocus\',\\n-    externals: [\'react\'],\\n-  },\\n-\\n-  {\\n-    bundleTypes: [\\n-      UMD_DEV,\\n-      UMD_PROD,\\n-      NODE_DEV,\\n-      NODE_PROD,\\n-      FB_WWW_DEV,\\n-      FB_WWW_PROD,\\n-    ],\\n-    moduleType: NON_FIBER_RENDERER,\\n-    entry: \'react-interactions/events/hover\',\\n-    global: \'ReactEventsHover\',\\n-    externals: [\'react\'],\\n-  },\\n-\\n-  {\\n-    bundleTypes: [\\n-      UMD_DEV,\\n-      UMD_PROD,\\n-      NODE_DEV,\\n-      NODE_PROD,\\n-      FB_WWW_DEV,\\n-      FB_WWW_PROD,\\n-    ],\\n-    moduleType: NON_FIBER_RENDERER,\\n-    entry: \'react-interactions/events/press-legacy\',\\n-    global: \'ReactEventsPressLegacy\',\\n-    externals: [\'react\'],\\n-  },\\n ];\\n \\n-const fbBundleExternalsMap = {\\n-  \'react-interactions/events/focus\': \'ReactEventsFocus\',\\n-  \'react-interactions/events/tap\': \'ReactEventsTap\',\\n-};\\n-\\n // Based on deep-freeze by substack (public domain)\\n function deepFreeze(o) {\\n   Object.freeze(o);\\n@@ -829,7 +762,6 @@ function getFilename(bundle, bundleType) {\\n }\\n \\n module.exports = {\\n-  fbBundleExternalsMap,\\n   bundleTypes,\\n   moduleTypes,\\n   bundles,"}],"stats":{"total":12450,"additions":125,"deletions":12325}}]')},299:function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o),a=t(30),s=t.n(a),c=(t(175),t(156)),i=t(13),l=t.n(i),d=t(31),p=t(8),u=t(310),f=t(314),b=t(315),h=t(312),m=t(313),v=(t(177),t(178),t(135)),g=t.n(v),E=t(154),y=t(316);function k(e){return new g.a(document.getElementById("canvas"),{type:"bar",data:{labels:null,datasets:[{label:"Number of changes",backgroundColor:"#FFFFFF",data:null}]},options:{legend:{display:!1},title:{display:!0,text:"File Changes"}}})}var R=t(86),T=t.n(R),C=t(136),x=t(179),_=t(298).Octokit,P=null,w=null,D=null,F=[],S=null;function I(e,n,t){var o=function(e){var n=new _;return new Promise((function(t,o){return n.users.getByUsername({username:e}).then((function(){t({value:!0,err:"",val:e,type:"Author"})})).catch((function(n){o({value:!1,err:n,val:e,type:"Author"})}))})).catch((function(e){return e}))}(e),r=function(e,n){var t=new _;return new Promise((function(o,r){return t.request("GET /repos/".concat(e,"/").concat(n)).then((function(){o({value:!0,err:"",val:n,type:"Repository"})})).catch((function(e){console.log(e),r({value:!1,err:e,val:n,type:"Repository"})}))})).catch((function(e){return e}))}(e,n),a=function(e,n,t){var o=new _({auth:t});return o.log=console,new Promise((function(r,a){return o.repos.listCommits({owner:e,repo:n}).then((function(){r({value:!0,err:"",val:t,type:"Authenicator"})})).catch((function(e){a({value:!1,err:e,val:t,type:"Authenicator"})}))})).catch((function(e){return e}))}(e,n,t);return Promise.all([o,r,a]).then((function(e){return console.log(e),e})).catch((function(e){return console.log(e),e}))}function M(){var e=x,n=r.a.createElement("div",{id:"table"},r.a.createElement(O,{commits:e}));return Object(o.useEffect)((function(){return S=k(),function(){}}),[]),r.a.createElement("div",{className:"mainContainer"},n,r.a.createElement("div",null,r.a.createElement("canvas",{id:"canvas"})))}function L(){var e=Object(o.useState)([]),n=Object(p.a)(e,2),t=n[0],a=n[1],s=Object(o.useState)(!1),i=Object(p.a)(s,2),l=i[0],d=i[1];Object(o.useEffect)((function(){var e=w,n=D;return P.repos.listCommits({owner:e,repo:n}).then((function(e){e.data.forEach((function(e){F.push(e.sha)}))})).finally((function(){F.forEach((function(t){P.request("GET /repos/".concat(e,"/").concat(n,"/commits/").concat(t)).then((function(e){var n=e.data;a((function(e){return[].concat(Object(c.a)(e),[{date:T()(n.commit.author.date).format("MMM Do YY"),parents:n.parents,author:n.author.login,files:n.files,stats:n.stats}])}))})).finally((function(){d(!0)})).catch((function(e){console.log(e)}))}))})),S=k(),function(){}}),[]);var u=r.a.createElement("div",{id:"table"},r.a.createElement(O,{commits:t}));return r.a.createElement("div",{className:"mainContainer"},l?u:null,r.a.createElement("div",null,r.a.createElement("canvas",{id:"canvas"})))}function A(e,n){e.current.style.backgroundColor="In"==n?"lightgray":"white"}function j(e,n){!function(e,n){var t=0;e.forEach((function(e){e.changes>t&&(t=e.changes)}));var o=E.a(y.a).domain([0,t]);e.sort((function(e,n){return n.changes-e.changes}));var r=[],a=[],s=[];e.forEach((function(e){e.name.length>20?r.push(e.name.slice(e.name.length-20,e.name.length)):r.push(e.name),a.push(e.changes),s.push(o(e.changes))})),n.data.datasets[0].backgroundColor=s,n.data.datasets[0].data=a,n.data.labels=r,n.update()}(e.files.map((function(e){return{name:e.filename,changes:e.changes}})),S),"gray"==n.current.style.backgroundColor?n.current.style.backgroundColor="darkgray":n.current.style.backgroundColor="gray"}function O(e){var n=Object(C.a)(),t=Object(p.a)(n,2),o=t[0],a=t[1];return r.a.createElement(m.a,null,r.a.createElement(m.a.Header,null,r.a.createElement(m.a.Row,null,r.a.createElement(m.a.HeaderCell,null,"Author"),r.a.createElement(m.a.HeaderCell,null,"Date"),r.a.createElement(m.a.HeaderCell,null,"Changes"),r.a.createElement(m.a.HeaderCell,null,"Additions"),r.a.createElement(m.a.HeaderCell,null,"Deletions"),r.a.createElement(m.a.HeaderCell,null,"Files"))),r.a.createElement(m.a.Body,null,e.commits.map((function(e,n){return r.a.createElement("tr",{key:n,ref:a(n.toString()),onMouseEnter:function(e){return A(o(n.toString()),"In")},onMouseLeave:function(e){return A(o(n.toString()),"Out")},onClick:function(){return j(e,o(n.toString()))}},r.a.createElement(m.a.Cell,null,e.author),r.a.createElement(m.a.Cell,null,e.date),r.a.createElement(m.a.Cell,null,e.stats.total),r.a.createElement(m.a.Cell,null,e.stats.additions),r.a.createElement(m.a.Cell,null,e.stats.deletions),r.a.createElement(m.a.Cell,null,e.files.length))}))))}var B=function(){var e=Object(o.useState)(""),n=Object(p.a)(e,2),t=n[0],a=n[1],s=Object(o.useState)(""),c=Object(p.a)(s,2),i=c[0],m=c[1],v=Object(o.useState)(""),g=Object(p.a)(v,2),E=g[0],y=g[1],k=Object(o.useState)(!1),R=Object(p.a)(k,2),T=R[0],C=R[1],x=Object(o.useState)(null),F=Object(p.a)(x,2),S=F[0],A=F[1],j=Object(o.useState)(!1),O=Object(p.a)(j,2),B=O[0],H=O[1],N=Object(o.useState)(!1),W=Object(p.a)(N,2),U=W[0],V=W[1],q=r.a.createElement("div",{id:"info"},r.a.createElement(u.a,null,r.a.createElement(f.a,null,r.a.createElement(u.a.Field,null,r.a.createElement("label",null,"Author"),r.a.createElement("input",{placeholder:"Ex: facebook",onChange:function(e){return a(e.target.value)}})),r.a.createElement(u.a.Field,null,r.a.createElement("label",null,"Repository"),r.a.createElement("input",{placeholder:"Ex: react",onChange:function(e){return m(e.target.value)}})),r.a.createElement(u.a.Field,null,r.a.createElement("label",null,"Authenicator"),r.a.createElement("input",{placeholder:"Ex: 0e181d0dffd8dd0e6359d......",onChange:function(e){return y(e.target.value)}})),r.a.createElement(b.a,{onClick:Object(d.a)(l.a.mark((function e(){var n,o,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,i,E);case 2:n=e.sent,o=!1,console.log(n),n.forEach((function(e){0==e.value&&(o=!0)})),a=n.filter((function(e){return 0==e.value})).map((function(e){return r.a.createElement("div",null,e.type+": "+e.err.message,r.a.createElement("br",null))})),o?(A(a),H(!0)):(w=n[0].val,D=n[1].val,s=n[2].val,P=new _({auth:s}),C(!0),H(!1));case 8:case"end":return e.stop()}}),e)})))},"Submit")),r.a.createElement(f.a,null,r.a.createElement(f.a.Header,null,"How to get authenticated."),"Unfortunately Github limits the amount of API calls from unauthenticated users so in order for this application to work correctly you need your PAT (Personal Access Token)",r.a.createElement("br",null),r.a.createElement("a",{href:"https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token"},"Github Documentation"),r.a.createElement("br",null),"Perimissions Required:",r.a.createElement(h.a,{as:"ul"},r.a.createElement(h.a.Item,{as:"li"},"repo:status"),r.a.createElement(h.a.Item,{as:"li"},"public_repo"))),B?r.a.createElement(f.a,{negative:!0},r.a.createElement(f.a.Header,{negative:!0},"Errors"),r.a.createElement("p",null,S)):null,r.a.createElement(f.a,null,"Don't wanna make an authenicator just to try it out? Here is an example with just a click of a button!",r.a.createElement("br",null),r.a.createElement(b.a,{onClick:function(){return V(!0)}},"Example"))));return r.a.createElement("div",null,r.a.createElement("h1",{className:"title"},"Repository Viewer"),T?r.a.createElement(L,null):null,U?r.a.createElement(M,null):null,1==T||1==U?null:q)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[170,1,2]]]);
//# sourceMappingURL=main.deac4717.chunk.js.map